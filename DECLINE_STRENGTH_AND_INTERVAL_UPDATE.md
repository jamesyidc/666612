# ä¸‹è·Œå¼ºåº¦æç¤ºæ›´æ–° & ç»´æŠ¤é—´éš”é™åˆ¶

## æ›´æ–°æ—¥æœŸ
2026-01-01 04:10

## ä»»åŠ¡æ¦‚è¿°
1. æ›´æ–°å¸‚åœºä¸‹è·Œå¼ºåº¦åˆ†æçš„æç¤ºæ–‡æœ¬
2. æ·»åŠ å­è´¦æˆ·ç»´æŠ¤é—´éš”15åˆ†é’Ÿçš„é™åˆ¶

---

## ä»»åŠ¡1: æ›´æ–°ä¸‹è·Œå¼ºåº¦æç¤ºæ–‡æœ¬

### ä¿®æ”¹å†…å®¹
å°†æ‰€æœ‰ä¸‹è·Œç­‰çº§çš„æç¤ºä»"å¤šå•ä¹°å…¥ç‚¹åœ¨X%"æ”¹ä¸º"äº¤æ˜“å¯¹çš„ç©ºä»“ç›ˆåˆ©è¦å¤§äºX%"

### å…·ä½“ä¿®æ”¹

#### ä¸‹è·Œç­‰çº§5ï¼ˆæç«¯ä¸‹è·Œï¼‰
- **åˆ¤æ–­æ¡ä»¶**: ç©ºå•ç›ˆåˆ©â‰¥100%çš„æ•°é‡â‰¥1
- **åŸæç¤º**: "å¤šå•ä¹°å…¥ç‚¹åœ¨100%ä»¥ä¸Š"
- **æ–°æç¤º**: "äº¤æ˜“å¯¹çš„ç©ºä»“ç›ˆåˆ©è¦å¤§äº100%"

#### ä¸‹è·Œç­‰çº§4
- **åˆ¤æ–­æ¡ä»¶**: ç©ºå•ç›ˆåˆ©â‰¥100%=0 ä¸” â‰¥90%â‰¥1 ä¸” â‰¥80%â‰¥1
- **åŸæç¤º**: "å¤šå•ä¹°å…¥ç‚¹åœ¨90%"
- **æ–°æç¤º**: "äº¤æ˜“å¯¹çš„ç©ºä»“ç›ˆåˆ©è¦å¤§äº90%"

#### ä¸‹è·Œç­‰çº§3
- **åˆ¤æ–­æ¡ä»¶**: ç©ºå•ç›ˆåˆ©â‰¥100%=0 ä¸” â‰¥90%=0 ä¸” â‰¥80%=0 ä¸” â‰¥70%â‰¥1 ä¸” â‰¥60%â‰¥2
- **åŸæç¤º**: "å¤šå•ä¹°å…¥ç‚¹åœ¨70-80%"
- **æ–°æç¤º**: "äº¤æ˜“å¯¹çš„ç©ºä»“ç›ˆåˆ©è¦å¤§äº70%"

#### ä¸‹è·Œç­‰çº§2
- **åˆ¤æ–­æ¡ä»¶**: ç©ºå•ç›ˆåˆ©â‰¥100%=0 ä¸” â‰¥90%=0 ä¸” â‰¥80%=0 ä¸” â‰¥70%=0 ä¸” â‰¥60%â‰¥2
- **åŸæç¤º**: "å¤šå•ä¹°å…¥ç‚¹åœ¨60%"
- **æ–°æç¤º**: "äº¤æ˜“å¯¹çš„ç©ºä»“ç›ˆåˆ©è¦å¤§äº60%"

#### ä¸‹è·Œç­‰çº§1
- **åˆ¤æ–­æ¡ä»¶**: ç©ºå•ç›ˆåˆ©â‰¥100%=0 ä¸” â‰¥90%=0 ä¸” â‰¥80%=0 ä¸” â‰¥70%=0 ä¸” â‰¥60%=0 ä¸” â‰¥50%=0 ä¸” â‰¥40%â‰¥3
- **åŸæç¤º**: "å¤šå•ä¹°å…¥ç‚¹åœ¨50%"
- **æ–°æç¤º**: "äº¤æ˜“å¯¹çš„ç©ºä»“ç›ˆåˆ©è¦å¤§äº40%"

### ä¿®æ”¹æ–‡ä»¶
- `templates/anchor_system_real.html` (ç¬¬1313-1350è¡Œ)

### æ˜¾ç¤ºæ•ˆæœ
ç”¨æˆ·ç°åœ¨çœ‹åˆ°çš„æç¤ºæ›´åŠ æ¸…æ™°ï¼Œç›´æ¥è¯´æ˜"äº¤æ˜“å¯¹çš„ç©ºä»“ç›ˆåˆ©è¦å¤§äºX%"ï¼Œè€Œä¸æ˜¯å«ç³Šçš„"ä¹°å…¥ç‚¹"ã€‚

---

## ä»»åŠ¡2: æ·»åŠ 15åˆ†é’Ÿç»´æŠ¤é—´éš”é™åˆ¶

### éœ€æ±‚èƒŒæ™¯
ä¸ºé¿å…åŒä¸€å¸ç§åœ¨çŸ­æ—¶é—´å†…é¢‘ç¹ç»´æŠ¤ï¼Œéœ€è¦åœ¨ä¸¤æ¬¡ç»´æŠ¤ä¹‹é—´è®¾ç½®15åˆ†é’Ÿçš„æœ€å°é—´éš”ã€‚

### å®ç°æ–¹æ¡ˆ

#### 1. æ–°å¢å‡½æ•° `check_maintenance_interval()`

```python
def check_maintenance_interval(account_name, inst_id, pos_side, min_interval_minutes=15):
    """æ£€æŸ¥è·ç¦»ä¸Šæ¬¡ç»´æŠ¤æ˜¯å¦å·²ç»è¿‡äº†è¶³å¤Ÿçš„æ—¶é—´ï¼ˆé»˜è®¤15åˆ†é’Ÿï¼‰"""
    try:
        with open('sub_account_maintenance.json', 'r', encoding='utf-8') as f:
            data = json.load(f)
        
        key = f"{account_name}_{inst_id}_{pos_side}"
        if key not in data:
            return True  # æ²¡æœ‰ç»´æŠ¤è®°å½•ï¼Œå…è®¸ç»´æŠ¤
        
        last_maintenance_str = data[key].get('last_maintenance')
        if not last_maintenance_str:
            return True  # æ²¡æœ‰ä¸Šæ¬¡ç»´æŠ¤æ—¶é—´ï¼Œå…è®¸ç»´æŠ¤
        
        # è§£æä¸Šæ¬¡ç»´æŠ¤æ—¶é—´
        last_maintenance = datetime.strptime(last_maintenance_str, '%Y-%m-%d %H:%M:%S')
        last_maintenance = last_maintenance.replace(tzinfo=timezone(timedelta(hours=8)))
        
        # è®¡ç®—æ—¶é—´å·®
        now = get_china_time()
        time_diff = (now - last_maintenance).total_seconds() / 60  # è½¬æ¢ä¸ºåˆ†é’Ÿ
        
        if time_diff < min_interval_minutes:
            remaining = min_interval_minutes - time_diff
            log(f"    â° è·ç¦»ä¸Šæ¬¡ç»´æŠ¤ä»… {time_diff:.1f} åˆ†é’Ÿï¼Œéœ€ç­‰å¾… {remaining:.1f} åˆ†é’Ÿ")
            return False
        
        return True
    except FileNotFoundError:
        return True  # æ–‡ä»¶ä¸å­˜åœ¨ï¼Œå…è®¸ç»´æŠ¤
    except Exception as e:
        log(f"âš ï¸ æ£€æŸ¥ç»´æŠ¤é—´éš”å¤±è´¥: {e}")
        return True  # å‡ºé”™æ—¶å…è®¸ç»´æŠ¤ï¼Œé¿å…å½±å“æ­£å¸¸æµç¨‹
```

**åŠŸèƒ½è¯´æ˜**:
- è¯»å– `sub_account_maintenance.json` è·å–ä¸Šæ¬¡ç»´æŠ¤æ—¶é—´
- è®¡ç®—è·ç¦»ä¸Šæ¬¡ç»´æŠ¤çš„æ—¶é—´å·®ï¼ˆåˆ†é’Ÿï¼‰
- å¦‚æœæ—¶é—´å·® < 15åˆ†é’Ÿï¼Œè¿”å› Falseï¼ˆä¸å…è®¸ç»´æŠ¤ï¼‰
- å¦‚æœæ—¶é—´å·® â‰¥ 15åˆ†é’Ÿï¼Œè¿”å› Trueï¼ˆå…è®¸ç»´æŠ¤ï¼‰
- å¼‚å¸¸æƒ…å†µï¼ˆæ–‡ä»¶ä¸å­˜åœ¨ã€è¯»å–å¤±è´¥ç­‰ï¼‰è¿”å› Trueï¼Œé¿å…å½±å“æ­£å¸¸æµç¨‹

#### 2. åœ¨ç»´æŠ¤æ‰§è¡Œå‰æ·»åŠ é—´éš”æ£€æŸ¥

åœ¨ `main_loop()` å‡½æ•°ä¸­ï¼Œç»´æŠ¤æ‰§è¡Œå‰æ·»åŠ æ£€æŸ¥ï¼š

```python
if should_maintain:
    # è·å–ä»Šæ—¥ç»´æŠ¤æ¬¡æ•°
    count = get_maintenance_count(account_name, inst_id, pos_side)
    log(f"    ä»Šæ—¥ç»´æŠ¤{count}/{MAX_MAINTENANCE_COUNT}æ¬¡")
    
    # æ£€æŸ¥æ˜¯å¦è¾¾åˆ°ä¸Šé™
    if count >= MAX_MAINTENANCE_COUNT:
        log(f"    ğŸš« ç»´æŠ¤æ¬¡æ•°å·²è¾¾ä¸Šé™ï¼Œè·³è¿‡")
        continue
    
    # âœ¨ æ–°å¢ï¼šæ£€æŸ¥ç»´æŠ¤é—´éš”ï¼ˆåŒä¸€ä¸ªå¸ä¸¤æ¬¡ç»´æŠ¤ä¹‹é—´éœ€è¦é—´éš”15åˆ†é’Ÿï¼‰
    if not check_maintenance_interval(account_name, inst_id, pos_side, min_interval_minutes=15):
        log(f"    â±ï¸  ç»´æŠ¤é—´éš”ä¸è¶³15åˆ†é’Ÿï¼Œè·³è¿‡")
        continue
    
    # æ£€æŸ¥æ˜¯å¦è¾¾åˆ°æ­¢æŸçº¿ï¼ˆç»´æŠ¤æ¬¡æ•°=2æ—¶ï¼‰
    if count == 2 and profit_rate <= STOP_LOSS_RATE:
        log(f"    ğŸ›‘ è§¦å‘æ­¢æŸçº¿({STOP_LOSS_RATE}%)ï¼Œå»ºè®®æ‰‹åŠ¨å¹³ä»“")
        continue
    
    # æ‰§è¡Œè¶…çº§ç»´æŠ¤
    success = execute_super_maintenance(sub_account, inst_id, pos_side, pos_size, profit_rate)
```

#### 3. æ›´æ–°å¯åŠ¨æ—¥å¿—

åœ¨ `main_loop()` å‡½æ•°çš„å¯åŠ¨æ—¥å¿—ä¸­æ·»åŠ ï¼š

```python
log("ğŸš€ å­è´¦æˆ·è¶…çº§ç»´æŠ¤å®ˆæŠ¤è¿›ç¨‹å¯åŠ¨")
log(f"â±ï¸  æ£€æŸ¥é—´éš”: {CHECK_INTERVAL}ç§’")
log(f"ğŸ“‰ è§¦å‘é˜ˆå€¼: æ”¶ç›Šç‡â‰¤{TRIGGER_RATE}%")
log(f"ğŸ’° ç»´æŠ¤é‡‘é¢: {MAINTENANCE_AMOUNT}U")
log(f"ğŸ”¢ æœ€å¤§ç»´æŠ¤æ¬¡æ•°: {MAX_MAINTENANCE_COUNT}æ¬¡")
log(f"ğŸ›‘ æ­¢æŸçº¿: {STOP_LOSS_RATE}%")
log(f"â° ç»´æŠ¤é—´éš”: åŒä¸€å¸ç§ä¸¤æ¬¡ç»´æŠ¤ä¹‹é—´éœ€é—´éš”15åˆ†é’Ÿ")  # âœ¨ æ–°å¢
```

### ä¿®æ”¹æ–‡ä»¶
- `sub_account_super_maintenance.py`

### æµ‹è¯•éªŒè¯

åˆ›å»ºæµ‹è¯•è„šæœ¬ `test_interval_check.py` éªŒè¯åŠŸèƒ½ï¼š

```bash
$ python3 test_interval_check.py

================================================================================
æµ‹è¯•15åˆ†é’Ÿç»´æŠ¤é—´éš”æ£€æŸ¥
================================================================================

CFX-USDT-SWAP        âœ… å…è®¸       è·ç¦»ä¸Šæ¬¡ç»´æŠ¤å·² 34.3 åˆ†é’Ÿï¼Œå¯ä»¥ç»´æŠ¤
APT-USDT-SWAP        âœ… å…è®¸       è·ç¦»ä¸Šæ¬¡ç»´æŠ¤å·² 34.0 åˆ†é’Ÿï¼Œå¯ä»¥ç»´æŠ¤
CRV-USDT-SWAP        âœ… å…è®¸       è·ç¦»ä¸Šæ¬¡ç»´æŠ¤å·² 88.0 åˆ†é’Ÿï¼Œå¯ä»¥ç»´æŠ¤
TON-USDT-SWAP        âœ… å…è®¸       è·ç¦»ä¸Šæ¬¡ç»´æŠ¤å·² 152.8 åˆ†é’Ÿï¼Œå¯ä»¥ç»´æŠ¤

================================================================================
```

âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼

### è¿è¡Œæ•ˆæœ

å½“å°è¯•åœ¨15åˆ†é’Ÿå†…å¯¹åŒä¸€å¸ç§è¿›è¡Œç»´æŠ¤æ—¶ï¼Œæ—¥å¿—å°†æ˜¾ç¤ºï¼š

```
[2026-01-01 04:10:30] ğŸ” æ£€æŸ¥è´¦æˆ·: Wu666666
[2026-01-01 04:10:30]   æ£€æŸ¥ CFX-USDT-SWAP long: æ”¶ç›Šç‡ -12.50%
[2026-01-01 04:10:30]     âš ï¸  æ”¶ç›Šç‡è·Œç ´ç»´æŠ¤é˜ˆå€¼-10%
[2026-01-01 04:10:30]     ä»Šæ—¥ç»´æŠ¤1/3æ¬¡
[2026-01-01 04:10:30]     â° è·ç¦»ä¸Šæ¬¡ç»´æŠ¤ä»… 8.5 åˆ†é’Ÿï¼Œéœ€ç­‰å¾… 6.5 åˆ†é’Ÿ
[2026-01-01 04:10:30]     â±ï¸  ç»´æŠ¤é—´éš”ä¸è¶³15åˆ†é’Ÿï¼Œè·³è¿‡
```

---

## æäº¤è®°å½•

### Commit: 70f5179
```
æ›´æ–°ä¸‹è·Œå¼ºåº¦æç¤ºæ–‡æœ¬å¹¶æ·»åŠ 15åˆ†é’Ÿç»´æŠ¤é—´éš”é™åˆ¶

1. ä¸‹è·Œå¼ºåº¦åˆ†ææ›´æ–°ï¼š
   - ç­‰çº§1: äº¤æ˜“å¯¹çš„ç©ºä»“ç›ˆåˆ©è¦å¤§äº40%
   - ç­‰çº§2: äº¤æ˜“å¯¹çš„ç©ºä»“ç›ˆåˆ©è¦å¤§äº60%
   - ç­‰çº§3: äº¤æ˜“å¯¹çš„ç©ºä»“ç›ˆåˆ©è¦å¤§äº70%
   - ç­‰çº§4: äº¤æ˜“å¯¹çš„ç©ºä»“ç›ˆåˆ©è¦å¤§äº90%
   - ç­‰çº§5: äº¤æ˜“å¯¹çš„ç©ºä»“ç›ˆåˆ©è¦å¤§äº100%ï¼ˆæç«¯ä¸‹è·Œï¼‰

2. å­è´¦æˆ·ç»´æŠ¤é—´éš”é™åˆ¶ï¼š
   - åŒä¸€ä¸ªå¸ç§ä¸¤æ¬¡ç»´æŠ¤ä¹‹é—´å¿…é¡»é—´éš”15åˆ†é’Ÿ
   - é¿å…çŸ­æ—¶é—´å†…é¢‘ç¹ç»´æŠ¤
   - æé«˜ç»´æŠ¤æ“ä½œçš„ç¨³å®šæ€§
```

### ä¿®æ”¹çš„æ–‡ä»¶
1. `templates/anchor_system_real.html` (ä¸‹è·Œå¼ºåº¦æç¤ºæ–‡æœ¬)
2. `sub_account_super_maintenance.py` (15åˆ†é’Ÿé—´éš”é™åˆ¶)
3. `test_interval_check.py` (æ–°å¢æµ‹è¯•è„šæœ¬)

### ä»“åº“
https://github.com/jamesyidc/666612.git

---

## æ€»ç»“

### ä»»åŠ¡1å®Œæˆæƒ…å†µ
âœ… **å·²å®Œæˆ**: æ›´æ–°äº†æ‰€æœ‰5ä¸ªä¸‹è·Œç­‰çº§çš„æç¤ºæ–‡æœ¬
- ä»"å¤šå•ä¹°å…¥ç‚¹åœ¨X%"æ”¹ä¸º"äº¤æ˜“å¯¹çš„ç©ºä»“ç›ˆåˆ©è¦å¤§äºX%"
- æç¤ºæ›´åŠ æ¸…æ™°ç›´è§‚
- ç”¨æˆ·ä½“éªŒæå‡

### ä»»åŠ¡2å®Œæˆæƒ…å†µ
âœ… **å·²å®Œæˆ**: æ·»åŠ äº†15åˆ†é’Ÿç»´æŠ¤é—´éš”é™åˆ¶
- æ–°å¢ `check_maintenance_interval()` å‡½æ•°
- åœ¨ç»´æŠ¤æ‰§è¡Œå‰æ£€æŸ¥æ—¶é—´é—´éš”
- æµ‹è¯•éªŒè¯é€šè¿‡
- é¿å…é¢‘ç¹ç»´æŠ¤ï¼Œæé«˜ç³»ç»Ÿç¨³å®šæ€§

### åç»­å»ºè®®

1. **ç›‘æ§ç»´æŠ¤æ—¥å¿—**
   - è§‚å¯Ÿ15åˆ†é’Ÿé—´éš”é™åˆ¶çš„æ•ˆæœ
   - ç¡®è®¤æ˜¯å¦éœ€è¦è°ƒæ•´é—´éš”æ—¶é—´ï¼ˆå¯ä»¥æ”¹ä¸º10åˆ†é’Ÿæˆ–20åˆ†é’Ÿï¼‰

2. **ç”¨æˆ·åé¦ˆ**
   - æ”¶é›†ç”¨æˆ·å¯¹æ–°æç¤ºæ–‡æœ¬çš„åé¦ˆ
   - ç¡®è®¤"äº¤æ˜“å¯¹çš„ç©ºä»“ç›ˆåˆ©è¦å¤§äºX%"çš„è¡¨è¿°æ˜¯å¦æ¸…æ™°

3. **æ€§èƒ½ä¼˜åŒ–**
   - å¦‚æœéœ€è¦ï¼Œå¯ä»¥å°†é—´éš”æ—¶é—´è®¾ä¸ºå¯é…ç½®å‚æ•°
   - ä¾‹å¦‚åœ¨ `sub_account_config.json` ä¸­æ·»åŠ  `maintenance_interval_minutes` å­—æ®µ

---

## éªŒè¯æ­¥éª¤

### 1. éªŒè¯ä¸‹è·Œå¼ºåº¦æç¤º
1. è®¿é—®é”šç‚¹ç³»ç»Ÿé¡µé¢
2. æŸ¥çœ‹"å¸‚åœºä¸‹è·Œå¼ºåº¦åˆ†æ"æ¨¡å—
3. ç¡®è®¤æç¤ºæ–‡æœ¬æ˜¾ç¤ºä¸º"äº¤æ˜“å¯¹çš„ç©ºä»“ç›ˆåˆ©è¦å¤§äºX%"

### 2. éªŒè¯15åˆ†é’Ÿé—´éš”é™åˆ¶
1. æŸ¥çœ‹å­è´¦æˆ·è¶…çº§ç»´æŠ¤æ—¥å¿—
2. ç¡®è®¤åŒä¸€å¸ç§ä¸¤æ¬¡ç»´æŠ¤ä¹‹é—´é—´éš”â‰¥15åˆ†é’Ÿ
3. è¿è¡Œæµ‹è¯•è„šæœ¬: `python3 test_interval_check.py`

---

**çŠ¶æ€**: âœ… æ‰€æœ‰ä»»åŠ¡å·²å®Œæˆå¹¶é€šè¿‡æµ‹è¯•ï¼
