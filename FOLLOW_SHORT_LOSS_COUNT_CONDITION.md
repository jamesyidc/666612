# è·Ÿç©ºå•äºæŸå¼€å• - å¢åŠ è®¡æ¬¡æ¡ä»¶

## åŠŸèƒ½è¯´æ˜
åœ¨"è·Ÿç©ºå•äºæŸå¼€å•"åŠŸèƒ½ä¸­ï¼Œå¢åŠ **è®¡æ¬¡ >= 3**çš„æ¡ä»¶åˆ¤æ–­ã€‚

åªæœ‰åŒæ—¶æ»¡è¶³ä»¥ä¸‹æ‰€æœ‰æ¡ä»¶æ—¶ï¼Œæ‰ä¼šè§¦å‘è·Ÿç©ºå•äºæŸå¼€å•ï¼š
1. âœ… ä¸»è´¦å·ç©ºå•äºæŸ
2. âœ… å­è´¦å·æœªæŒæœ‰è¯¥å¸ç§
3. âœ… è·Ÿç©ºå•äºæŸå¼€å•å¼€å…³å·²å¯ç”¨
4. âœ… **ä¸‹è·Œå¼ºåº¦ç­‰çº§ >= 5**
5. âœ… **è®¡æ¬¡ >= 3**ï¼ˆæ–°å¢ï¼‰

## ä¿®æ”¹æ—¶é—´
**2026-01-04 13:10:00**

---

## ä¿®æ”¹å†…å®¹

### ä¿®æ”¹æ–‡ä»¶
`sub_account_opener_daemon.py`

### 1. ä¿®æ”¹ get_market_strength() å‡½æ•°

#### å¢åŠ è®¡æ¬¡æ•°æ®è·å–
```python
# è·å–è®¡æ¬¡æ•°æ®
count = 0
try:
    count_url = f"{MAIN_API_URL}/api/latest"
    count_response = requests.get(count_url, timeout=10)
    if count_response.status_code == 200:
        count_data = count_response.json()
        count = count_data.get('count', 0)
except Exception as e:
    print(f"   âš ï¸ è·å–è®¡æ¬¡å¤±è´¥: {e}")

return {
    'decline_level': decline_level,
    'rise_level': rise_level,
    'count': count  # æ–°å¢
}
```

### 2. ä¿®æ”¹ç©ºå•äºæŸå¼€å•é€»è¾‘

#### ä¿®æ”¹å‰ âŒ
```python
if pos_side == 'short':
    # ç©ºå•äºæŸéœ€è¦ä¸‹è·Œå¼ºåº¦>=5
    if market_strength['decline_level'] < 5:
        print(f"   âš ï¸ ä¸‹è·Œå¼ºåº¦ç­‰çº§{market_strength['decline_level']}ä¸è¶³ï¼ˆéœ€è¦>=5ï¼‰ï¼Œè·³è¿‡ {inst_id} {pos_side}")
        continue
    else:
        print(f"   âœ… ä¸‹è·Œå¼ºåº¦ç­‰çº§{market_strength['decline_level']}æ»¡è¶³æ¡ä»¶ï¼ˆ>=5ï¼‰")
```

#### ä¿®æ”¹å âœ…
```python
if pos_side == 'short':
    # ç©ºå•äºæŸéœ€è¦ä¸‹è·Œå¼ºåº¦>=5 ä¸” è®¡æ¬¡>=3
    if market_strength['decline_level'] < 5:
        print(f"   âš ï¸ ä¸‹è·Œå¼ºåº¦ç­‰çº§{market_strength['decline_level']}ä¸è¶³ï¼ˆéœ€è¦>=5ï¼‰ï¼Œè·³è¿‡ {inst_id} {pos_side}")
        continue
    elif market_strength['count'] < 3:
        print(f"   âš ï¸ è®¡æ¬¡{market_strength['count']}ä¸è¶³ï¼ˆéœ€è¦>=3ï¼‰ï¼Œè·³è¿‡ {inst_id} {pos_side}")
        continue
    else:
        print(f"   âœ… ä¸‹è·Œå¼ºåº¦ç­‰çº§{market_strength['decline_level']}æ»¡è¶³æ¡ä»¶ï¼ˆ>=5ï¼‰ï¼Œè®¡æ¬¡{market_strength['count']}æ»¡è¶³æ¡ä»¶ï¼ˆ>=3ï¼‰")
```

---

## åŠŸèƒ½é€»è¾‘

### å®Œæ•´åˆ¤æ–­æµç¨‹

```
å¼€å§‹
  â†“
1. æ£€æŸ¥ä¸»è´¦å·æ˜¯å¦æœ‰äºæŸçš„ç©ºå•ï¼Ÿ
   â””â”€ å¦ â†’ è·³è¿‡
   â””â”€ æ˜¯ â†“
  
2. æ£€æŸ¥å­è´¦å·æ˜¯å¦å·²æŒæœ‰è¯¥å¸ç§ï¼Ÿ
   â””â”€ æ˜¯ â†’ è·³è¿‡ï¼ˆå·²æœ‰ä»“ä½ï¼‰
   â””â”€ å¦ â†“
  
3. æ£€æŸ¥è·Ÿç©ºå•äºæŸå¼€å•å¼€å…³æ˜¯å¦å¯ç”¨ï¼Ÿ
   â””â”€ å¦ â†’ è·³è¿‡ï¼ˆåŠŸèƒ½æœªå¯ç”¨ï¼‰
   â””â”€ æ˜¯ â†“
  
4. æ£€æŸ¥ä¸‹è·Œå¼ºåº¦ç­‰çº§æ˜¯å¦ >= 5ï¼Ÿ
   â””â”€ å¦ â†’ è·³è¿‡ï¼ˆä¸‹è·Œå¼ºåº¦ä¸è¶³ï¼‰
   â””â”€ æ˜¯ â†“
  
5. æ£€æŸ¥è®¡æ¬¡æ˜¯å¦ >= 3ï¼Ÿ â† ã€æ–°å¢æ¡ä»¶ã€‘
   â””â”€ å¦ â†’ è·³è¿‡ï¼ˆè®¡æ¬¡ä¸è¶³ï¼‰
   â””â”€ æ˜¯ â†“
  
6. æ£€æŸ¥æ˜¯å¦ä¼šè¶…è¿‡æœ€å¤§æŒä»“é™åˆ¶ï¼Ÿ
   â””â”€ æ˜¯ â†’ è·³è¿‡ï¼ˆæŒä»“å·²æ»¡ï¼‰
   â””â”€ å¦ â†“
  
7. âœ… è§¦å‘å¼€å•ï¼šåœ¨å­è´¦å·å¼€10Uç©ºå•
```

---

## æ¡ä»¶è¯¦è§£

### æ–°å¢æ¡ä»¶ï¼šè®¡æ¬¡ >= 3

#### æ•°æ®æ¥æº
- **API**: `/api/latest`
- **å­—æ®µ**: `count`
- **ç¤ºä¾‹æ•°æ®**:
  ```json
  {
    "snapshot_time": "2026-01-04 11:47:00",
    "count": 1,
    "rush_up": 9,
    "rush_down": 4,
    "status": "éœ‡è¡æ— åº"
  }
  ```

#### åˆ¤æ–­æ ‡å‡†
| è®¡æ¬¡å€¼ | æ˜¯å¦è§¦å‘ | è¯´æ˜ |
|--------|----------|------|
| 0 | âŒ å¦ | è®¡æ¬¡ä¸è¶³ |
| 1 | âŒ å¦ | è®¡æ¬¡ä¸è¶³ |
| 2 | âŒ å¦ | è®¡æ¬¡ä¸è¶³ |
| 3 | âœ… æ˜¯ | æ»¡è¶³æ¡ä»¶ |
| 4+ | âœ… æ˜¯ | æ»¡è¶³æ¡ä»¶ |

#### è®¡æ¬¡å«ä¹‰
- **è®¡æ¬¡**ï¼šå¸‚åœºæ³¢åŠ¨çš„ç´¯è®¡æ¬¡æ•°
- **è®¡æ¬¡ >= 3**ï¼šè¡¨ç¤ºå¸‚åœºå·²ç»æœ‰äº†è¶³å¤Ÿçš„æ³¢åŠ¨
- **ç›®çš„**ï¼šé¿å…åœ¨å¸‚åœºæ³¢åŠ¨ä¸å……åˆ†æ—¶è¿‡æ—©å¼€å•

---

## æ—¥å¿—è¾“å‡º

### åœºæ™¯1ï¼šè®¡æ¬¡ä¸è¶³
```
âš ï¸ è®¡æ¬¡1ä¸è¶³ï¼ˆéœ€è¦>=3ï¼‰ï¼Œè·³è¿‡ SOL-USDT-SWAP short
```

### åœºæ™¯2ï¼šä¸‹è·Œå¼ºåº¦ä¸è¶³
```
âš ï¸ ä¸‹è·Œå¼ºåº¦ç­‰çº§3ä¸è¶³ï¼ˆéœ€è¦>=5ï¼‰ï¼Œè·³è¿‡ BTC-USDT-SWAP short
```

### åœºæ™¯3ï¼šæ¡ä»¶å…¨éƒ¨æ»¡è¶³
```
âœ… ä¸‹è·Œå¼ºåº¦ç­‰çº§5æ»¡è¶³æ¡ä»¶ï¼ˆ>=5ï¼‰ï¼Œè®¡æ¬¡3æ»¡è¶³æ¡ä»¶ï¼ˆ>=3ï¼‰
ğŸš€ å‡†å¤‡å¼€ä»“ 10U...
âœ… å¼€ä»“æˆåŠŸ: ETH-USDT-SWAP short 10U
```

---

## ä½¿ç”¨åœºæ™¯

### åœºæ™¯Aï¼šå¸‚åœºåˆæœŸæ³¢åŠ¨ï¼ˆè®¡æ¬¡=1ï¼‰
```
çŠ¶æ€ï¼š
- ä¸»è´¦å·ç©ºå•äºæŸï¼šæ˜¯
- ä¸‹è·Œå¼ºåº¦ï¼š5çº§
- è®¡æ¬¡ï¼š1

ç»“æœï¼šâŒ ä¸è§¦å‘å¼€å•
åŸå› ï¼šè®¡æ¬¡ä¸è¶³ï¼ˆéœ€è¦>=3ï¼‰
```

### åœºæ™¯Bï¼šå¸‚åœºå……åˆ†æ³¢åŠ¨ï¼ˆè®¡æ¬¡=3ï¼‰
```
çŠ¶æ€ï¼š
- ä¸»è´¦å·ç©ºå•äºæŸï¼šæ˜¯
- ä¸‹è·Œå¼ºåº¦ï¼š5çº§
- è®¡æ¬¡ï¼š3

ç»“æœï¼šâœ… è§¦å‘å¼€å•
åŸå› ï¼šæ‰€æœ‰æ¡ä»¶æ»¡è¶³
```

### åœºæ™¯Cï¼šä¸‹è·Œå¼ºåº¦ä¸è¶³
```
çŠ¶æ€ï¼š
- ä¸»è´¦å·ç©ºå•äºæŸï¼šæ˜¯
- ä¸‹è·Œå¼ºåº¦ï¼š3çº§
- è®¡æ¬¡ï¼š5

ç»“æœï¼šâŒ ä¸è§¦å‘å¼€å•
åŸå› ï¼šä¸‹è·Œå¼ºåº¦ä¸è¶³ï¼ˆéœ€è¦>=5ï¼‰
```

---

## é…ç½®è¯´æ˜

### å¯ç”¨è·Ÿç©ºå•äºæŸå¼€å•

#### 1. åœ¨å®ç›˜é”šç‚¹ç³»ç»Ÿé¡µé¢å¯ç”¨
```
è·¯å¾„ï¼š
é¦–é¡µ â†’ å®ç›˜é”šç‚¹ç³»ç»Ÿ â†’ å­è´¦æˆ·é…ç½® â†’ è·Ÿç©ºå•äºæŸ

æ“ä½œï¼š
å‹¾é€‰"è·Ÿç©ºå•äºæŸ"å¼€å…³
```

#### 2. APIé…ç½®
```bash
curl -X POST http://localhost:5000/api/sub-account/config \
  -H "Content-Type: application/json" \
  -d '{
    "follow_short_loss_enabled": true
  }'
```

#### 3. é…ç½®æ–‡ä»¶
æ–‡ä»¶ï¼š`config/sub_account_config.json`
```json
{
  "follow_short_loss_enabled": true,
  "follow_long_loss_enabled": false
}
```

---

## Git æäº¤è®°å½•

### Commit
```
e6f0c49 - feat: è·Ÿç©ºå•äºæŸå¼€å•å¢åŠ è®¡æ¬¡>=3çš„æ¡ä»¶
```

### ä¿®æ”¹ç»Ÿè®¡
```
2 files changed, 23 insertions(+), 8 deletions(-)
```

### GitHub
https://github.com/jamesyidc/666612.git

---

## æµ‹è¯•æ–¹æ³•

### 1. æ£€æŸ¥å½“å‰è®¡æ¬¡
```bash
curl -s http://localhost:5000/api/latest | python3 -c "import json, sys; data = json.load(sys.stdin); print(f'è®¡æ¬¡: {data.get(\"count\", 0)}')"
```

### 2. æ£€æŸ¥æœåŠ¡æ—¥å¿—
```bash
pm2 logs sub-account-opener --lines 50
```

### 3. æ¨¡æ‹Ÿæµ‹è¯•

#### æµ‹è¯•åœºæ™¯1ï¼šè®¡æ¬¡ä¸è¶³
```
å‡†å¤‡ï¼š
1. ç¡®ä¿ä¸»è´¦å·æœ‰ç©ºå•äºæŸ
2. ç¡®ä¿è®¡æ¬¡ < 3

é¢„æœŸæ—¥å¿—ï¼š
âš ï¸ è®¡æ¬¡1ä¸è¶³ï¼ˆéœ€è¦>=3ï¼‰ï¼Œè·³è¿‡ XXX-USDT-SWAP short
```

#### æµ‹è¯•åœºæ™¯2ï¼šè®¡æ¬¡æ»¡è¶³
```
å‡†å¤‡ï¼š
1. ç¡®ä¿ä¸»è´¦å·æœ‰ç©ºå•äºæŸ
2. ç¡®ä¿è®¡æ¬¡ >= 3
3. ç¡®ä¿ä¸‹è·Œå¼ºåº¦ >= 5

é¢„æœŸæ—¥å¿—ï¼š
âœ… ä¸‹è·Œå¼ºåº¦ç­‰çº§5æ»¡è¶³æ¡ä»¶ï¼ˆ>=5ï¼‰ï¼Œè®¡æ¬¡3æ»¡è¶³æ¡ä»¶ï¼ˆ>=3ï¼‰
ğŸš€ å‡†å¤‡å¼€ä»“ 10U...
```

---

## ç›¸å…³æœåŠ¡

### å­è´¦æˆ·å¼€ä»“æœåŠ¡
- **è¿›ç¨‹å**: `sub-account-opener`
- **æ£€æŸ¥é¢‘ç‡**: 60ç§’/æ¬¡
- **ä¸»è¦åŠŸèƒ½**: ç›‘æ§ä¸»è´¦å·äºæŸä»“ä½ï¼Œè‡ªåŠ¨åœ¨å­è´¦å·å¼€ä»“

### ç›¸å…³API
- `/api/latest` - è·å–æœ€æ–°è®¡æ¬¡æ•°æ®
- `/api/anchor/decline-strength` - è·å–ä¸‹è·Œå¼ºåº¦
- `/api/anchor-system/current-positions` - è·å–ä¸»è´¦å·æŒä»“

### ç®¡ç†å‘½ä»¤
```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
pm2 status sub-account-opener

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
pm2 logs sub-account-opener

# é‡å¯æœåŠ¡
pm2 restart sub-account-opener

# åœæ­¢æœåŠ¡
pm2 stop sub-account-opener
```

---

## ç³»ç»ŸçŠ¶æ€

### å½“å‰çŠ¶æ€
- ğŸŸ¢ **æœåŠ¡è¿è¡Œ**: æ­£å¸¸
- ğŸŸ¢ **è®¡æ¬¡è·å–**: æ­£å¸¸
- ğŸŸ¢ **æ¡ä»¶åˆ¤æ–­**: å·²å¯ç”¨
- ğŸŸ¢ **æ—¥å¿—è¾“å‡º**: æ­£å¸¸

### PM2è¿›ç¨‹
```bash
pm2 status | grep sub-account-opener
```

| è¿›ç¨‹ | çŠ¶æ€ | é‡å¯æ¬¡æ•° |
|------|------|----------|
| sub-account-opener | online | 3 |

---

## æ³¨æ„äº‹é¡¹

### 1. è®¡æ¬¡æ•°æ®å®æ—¶æ€§
- è®¡æ¬¡æ•°æ®æ¯åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡
- å¦‚æœæ•°æ®è¶…è¿‡20åˆ†é’Ÿæœªæ›´æ–°ï¼Œä¼šæ˜¾ç¤º"è¶…æ—¶"
- ç¡®ä¿ `escape-stats-recorder` æœåŠ¡æ­£å¸¸è¿è¡Œ

### 2. å¤šé‡æ¡ä»¶åˆ¤æ–­
- æ‰€æœ‰æ¡ä»¶å¿…é¡»åŒæ—¶æ»¡è¶³
- ä»»ä¸€æ¡ä»¶ä¸æ»¡è¶³éƒ½ä¼šè·³è¿‡å¼€å•
- å»ºè®®åœ¨å¸‚åœºæ³¢åŠ¨å……åˆ†æ—¶æ‰å¯ç”¨

### 3. é£é™©æ§åˆ¶
- è®¡æ¬¡ >= 3 å¢åŠ äº†å¼€å•é—¨æ§›
- å‡å°‘äº†åœ¨å¸‚åœºåˆæœŸæ³¢åŠ¨æ—¶çš„è¯¯è§¦å‘
- æé«˜äº†å¼€å•çš„å‡†ç¡®æ€§

### 4. é…ç½®æ£€æŸ¥
- ç¡®ä¿"è·Ÿç©ºå•äºæŸå¼€å•"å¼€å…³å·²å¯ç”¨
- æ£€æŸ¥å­è´¦å·çš„æœ€å¤§æŒä»“é™åˆ¶
- ç¡®è®¤å­è´¦å·ä½™é¢å……è¶³ï¼ˆè‡³å°‘10Uï¼‰

---

## ä¼˜åŠ¿åˆ†æ

### ä¿®æ”¹å‰
```
è§¦å‘æ¡ä»¶ï¼š
1. ä¸»è´¦å·ç©ºå•äºæŸ
2. ä¸‹è·Œå¼ºåº¦ >= 5

é—®é¢˜ï¼š
- å¯èƒ½åœ¨å¸‚åœºæ³¢åŠ¨åˆæœŸå°±è§¦å‘
- å¼€å•æ—¶æœºå¯èƒ½è¿‡æ—©
```

### ä¿®æ”¹å
```
è§¦å‘æ¡ä»¶ï¼š
1. ä¸»è´¦å·ç©ºå•äºæŸ
2. ä¸‹è·Œå¼ºåº¦ >= 5
3. è®¡æ¬¡ >= 3 â† æ–°å¢

ä¼˜åŠ¿ï¼š
- âœ… ç¡®ä¿å¸‚åœºå·²æœ‰è¶³å¤Ÿæ³¢åŠ¨
- âœ… å‡å°‘è¯¯è§¦å‘
- âœ… æé«˜å¼€å•å‡†ç¡®æ€§
- âœ… æ›´å¥½çš„é£é™©æ§åˆ¶
```

---

## æœªæ¥ä¼˜åŒ–æ–¹å‘

### 1. å¯é…ç½®çš„è®¡æ¬¡é˜ˆå€¼
```python
# ä»é…ç½®è¯»å–è®¡æ¬¡é˜ˆå€¼
count_threshold = config.get('count_threshold', 3)

if market_strength['count'] < count_threshold:
    print(f"   âš ï¸ è®¡æ¬¡{market_strength['count']}ä¸è¶³ï¼ˆéœ€è¦>={count_threshold}ï¼‰ï¼Œè·³è¿‡")
```

### 2. åŠ¨æ€è°ƒæ•´é˜ˆå€¼
```python
# æ ¹æ®å¸‚åœºçŠ¶å†µåŠ¨æ€è°ƒæ•´
if market_strength['decline_level'] >= 6:
    count_threshold = 2  # ä¸‹è·Œå¼ºåº¦å¾ˆé«˜æ—¶ï¼Œé™ä½è®¡æ¬¡è¦æ±‚
else:
    count_threshold = 3  # æ­£å¸¸æƒ…å†µ
```

### 3. å¢åŠ è®¡æ¬¡è¶‹åŠ¿åˆ¤æ–­
```python
# åˆ¤æ–­è®¡æ¬¡æ˜¯å¦åœ¨ä¸Šå‡
if current_count > previous_count:
    print("   âœ… è®¡æ¬¡ä¸Šå‡è¶‹åŠ¿ï¼Œå¸‚åœºæ³¢åŠ¨å¢å¼º")
```

---

## ä¿®å¤å®Œæˆæ—¶é—´
**2026-01-04 13:10:00**

## ä¿®å¤äººå‘˜
Claude AI Assistant

## æ–‡æ¡£ç‰ˆæœ¬
v1.0

---

**âœ… è·Ÿç©ºå•äºæŸå¼€å•åŠŸèƒ½å·²ä¼˜åŒ–ï¼å¢åŠ è®¡æ¬¡>=3æ¡ä»¶ï¼Œæé«˜å¼€å•å‡†ç¡®æ€§ï¼**
