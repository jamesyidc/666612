# 逃顶信号系统 - 全局趋势图功能说明

## 功能概述
为逃顶信号系统添加了全局趋势图，展示24小时内所有币种的逃顶信号汇总统计。

## 新增功能

### 1. 全局趋势图
**位置**: 统计卡片和按币种趋势图之间

**展示内容**:
- **柱状图**: 每个时间点的逃顶信号数量
- **实线**: 所有币种的平均逃顶分数
- **虚线**: 所有币种的最高逃顶分数
- **阈值线**: 红色实线标记逃顶阈值（分数=8）

**图表特点**:
1. **双Y轴设计**
   - 左侧Y轴：信号数量
   - 右侧Y轴：逃顶分数

2. **交互式Tooltip**
   - 显示时间点
   - 显示信号数量、平均分数、最高分数
   - 列出该时间点所有达到逃顶阈值的币种及其分数

3. **视觉效果**
   - 柱状图：渐变色（黄色到橙色）
   - 平均分数线：蓝色
   - 最高分数线：红色虚线
   - 透明背景与系统整体风格一致

### 2. 数据统计逻辑
- 按时间点汇总所有币种的逃顶信号
- 计算每个时间点的：
  - 信号总数（有几个币种触发）
  - 平均逃顶分数
  - 最高逃顶分数
  - 达到阈值的币种列表

### 3. 自动更新
- 随主数据一起更新（每60秒）
- 与按币种趋势图同步刷新

## 页面布局
```
┌──────────────────────────────────────┐
│        逃顶信号系统标题                │
├──────────────────────────────────────┤
│  统计卡片（4个）                      │
├──────────────────────────────────────┤
│  📈 全局趋势图（新增）                │
│  - 24小时所有币种汇总                 │
│  - 柱状图+双折线图                    │
├──────────────────────────────────────┤
│  📊 按币种趋势图（原有）              │
│  - 每个币种单独曲线                   │
├──────────────────────────────────────┤
│  📋 逃顶信号详情表格                  │
└──────────────────────────────────────┘
```

## 技术实现

### 前端修改
**文件**: `templates/escape_top_signals.html`

1. **HTML结构**
   - 添加 `globalTrendChart` div容器
   - 高度：400px
   - 位置：在原有趋势图之前

2. **JavaScript函数**
   - `initChart()`: 初始化全局趋势图的ECharts实例
   - `updateGlobalTrendChart(data)`: 处理数据并更新图表
   - `loadData()`: 添加对全局趋势图的更新调用

3. **数据处理流程**
   ```javascript
   原始数据 -> 按时间汇总 -> 计算统计值 -> 生成ECharts配置 -> 渲染图表
   ```

## 访问地址
- **逃顶信号页面**: https://5000-ifbgdsngd9an7si2g7jy0-5634da27.sandbox.novita.ai/escape-top-signals
- **主系统入口**: https://5000-ifbgdsngd9an7si2g7jy0-5634da27.sandbox.novita.ai

## 使用说明

1. **查看全局趋势**
   - 打开逃顶信号页面
   - 在统计卡片下方即可看到全局趋势图
   - 鼠标悬停查看详细信息

2. **理解图表**
   - 柱状图高度表示该时间点有多少个币种触发信号
   - 蓝色线显示所有币种的平均逃顶分数
   - 红色虚线显示最高分数，判断市场整体逃顶强度
   - 分数超过8的横线表示触发逃顶警告

3. **对比分析**
   - 全局趋势图：看整体市场的逃顶压力
   - 按币种图：看具体哪些币种有问题

## 代码变更记录

### Commit: 455c3a8
**提交信息**: Add global trend chart to escape top signals page
**修改文件**: 
- `templates/escape_top_signals.html` (+180 行)

**主要变更**:
1. 添加全局趋势图HTML容器
2. 初始化globalTrendChart ECharts实例
3. 实现updateGlobalTrendChart()函数
4. 集成到loadData()更新流程

## 系统状态
- ✅ Flask应用已重启
- ✅ 全局趋势图已添加
- ✅ 功能测试通过
- ✅ PM2配置已保存
- ✅ Git提交已完成

## 下一步优化建议

1. **时间范围筛选**
   - 添加时间范围选择器（1h/6h/12h/24h）
   - 全局趋势图响应筛选器变化

2. **高级统计**
   - 添加逃顶信号密度热力图
   - 显示高危时段标记

3. **告警集成**
   - 当全局最高分数超过阈值时高亮显示
   - 添加全局逃顶强度指标

4. **数据导出**
   - 支持导出全局趋势数据为CSV
   - 生成趋势分析报告

---
**文档创建时间**: 2025-12-30
**功能版本**: v1.0
**状态**: ✅ 已部署生产环境
