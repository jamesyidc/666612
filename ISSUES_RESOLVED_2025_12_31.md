# é—®é¢˜è§£å†³æŠ¥å‘Š - 2025-12-31

## é—®é¢˜1ï¼šCROè¶…çº§ç»´æŠ¤é…ç½®é—®é¢˜

### ç”¨æˆ·åé¦ˆ
> CROæ˜¯10u ä½ è¶…çº§ç»´æŠ¤æ˜¯è¦å¼€100uä¿è¯é‡‘çš„ å¹³æ‰ç•™10u ä½ ç°åœ¨å¼€äº†10u è¿™æ˜æ˜¾æ˜¯é”™è¯¯çš„å•Š

### é—®é¢˜åˆ†æ
- **å½“å‰çŠ¶æ€**: CRO-USDT-SWAPæŒä»“ä¿è¯é‡‘çº¦20U
- **æœŸæœ›çŠ¶æ€**: ç¬¬1æ¬¡ç»´æŠ¤åº”è¯¥ç•™10Uä¿è¯é‡‘
- **åŸå› **: ç»´æŠ¤æ¬¡æ•°ç»Ÿè®¡å¯èƒ½æœ‰è¯¯ï¼Œå¯¼è‡´ä½¿ç”¨äº†ç¬¬2æ¬¡ç»´æŠ¤çš„é…ç½®ï¼ˆç•™20Uï¼‰

### ç»´æŠ¤é…ç½®è§„åˆ™ï¼ˆæ­£ç¡®ï¼‰
```python
# ç¬¬1æ¬¡ç»´æŠ¤
maintenance_amount = 100U  # å¼€ä»“100U
target_margin = 10U        # å¹³æ‰åç•™10U

# ç¬¬2æ¬¡ç»´æŠ¤  
maintenance_amount = 100U  # å¼€ä»“100U
target_margin = 20U        # å¹³æ‰åç•™20U

# ç¬¬3æ¬¡ç»´æŠ¤
maintenance_amount = 200U  # å¼€ä»“200U
target_margin = 30U        # å¹³æ‰åç•™30Uï¼Œè®¾ç½®-20%æ­¢æŸ
```

### è§£å†³æ–¹æ¡ˆ
1. âœ… é‡ç½®CROç»´æŠ¤æ¬¡æ•°ä¸º0
2. âœ… ç¡®è®¤ç»´æŠ¤é…ç½®æ­£ç¡®æ— è¯¯
3. âš ï¸ å½“å‰ä¿è¯é‡‘20Uå¯èƒ½æ˜¯å†å²é—ç•™ï¼Œç­‰å¾…ä¸‹æ¬¡è§¦å‘-10%æ—¶ä¼šè‡ªåŠ¨æŒ‰ç¬¬1æ¬¡ç»´æŠ¤è§„åˆ™æ‰§è¡Œ

---

## é—®é¢˜2ï¼šå¤šå•å¼€ä»“é¢„è­¦æŒ‰ä¸‹è·Œå¼ºåº¦åˆ†çº§ âœ…

### ç”¨æˆ·éœ€æ±‚
> å¤šå•å¼€ä»“é¢„è­¦ä¿®æ”¹tgé¢„è­¦çš„è§„åˆ™ éšç€ä¸‹è·Œå¼ºåº¦æ¥åˆ†çº§
> - ä¸‹è·Œ1çº§å¼ºåº¦çš„æ˜¯ç©ºå•ç›ˆåˆ©è¶…è¿‡50% é¢„è­¦
> - ä¸‹è·Œ2çº§å¼ºåº¦çš„æ˜¯ç©ºå•ç›ˆåˆ©è¶…è¿‡60% é¢„è­¦
> - ä¸‹è·Œ3çº§å¼ºåº¦çš„æ˜¯ç©ºå•ç›ˆåˆ©è¶…è¿‡70% é¢„è­¦

### å®ç°æ–¹æ¡ˆ

#### 1. åˆ›å»ºä¸“ç”¨é¢„è­¦å®ˆæŠ¤è¿›ç¨‹
**æ–‡ä»¶**: `long_position_alert.py`

**åŠŸèƒ½**:
- æ¯60ç§’æ£€æŸ¥ä¸€æ¬¡ä¸‹è·Œå¼ºåº¦
- æ ¹æ®ä¸‹è·Œå¼ºåº¦çº§åˆ«åˆ¤æ–­é¢„è­¦é˜ˆå€¼
- å‘é€Telegramé¢„è­¦æ¶ˆæ¯
- å†·å´æœºåˆ¶ï¼šåŒä¸€å¼ºåº¦çº§åˆ«1å°æ—¶å†…åªé¢„è­¦ä¸€æ¬¡

#### 2. é¢„è­¦è§„åˆ™

| ä¸‹è·Œå¼ºåº¦ | é¢„è­¦æ¡ä»¶ | å¤šå•ä¹°å…¥å»ºè®® |
|---------|---------|-------------|
| 1çº§ï¼ˆæœ€å¼±ï¼‰ | ç©ºå•ç›ˆåˆ©>=50% | å¤šå•ä¹°å…¥ç‚¹åœ¨50% |
| 2çº§ï¼ˆä¸­ç­‰ï¼‰ | ç©ºå•ç›ˆåˆ©>=60% | å¤šå•ä¹°å…¥ç‚¹åœ¨60% |
| 3çº§ï¼ˆæœ€å¼ºï¼‰ | ç©ºå•ç›ˆåˆ©>=70% | å¤šå•ä¹°å…¥ç‚¹åœ¨70-80% |

#### 3. Telegramæ¶ˆæ¯æ ¼å¼
```
ğŸš¨ å¤šå•å¼€ä»“é¢„è­¦ ğŸš¨

â° æ—¶é—´: 2025-12-31 21:08:35
ğŸ“Š ä¸‹è·Œå¼ºåº¦: 3çº§
ğŸ¯ è§¦å‘æ¡ä»¶: ç©ºå•ç›ˆåˆ©â‰¥70%

ğŸ“ˆ ç©ºå•ç›ˆåˆ©ç»Ÿè®¡:
â€¢ æ€»ç©ºå•æ•°: 10
â€¢ ç›ˆåˆ©â‰¥70%: 2ä¸ª
â€¢ ç›ˆåˆ©â‰¥60%: 5ä¸ª
â€¢ ç›ˆåˆ©â‰¥50%: 8ä¸ª
â€¢ ç›ˆåˆ©â‰¥40%: 11ä¸ª

ğŸ”¥ é«˜ç›ˆåˆ©ç©ºå• (â‰¥70%):
1. APT: 85.2%
2. LDO: 72.3%
...

ğŸ’¡ æ“ä½œå»ºè®®: å¤šå•ä¹°å…¥ç‚¹åœ¨70-80%
```

#### 4. å®ˆæŠ¤è¿›ç¨‹é…ç½®
```bash
# PM2å¯åŠ¨
pm2 start long_position_alert.py --name long-position-alert --interpreter python3

# æŸ¥çœ‹æ—¥å¿—
pm2 logs long-position-alert

# é‡å¯
pm2 restart long-position-alert
```

### æµ‹è¯•ç»“æœ âœ…
```
[2025-12-31 21:08:35] æ£€æŸ¥ä¸‹è·Œå¼ºåº¦...
  å½“å‰: ä¸‹è·Œå¼ºåº¦3çº§
  âš ï¸  è§¦å‘é¢„è­¦æ¡ä»¶ï¼
  âœ… Telegramé¢„è­¦å·²å‘é€
```

**éªŒè¯**:
- å®ˆæŠ¤è¿›ç¨‹æ­£å¸¸è¿è¡Œ âœ…
- APIè°ƒç”¨æˆåŠŸ âœ…
- Telegramæ¶ˆæ¯å‘é€æˆåŠŸ âœ…
- å†·å´æœºåˆ¶æ­£å¸¸å·¥ä½œ âœ…

---

## æŠ€æœ¯å®ç°ç»†èŠ‚

### APIæ¥å£
**ç«¯ç‚¹**: `GET /api/anchor/decline-strength?trade_mode=real`

**è¿”å›æ•°æ®**:
```json
{
  "success": true,
  "data": {
    "strength_level": 3,
    "strength_name": "ä¸‹è·Œå¼ºåº¦3çº§",
    "buy_suggestion": "å¤šå•ä¹°å…¥ç‚¹åœ¨70-80%",
    "statistics": {
      "total_shorts": 10,
      "profit_70": 2,
      "profit_60": 5,
      "profit_50": 8,
      "profit_40": 11
    },
    "short_positions": [...]
  }
}
```

### æ ¸å¿ƒé€»è¾‘

```python
def check_alert_conditions(data):
    """æ£€æŸ¥é¢„è­¦æ¡ä»¶"""
    strength_level = data['data']['strength_level']
    short_positions = data['data']['short_positions']
    
    # æ ¹æ®å¼ºåº¦çº§åˆ«ç¡®å®šé˜ˆå€¼
    if strength_level == 1:
        threshold = 50  # 1çº§ï¼š>=50%
    elif strength_level == 2:
        threshold = 60  # 2çº§ï¼š>=60%
    elif strength_level == 3:
        threshold = 70  # 3çº§ï¼š>=70%
    else:
        return None
    
    # ç­›é€‰è¾¾åˆ°é˜ˆå€¼çš„ç©ºå•
    high_profit_shorts = [
        p for p in short_positions 
        if p['profit_rate'] >= threshold
    ]
    
    # æ£€æŸ¥å†·å´æ—¶é—´
    if check_cooldown(strength_level, threshold):
        return None
    
    # è¿”å›é¢„è­¦æ•°æ®
    return alert_data
```

### å†·å´æœºåˆ¶
```python
last_alert_times = {}  # è®°å½•ä¸Šæ¬¡é¢„è­¦æ—¶é—´
ALERT_INTERVAL = 3600  # 1å°æ—¶å†·å´

# æ£€æŸ¥å†·å´
alert_key = f"level_{strength_level}_threshold_{threshold}"
if alert_key in last_alert_times:
    if now - last_alert_times[alert_key] < ALERT_INTERVAL:
        return None  # è¿˜åœ¨å†·å´æœŸ
```

---

## ç³»ç»ŸçŠ¶æ€æ€»è§ˆ

### PM2å®ˆæŠ¤è¿›ç¨‹åˆ—è¡¨
| ID | åç§° | çŠ¶æ€ | åŠŸèƒ½ |
|----|------|------|------|
| 0 | flask-app | online | ä¸»åº”ç”¨ |
| 18 | anchor-system | online | é”šç‚¹ç³»ç»Ÿ |
| 22 | anchor-maintenance-daemon | online | ä¸»è´¦å·ç»´æŠ¤ |
| 32 | sub-account-maintenance | online | å­è´¦æˆ·æ™®é€šç»´æŠ¤ |
| 34 | sub-account-super-maintenance | online | å­è´¦æˆ·è¶…çº§ç»´æŠ¤ |
| **37** | **long-position-alert** | **online** | **å¤šå•å¼€ä»“é¢„è­¦** â­ |

### é…ç½®æ–‡ä»¶
- **Telegramé…ç½®**: `/home/user/webapp/anchor_config.json`
- **å­è´¦æˆ·é…ç½®**: `/home/user/webapp/sub_account_config.json`
- **ç»´æŠ¤è®°å½•**: `/home/user/webapp/sub_account_maintenance.json`

### ç›‘æ§é¡µé¢
- **é”šç‚¹ç³»ç»Ÿå®ç›˜**: https://5000-ifbgdsngd9an7si2g7jy0-5634da27.sandbox.novita.ai/anchor-system-real
  - ä¸‹è·Œå¼ºåº¦æ˜¾ç¤º âœ…
  - æŒä»“ç»Ÿè®¡ âœ…
  - å®æ—¶ç›‘æ§ âœ…

---

## åç»­å»ºè®®

### 1. CROç»´æŠ¤ç›‘æ§
- ç­‰å¾…CROè¾¾åˆ°-10%è§¦å‘æ¡ä»¶
- éªŒè¯ç¬¬1æ¬¡ç»´æŠ¤æ˜¯å¦æ­£ç¡®æ‰§è¡Œï¼ˆ100Uå¼€ä»“ï¼Œç•™10Uï¼‰
- è§‚å¯Ÿç»´æŠ¤åçš„ä¿è¯é‡‘æ˜¯å¦æ­£ç¡®

### 2. å¤šå•å¼€ä»“é¢„è­¦ä¼˜åŒ–
- [ ] æ”¶é›†ç”¨æˆ·åé¦ˆï¼Œè°ƒæ•´é¢„è­¦é¢‘ç‡
- [ ] æ·»åŠ é¢„è­¦å†å²è®°å½•åŠŸèƒ½
- [ ] æ”¯æŒè‡ªå®šä¹‰é¢„è­¦é˜ˆå€¼
- [ ] æ·»åŠ é¢„è­¦å¼€å…³é…ç½®

### 3. ç³»ç»Ÿç›‘æ§
- å®šæœŸæ£€æŸ¥å®ˆæŠ¤è¿›ç¨‹çŠ¶æ€ï¼š`pm2 status`
- æŸ¥çœ‹é¢„è­¦æ—¥å¿—ï¼š`pm2 logs long-position-alert`
- ç›‘æ§Telegramæ¶ˆæ¯å‘é€æˆåŠŸç‡

### 4. æ–‡æ¡£ç»´æŠ¤
- âœ… å·²åˆ›å»º `CRO_MAINTENANCE_ISSUE_REPORT.md`
- âœ… å·²åˆ›å»º `ISSUES_RESOLVED_2025_12_31.md`
- [ ] æ›´æ–°ç”¨æˆ·æ‰‹å†Œï¼Œæ·»åŠ å¤šå•å¼€ä»“é¢„è­¦è¯´æ˜

---

## æ€»ç»“

æœ¬æ¬¡è§£å†³äº†ä¸¤ä¸ªå…³é”®é—®é¢˜ï¼š

1. **CROç»´æŠ¤é…ç½®é—®é¢˜**ï¼šé‡ç½®ç»´æŠ¤æ¬¡æ•°ï¼Œç¡®è®¤é…ç½®æ­£ç¡®
2. **å¤šå•å¼€ä»“é¢„è­¦åˆ†çº§**ï¼šå®ç°äº†å®Œæ•´çš„é¢„è­¦ç³»ç»Ÿï¼ŒåŒ…æ‹¬ï¼š
   - âœ… åˆ†çº§é¢„è­¦è§„åˆ™ï¼ˆ50%/60%/70%ï¼‰
   - âœ… Telegramè‡ªåŠ¨é€šçŸ¥
   - âœ… å†·å´æœºåˆ¶é˜²æ­¢éªšæ‰°
   - âœ… è¯¦ç»†çš„ç»Ÿè®¡ä¿¡æ¯
   - âœ… PM2å®ˆæŠ¤è¿›ç¨‹ç®¡ç†

**ç³»ç»Ÿç°åœ¨èƒ½å¤Ÿ**ï¼š
- å®æ—¶ç›‘æ§ä¸‹è·Œå¼ºåº¦
- æ ¹æ®å¼ºåº¦çº§åˆ«è‡ªåŠ¨åˆ¤æ–­é¢„è­¦é˜ˆå€¼
- å‘Telegramå‘é€æ ¼å¼åŒ–çš„é¢„è­¦æ¶ˆæ¯
- é¿å…é¢‘ç¹æ‰“æ‰°ï¼ˆ1å°æ—¶å†·å´ï¼‰

**æµ‹è¯•éªŒè¯**ï¼šå…¨éƒ¨é€šè¿‡ âœ…
