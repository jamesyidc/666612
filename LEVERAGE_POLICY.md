# 交易模式管理政策

## 🎯 核心原则

1. **所有交易必须使用10倍杠杆，不允许使用其他杠杆倍数。**
2. **所有交易必须使用全仓模式(cross)，不允许使用逐仓模式(isolated)。**

### 为什么要使用全仓模式？

**问题**: 如果同一个币种有多个逐仓持仓，OKEx会分开显示，无法自动合并。

**示例**: CRV有两个多单持仓
- CRV 21个（全仓模式）
- CRV 26个（逐仓模式）← 无法自动合并

**解决方案**: 统一使用全仓模式，相同币种、相同方向的持仓会自动合并！

## ✅ 已实施的措施

### 1. 代码层面
- ✅ 所有交易API调用都硬编码为10倍杠杆
- ✅ 维护锚点单功能使用10倍杠杆
- ✅ 锚点系统使用10倍杠杆

### 2. 自动修正
已创建 `fix_leverage.py` 脚本，用于：
- 检查所有持仓的杠杆倍数
- 自动将非10倍杠杆的持仓修改为10倍
- 生成检查报告

### 3. 使用方法

#### 手动运行检查
```bash
cd /home/user/webapp
python3 fix_leverage.py
```

#### 定期自动检查（建议）
可以通过PM2定期运行：
```bash
pm2 start fix_leverage.py --name leverage-checker --cron "0 */6 * * *"
```
这将每6小时自动检查一次。

## 📊 当前状态

截至最后检查时间：2025-12-30 21:45

### 杠杆倍数
- ✅ 所有16个持仓都是10倍杠杆

### 保证金模式
- ⚠️ **全仓持仓**: 1个
- ⚠️ **逐仓持仓**: 15个（需要逐步转换）

**问题**: 大部分持仓使用逐仓模式，导致相同币种的持仓被分散显示。

**解决中**: 
- ✅ 已修改代码，所有新开仓位都使用全仓模式
- 🔄 旧的逐仓持仓将在平仓后自然消失
- 📝 不建议立即强制平仓转换（避免影响盈利持仓）

## ⚠️ 注意事项

1. **手动操作风险**：如果在OKEx网页或其他地方手动开仓，请确保选择10倍杠杆
2. **第三方工具**：如果使用其他交易机器人或工具，请配置为10倍杠杆
3. **定期检查**：建议每天检查一次杠杆倍数

## 🔧 技术细节

### OKEx API调用
```python
# 修改杠杆倍数
leverage_body = {
    'instId': 'CRV-USDT-SWAP',
    'lever': '10',
    'mgnMode': 'cross',
    'posSide': 'long'
}
```

### 查询当前杠杆
```python
positions = okex_api.get_positions()
for pos in positions:
    print(f"{pos['instId']}: {pos['lever']}x")
```

## 📝 变更历史

- **2025-12-30 21:35**: 创建杠杆管理政策文档
- **2025-12-30 21:30**: 修正所有持仓为10倍杠杆
- **2025-12-30 21:25**: 创建自动修正脚本

---

**重要提醒**：如果发现任何非10倍杠杆的持仓，请立即运行 `fix_leverage.py` 进行修正！
