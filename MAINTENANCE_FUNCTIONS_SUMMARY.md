# 所有维护函数汇总

## 📋 **维护函数列表**

### 1️⃣ **子账户维护**

| 函数名 | 路径 | 状态 | 说明 |
|--------|------|------|------|
| `maintain_sub_account()` | `/api/anchor/maintain-sub-account` | ⚠️ 需修改 | 先开仓再平仓（有问题） |

**问题**：
- 逐仓模式，先开仓会保证金不足
- 错误：51008 - Insufficient USDT margin

**解决方案**：
- 已测试：先平仓 → 再开仓 ✅ 成功
- 需要修改app_new.py中的函数

---

### 2️⃣ **主账号维护**

| 函数名 | 路径 | 状态 | 说明 |
|--------|------|------|------|
| `super_maintain_anchor_order()` | `/api/anchor/super-maintain` | ⚠️ 待测试 | 先开仓再平仓（可能有问题） |
| `maintain_anchor_order()` | `/api/anchor/maintain-anchor` | ⚠️ 待检查 | 需要查看完整逻辑 |

**问题**：
- 主账号也是逐仓模式
- 可能也会遇到保证金不足的问题

**建议**：
- 测试主账号超级维护
- 如果失败，也改成先平仓再开仓

---

## 🔧 **修改优先级**

### 高优先级 ✅
1. ✅ **子账户超级维护** - 已测试成功，需要修改代码
2. ⚠️  **主账户超级维护** - 需要测试并可能修改

### 中优先级
3. ⚠️  **主账户维护** - 需要查看完整逻辑

---

## 📝 **待办事项**

### ✅ 已完成
- [x] 分析子账户维护问题
- [x] 测试新逻辑（先平仓再开仓）
- [x] 验证APT维护成功

### ⏳ 进行中
- [ ] 修改 `maintain_sub_account()` 函数
- [ ] 测试主账户超级维护
- [ ] 检查主账户维护函数

### 📅 待开始
- [ ] 统一所有维护函数的逻辑
- [ ] 完整测试所有维护功能
- [ ] 更新文档

---

## 🎯 **统一方案**

**所有维护函数统一采用：**
```
1. 先平仓（释放保证金）
2. 等待3秒
3. 再开仓（使用释放的保证金）
4. 纠错机制调整到目标保证金
```

**优势**：
- ✅ 避免保证金不足
- ✅ 逻辑统一，易于维护
- ✅ 适用于逐仓和全仓模式
- ✅ 无需手动充值

---

**下一步**：
1. 修改子账户维护函数
2. 测试主账户维护函数
3. 统一所有维护逻辑
