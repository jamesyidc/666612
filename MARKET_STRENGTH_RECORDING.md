# å¸‚åœºå¼ºåº¦è®°å½•åŠŸèƒ½å®ç°æ–‡æ¡£

## ğŸ“‹ ä»»åŠ¡æ¦‚è¿°

åœ¨é€ƒé¡¶ä¿¡å·ç»Ÿè®¡ç³»ç»Ÿä¸­æ·»åŠ å¸‚åœºå¼ºåº¦ç­‰çº§è®°å½•åŠŸèƒ½ï¼Œå®æ—¶è®°å½•"ä¸‹è·Œå¼ºåº¦ç­‰çº§"å’Œ"ä¸Šæ¶¨å¼ºåº¦ç­‰çº§"ã€‚

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. åˆ›å»ºå¸‚åœºå¼ºåº¦ç»¼åˆAPI

**æ–‡ä»¶**: `app_new.py`
**APIç«¯ç‚¹**: `/api/anchor/market-strength`

è¿™ä¸ªæ–°çš„APIç«¯ç‚¹åŒæ—¶è¿”å›ï¼š
- **ä¸‹è·Œå¼ºåº¦ç­‰çº§** (decline_strength): åŸºäºç©ºå•ç›ˆåˆ©æƒ…å†µ
  - ç­‰çº§0-5ï¼šå¸‚åœºæ­£å¸¸ â†’ æç«¯ä¸‹è·Œ
  - ç»Ÿè®¡å„æ”¶ç›ŠåŒºé—´çš„ç©ºå•æ•°é‡ï¼ˆ40%, 50%, 60%, 70%, 80%, 90%, 100%ï¼‰
  
- **ä¸Šæ¶¨å¼ºåº¦ç­‰çº§** (rise_strength): åŸºäºç©ºå•äºæŸæ•°é‡
  - ç­‰çº§0-5ï¼šå¸‚åœºæ­£å¸¸ â†’ æç«¯é€¼ç©ºé˜¶æ®µ
  - ç»Ÿè®¡äºæŸè¶…è¿‡10%çš„ç©ºå•æ•°é‡

**APIå“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "data": {
    "decline_strength": {
      "level": 0,
      "name": "å¸‚åœºæ­£å¸¸",
      "statistics": {
        "total_shorts": 17,
        "profit_100": 0,
        "profit_90": 0,
        "profit_80": 0,
        "profit_70": 0,
        "profit_60": 0,
        "profit_50": 0,
        "profit_40": 0
      }
    },
    "rise_strength": {
      "level": 0,
      "name": "å¸‚åœºæ­£å¸¸",
      "short_loss_count": 0
    }
  }
}
```

### 2. æ•°æ®åº“è¡¨ç»“æ„æ›´æ–°

#### escape_snapshot_stats è¡¨
- å·²æ·»åŠ å­—æ®µï¼š
  - `decline_strength_level` (INTEGER, DEFAULT 0)
  - `rise_strength_level` (INTEGER, DEFAULT 0)

#### escape_signal_stats è¡¨
- å·²æ·»åŠ å­—æ®µï¼š
  - `decline_strength_level` (INTEGER, DEFAULT 0)
  - `rise_strength_level` (INTEGER, DEFAULT 0)
  - `max_signal_24h` (INTEGER, DEFAULT 0)
  - `max_signal_2h` (INTEGER, DEFAULT 0)

### 3. æ•°æ®è®°å½•è„šæœ¬æ›´æ–°

#### escape_stats_recorder.py
- **åŠŸèƒ½**: è®°å½•é€ƒé¡¶å¿«ç…§ç»Ÿè®¡ï¼ˆåŸºäºé€ƒé¡¶äº‹ä»¶æ•°é‡ï¼‰
- **è®°å½•é—´éš”**: æ¯60ç§’
- **æ•°æ®æ¥æº**: support_resistance.db çš„ support_resistance_snapshots è¡¨
- **ç›®æ ‡è¡¨**: crypto_data.db çš„ escape_snapshot_stats è¡¨
- **å·²æ›´æ–°**: ä½¿ç”¨æ–°çš„ `/api/anchor/market-strength` API è·å–å¸‚åœºå¼ºåº¦

#### escape_signal_recorder.py
- **åŠŸèƒ½**: è®°å½•é€ƒé¡¶ä¿¡å·æ•°ç»Ÿè®¡ï¼ˆåŸºäºscenario_3 + scenario_4ï¼‰
- **è®°å½•é—´éš”**: æ¯60ç§’
- **æ•°æ®æ¥æº**: support_resistance.db çš„ support_resistance_snapshots è¡¨
- **ç›®æ ‡è¡¨**: crypto_data.db çš„ escape_signal_stats è¡¨
- **å·²æ›´æ–°**: ä½¿ç”¨æ–°çš„ `/api/anchor/market-strength` API è·å–å¸‚åœºå¼ºåº¦
- **å·²å¯åŠ¨**: å·²åŠ å…¥PM2è¿›ç¨‹ç®¡ç†

### 4. å‰ç«¯è¡¨æ ¼æ›´æ–°

**æ–‡ä»¶**: `templates/escape_stats_history.html`

å·²ä¿®æ”¹è¡¨æ ¼æ˜¾ç¤ºï¼š
- æ·»åŠ "ä¸‹è·Œç­‰çº§"åˆ—
- æ·»åŠ "ä¸Šæ¶¨å¼ºåº¦"åˆ—
- æ›´æ–°"æš‚æ— æ•°æ®"çš„åˆ—æ•°ä»4åˆ—æ”¹ä¸º6åˆ—

**è¡¨æ ¼ç»“æ„**:
```
| è®°å½•æ—¶é—´ | 24å°æ—¶ä¿¡å·æ•° | 2å°æ—¶ä¿¡å·æ•° | ä¸‹è·Œç­‰çº§ | ä¸Šæ¶¨å¼ºåº¦ | çŠ¶æ€ |
```

### 5. PM2è¿›ç¨‹ç®¡ç†

å·²å¯åŠ¨çš„è¿›ç¨‹ï¼š
- `escape-stats-recorder`: é€ƒé¡¶å¿«ç…§ç»Ÿè®¡è®°å½•å™¨ âœ…
- `escape-signal-recorder`: é€ƒé¡¶ä¿¡å·æ•°è®°å½•å™¨ âœ…

å·²æ‰§è¡Œ `pm2 save` ä¿å­˜é…ç½®ã€‚

## ğŸ“Š æ•°æ®æµç¨‹

```
1. é”šç‚¹ç³»ç»Ÿ OKEx API
   â†“
2. /api/anchor/market-strength API
   â†“ (æ¯60ç§’)
3. escape_stats_recorder.py / escape_signal_recorder.py
   â†“
4. SQLiteæ•°æ®åº“ (crypto_data.db)
   - escape_snapshot_stats è¡¨
   - escape_signal_stats è¡¨
   â†“
5. /api/support-resistance/escape-stats-history API
   â†“
6. å‰ç«¯é¡µé¢æ˜¾ç¤º (escape_stats_history.html)
```

## ğŸ” æ•°æ®éªŒè¯

### æœ€æ–°è®°å½•ç¤ºä¾‹

**escape_signal_stats è¡¨**:
```
æ—¶é—´: 2026-01-03 11:52:31
24Hä¿¡å·: 12955, 2Hä¿¡å·: 1723
ä¸‹è·Œå¼ºåº¦: 0, ä¸Šæ¶¨å¼ºåº¦: 0
Max24H: 12955, Max2H: 1723
```

**escape_snapshot_stats è¡¨**:
```
æ—¶é—´: 2026-01-03 11:52:40
24Hå¿«ç…§: 1086, 2Hå¿«ç…§: 548
ä¸‹è·Œå¼ºåº¦: 0, ä¸Šæ¶¨å¼ºåº¦: 0
```

## ğŸŒ è®¿é—®åœ°å€

- **é€ƒé¡¶ç»Ÿè®¡é¡µé¢**: https://5000-ifbgdsngd9an7si2g7jy0-5634da27.sandbox.novita.ai/escape-stats-history
- **é”šç‚¹ç³»ç»Ÿé¡µé¢**: https://5000-ifbgdsngd9an7si2g7jy0-5634da27.sandbox.novita.ai/anchor-system-real

## ğŸ“ å¼ºåº¦ç­‰çº§è¯´æ˜

### ä¸‹è·Œå¼ºåº¦ç­‰çº§ï¼ˆåŸºäºç©ºå•ç›ˆåˆ©ï¼‰
- **ç­‰çº§5**: ç©ºå•ç›ˆåˆ©â‰¥100% (æç«¯ä¸‹è·Œ)
- **ç­‰çº§4**: ç©ºå•ç›ˆåˆ©â‰¥90% ä¸” â‰¥80% (è¶…é«˜å¼ºåº¦ä¸‹è·Œ)
- **ç­‰çº§3**: ç©ºå•ç›ˆåˆ©â‰¥70% ä¸” â‰¥60%Ã—2 (é«˜å¼ºåº¦ä¸‹è·Œ)
- **ç­‰çº§2**: ç©ºå•ç›ˆåˆ©â‰¥60%Ã—2 (ä¸­ç­‰å¼ºåº¦ä¸‹è·Œ)
- **ç­‰çº§1**: ç©ºå•ç›ˆåˆ©â‰¥40%Ã—3 (è½»å¾®ä¸‹è·Œ)
- **ç­‰çº§0**: å…¶ä»–æƒ…å†µ (å¸‚åœºæ­£å¸¸)

### ä¸Šæ¶¨å¼ºåº¦ç­‰çº§ï¼ˆåŸºäºç©ºå•äºæŸï¼‰
- **ç­‰çº§5**: ç©ºå•äºæŸâ‰¥10ä¸ª (æç«¯é€¼ç©ºé˜¶æ®µ)
- **ç­‰çº§4**: ç©ºå•äºæŸâ‰¥8ä¸ª (åŠ é€Ÿèµ¶é¡¶)
- **ç­‰çº§3**: ç©ºå•äºæŸâ‰¥5ä¸ª (é˜¶æ®µæ€§åŠ é€Ÿ)
- **ç­‰çº§2**: ç©ºå•äºæŸâ‰¥4ä¸ª (åŠ é€Ÿé˜¶æ®µ)
- **ç­‰çº§1**: ç©ºå•äºæŸâ‰¥2ä¸ª (èµ·æ¶¨é˜¶æ®µ)
- **ç­‰çº§0**: å…¶ä»–æƒ…å†µ (å¸‚åœºæ­£å¸¸)

## ğŸ”§ æŠ€æœ¯å®ç°

### APIè·¯ç”±
```python
@app.route('/api/anchor/market-strength', methods=['GET'])
def get_market_strength():
    """è·å–å¸‚åœºå¼ºåº¦ï¼ˆåŒ…æ‹¬ä¸‹è·Œç­‰çº§å’Œä¸Šæ¶¨å¼ºåº¦ï¼‰"""
    # ä» OKEx API è·å–å®ç›˜æŒä»“
    # ç»Ÿè®¡ç©ºå•ç›ˆåˆ©å’Œç©ºå•äºæŸ
    # è®¡ç®—ä¸‹è·Œå¼ºåº¦å’Œä¸Šæ¶¨å¼ºåº¦
    # è¿”å›ç»¼åˆæ•°æ®
```

### è®°å½•è„šæœ¬
```python
def get_market_strength():
    """ä»APIè·å–å¸‚åœºå¼ºåº¦ç­‰çº§"""
    response = requests.get('http://localhost:5000/api/anchor/market-strength')
    # è¿”å› (decline_level, rise_level)
```

## âœ¨ åŠŸèƒ½ç‰¹ç‚¹

1. **å®æ—¶æ›´æ–°**: æ¯åˆ†é’Ÿè‡ªåŠ¨è®°å½•ä¸€æ¬¡å¸‚åœºå¼ºåº¦
2. **åŒè¡¨å­˜å‚¨**: åŒæ—¶ç»´æŠ¤ä¸¤ä¸ªç»Ÿè®¡è¡¨ï¼Œæä¾›ä¸åŒç»´åº¦çš„æ•°æ®
3. **APIé›†æˆ**: ç›´æ¥è°ƒç”¨é”šç‚¹ç³»ç»Ÿçš„æŒä»“æ•°æ®
4. **å®¹é”™æœºåˆ¶**: APIè°ƒç”¨å¤±è´¥æ—¶ä½¿ç”¨é»˜è®¤å€¼0ï¼Œä¸ä¸­æ–­è®°å½•
5. **è¿›ç¨‹ç®¡ç†**: ä½¿ç”¨PM2ç¡®ä¿æœåŠ¡ç¨³å®šè¿è¡Œ

## ğŸ“… å®Œæˆæ—¶é—´

2026-01-03 11:53 UTC

## ğŸš€ åç»­ä¼˜åŒ–å»ºè®®

1. æ·»åŠ å¸‚åœºå¼ºåº¦ç­‰çº§çš„å†å²è¶‹åŠ¿å›¾è¡¨
2. æ·»åŠ å¸‚åœºå¼ºåº¦ç­‰çº§å˜åŒ–çš„å‘Šè­¦åŠŸèƒ½
3. åœ¨å‰ç«¯æ˜¾ç¤ºæ›´è¯¦ç»†çš„ç»Ÿè®¡ä¿¡æ¯
4. æ·»åŠ å¸‚åœºå¼ºåº¦ç­‰çº§çš„é¢„æµ‹åŠŸèƒ½
5. æ”¯æŒå¯¼å‡ºåŒ…å«å¸‚åœºå¼ºåº¦çš„CSVæŠ¥å‘Š

---

**æ³¨æ„**: æ‰€æœ‰æ—¶é—´å‡ä¸ºåŒ—äº¬æ—¶é—´ï¼ˆAsia/Shanghaiï¼‰
