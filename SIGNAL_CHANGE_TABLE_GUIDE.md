# 📊 支撑阻力信号变化记录表 - 功能说明

## 🎯 功能概述

在实盘锚点系统页面添加了"支撑阻力信号变化记录"表格，实时展示最近30条信号数据的1分钟变化情况。

---

## 📍 显示位置

**页面**: `/anchor-system-real` (实盘锚点系统)  
**位置**: "当前预警"卡片和"历史极值记录"卡片之间

---

## 📋 表格列说明

### 表头结构
```
┌──────────────┬────────────────┬────────┬────────────────┬────────┬──────┬──────┬──────┬──────┐
│ 时间         │ 24小时顶信号   │ 变化   │ 2小时底信号    │ 变化   │ 情况1│ 情况2│ 情况3│ 情况4│
└──────────────┴────────────────┴────────┴────────────────┴────────┴──────┴──────┴──────┴──────┘
```

### 列详细说明

1. **时间**
   - 格式：`YYYY-MM-DD HH:MM:SS`
   - 说明：信号数据的抓取时间
   - 样式：加粗显示，黑色

2. **24小时顶信号**
   - 数值：情况3 + 情况4
   - 说明：进入顶部阻力区的币种数量
   - 样式：加粗，大号字体，红色 (#dc2626)

3. **变化** (顶信号)
   - 计算：当前顶信号 - 上一条记录的顶信号
   - 显示格式：
     - `+N` (红色) - 增加了N个币种
     - `-N` (绿色) - 减少了N个币种
     - `0` (灰色) - 无变化

4. **2小时底信号**
   - 数值：情况1 + 情况2
   - 说明：进入底部支撑区的币种数量
   - 样式：加粗，大号字体，橙色 (#f59e0b)

5. **变化** (底信号)
   - 计算：当前底信号 - 上一条记录的底信号
   - 显示格式：同顶信号变化

6. **情况1-4**
   - 显示：支撑阻力的4种情况的币种数量
   - 样式：灰色，普通字体

---

## 🎨 视觉设计

### 变化量颜色规则
- **增加** → 红色 (#ef4444) / 橙色 (#f59e0b)
  - 顶信号增加：红色（警示）
  - 底信号增加：橙色（提示）
- **减少** → 绿色 (#10b981)
  - 顶信号减少：绿色（安全）
  - 底信号减少：绿色（正常）
- **不变** → 灰色 (#718096)

### 显示顺序
- **倒序排列**：最新的记录在最上面
- **显示条数**：最近30条记录
- **自动更新**：每60秒自动刷新

---

## 📊 数据示例

### 示例1：顶信号增加
```
时间                  24小时顶信号  变化    2小时底信号  变化    情况1  情况2  情况3  情况4
2026-01-02 08:48:21   1            0       0           0       0     0     1     0
2026-01-02 08:47:21   1            +1      0           0       0     0     1     0
2026-01-02 08:46:21   0            0       0           0       0     0     0     0
```
**解读**: 
- 08:47:21 时，有1个币种进入了顶部阻力区（情况3）
- 顶信号从0增加到1，变化量显示为 `+1` (红色)
- 底信号保持为0

### 示例2：底信号增加
```
时间                  24小时顶信号  变化    2小时底信号  变化    情况1  情况2  情况3  情况4
2026-01-02 09:00:00   1            0       2           0       1     1     1     0
2026-01-02 08:59:00   1            0       2           +2      1     1     1     0
2026-01-02 08:58:00   1            0       0           0       0     0     1     0
```
**解读**:
- 08:59:00 时，底信号从0增加到2
- 变化量显示为 `+2` (橙色)
- 情况1和情况2各有1个币种进入底部支撑区

### 示例3：信号减少
```
时间                  24小时顶信号  变化    2小时底信号  变化    情况1  情况2  情况3  情况4
2026-01-02 09:05:00   0            -1      1           -1      0     1     0     0
2026-01-02 09:04:00   1            0       2           0       1     1     1     0
```
**解读**:
- 09:05:00 时，顶信号从1减少到0，变化量 `-1` (绿色)
- 底信号从2减少到1，变化量 `-1` (绿色)
- 说明有币种离开了阻力区和支撑区

---

## 🔄 更新机制

### 数据来源
- **API端点**: `/api/signal-monitor/history?limit=30`
- **数据源**: `signal_monitor_data.json`
- **守护进程**: `signal_monitor.py`

### 更新频率
- **守护进程抓取**: 每60秒抓取一次原始信号
- **前端刷新**: 每60秒自动刷新表格
- **手动刷新**: 刷新页面（Ctrl+F5）

### 数据计算
```javascript
// 变化量计算逻辑
const topChange = item.top_signal - prevItem.top_signal;
const bottomChange = item.bottom_signal - prevItem.bottom_signal;

// 颜色和符号
if (topChange > 0) {
    color = '#ef4444';  // 红色
    text = `+${topChange}`;
} else if (topChange < 0) {
    color = '#10b981';  // 绿色
    text = `${topChange}`;
} else {
    color = '#718096';  // 灰色
    text = '0';
}
```

---

## 🎯 使用场景

### 场景1：监控市场情绪变化
- 观察顶信号的增减
- 顶信号持续增加 → 市场可能接近顶部
- 顶信号持续减少 → 市场回调结束

### 场景2：捕捉抄底机会
- 观察底信号的增减
- 底信号快速增加 → 多个币种进入支撑区
- 可能出现抄底机会

### 场景3：分析市场节奏
- 查看变化的频率和幅度
- 快速变化 → 市场波动剧烈
- 缓慢变化 → 市场相对稳定

---

## 💡 解读技巧

### 1. 关注连续变化
```
08:50:00  顶信号: 5   变化: +1
08:51:00  顶信号: 7   变化: +2
08:52:00  顶信号: 10  变化: +3
```
**解读**: 顶信号连续快速增加，说明大量币种同时进入阻力区，市场可能见顶

### 2. 关注极值出现
```
08:55:00  顶信号: 15  变化: +3   ← 历史高点
08:56:00  顶信号: 12  变化: -3
08:57:00  顶信号: 8   变化: -4
```
**解读**: 顶信号达到峰值后快速回落，可能是短期顶部确认

### 3. 关注背离现象
```
时间       顶信号  底信号  价格趋势
09:00:00   2      0       上涨
09:01:00   3      1       上涨
09:02:00   5      2       下跌   ← 背离
```
**解读**: 顶信号和底信号同时增加，但价格下跌，可能是市场犹豫不决

---

## 🔍 故障排除

### 问题1: 表格显示"暂无历史记录"
**原因**: 守护进程刚启动，还没有积累数据  
**解决**: 等待1-2分钟，系统会自动抓取数据

### 问题2: 变化量全部显示为0
**原因**: 信号数值没有变化  
**解决**: 这是正常现象，说明市场稳定

### 问题3: 表格不更新
**原因**: 
1. 守护进程停止运行
2. Flask未正确重启

**解决**:
```bash
# 检查守护进程
pm2 status signal-monitor

# 重启守护进程
pm2 restart signal-monitor

# 重启Flask
pm2 restart flask-app
```

### 问题4: 数据显示异常
**原因**: API异常或数据文件损坏  
**解决**:
```bash
# 查看日志
pm2 logs signal-monitor --lines 50

# 如需重置，删除数据文件
rm signal_monitor_data.json
pm2 restart signal-monitor
```

---

## 📝 技术实现

### 前端渲染函数
```javascript
function renderSignalHistory(history) {
    // 只显示最近30条，倒序显示
    const recentHistory = history.slice(-30).reverse();
    
    for (let i = 0; i < recentHistory.length; i++) {
        const item = recentHistory[i];
        const prevItem = recentHistory[i + 1];
        
        // 计算变化量
        const topChange = prevItem ? item.top_signal - prevItem.top_signal : 0;
        const bottomChange = prevItem ? item.bottom_signal - prevItem.bottom_signal : 0;
        
        // 渲染表格行...
    }
}
```

### API接口
```python
@app.route('/api/signal-monitor/history')
def api_signal_monitor_history():
    limit = request.args.get('limit', 100, type=int)
    
    with open('signal_monitor_data.json', 'r') as f:
        data = json.load(f)
    
    history = data.get('history', [])
    history = history[-limit:] if len(history) > limit else history
    
    return jsonify({
        'success': True,
        'history': history,
        'total': len(data.get('history', [])),
        'returned': len(history)
    })
```

---

## 🎊 功能特点

### 优点
1. ✅ **实时监控**: 每分钟更新，不错过任何变化
2. ✅ **直观显示**: 颜色编码，一目了然
3. ✅ **历史追溯**: 保留30条记录，可以回顾历史
4. ✅ **详细数据**: 包含情况1-4的详细分解
5. ✅ **自动刷新**: 无需手动操作，自动更新

### 适用人群
- 短线交易者：监控市场快速变化
- 波段交易者：观察趋势形成和反转
- 数据分析师：统计和分析市场规律

---

## 🚀 未来改进建议

1. **添加图表可视化**
   - 绘制顶信号和底信号的趋势线
   - 用折线图展示变化曲线

2. **添加告警功能**
   - 当变化量超过阈值时发送通知
   - 例如：顶信号1分钟内增加 >= 5

3. **添加统计分析**
   - 计算平均变化速度
   - 显示最大单次变化量
   - 统计变化频率

4. **导出功能**
   - 支持导出CSV/Excel
   - 用于进一步数据分析

---

**文档更新时间**: 2026-01-02 08:50:00  
**功能状态**: ✅ 已上线并正常运行  
**作者**: AI Assistant
