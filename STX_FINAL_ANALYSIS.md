# STX问题最终分析报告

## 🎯 您的两个问题

### ❓ 问题1：维护过为什么不加维护的次数？
**答案**：**STX从未被维护过！**

证据：
- `maintenance_count: 0` （维护次数为0）
- `sub_account_maintenance.json` 中没有STX的记录
- 守护进程日志中STX一直被跳过（在黑名单中）

### ❓ 问题2：STX禁止开仓了，为什么还开仓了100U？
**答案**：**时间顺序问题 + 保证金计算疑问**

1. **时间线**：
   - **开仓时间**: 2025-12-31 18:45:40（昨天下午）
   - **加入黑名单时间**: 2026-01-01 02:36:08（今天凌晨）
   - **结论**：开仓时STX还没被加入黑名单！

2. **谁开的仓**：`sub-account-opener`守护进程
   - 检测到主账号STX亏损-0.03%，子账号没持仓
   - 自动开仓10U（配置: `initial_position_usdt: 10`）
   - 订单ID: 3177750365923008512
   - 数量: 417张

3. **保证金疑问**：
   - **守护进程日志说**: 目标保证金10U
   - **OKEx显示**: 保证金100.14956 USDT ❓
   - **账单记录**: 18:45:40有多笔扣款，总计约100U
   
---

## 🔍 深入调查：为什么保证金是100U？

### 可能的原因：

#### 原因A：OKEx保证金计算方式
- OKEx的"保证金"字段可能包括：
  1. **初始保证金**（10U）
  2. **追加保证金**（如果有的话）
  3. **风险准备金**
  4. **其他费用**

#### 原因B：系统自动追加保证金
- 逐仓模式下，如果爆仓风险高，OKEx可能自动追加保证金
- 或者其他守护进程（sub-account-maintenance）追加了保证金

#### 原因C：代码bug
- `open_position_on_sub_account`函数可能有bug
- 实际开仓金额和日志显示不一致

---

## ✅ 已确认的事实

1. ✅ STX开仓时间：2025-12-31 18:45:40
2. ✅ 开仓守护进程：sub-account-opener
3. ✅ 订单ID：3177750365923008512
4. ✅ 持仓数量：417张
5. ✅ 当前保证金：100.14956 USDT
6. ✅ 维护次数：0（从未被维护）
7. ✅ 黑名单状态：已加入黑名单（今天凌晨）
8. ✅ 当前状态：正常跳过，不会再自动开仓

---

## 🛠️ 建议的后续操作

### 1. 确认保证金来源
运行以下命令查看详细的保证金分解：
```python
# 查询STX持仓的详细保证金信息
# 包括：初始保证金、维护保证金、未实现盈亏等
```

### 2. 平仓STX（如果需要）
如果您不想持有这个100U的STX仓位，可以：
```bash
# 已经提供过平仓脚本
python3 close_stx_isolated.py
```

### 3. 检查sub-account-opener代码
检查 `sub_account_opener_daemon.py` 第215行的计算逻辑：
```python
size = round((size_usdt * lever) / last_price)
```
确认是否有bug导致实际开仓金额与预期不符。

### 4. 监控其他币种
确保其他币种没有类似问题：
- 检查所有子账户持仓的保证金
- 确认是否有其他币种保证金异常

---

## 📊 当前STX持仓状态

- **账户**: Wu666666
- **币种**: STX-USDT-SWAP
- **方向**: LONG（多单）
- **数量**: 417张
- **开仓价**: 0.2402
- **标记价**: 0.2393
- **保证金**: 100.15 USDT
- **杠杆**: 10x
- **收益率**: -3.61%
- **未实现盈亏**: -3.61 USDT
- **保证金模式**: isolated（逐仓）
- **维护次数**: 0
- **黑名单状态**: ✅ 已加入（不会再自动操作）

---

## 🎯 总结

**STX没有被维护过**，维护次数为0是正常的。

**STX在加入黑名单前开仓了100U**（昨天18:45，加入黑名单是今天凌晨）。

**保证金为什么是100U而不是10U**，需要进一步调查OKEx的保证金计算方式或检查代码bug。

**目前STX已在黑名单**，不会再自动开仓或维护。

