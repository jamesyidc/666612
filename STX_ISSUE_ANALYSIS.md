# STX持仓异常问题分析

## 问题描述

1. **STX维护后维护次数没有增加** - maintenance_count仍为0
2. **STX已加入黑名单，为什么还开仓了100U**

## 问题调查

### 1. STX持仓信息
- **持仓数量**: 417张
- **保证金**: 100.14956 USDT（异常！应该是10U）
- **保证金模式**: isolated（逐仓）
- **杠杆**: 10x
- **创建时间**: 2025-12-31 18:45:40
- **维护次数**: 0（说明不是维护系统加的仓）

### 2. 订单历史
```
1. 12-31 06:04 - 买入395张 (原老仓位，已平仓)
2. 12-31 18:30 - 买入1张 (测试单)
3. 12-31 18:45 - 买入417张 (问题订单)
```

### 3. 守护进程日志
**sub-account-opener守护进程** 在 12-31 18:45 开的仓：
```
⚠️ 发现主账号亏损但子账号未持仓: STX-USDT-SWAP long 亏损:-0.03%
🚀 准备开仓 10U...
📊 准备开仓: STX-USDT-SWAP long 数量:417张 价格:$0.2400 杠杆:10x 目标保证金:10U
✅ 开仓成功: STX-USDT-SWAP long 订单ID:3177750365923008512
```

### 4. 计算验证
- **开仓数量**: `round((10U * 10倍) / 0.24) = 417张` ✅ 正确
- **理论保证金**: `417张 × 0.2393 / 10倍 = 9.98 USDT` ≈ 10U
- **实际保证金**: **100.14956 USDT** ❌ 异常！

## 根本原因

### 原因1: STX没有加入黑名单（时间顺序问题）
- **STX开仓时间**: 2025-12-31 18:45:40
- **STX加入黑名单时间**: 2026-01-01 02:36:08（今天凌晨）
- **结论**: 开仓时STX还不在黑名单中

### 原因2: 保证金被追加到100U（推测）
可能的情况：
1. **逐仓模式可以追加保证金** - 用户或系统可能追加了保证金
2. **维护系统尝试维护但失败** - 开了新仓但没记录到maintenance_count
3. **sub-account-maintenance守护进程** - 普通维护守护进程可能加了仓

让我检查普通维护守护进程的记录。

