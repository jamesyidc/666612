# 支撑压力系统 - 24小时逃顶信号统计图功能说明

## 功能概述
在支撑压力系统页面添加独立的24小时逃顶信号统计曲线图，用于实时监控逃顶信号的趋势变化。

## 部署位置
在 `/support-resistance` 页面的 **12小时分页趋势图下方，每日时间轴上方**。

## 新增功能

### 1. 24小时逃顶信号统计图

**图表标题**: 🚨 24小时逃顶信号统计

**副标题**: 实时监控24小时内的逃顶信号趋势（逃顶分数 ≥ 8）

**图表类型**: 
- **柱状图** + **双折线图**
- 双Y轴设计（左侧：信号数量，右侧：逃顶分数）

**展示数据**:
1. **柱状图**: 每个时间点的逃顶信号数量（渐变黄→橙）
2. **蓝色实线**: 所有逃顶币种的平均分数
3. **红色虚线**: 最高逃顶分数
4. **红色阈值线**: 逃顶警戒线（分数 = 8）

### 2. 统计徽章（右上角）

显示三个关键指标：
- 🔴 **活跃币种**: 触发逃顶信号的币种数量
- 🟡 **平均分数**: 所有逃顶信号的平均分数
- 🔵 **最高分数**: 24小时内的最高逃顶分数

### 3. 交互功能

- **鼠标悬停**: 显示详细信息（时间、信号数量、平均分数、最高分数）
- **自动刷新**: 每3分钟自动更新数据
- **响应式设计**: 自适应容器宽度

## 页面布局

```
┌─────────────────────────────────────────┐
│    全局趋势图（所有历史数据）             │
├─────────────────────────────────────────┤
│    12小时分页趋势图                      │
│    ← 更早 | 第N页 | 更晚 →                │
├─────────────────────────────────────────┤
│  🚨 24小时逃顶信号统计（新增）           │
│  [活跃币种] [平均分数] [最高分数]         │
│  ┌──────────────────────────────┐       │
│  │    柱状图 + 双折线图          │       │
│  │    (信号数量、平均分、最高分) │       │
│  └──────────────────────────────┘       │
├─────────────────────────────────────────┤
│    每日时间轴                            │
│    [日期选择器]                          │
└─────────────────────────────────────────┘
```

## 技术实现

### 前端修改
**文件**: `templates/support_resistance.html`

#### 1. HTML结构 (+40行)
```html
<!-- 24小时逃顶信号统计图 -->
<div class="timeline-section">
    <div class="timeline-header">
        <h2>🚨 24小时逃顶信号统计</h2>
        <div class="stat-badges">
            <!-- 三个统计徽章 -->
        </div>
    </div>
    <div id="escapeSignalChart" class="trend-chart-container"></div>
</div>
```

#### 2. JavaScript变量 (+1行)
```javascript
let escapeSignalChart; // 24小时逃顶信号统计图
```

#### 3. 初始化函数 (+120行)
```javascript
function initEscapeSignalChart() {
    // 初始化ECharts实例
    // 配置双Y轴、柱状图、折线图
    // 设置阈值线
}
```

#### 4. 数据加载函数 (+90行)
```javascript
async function loadEscapeSignalData() {
    // 从API获取逃顶信号数据
    // 按时间汇总统计
    // 更新统计徽章
    // 更新图表数据
}
```

#### 5. 页面初始化集成 (+15行)
```javascript
// 在DOMContentLoaded中添加
initEscapeSignalChart();
loadEscapeSignalData();
```

#### 6. 定时刷新集成 (+1行)
```javascript
setInterval(function() {
    loadEscapeSignalData(); // 每3分钟刷新
}, 180000);
```

### 数据源
**API端点**: 
- `/api/escape-top-signals/latest` - 获取最新逃顶信号数据
- `/api/escape-top-signals/stats` - 获取统计汇总数据

### 数据处理流程
```
API数据 → 按时间汇总 → 计算统计值 → 格式化时间标签 → ECharts渲染
```

## 图表配置详情

### 双Y轴设计
- **左Y轴**: 信号数量（整数）
- **右Y轴**: 逃顶分数（0-100）

### 系列配置
1. **信号数量**（柱状图）
   - yAxisIndex: 0
   - 渐变色：黄色 → 橙色

2. **平均分数**（折线图）
   - yAxisIndex: 1
   - 颜色：蓝色 (#3b82f6)
   - 平滑曲线

3. **最高分数**（折线图）
   - yAxisIndex: 1
   - 颜色：红色 (#ef4444)
   - 虚线样式
   - 包含阈值标记线（y=8）

### Tooltip配置
```javascript
formatter: function(params) {
    // 显示时间
    // 显示信号数量
    // 显示平均分数
    // 显示最高分数
}
```

## 访问地址

**支撑压力系统页面**: https://5000-ifbgdsngd9an7si2g7jy0-5634da27.sandbox.novita.ai/support-resistance

**图表位置**: 页面中部，12小时分页图下方

## 使用场景

### 1. 市场监控
- 观察24小时内逃顶信号的分布
- 判断市场逃顶压力的变化趋势
- 识别逃顶信号集中时段

### 2. 风险评估
- **活跃币种**: 当前有多少币种触发逃顶
- **平均分数**: 整体逃顶强度
- **最高分数**: 最强逃顶信号

### 3. 决策辅助
- 信号数量突然增加 → 市场可能见顶
- 平均分数持续走高 → 逃顶压力增大
- 最高分数超过阈值 → 个别币种风险极高

### 4. 与其他图表配合
- **全局趋势图**: 查看历史支撑压力数据
- **12小时分页图**: 详细查看某时段的四种情况分布
- **逃顶统计图**: 专注于逃顶信号的时序变化
- **每日时间轴**: 查看某一天的详细快照

## 数据刷新策略

- **初始加载**: 页面打开时立即加载
- **自动刷新**: 每3分钟更新一次
- **手动刷新**: 刷新页面立即更新

## 代码变更记录

### Commit: 5372e09
**提交信息**: Add 24-hour escape signal statistics chart to support-resistance page

**修改文件**: 
- `templates/support_resistance.html` (+254 行)

**主要变更**:
1. 添加逃顶信号统计图HTML结构（含统计徽章）
2. 定义escapeSignalChart变量
3. 实现initEscapeSignalChart()初始化函数
4. 实现loadEscapeSignalData()数据加载函数
5. 集成到页面初始化流程
6. 添加定时刷新逻辑

## 系统状态

- ✅ 逃顶信号统计图已添加到支撑压力页面
- ✅ 双Y轴图表配置完成
- ✅ 统计徽章显示正常
- ✅ 数据自动刷新已启用
- ✅ Flask应用已重启
- ✅ PM2配置已保存
- ✅ Git提交已完成

## 性能优化

1. **异步加载**: 使用async/await处理API请求
2. **错误处理**: catch块处理加载失败情况
3. **数据缓存**: 汇总数据存储在内存中
4. **按需刷新**: 仅3分钟刷新一次，避免频繁请求

## 未来优化建议

### 1. 高级筛选
- 添加时间范围选择器（1h/6h/12h/24h）
- 支持按逃顶分数区间筛选
- 添加币种筛选功能

### 2. 详细视图
- 点击柱状图显示该时刻的详细币种列表
- 弹窗展示逃顶币种的具体数据
- 显示每个币种的逃顶分数构成

### 3. 对比分析
- 添加历史同期数据对比
- 显示环比、同比变化
- 标记异常时段

### 4. 告警功能
- 当信号数量超过阈值时发送告警
- 平均分数异常波动提醒
- 集成Telegram通知

### 5. 数据导出
- 导出24小时逃顶统计数据为CSV
- 生成趋势分析报告
- 支持图表截图

---
**文档创建时间**: 2025-12-30
**功能版本**: v1.0
**状态**: ✅ 已部署生产环境
**页面路径**: /support-resistance
