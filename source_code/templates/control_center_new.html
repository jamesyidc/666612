<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>ä¸­æ§ç³»ç»Ÿ - OKXäº¤æ˜“ + æ•°æ®åˆ†æ v2.2 (27å¸ç§)</title>
    <!-- Version: 2.2.0-27coins | Updated: 2025-12-07 06:30 -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', sans-serif;
            background: #0a0e27;
            color: #e0e0e0;
            overflow: hidden;
        }

        .container {
            display: flex;
            height: 100vh;
            width: 100vw;
        }

        /* å·¦ä¾§ï¼šOKXé¡µé¢ */
        .left-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            border-right: 2px solid #1a1f3a;
        }

        .panel-header {
            background: linear-gradient(135deg, #1a1f3a 0%, #0f1229 100%);
            padding: 15px 20px;
            border-bottom: 2px solid #2a3558;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .panel-title {
            font-size: 18px;
            font-weight: 600;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .symbol-input {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .symbol-input input {
            padding: 8px 12px;
            background: #0f1229;
            border: 1px solid #2a3558;
            border-radius: 6px;
            color: #e0e0e0;
            font-size: 14px;
            width: 180px;
        }

        .symbol-input input:focus {
            outline: none;
            border-color: #2962ff;
        }

        .symbol-input button {
            padding: 8px 16px;
            background: #2962ff;
            border: none;
            border-radius: 6px;
            color: #fff;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .symbol-input button:hover {
            background: #1e4fd9;
        }

        /* å¿«é€Ÿé€‰æ‹©å¸ç§æŒ‰é’® */
        .quick-select {
            display: flex;
            gap: 8px;
            padding: 10px 20px;
            background: #0f1229;
            border-bottom: 1px solid #1a1f3a;
            flex-wrap: wrap;
        }

        .quick-btn {
            padding: 6px 12px;
            background: #1a1f3a;
            border: 1px solid #2a3558;
            border-radius: 6px;
            color: #e0e0e0;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s ease;
        }

        .quick-btn:hover {
            background: #2a3558;
            border-color: #3a4578;
        }

        .quick-btn.active {
            background: #2962ff;
            border-color: #2962ff;
            color: #fff;
        }

        /* æ—¶é—´æ®µé€‰æ‹©æŒ‰é’® */
        .time-btn {
            padding: 6px 12px;
            background: #1a1f3a;
            border: 1px solid #2a3558;
            border-radius: 6px;
            color: #e0e0e0;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .time-btn:hover {
            background: #2a3558;
            border-color: #3a4578;
        }

        .time-btn.active {
            background: #ffa726;
            border-color: #ffa726;
            color: #000;
            font-weight: 600;
        }

        /* å¸ç§é€‰æ‹©æŒ‰é’® */
        .coin-select-btn {
            padding: 10px 12px;
            background: #0f1229;
            border: 2px solid #2a3558;
            border-radius: 8px;
            color: #e0e0e0;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            text-align: center;
        }

        .coin-select-btn:hover {
            background: #1a1f3a;
            border-color: #3a4578;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .coin-select-btn.active {
            background: linear-gradient(135deg, #00ff88 0%, #00cc6a 100%);
            border-color: #00ff88;
            color: #000;
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.5);
        }

        .iframe-container {
            flex: 1;
            position: relative;
            background: #000;
        }

        .iframe-container iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        /* æ·±åº¦å›¾æ ‡è¯†æ¡† */
        .depth-chart-marker {
            position: absolute;
            border: 3px solid #ffa726;
            pointer-events: all;
            z-index: 5;
            box-shadow: 0 0 10px rgba(255, 167, 38, 0.5);
            cursor: move;
        }
        
        .depth-chart-marker.dragging {
            opacity: 0.7;
        }

        .marker-label {
            position: absolute;
            background: rgba(255, 167, 38, 0.9);
            color: #000;
            padding: 4px 8px;
            font-size: 12px;
            font-weight: 600;
            border-radius: 4px;
            white-space: nowrap;
        }

        .marker-label.top {
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
        }

        .marker-label.bottom {
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
        }

        /* åˆ»åº¦çº¿ */
        .scale-line {
            position: absolute;
            width: 100%;
            height: 2px;
            background: rgba(255, 167, 38, 0.6);
            left: 0;
        }

        .scale-label {
            position: absolute;
            right: -45px;
            top: -8px;
            background: rgba(255, 167, 38, 0.9);
            color: #000;
            padding: 2px 8px;
            font-size: 11px;
            font-weight: 600;
            border-radius: 3px;
        }

        /* è°ƒæ•´æ§åˆ¶é¢æ¿ */
        .marker-controls {
            position: absolute;
            top: 60px;
            right: 20px;
            background: rgba(10, 14, 39, 0.95);
            border: 2px solid #2a3558;
            border-radius: 8px;
            padding: 15px;
            z-index: 20;
            min-width: 250px;
            transition: all 0.3s ease;
        }

        .marker-controls.collapsed {
            padding: 8px 15px;
            min-width: auto;
        }

        .marker-controls.collapsed .control-content {
            display: none;
        }

        .controls-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            cursor: pointer;
        }

        .controls-header .title {
            font-size: 14px;
            font-weight: 600;
            color: #fff;
        }

        .collapse-btn {
            background: none;
            border: none;
            color: #8b8fa4;
            font-size: 18px;
            cursor: pointer;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.3s ease;
        }

        .collapse-btn:hover {
            color: #fff;
        }

        .marker-controls.collapsed .collapse-btn {
            transform: rotate(180deg);
        }

        .control-group {
            margin-bottom: 10px;
        }

        .control-group label {
            display: block;
            font-size: 12px;
            color: #8b8fa4;
            margin-bottom: 5px;
        }

        .control-group input {
            width: 60px;
            padding: 4px 8px;
            background: #1a1f3a;
            border: 1px solid #2a3558;
            border-radius: 4px;
            color: #e0e0e0;
            font-size: 12px;
        }

        .control-group button {
            padding: 4px 12px;
            background: #2962ff;
            border: none;
            border-radius: 4px;
            color: #fff;
            cursor: pointer;
            font-size: 12px;
            margin-left: 5px;
        }

        .control-group button:hover {
            background: #1e4fd9;
        }

        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(10, 14, 39, 0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10;
        }

        .loading-text {
            font-size: 16px;
            color: #8b8fa4;
        }

        /* å³ä¾§ï¼šæ•°æ®åˆ†æ */
        .right-panel {
            width: 450px;
            display: flex;
            flex-direction: column;
            background: #0a0e27;
            overflow-y: auto;
        }

        .stats-section {
            padding: 20px;
        }

        .stats-title {
            font-size: 16px;
            font-weight: 600;
            color: #fff;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #1a1f3a;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* æ·±åº¦çº¿è¯„åˆ†å¡ç‰‡ */
        .score-card {
            background: linear-gradient(135deg, #1a1f3a 0%, #0f1229 100%);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid #2a3558;
        }

        .score-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .score-label {
            font-size: 12px;
            color: #8b8fa4;
            text-transform: uppercase;
        }

        .score-value {
            font-size: 32px;
            font-weight: 700;
        }

        .score-value.long {
            color: #00ff88;
        }

        .score-value.short {
            color: #ff4d4f;
        }

        .score-bar {
            height: 8px;
            background: #0a0e27;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }

        .score-bar-fill {
            height: 100%;
            transition: width 0.5s ease;
            border-radius: 4px;
        }

        .score-bar-fill.long {
            background: linear-gradient(90deg, #00ff88 0%, #00cc66 100%);
        }

        .score-bar-fill.short {
            background: linear-gradient(90deg, #ff4d4f 0%, #cc0000 100%);
        }

        /* 20æ¡£åˆ†å¸ƒ */
        .distribution-grid {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 4px;
            margin-top: 10px;
        }

        .dist-cell {
            aspect-ratio: 1;
            background: #0a0e27;
            border-radius: 3px;
            position: relative;
            overflow: hidden;
        }

        .dist-cell-fill {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            transition: height 0.3s ease;
        }

        .dist-cell-fill.long {
            background: #00ff88;
        }

        .dist-cell-fill.short {
            background: #ff4d4f;
        }

        /* æ•°æ®ç»Ÿè®¡å¡ç‰‡ */
        .stat-card {
            background: linear-gradient(135deg, #1a1f3a 0%, #0f1229 100%);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid #2a3558;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #1a1f3a;
        }

        .stat-row:last-child {
            border-bottom: none;
        }

        .stat-label {
            font-size: 13px;
            color: #8b8fa4;
        }

        .stat-value {
            font-size: 14px;
            font-weight: 600;
            color: #e0e0e0;
        }

        .stat-value.green {
            color: #00ff88;
        }

        .stat-value.red {
            color: #ff4d4f;
        }

        .stat-value.yellow {
            color: #ffa726;
        }

        /* SARç»Ÿè®¡å¡ç‰‡ */
        .sar-coin-card {
            background: linear-gradient(135deg, #1a1f3a 0%, #0f1229 100%);
            border: 2px solid #2d3455;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .sar-coin-card:hover {
            /* ç§»é™¤æ‚¬æµ®æ•ˆæœ */
        }

        .sar-coin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid #1a1f3a;
        }

        .sar-coin-name {
            font-size: 14px;
            font-weight: 600;
            color: #fff;
        }

        .sar-trend {
            font-size: 13px;
            font-weight: 600;
            padding: 3px 8px;
            border-radius: 4px;
            background: #1a1f3a;
        }

        .sar-trend.bullish {
            color: #00ff88;
            background: rgba(0, 255, 136, 0.15);
        }

        .sar-trend.bearish {
            color: #ff4d4f;
            background: rgba(255, 77, 79, 0.15);
        }

        .sar-coin-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 6px;
        }

        .sar-rsi {
            font-size: 13px;
            font-weight: 600;
            color: #ffa726;
        }

        .sar-price {
            font-size: 13px;
            font-weight: 600;
            color: #00bfff;
        }

        .sar-update-time {
            font-size: 10px;
            color: #8b8fa4;
            margin-top: 6px;
            text-align: right;
        }

        /* ç›‘æ§çŠ¶æ€ */
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 12px;
            background: rgba(0, 255, 136, 0.2);
            border-radius: 12px;
            font-size: 12px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #00ff88;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }

        .update-time {
            font-size: 11px;
            color: #8b8fa4;
            text-align: right;
            margin-top: 10px;
        }

        /* æ»šåŠ¨æ¡ */
        .right-panel::-webkit-scrollbar {
            width: 6px;
        }

        .right-panel::-webkit-scrollbar-track {
            background: #0a0e27;
        }

        .right-panel::-webkit-scrollbar-thumb {
            background: #2a3558;
            border-radius: 3px;
        }

        /* æ§åˆ¶æŒ‰é’® */
        .control-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .control-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .control-btn.start {
            background: #00ff88;
            color: #0a0e27;
        }

        .control-btn.start:hover {
            background: #00cc66;
        }

        .control-btn.stop {
            background: #ff4d4f;
            color: #fff;
        }

        .control-btn.stop:hover {
            background: #cc0000;
        }

        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .control-btn.memory {
            background: #9c27b0;
            color: #fff;
        }

        .control-btn.memory:hover {
            background: #7b1fa2;
        }

        .control-btn.refresh {
            background: #2196f3;
            color: #fff;
        }

        .control-btn.refresh:hover {
            background: #1976d2;
        }

        /* å†…å­˜çŠ¶æ€æŒ‡ç¤ºå™¨ */
        .memory-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(26, 31, 58, 0.95);
            border: 1px solid #2a3558;
            border-radius: 8px;
            padding: 12px 16px;
            color: #e0e0e0;
            font-size: 12px;
            z-index: 9999;
            min-width: 200px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .memory-indicator .memory-title {
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .memory-indicator .memory-item {
            display: flex;
            justify-content: space-between;
            margin: 4px 0;
        }

        .memory-indicator .memory-value {
            font-weight: 600;
            color: #00ff88;
        }

        .memory-indicator .memory-value.warning {
            color: #ffa726;
        }

        .memory-indicator .memory-value.danger {
            color: #ff4d4f;
        }

        /* é€šçŸ¥åŠ¨ç”» */
        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }

        /* è„‰åŠ¨åŠ¨ç”» - ç”¨äºè‡ªåŠ¨åˆ·æ–°æŒ‡ç¤ºå™¨ */
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
                box-shadow: 0 0 8px #00ff88;
            }
            50% {
                opacity: 0.5;
                box-shadow: 0 0 16px #00ff88;
            }
        }

        /* æ—‹è½¬åŠ¨ç”» - ç”¨äºåŠ è½½æŒ‡ç¤ºå™¨ */
        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- å·¦ä¾§ï¼šOKXé¡µé¢ -->
        <div class="left-panel">
            <div class="panel-header">
                <div class="panel-title">
                    <span>ğŸ“Š</span>
                    <span>OKXäº¤æ˜“é¡µé¢</span>
                </div>
                <div class="symbol-input">
                    <input type="text" id="symbolInput" value="eth-usdt-swap" placeholder="è¾“å…¥äº¤æ˜“å¯¹ (å¦‚: eth-usdt-swap)">
                    <button onclick="loadOkexPage()">åŠ è½½</button>
                </div>
            </div>
            <!-- å¿«é€Ÿé€‰æ‹©å¸ç§ -->
            <div class="quick-select" style="display: flex; flex-wrap: wrap; gap: 8px; align-items: center;">
                <button class="quick-btn active" onclick="quickSelect('eth-usdt-swap')">ETH</button>
                <button class="quick-btn active" onclick="quickSelect('xrp-usdt-swap')">XRP</button>
                <button class="quick-btn active" onclick="quickSelect('bnb-usdt-swap')">BNB</button>
                <button class="quick-btn active" onclick="quickSelect('sol-usdt-swap')">SOL</button>
                <button class="quick-btn active" onclick="quickSelect('trx-usdt-swap')">TRX</button>
                <button class="quick-btn active" onclick="quickSelect('ton-usdt-swap')">TON</button>
                <button class="quick-btn active" onclick="quickSelect('etc-usdt-swap')">ETC</button>
                <button class="quick-btn active" onclick="quickSelect('link-usdt-swap')">LINK</button>
                <button class="quick-btn active" onclick="quickSelect('cro-usdt-swap')">CRO</button>
                <button class="quick-btn active" onclick="quickSelect('dot-usdt-swap')">DOT</button>
                <button class="quick-btn active" onclick="quickSelect('aave-usdt-swap')">AAVE</button>
                <button class="quick-btn active" onclick="quickSelect('near-usdt-swap')">NEAR</button>
                <button class="quick-btn active" onclick="quickSelect('apt-usdt-swap')">APT</button>
                <button class="quick-btn active" onclick="quickSelect('crv-usdt-swap')">CRV</button>
                <button class="quick-btn active" onclick="quickSelect('stx-usdt-swap')">STX</button>
                <button class="quick-btn active" onclick="quickSelect('ldo-usdt-swap')">LDO</button>
                <button class="quick-btn active" onclick="quickSelect('doge-usdt-swap')">DOGE</button>
                <button class="quick-btn active" onclick="quickSelect('ltc-usdt-swap')">LTC</button>
                <button class="quick-btn active" onclick="quickSelect('sui-usdt-swap')">SUI</button>
                <button onclick="selectAll()" style="padding: 8px 16px; background: #1a1f3a; border: 1px solid #00ff88; border-radius: 6px; color: #00ff88; cursor: pointer; font-size: 14px; margin-left: 10px;">å…¨é€‰</button>
                <button onclick="clearAll()" style="padding: 8px 16px; background: #1a1f3a; border: 1px solid #ff4d4f; border-radius: 6px; color: #ff4d4f; cursor: pointer; font-size: 14px;">æ¸…ç©º</button>
            </div>
            <div class="iframe-container">
                <div class="loading-overlay" id="loadingOverlay">
                    <div class="loading-text">æ­£åœ¨åŠ è½½OKXé¡µé¢...</div>
                </div>
                <iframe id="okexIframe" src="https://www.okx.com/zh-hans/trade-swap/eth-usdt-swap"></iframe>
                
                <!-- æ·±åº¦å›¾æ ‡è¯†æ¡† -->
                <div class="depth-chart-marker" id="depthMarker" style="display: none;">
                    <div class="marker-label top">100åˆ†</div>
                    <div class="marker-label bottom">0åˆ†</div>
                    
                    <!-- åˆ»åº¦çº¿ï¼šä»é¡¶éƒ¨å¼€å§‹ï¼Œæ¯10%ä¸€æ¡ -->
                    <div class="scale-line" style="top: 10%;">
                        <div class="scale-label">90åˆ†</div>
                    </div>
                    <div class="scale-line" style="top: 20%;">
                        <div class="scale-label">80åˆ†</div>
                    </div>
                    <div class="scale-line" style="top: 30%;">
                        <div class="scale-label">70åˆ†</div>
                    </div>
                    <div class="scale-line" style="top: 40%;">
                        <div class="scale-label">60åˆ†</div>
                    </div>
                    <div class="scale-line" style="top: 50%;">
                        <div class="scale-label">50åˆ†</div>
                    </div>
                    <div class="scale-line" style="top: 60%;">
                        <div class="scale-label">40åˆ†</div>
                    </div>
                    <div class="scale-line" style="top: 70%;">
                        <div class="scale-label">30åˆ†</div>
                    </div>
                    <div class="scale-line" style="top: 80%;">
                        <div class="scale-label">20åˆ†</div>
                    </div>
                    <div class="scale-line" style="top: 90%;">
                        <div class="scale-label">10åˆ†</div>
                    </div>
                </div>
                
                <!-- è°ƒæ•´æ§åˆ¶é¢æ¿ -->
                <div class="marker-controls" id="markerControls">
                    <div class="controls-header" onclick="toggleControls()">
                        <div class="title">ğŸ“ æ·±åº¦å›¾æ¡†å®šä½</div>
                        <button class="collapse-btn" id="collapseBtn">â–¼</button>
                    </div>
                    
                    <div class="control-content" id="controlContent">
                    <div class="control-group">
                        <label>å·¦è¾¹è· (px)</label>
                        <input type="number" id="markerLeft" value="165" step="5">
                        <button onclick="updateMarker()">åº”ç”¨</button>
                    </div>
                    
                    <div class="control-group">
                        <label>é¡¶éƒ¨è·ç¦» (px)</label>
                        <input type="number" id="markerTop" value="140" step="5">
                    </div>
                    
                    <div class="control-group">
                        <label>å®½åº¦ (px)</label>
                        <input type="number" id="markerWidth" value="400" step="5">
                    </div>
                    
                    <div class="control-group">
                        <label>é«˜åº¦ (px)</label>
                        <input type="number" id="markerHeight" value="275" step="5">
                    </div>
                    
                    <div class="control-group">
                        <button onclick="toggleMarker()" style="width: 100%; background: #00ff88; color: #000;">æ˜¾ç¤º/éšè—æ ‡è¯†æ¡†</button>
                    </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- å³ä¾§ï¼šæ•°æ®åˆ†æ -->
        <div class="right-panel">
            <div class="stats-section">
                <!-- å†å²æ•°æ®å¤šæ—¶é—´æ®µæ˜¾ç¤º -->
                <div class="stat-card" style="margin-bottom: 20px;">
                    <div class="stats-title" style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span>ğŸ“Š</span>
                            <span>å†å²æ·±åº¦è¯„åˆ†æ›²çº¿</span>
                            <span style="font-size: 12px; color: #00ff88; background: rgba(0, 255, 136, 0.1); padding: 2px 8px; border-radius: 4px; border: 1px solid #00ff88;">v2.1 è‡ªåŠ¨åˆ·æ–°</span>
                        </div>
                        <!-- å¸ç§é€‰æ‹©ä¸‹æ‹‰æ¡† -->
                        <select id="historyCoinSelect" onchange="switchHistoryCoin()" style="padding: 6px 12px; background: #1a1f3a; border: 1px solid #2d3455; border-radius: 6px; color: #fff; font-size: 14px; cursor: pointer;">
                            <option value="BTC-USDT-SWAP">BTC</option>
                            <option value="ETH-USDT-SWAP" selected>ETH</option>
                            <option value="XRP-USDT-SWAP">XRP</option>
                            <option value="BNB-USDT-SWAP">BNB</option>
                            <option value="SOL-USDT-SWAP">SOL</option>
                            <option value="LTC-USDT-SWAP">LTC</option>
                            <option value="DOGE-USDT-SWAP">DOGE</option>
                            <option value="SUI-USDT-SWAP">SUI</option>
                            <option value="TRX-USDT-SWAP">TRX</option>
                            <option value="TON-USDT-SWAP">TON</option>
                            <option value="ETC-USDT-SWAP">ETC</option>
                            <option value="BCH-USDT-SWAP">BCH</option>
                            <option value="HBAR-USDT-SWAP">HBAR</option>
                            <option value="XLM-USDT-SWAP">XLM</option>
                            <option value="FIL-USDT-SWAP">FIL</option>
                            <option value="LINK-USDT-SWAP">LINK</option>
                            <option value="CRO-USDT-SWAP">CRO</option>
                            <option value="DOT-USDT-SWAP">DOT</option>
                            <option value="AAVE-USDT-SWAP">AAVE</option>
                            <option value="UNI-USDT-SWAP">UNI</option>
                            <option value="NEAR-USDT-SWAP">NEAR</option>
                            <option value="APT-USDT-SWAP">APT</option>
                            <option value="CFX-USDT-SWAP">CFX</option>
                            <option value="CRV-USDT-SWAP">CRV</option>
                            <option value="STX-USDT-SWAP">STX</option>
                            <option value="LDO-USDT-SWAP">LDO</option>
                            <option value="TAO-USDT-SWAP">TAO</option>
                        </select>
                    </div>
                    
                    <!-- æ—¶é—´æ®µé€‰æ‹© -->
                    <div style="display: flex; gap: 8px; margin-bottom: 15px; margin-top: 15px; flex-wrap: wrap;">
                        <button class="time-btn" onclick="switchTimeRange('3m')" data-range="3m">3åˆ†é’Ÿ</button>
                        <button class="time-btn active" onclick="switchTimeRange('1h')" data-range="1h">1å°æ—¶</button>
                        <button class="time-btn" onclick="switchTimeRange('3h')" data-range="3h">3å°æ—¶</button>
                        <button class="time-btn" onclick="switchTimeRange('6h')" data-range="6h">6å°æ—¶</button>
                        <button class="time-btn" onclick="switchTimeRange('12h')" data-range="12h">12å°æ—¶</button>
                        <button class="time-btn" onclick="switchTimeRange('24h')" data-range="24h">24å°æ—¶</button>
                    </div>
                    
                    <!-- å†å²æ•°æ®å›¾è¡¨ -->
                    <!-- ä¸»å›¾è¡¨åŒ…å«ï¼šåšå¤šè¯„åˆ†ã€åšç©ºè¯„åˆ†ã€å¤šç©ºå·®å€¼ã€ä»·æ ¼æ³¢åŠ¨ -->
                    <div style="position: relative;">
                        <!-- åŠ è½½çŠ¶æ€æŒ‡ç¤ºå™¨ -->
                        <div id="chartLoadingIndicator" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 10; display: none; text-align: center;">
                            <div style="width: 60px; height: 60px; border: 4px solid rgba(0, 255, 136, 0.2); border-top: 4px solid #00ff88; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 15px;"></div>
                            <div style="color: #00ff88; font-size: 14px; font-weight: 600;">åŠ è½½ä¸­...</div>
                            <div id="loadingStatus" style="color: #8b8fa4; font-size: 12px; margin-top: 8px;">æ­£åœ¨è·å–æ•°æ®</div>
                        </div>
                        <canvas id="historyChart" width="800" height="380" style="width: 100%; height: 380px;"></canvas>
                    </div>
                    
                    <!-- å›¾ä¾‹ -->
                    <div style="display: flex; justify-content: center; gap: 20px; margin-top: 10px; font-size: 13px; color: #8b8fa4; flex-wrap: wrap;">
                        <div style="display: flex; align-items: center; gap: 5px;">
                            <div style="width: 20px; height: 3px; background: #00ff88;"></div>
                            <span>åšå¤šè¯„åˆ†</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 5px;">
                            <div style="width: 20px; height: 3px; background: #ff4d4f;"></div>
                            <span>åšç©ºè¯„åˆ†</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 5px;">
                            <div style="width: 20px; height: 2px; background: #ffa726; border-top: 2px dashed #ffa726;"></div>
                            <span>å¤šç©ºå·®å€¼</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 5px;">
                            <div style="width: 20px; height: 2px; background: #bb86fc; border-top: 2px dashed #bb86fc;"></div>
                            <span>ä»·æ ¼æ¶¨è·Œå¹…</span>
                        </div>
                    </div>
                    
                    <!-- ç»Ÿè®¡ä¿¡æ¯ -->
                    <div style="margin-top: 15px; padding: 12px; background: rgba(15, 18, 41, 0.6); border-radius: 8px; font-size: 13px; border: 1px solid rgba(139, 143, 164, 0.2);">
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px;">
                            <div>
                                <span style="color: #8b8fa4;">å½“å‰æ—¶æ®µ:</span>
                                <span style="color: #fff; margin-left: 5px; font-weight: 600;" id="currentRange">1å°æ—¶</span>
                            </div>
                            <div>
                                <span style="color: #8b8fa4;">æ•°æ®ç‚¹æ•°:</span>
                                <span style="color: #fff; margin-left: 5px; font-weight: 600;" id="dataPoints">--</span>
                            </div>
                            <div>
                                <span style="color: #8b8fa4;">å¹³å‡åšå¤š:</span>
                                <span style="color: #00ff88; margin-left: 5px; font-weight: 600;" id="avgLong">--</span>
                            </div>
                            <div>
                                <span style="color: #8b8fa4;">å¹³å‡åšç©º:</span>
                                <span style="color: #ff4d4f; margin-left: 5px; font-weight: 600;" id="avgShort">--</span>
                            </div>
                        </div>
                        <!-- è‡ªåŠ¨åˆ·æ–°çŠ¶æ€æŒ‡ç¤ºå™¨ -->
                        <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(139, 143, 164, 0.2); display: flex; justify-content: space-between; align-items: center;">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span style="width: 8px; height: 8px; background: #00ff88; border-radius: 50%; box-shadow: 0 0 8px #00ff88; animation: pulse 2s ease-in-out infinite;"></span>
                                <span style="color: #8b8fa4; font-size: 12px;">è‡ªåŠ¨åˆ·æ–°å·²å¯ç”¨ (30ç§’/æ¬¡)</span>
                            </div>
                            <div>
                                <span style="color: #8b8fa4; font-size: 11px;">ä¸Šæ¬¡åˆ·æ–°:</span>
                                <span style="color: #00ff88; margin-left: 5px; font-size: 11px;" id="lastRefreshTime">--</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ä»·æ ¼æ¶¨è·Œæ›²çº¿å›¾è¡¨ï¼ˆå·²æ•´åˆåˆ°ä¸»å›¾è¡¨ï¼Œæ­¤å®¹å™¨éšè—ï¼‰ -->
                    <div style="margin-top: 20px; padding: 15px; background: rgba(187, 134, 252, 0.05); border: 2px solid rgba(187, 134, 252, 0.3); border-radius: 12px; display: none;">
                        <!-- æ ‡é¢˜ -->
                        <div style="font-size: 14px; color: #bb86fc; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; font-weight: 600;">
                            <div style="width: 20px; height: 2px; background: #bb86fc; border-top: 2px dotted #bb86fc;"></div>
                            <span>ä»·æ ¼æ¶¨è·Œç™¾åˆ†æ¯”æ›²çº¿ï¼ˆå·²é›†æˆåˆ°ä¸»å›¾è¡¨ï¼‰</span>
                        </div>
                        
                        <!-- ä»·æ ¼æ›²çº¿ -->
                        <canvas id="priceChart" width="800" height="120" style="width: 100%; height: 120px;"></canvas>
                        
                        <!-- ç»Ÿè®¡ä¿¡æ¯ -->
                        <div style="margin-top: 12px; padding: 10px; background: rgba(15, 18, 41, 0.6); border-radius: 8px; font-size: 12px; border: 1px solid rgba(139, 143, 164, 0.2);">
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                                <div>
                                    <span style="color: #8b8fa4;">å½“å‰æ—¶æ®µ:</span>
                                    <span style="color: #fff; margin-left: 5px;" id="currentRange">1å°æ—¶</span>
                                </div>
                                <div>
                                    <span style="color: #8b8fa4;">æ•°æ®ç‚¹æ•°:</span>
                                    <span style="color: #fff; margin-left: 5px;" id="dataPoints">--</span>
                                </div>
                                <div>
                                    <span style="color: #8b8fa4;">å¹³å‡åšå¤š:</span>
                                    <span style="color: #00ff88; margin-left: 5px;" id="avgLong">--</span>
                                </div>
                                <div>
                                    <span style="color: #8b8fa4;">å¹³å‡åšç©º:</span>
                                    <span style="color: #ff4d4f; margin-left: 5px;" id="avgShort">--</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SARç»Ÿè®¡é¢æ¿ -->
                <div class="stat-card" style="margin-bottom: 20px;">
                    <div class="stats-title" style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <span>ğŸ¯</span>
                            <span>SARè¶‹åŠ¿ç»Ÿè®¡</span>
                            <!-- å¸ƒæ—å¸¦è±¡é™æŒ‡ç¤ºå™¨ -->
                            <span id="bollingerQuadrant" style="font-size: 12px; padding: 3px 10px; border-radius: 4px; font-weight: 600; border: 1px solid;">--</span>
                        </div>
                        <!-- SARå¸ç§æ˜¾ç¤ºï¼ˆè·Ÿéšå†å²æ·±åº¦è¯„åˆ†çš„é€‰æ‹©ï¼‰ -->
                        <div id="sarCoinDisplay" style="padding: 6px 12px; background: #1a1f3a; border: 1px solid #2d3455; border-radius: 6px; color: #00ff88; font-size: 14px; font-weight: 600;">
                            TAO
                        </div>
                    </div>
                    
                    <!-- SARå•å¸ç§æ˜¾ç¤º -->
                    <div style="margin-top: 15px;">
                        <div class="sar-coin-card" id="sarSingleCard" style="max-width: 500px; margin: 0 auto;">
                            <div class="sar-coin-header">
                                <span class="sar-coin-name" id="sarCoinName">TAO</span>
                                <span class="sar-trend" id="sarTrend">--</span>
                            </div>
                            <div class="sar-coin-info">
                                <div style="font-size: 12px; color: #8b8fa4;">RSI(5m)</div>
                                <div class="sar-rsi" id="sarRsi" style="font-size: 16px;">--</div>
                            </div>
                            <div class="sar-coin-info">
                                <div style="font-size: 12px; color: #8b8fa4;">ä»·æ ¼</div>
                                <div class="sar-price" id="sarPrice" style="font-size: 16px;">--</div>
                            </div>

                            <div class="sar-update-time" id="sarUpdateTime">--</div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 12px; padding: 8px; background: rgba(139, 143, 164, 0.1); border-left: 3px solid #8b8fa4; border-radius: 4px; font-size: 11px; color: #8b8fa4;">
                        ğŸ’¡ SAR: åœ¨Kçº¿ä¸Šæ–¹=ç©ºå¤´ | åœ¨Kçº¿ä¸‹æ–¹=å¤šå¤´ | è‡ªåŠ¨è®¡æ•°è½¬æ¢æ¬¡æ•° | æ¯5åˆ†é’Ÿæ›´æ–°
                    </div>
                </div>

                <div class="stats-title">
                    <span>ğŸ“ˆ</span>
                    <span>æ·±åº¦çº¿è¯„åˆ†ç³»ç»Ÿ</span>
                    <div class="status-indicator" id="monitorStatus">
                        <div class="status-dot"></div>
                        <span>ç›‘æ§ä¸­</span>
                    </div>
                </div>

                <!-- å·²é€‰å¸ç§æ˜¾ç¤º -->
                <div class="stat-card" style="margin-bottom: 15px; background: linear-gradient(135deg, #1a1f3a 0%, #0f1229 100%);">
                    <div style="font-size: 14px; color: #8b8fa4; margin-bottom: 10px;">
                        <span>ğŸ“Š</span>
                        <span>å·²é€‰ç›‘æ§å¸ç§</span>
                    </div>
                    <div style="padding: 12px; background: #0f1229; border-radius: 6px; border: 1px solid #2d3455;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <span style="color: #8b8fa4; font-size: 13px;">é€‰ä¸­æ•°é‡:</span>
                            <span style="color: #00ff88; font-weight: 600; font-size: 16px;" id="selectedCount">27</span>
                        </div>
                        <div style="display: flex; flex-wrap: wrap; gap: 6px; margin-top: 10px;" id="selectedCoinsDisplay">
                            <span style="padding: 4px 10px; background: #1a1f3a; border: 1px solid #00ff88; border-radius: 4px; color: #00ff88; font-size: 12px;">BTC</span>
                            <span style="padding: 4px 10px; background: #1a1f3a; border: 1px solid #00ff88; border-radius: 4px; color: #00ff88; font-size: 12px;">ETH</span>
                            <span style="padding: 4px 10px; background: #1a1f3a; border: 1px solid #00ff88; border-radius: 4px; color: #00ff88; font-size: 12px;">XRP</span>
                            <span style="padding: 4px 10px; background: #1a1f3a; border: 1px solid #00ff88; border-radius: 4px; color: #00ff88; font-size: 12px;">BNB</span>
                            <span style="padding: 4px 10px; background: #1a1f3a; border: 1px solid #00ff88; border-radius: 4px; color: #00ff88; font-size: 12px;">SOL</span>
                            <span style="padding: 4px 10px; background: #1a1f3a; border: 1px solid #00ff88; border-radius: 4px; color: #00ff88; font-size: 12px;">LTC</span>
                            <span style="padding: 4px 10px; background: #1a1f3a; border: 1px solid #00ff88; border-radius: 4px; color: #00ff88; font-size: 12px;">DOGE</span>
                            <span style="padding: 4px 10px; background: #1a1f3a; border: 1px solid #00ff88; border-radius: 4px; color: #00ff88; font-size: 12px;">SUI</span>
                            <span style="padding: 4px 10px; background: #1a1f3a; border: 1px solid #00ff88; border-radius: 4px; color: #00ff88; font-size: 12px;">TRX</span>
                            <span style="padding: 4px 10px; background: #1a1f3a; border: 1px solid #00ff88; border-radius: 4px; color: #00ff88; font-size: 12px;">TON</span>
                            <span style="padding: 4px 10px; background: #1a1f3a; border: 1px solid #00ff88; border-radius: 4px; color: #00ff88; font-size: 12px;">ETC</span>
                            <span style="padding: 4px 10px; background: #1a1f3a; border: 1px solid #00ff88; border-radius: 4px; color: #00ff88; font-size: 12px;">BCH</span>
                            <span style="padding: 4px 10px; background: #1a1f3a; border: 1px solid #00ff88; border-radius: 4px; color: #00ff88; font-size: 12px;">HBAR</span>
                            <span style="padding: 4px 10px; background: #1a1f3a; border: 1px solid #00ff88; border-radius: 4px; color: #00ff88; font-size: 12px;">XLM</span>
                            <span style="padding: 4px 10px; background: #1a1f3a; border: 1px solid #00ff88; border-radius: 4px; color: #00ff88; font-size: 12px;">FIL</span>
                            <span style="padding: 4px 10px; background: #1a1f3a; border: 1px solid #00ff88; border-radius: 4px; color: #00ff88; font-size: 12px;">LINK</span>
                            <span style="padding: 4px 10px; background: #1a1f3a; border: 1px solid #00ff88; border-radius: 4px; color: #00ff88; font-size: 12px;">CRO</span>
                            <span style="padding: 4px 10px; background: #1a1f3a; border: 1px solid #00ff88; border-radius: 4px; color: #00ff88; font-size: 12px;">DOT</span>
                            <span style="padding: 4px 10px; background: #1a1f3a; border: 1px solid #00ff88; border-radius: 4px; color: #00ff88; font-size: 12px;">AAVE</span>
                            <span style="padding: 4px 10px; background: #1a1f3a; border: 1px solid #00ff88; border-radius: 4px; color: #00ff88; font-size: 12px;">UNI</span>
                            <span style="padding: 4px 10px; background: #1a1f3a; border: 1px solid #00ff88; border-radius: 4px; color: #00ff88; font-size: 12px;">NEAR</span>
                            <span style="padding: 4px 10px; background: #1a1f3a; border: 1px solid #00ff88; border-radius: 4px; color: #00ff88; font-size: 12px;">APT</span>
                            <span style="padding: 4px 10px; background: #1a1f3a; border: 1px solid #00ff88; border-radius: 4px; color: #00ff88; font-size: 12px;">CFX</span>
                            <span style="padding: 4px 10px; background: #1a1f3a; border: 1px solid #00ff88; border-radius: 4px; color: #00ff88; font-size: 12px;">CRV</span>
                            <span style="padding: 4px 10px; background: #1a1f3a; border: 1px solid #00ff88; border-radius: 4px; color: #00ff88; font-size: 12px;">STX</span>
                            <span style="padding: 4px 10px; background: #1a1f3a; border: 1px solid #00ff88; border-radius: 4px; color: #00ff88; font-size: 12px;">LDO</span>
                            <span style="padding: 4px 10px; background: #1a1f3a; border: 1px solid #00ff88; border-radius: 4px; color: #00ff88; font-size: 12px;">TAO</span>
                        </div>
                    </div>
                    <div style="margin-top: 10px; padding: 8px; background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00ff88; border-radius: 4px; font-size: 12px; color: #8b8fa4;">
                        ğŸ’¡ æç¤ºï¼šç‚¹å‡»å·¦ä¾§å¸ç§æŒ‰é’®è¿›è¡Œå¤šé€‰ï¼Œå¯åŠ¨ç›‘æ§å°†ç›‘æ§æ‰€æœ‰é€‰ä¸­çš„å¸ç§
                    </div>
                </div>

                <!-- æ§åˆ¶æŒ‰é’® -->
                <div class="control-buttons">
                    <button class="control-btn start" onclick="startMonitor()" id="startBtn">å¯åŠ¨ç›‘æ§ (27ä¸ªå¸ç§)</button>
                    <button class="control-btn stop" onclick="stopMonitor()" id="stopBtn" disabled>åœæ­¢ç›‘æ§</button>
                </div>
                
                <!-- å†…å­˜ç®¡ç†æŒ‰é’® -->
                <div class="control-buttons">
                    <button class="control-btn memory" onclick="manualClearMemory()" title="ç«‹å³é‡Šæ”¾å†…å­˜">ğŸ§¹ é‡Šæ”¾å†…å­˜</button>
                    <button class="control-btn refresh" onclick="hardRefresh()" title="ç¡¬åˆ·æ–°é¡µé¢">ğŸ”„ ç¡¬åˆ·æ–°</button>
                </div>

                <!-- åšå¤šå¾—åˆ† -->
                <div class="score-card">
                    <div class="score-header">
                        <div class="score-label">åšå¤šå¾—åˆ†</div>
                        <div class="score-value long" id="longScore">--</div>
                    </div>
                    <div class="score-bar">
                        <div class="score-bar-fill long" id="longScoreBar" style="width: 0%"></div>
                    </div>
                    <div class="distribution-grid" id="longDistribution">
                        <!-- åŠ¨æ€ç”Ÿæˆ20ä¸ªæ ¼å­ -->
                    </div>
                </div>

                <!-- åšç©ºå¾—åˆ† -->
                <div class="score-card">
                    <div class="score-header">
                        <div class="score-label">åšç©ºå¾—åˆ†</div>
                        <div class="score-value short" id="shortScore">--</div>
                    </div>
                    <div class="score-bar">
                        <div class="score-bar-fill short" id="shortScoreBar" style="width: 0%"></div>
                    </div>
                    <div class="distribution-grid" id="shortDistribution">
                        <!-- åŠ¨æ€ç”Ÿæˆ20ä¸ªæ ¼å­ -->
                    </div>
                </div>

                <!-- æ·±åº¦çº¿ä½ç½®æ ‡æ³¨ -->
                <div class="stat-card">
                    <div class="stats-title">
                        <span>ğŸ“</span>
                        <span>æ·±åº¦çº¿ä½ç½®æ ‡æ³¨</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">åšå¤šçº¿é¡¶éƒ¨ï¼ˆYè½´ï¼‰</span>
                        <span class="stat-value green" id="longTop">--</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">åšå¤šçº¿åº•éƒ¨ï¼ˆYè½´ï¼‰</span>
                        <span class="stat-value green" id="longBottom">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">åšç©ºçº¿é¡¶éƒ¨ï¼ˆYè½´ï¼‰</span>
                        <span class="stat-value red" id="shortTop">--</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">åšç©ºçº¿åº•éƒ¨ï¼ˆYè½´ï¼‰</span>
                        <span class="stat-value red" id="shortBottom">0</span>
                    </div>
                </div>

                <!-- æ·±åº¦ç»Ÿè®¡ -->
                <div class="stat-card">
                    <div class="stats-title">
                        <span>ğŸ’°</span>
                        <span>æ·±åº¦ç»Ÿè®¡</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">ä¹°ç›˜ç´¯ç§¯é‡</span>
                        <span class="stat-value green" id="bidVolume">--</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">å–ç›˜ç´¯ç§¯é‡</span>
                        <span class="stat-value red" id="askVolume">--</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">ä¸­é—´ä»·</span>
                        <span class="stat-value yellow" id="midPrice">--</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">æ•°æ®æ¡æ•°</span>
                        <span class="stat-value" id="dataCount">--</span>
                    </div>
                </div>

                <div class="update-time" id="updateTime">æœ€åæ›´æ–°: --</div>
            </div>
        </div>
    </div>

    <script>
        // è‡ªåŠ¨æ„å»ºAPI URL - æ”¯æŒe2b.devåŸŸå
        const API_BASE_URL = (() => {
            const hostname = window.location.hostname;
            const protocol = window.location.protocol;
            if (hostname === 'localhost' || hostname === '127.0.0.1') {
                return 'http://localhost:5009';
            }
            // ä» 3000-xxx.e2b.dev è½¬æ¢ä¸º 5009-xxx.e2b.dev
            const parts = hostname.split('-');
            parts[0] = '5009';
            return `${protocol}//${parts.join('-')}`;
        })();
        
        console.log('ğŸ”— API Base URL:', API_BASE_URL);
        
        // å†å²æ•°æ®API URL (ç«¯å£5011)
        const HISTORY_API_URL = (() => {
            const hostname = window.location.hostname;
            const protocol = window.location.protocol;
            if (hostname === 'localhost' || hostname === '127.0.0.1') {
                return 'http://localhost:5011';
            }
            const parts = hostname.split('-');
            parts[0] = '5011';
            return `${protocol}//${parts.join('-')}`;
        })();
        
        console.log('ğŸ”— History API URL:', HISTORY_API_URL);
        
        // ä»·æ ¼ç›‘æ§API URL (ç«¯å£5006)
        const PRICE_API_URL = (() => {
            const hostname = window.location.hostname;
            const protocol = window.location.protocol;
            if (hostname === 'localhost' || hostname === '127.0.0.1') {
                return 'http://localhost:5006';
            }
            const parts = hostname.split('-');
            parts[0] = '5006';
            return `${protocol}//${parts.join('-')}`;
        })();
        
        console.log('ğŸ”— Price API URL:', PRICE_API_URL);
        
        // è¦ç›‘æ§çš„å¸ç§åˆ—è¡¨
        const MONITOR_SYMBOLS = [
            'BTC-USDT-SWAP',
            'ETH-USDT-SWAP',
            'XRP-USDT-SWAP', 
            'BNB-USDT-SWAP',
            'SOL-USDT-SWAP',
            'LTC-USDT-SWAP',
            'DOGE-USDT-SWAP',
            'SUI-USDT-SWAP',
            'TRX-USDT-SWAP',
            'TON-USDT-SWAP',
            'ETC-USDT-SWAP',
            'BCH-USDT-SWAP',
            'HBAR-USDT-SWAP',
            'XLM-USDT-SWAP',
            'FIL-USDT-SWAP',
            'LINK-USDT-SWAP',
            'CRO-USDT-SWAP',
            'DOT-USDT-SWAP',
            'AAVE-USDT-SWAP',
            'UNI-USDT-SWAP',
            'NEAR-USDT-SWAP',
            'APT-USDT-SWAP',
            'CFX-USDT-SWAP',
            'CRV-USDT-SWAP',
            'STX-USDT-SWAP',
            'LDO-USDT-SWAP',
            'TAO-USDT-SWAP'
        ];
        
        let currentSymbol = 'ETH-USDT-SWAP';
        let updateInterval;
        let saveDataInterval; // å®šæ—¶ä¿å­˜æ•°æ®åˆ°æ•°æ®åº“
        let priceUpdateInterval; // å®æ—¶ä»·æ ¼æ›´æ–°å®šæ—¶å™¨ï¼ˆ0.5ç§’ï¼‰
        let trendCanvas, trendCtx;
        let historyCanvas, historyCtx;
        let priceCanvas, priceCtx;
        let currentTimeRange = '1h'; // å½“å‰é€‰ä¸­çš„æ—¶é—´èŒƒå›´
        
        // âš¡ æ€§èƒ½ä¼˜åŒ–ï¼šæ·»åŠ å¸ç§æ•°æ®ç¼“å­˜
        let symbolDataCache = {}; // æ ¼å¼: { 'BTC-1h': { data, timestamp }, ... }
        let scoreHistory = {
            long: [],
            short: [],
            timestamps: []
        };
        // å®æ—¶ä»·æ ¼å˜åŒ–å†å²ï¼ˆç”¨äºä»·æ ¼æ›²çº¿å®æ—¶æ˜¾ç¤ºï¼‰
        let realtimePriceHistory = {
            prices: [],        // å®é™…ä»·æ ¼
            changes: [],       // æ¶¨è·Œå¹…ç™¾åˆ†æ¯”
            timestamps: [],    // æ—¶é—´æˆ³
            basePrice: null    // åŸºå‡†ä»·æ ¼ï¼ˆç”¨äºè®¡ç®—æ¶¨è·Œå¹…ï¼‰
        };
        let historyData = {
            '3m': { long: [], short: [], timestamps: [], price_change: [], price_actual: [] },
            '1h': { long: [], short: [], timestamps: [], price_change: [], price_actual: [] },
            '3h': { long: [], short: [], timestamps: [], price_change: [], price_actual: [] },
            '6h': { long: [], short: [], timestamps: [], price_change: [], price_actual: [] },
            '12h': { long: [], short: [], timestamps: [], price_change: [], price_actual: [] },
            '24h': { long: [], short: [], timestamps: [], price_change: [], price_actual: [] }
        };

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            // åˆå§‹åŒ–åˆ†å¸ƒç½‘æ ¼
            initDistributionGrid('longDistribution', 20);
            initDistributionGrid('shortDistribution', 20);

            // åˆå§‹åŒ–å†å²å›¾è¡¨Canvas
            historyCanvas = document.getElementById('historyChart');
            historyCtx = historyCanvas.getContext('2d');
            priceCanvas = document.getElementById('priceChart');
            priceCtx = priceCanvas.getContext('2d');
            
            // iframeåŠ è½½å®Œæˆ
            document.getElementById('okexIframe').onload = function() {
                document.getElementById('loadingOverlay').style.display = 'none';
            };

            // æ£€æŸ¥ç›‘æ§çŠ¶æ€
            checkMonitorStatus();
            
            // åŠ è½½å†å²æ•°æ®
            loadHistoryData('1h');
            
            // ğŸ¯ åˆå§‹åŒ–SARå¸ç§æ˜¾ç¤ºï¼ˆä¸å†å²æ·±åº¦è¯„åˆ†çš„é»˜è®¤å¸ç§åŒæ­¥ï¼‰
            updateSarCoinDisplay(currentSymbol);
            
            // å¯åŠ¨å†å²æ•°æ®è‡ªåŠ¨åˆ·æ–°ï¼ˆæ¯30ç§’åˆ·æ–°ä¸€æ¬¡ï¼‰
            console.log('âœ… å†å²æ•°æ®è‡ªåŠ¨åˆ·æ–°å·²å¯åŠ¨ï¼ˆæ¯30ç§’ï¼‰');
            setInterval(() => {
                console.log('ğŸ”„ è‡ªåŠ¨åˆ·æ–°å†å²æ•°æ®...', new Date().toLocaleTimeString());
                loadHistoryData(currentTimeRange);
            }, 30000);
            
            // å¯åŠ¨å®šæ—¶ä¿å­˜æ•°æ®ï¼ˆæ¯30ç§’ä¿å­˜ä¸€æ¬¡ï¼‰
            startAutoSave();
        });

        function initDistributionGrid(containerId, count) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            for (let i = 0; i < count; i++) {
                const cell = document.createElement('div');
                cell.className = 'dist-cell';
                cell.innerHTML = `<div class="dist-cell-fill ${containerId.includes('long') ? 'long' : 'short'}"></div>`;
                container.appendChild(cell);
            }
        }

        function loadOkexPage() {
            const symbol = document.getElementById('symbolInput').value.trim();
            if (!symbol) {
                alert('è¯·è¾“å…¥äº¤æ˜“å¯¹');
                return;
            }
            
            document.getElementById('loadingOverlay').style.display = 'flex';
            const iframe = document.getElementById('okexIframe');
            iframe.src = `https://www.okx.com/zh-hans/trade-swap/${symbol}`;
            
            // æ›´æ–°å½“å‰å¸ç§
            currentSymbol = symbol.toUpperCase().replace(/-/g, '-');
        }

        // å¿«é€Ÿé€‰æ‹©å¸ç§ï¼ˆå·¦ä¾§OKXé¡µé¢ï¼‰
        // å­˜å‚¨é€‰ä¸­çš„å¸ç§åˆ—è¡¨ï¼ˆæ”¯æŒå¤šé€‰ï¼‰
        let selectedSymbols = [...MONITOR_SYMBOLS]; // é»˜è®¤å…¨éƒ¨é€‰ä¸­ï¼ˆ19ä¸ªå¸ç§ï¼‰
        
        // å…¨é€‰æ‰€æœ‰å¸ç§
        function selectAll() {
            selectedSymbols = [...MONITOR_SYMBOLS];
            document.querySelectorAll('.quick-btn').forEach(btn => {
                btn.classList.add('active');
            });
            updateSelectedDisplay();
            console.log('âœ… å…¨é€‰æ‰€æœ‰å¸ç§:', selectedSymbols.join(', '));
            alert(`âœ… å·²é€‰ä¸­å…¨éƒ¨ ${selectedSymbols.length} ä¸ªå¸ç§`);
        }
        
        // æ¸…ç©ºæ‰€æœ‰é€‰æ‹©ï¼ˆä¿ç•™ç¬¬ä¸€ä¸ªï¼‰
        function clearAll() {
            selectedSymbols = [MONITOR_SYMBOLS[0]]; // ä¿ç•™ç¬¬ä¸€ä¸ª
            document.querySelectorAll('.quick-btn').forEach((btn, index) => {
                if (index === 0) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            updateSelectedDisplay();
            console.log('ğŸ”„ å·²æ¸…ç©ºï¼Œä¿ç•™:', selectedSymbols[0]);
            alert('ğŸ”„ å·²æ¸…ç©ºé€‰æ‹©ï¼Œä¿ç•™ ETH');
        }
        
        function quickSelect(symbol) {
            const upperSymbol = symbol.toUpperCase();
            const btn = event.target;
            
            // åˆ‡æ¢é€‰ä¸­çŠ¶æ€ï¼ˆå¤šé€‰æ¨¡å¼ï¼‰
            if (btn.classList.contains('active')) {
                // å¦‚æœå·²é€‰ä¸­ï¼Œåˆ™å–æ¶ˆé€‰ä¸­
                if (selectedSymbols.length > 1) { // è‡³å°‘ä¿ç•™ä¸€ä¸ªé€‰ä¸­
                    btn.classList.remove('active');
                    selectedSymbols = selectedSymbols.filter(s => s !== upperSymbol);
                    console.log('âŒ å–æ¶ˆé€‰æ‹©:', upperSymbol);
                } else {
                    console.log('âš ï¸ è‡³å°‘éœ€è¦é€‰æ‹©ä¸€ä¸ªå¸ç§');
                    return;
                }
            } else {
                // å¦‚æœæœªé€‰ä¸­ï¼Œåˆ™æ·»åŠ é€‰ä¸­
                btn.classList.add('active');
                selectedSymbols.push(upperSymbol);
                console.log('âœ… æ·»åŠ é€‰æ‹©:', upperSymbol);
            }
            
            // æ›´æ–°å³ä¾§æ˜¾ç¤º
            updateSelectedDisplay();
            
            // æ›´æ–°æ˜¾ç¤ºçš„å¸ç§åˆ—è¡¨
            console.log('ğŸ“Š å½“å‰é€‰ä¸­å¸ç§:', selectedSymbols.join(', '));
            
            // æ›´æ–°è¾“å…¥æ¡†æ˜¾ç¤ºç¬¬ä¸€ä¸ªé€‰ä¸­çš„å¸ç§
            document.getElementById('symbolInput').value = selectedSymbols[0].toLowerCase();
            
            // è‡ªåŠ¨åŠ è½½ç¬¬ä¸€ä¸ªé€‰ä¸­å¸ç§çš„OKXé¡µé¢
            loadOkexPage();
            
            // å¦‚æœç›‘æ§æ­£åœ¨è¿è¡Œï¼Œæ›´æ–°ç›‘æ§åˆ—è¡¨
            if (document.getElementById('startBtn').disabled) {
                console.log('ğŸ”„ ç›‘æ§å¸ç§å·²æ›´æ–°ä¸º:', selectedSymbols.join(', '));
            }
        }
        
        // æ›´æ–°å³ä¾§é€‰ä¸­å¸ç§çš„æ˜¾ç¤º
        function updateSelectedDisplay() {
            // æ›´æ–°æ•°é‡
            document.getElementById('selectedCount').textContent = selectedSymbols.length;
            
            // æ›´æ–°å¸ç§æ ‡ç­¾
            const displayDiv = document.getElementById('selectedCoinsDisplay');
            displayDiv.innerHTML = selectedSymbols.map(symbol => {
                const coinName = symbol.split('-')[0]; // æå–å¸ç§åç§°
                return `<span style="padding: 4px 10px; background: #1a1f3a; border: 1px solid #00ff88; border-radius: 4px; color: #00ff88; font-size: 12px;">${coinName}</span>`;
            }).join('');
        }

        // é€‰æ‹©ç›‘æ§å¸ç§ï¼ˆå³ä¾§è¯„åˆ†ç³»ç»Ÿï¼‰
        function selectMonitorCoin(symbol, btnElement) {
            // æ›´æ–°å½“å‰ç›‘æ§çš„å¸ç§
            currentSymbol = symbol;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.coin-select-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            if (btnElement) {
                btnElement.classList.add('active');
            }
            
            // æ›´æ–°æ˜¾ç¤ºçš„å½“å‰å¸ç§
            document.getElementById('currentMonitorSymbol').textContent = symbol;
            
            // å¦‚æœç›‘æ§æ­£åœ¨è¿è¡Œï¼Œé‡æ–°åŠ è½½è¯¥å¸ç§çš„æ•°æ®
            const isMonitoring = !document.getElementById('startBtn').disabled;
            if (isMonitoring) {
                // ç«‹å³æ›´æ–°æ•°æ®
                updateData();
                console.log('âœ… å·²åˆ‡æ¢ç›‘æ§å¸ç§åˆ°:', symbol);
            }
            
            // é‡æ–°åŠ è½½å†å²æ•°æ®
            loadHistoryData(currentTimeRange);
        }

        async function startMonitor() {
            try {
                // ç›‘æ§é€‰ä¸­çš„å¸ç§
                const response = await fetch(`${API_BASE_URL}/api/depth/score/start`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ symbols: selectedSymbols })
                });
                
                const data = await response.json();
                if (data.success) {
                    document.getElementById('startBtn').disabled = true;
                    document.getElementById('stopBtn').disabled = false;
                    startUpdate();
                    
                    // æ˜¾ç¤ºæ­£åœ¨ç›‘æ§çš„å¸ç§
                    const symbolsText = selectedSymbols.map(s => s.split('-')[0]).join(', ');
                    alert(`âœ… ç›‘æ§å·²å¯åŠ¨\næ­£åœ¨ç›‘æ§ ${selectedSymbols.length} ä¸ªå¸ç§:\n${symbolsText}`);
                    
                    // æ›´æ–°æŒ‰é’®æ–‡æœ¬
                    document.getElementById('startBtn').textContent = `å¯åŠ¨ç›‘æ§ (${selectedSymbols.length}ä¸ªå¸ç§)`;
                } else {
                    alert('å¯åŠ¨å¤±è´¥: ' + data.message);
                }
            } catch (error) {
                console.error('å¯åŠ¨ç›‘æ§å¤±è´¥:', error);
                alert('å¯åŠ¨å¤±è´¥ï¼Œè¯·æ£€æŸ¥APIæœåŠ¡');
            }
        }

        async function stopMonitor() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/depth/score/stop`, {
                    method: 'POST'
                });
                
                const data = await response.json();
                if (data.success) {
                    document.getElementById('startBtn').disabled = false;
                    document.getElementById('stopBtn').disabled = true;
                    stopUpdate();
                    alert('ç›‘æ§å·²åœæ­¢');
                }
            } catch (error) {
                console.error('åœæ­¢ç›‘æ§å¤±è´¥:', error);
            }
        }

        async function checkMonitorStatus() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/depth/score/status`);
                const data = await response.json();
                
                if (data.success && data.is_running) {
                    // ç›‘æ§æ­£åœ¨è¿è¡Œ
                    document.getElementById('startBtn').disabled = true;
                    document.getElementById('stopBtn').disabled = false;
                    startUpdate();
                    console.log('âœ… ç›‘æ§å·²åœ¨è¿è¡Œä¸­');
                } else {
                    // ç›‘æ§æœªè¿è¡Œï¼Œè‡ªåŠ¨å¯åŠ¨
                    console.log('âš ï¸ ç›‘æ§æœªè¿è¡Œï¼Œè‡ªåŠ¨å¯åŠ¨ä¸­...');
                    await autoStartMonitor();
                }
            } catch (error) {
                console.error('æ£€æŸ¥çŠ¶æ€å¤±è´¥:', error);
                // å³ä½¿æ£€æŸ¥å¤±è´¥ï¼Œä¹Ÿå°è¯•å¯åŠ¨ç›‘æ§
                console.log('âš ï¸ æ— æ³•æ£€æŸ¥çŠ¶æ€ï¼Œå°è¯•è‡ªåŠ¨å¯åŠ¨...');
                await autoStartMonitor();
            }
        }
        
        // è‡ªåŠ¨å¯åŠ¨ç›‘æ§ï¼ˆä¸æ˜¾ç¤ºalertï¼‰
        async function autoStartMonitor() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/depth/score/start`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ symbols: selectedSymbols })
                });
                
                const data = await response.json();
                if (data.success) {
                    document.getElementById('startBtn').disabled = true;
                    document.getElementById('stopBtn').disabled = false;
                    startUpdate();
                    console.log('âœ… ç›‘æ§å·²è‡ªåŠ¨å¯åŠ¨ï¼Œç›‘æ§å¸ç§:', selectedSymbols);
                    
                    // æ›´æ–°æŒ‰é’®æ–‡æœ¬
                    document.getElementById('startBtn').textContent = `å¯åŠ¨ç›‘æ§ (${selectedSymbols.length}ä¸ªå¸ç§)`;
                    
                    // æ˜¾ç¤ºç®€çŸ­çš„é€šçŸ¥ï¼ˆä¸ç”¨alertæ‰“æ–­ï¼‰
                    showNotification(`âœ… æ·±åº¦çº¿è¯„åˆ†ç³»ç»Ÿå·²è‡ªåŠ¨å¯åŠ¨ (${selectedSymbols.length}ä¸ªå¸ç§)`);
                } else {
                    console.error('è‡ªåŠ¨å¯åŠ¨å¤±è´¥:', data.message);
                }
            } catch (error) {
                console.error('è‡ªåŠ¨å¯åŠ¨ç›‘æ§å¤±è´¥:', error);
            }
        }
        
        // æ˜¾ç¤ºé€šçŸ¥ï¼ˆéä¾µå…¥å¼ï¼‰
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #00ff88 0%, #00cc6a 100%);
                color: #0a0e27;
                padding: 15px 25px;
                border-radius: 8px;
                box-shadow: 0 4px 20px rgba(0, 255, 136, 0.4);
                font-weight: 600;
                z-index: 10000;
                animation: slideIn 0.3s ease-out;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            // 3ç§’åè‡ªåŠ¨æ¶ˆå¤±
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease-in';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        function startUpdate() {
            if (updateInterval) clearInterval(updateInterval);
            updateData(); // ç«‹å³æ›´æ–°ä¸€æ¬¡
            updateInterval = setInterval(updateData, 2000); // æ¯2ç§’æ›´æ–°
            
            // å¯åŠ¨å®æ—¶ä»·æ ¼æ›´æ–°ï¼ˆæ¯0.5ç§’ï¼‰
            if (priceUpdateInterval) clearInterval(priceUpdateInterval);
            updateRealtimePrice(); // ç«‹å³æ›´æ–°ä¸€æ¬¡
            priceUpdateInterval = setInterval(updateRealtimePrice, 500); // æ¯0.5ç§’æ›´æ–°ä»·æ ¼
        }

        function stopUpdate() {
            if (updateInterval) {
                clearInterval(updateInterval);
                updateInterval = null;
            }
            if (priceUpdateInterval) {
                clearInterval(priceUpdateInterval);
                priceUpdateInterval = null;
            }
        }
        
        // å®æ—¶ä»·æ ¼æ›´æ–°å‡½æ•°ï¼ˆæ¯0.5ç§’è°ƒç”¨ï¼‰
        async function updateRealtimePrice() {
            try {
                // ä» change-monitor-api è·å–å®æ—¶ä»·æ ¼æ•°æ®
                const response = await fetch(`http://localhost:5013/api/change/data`);
                const result = await response.json();
                
                if (result.success && result.data) {
                    // æ‰¾åˆ°å½“å‰é€‰ä¸­å¸ç§çš„æ•°æ®
                    const coinData = result.data.find(coin => coin.symbol === currentSymbol);
                    
                    if (coinData && coinData.price) {
                        const currentPrice = coinData.price;
                        const timestamp = Date.now();
                        
                        // å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡è®°å½•ï¼Œè®¾ç½®åŸºå‡†ä»·æ ¼
                        if (realtimePriceHistory.basePrice === null) {
                            realtimePriceHistory.basePrice = currentPrice;
                        }
                        
                        // è®¡ç®—æ¶¨è·Œå¹…ï¼ˆç›¸å¯¹äºåŸºå‡†ä»·æ ¼ï¼‰
                        const changePercent = ((currentPrice - realtimePriceHistory.basePrice) / realtimePriceHistory.basePrice) * 100;
                        
                        // è®°å½•æ•°æ®
                        realtimePriceHistory.prices.push(currentPrice);
                        realtimePriceHistory.changes.push(changePercent);
                        realtimePriceHistory.timestamps.push(timestamp);
                        
                        // åªä¿ç•™æœ€è¿‘3åˆ†é’Ÿçš„æ•°æ®ï¼ˆ360ä¸ªç‚¹ï¼Œæ¯0.5ç§’ä¸€ä¸ªï¼‰
                        const maxPoints = 360;
                        if (realtimePriceHistory.prices.length > maxPoints) {
                            realtimePriceHistory.prices.shift();
                            realtimePriceHistory.changes.shift();
                            realtimePriceHistory.timestamps.shift();
                        }
                        
                        // é‡æ–°ç»˜åˆ¶å®æ—¶ä»·æ ¼æ›²çº¿
                        drawRealtimePriceChart();
                    }
                }
            } catch (error) {
                console.error('æ›´æ–°å®æ—¶ä»·æ ¼å¤±è´¥:', error);
            }
        }

        async function updateData() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/depth/score/current/${currentSymbol}`);
                const result = await response.json();
                
                if (result.success && result.data) {
                    const data = result.data;
                    
                    // æ›´æ–°å¾—åˆ†
                    document.getElementById('longScore').textContent = data.long_score.toFixed(2);
                    document.getElementById('shortScore').textContent = data.short_score.toFixed(2);
                    
                    // æ›´æ–°è¿›åº¦æ¡
                    document.getElementById('longScoreBar').style.width = data.long_score + '%';
                    document.getElementById('shortScoreBar').style.width = data.short_score + '%';
                    
                    // æ›´æ–°åˆ†å¸ƒ
                    updateDistribution('longDistribution', data.long_distribution);
                    updateDistribution('shortDistribution', data.short_distribution);
                    
                    // æ›´æ–°æ·±åº¦çº¿ä½ç½®æ ‡æ³¨
                    document.getElementById('longTop').textContent = formatNumber(data.max_bid_volume);
                    document.getElementById('longBottom').textContent = '0';
                    document.getElementById('shortTop').textContent = formatNumber(data.max_ask_volume);
                    document.getElementById('shortBottom').textContent = '0';
                    
                    // æ›´æ–°ç»Ÿè®¡æ•°æ®
                    document.getElementById('bidVolume').textContent = formatNumber(data.max_bid_volume);
                    document.getElementById('askVolume').textContent = formatNumber(data.max_ask_volume);
                    document.getElementById('midPrice').textContent = data.mid_price.toFixed(2);
                    
                    // è®°å½•å†å²æ•°æ®ç”¨äºæ›²çº¿å›¾
                    scoreHistory.long.push(data.long_score);
                    scoreHistory.short.push(data.short_score);
                    scoreHistory.timestamps.push(new Date(data.timestamp));
                    
                    // åªä¿ç•™3åˆ†é’Ÿæ•°æ®ï¼ˆ180ä¸ªç‚¹ï¼Œæ¯2ç§’æ›´æ–°ä¸€æ¬¡ï¼‰
                    const maxPoints = 90;
                    if (scoreHistory.long.length > maxPoints) {
                        scoreHistory.long.shift();
                        scoreHistory.short.shift();
                        scoreHistory.timestamps.shift();
                    }
                    
                    // ç»˜åˆ¶æ›²çº¿å›¾
                    drawTrendChart();
                    
                    // æ›´æ–°æ—¶é—´
                    const now = new Date();
                    document.getElementById('updateTime').textContent = `æœ€åæ›´æ–°: ${now.toLocaleTimeString()}`;
                }
                
                // è·å–å†å²æ•°æ®æ¡æ•°
                const historyResponse = await fetch(`${API_BASE_URL}/api/depth/score/status`);
                const historyData = await historyResponse.json();
                if (historyData.success && historyData.history_counts) {
                    const count = historyData.history_counts[currentSymbol] || 0;
                    document.getElementById('dataCount').textContent = count + ' æ¡';
                }
                
            } catch (error) {
                console.error('æ›´æ–°æ•°æ®å¤±è´¥:', error);
            }
        }

        function updateDistribution(containerId, distribution) {
            const container = document.getElementById(containerId);
            const cells = container.querySelectorAll('.dist-cell-fill');
            const maxCount = Math.max(...distribution, 1);
            
            distribution.forEach((count, index) => {
                if (cells[index]) {
                    const percentage = (count / maxCount) * 100;
                    cells[index].style.height = percentage + '%';
                }
            });
        }

        function formatNumber(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(2) + 'M';
            } else if (num >= 1000) {
                return (num / 1000).toFixed(2) + 'K';
            }
            return num.toFixed(2);
        }

        // æ·±åº¦å›¾æ ‡è¯†æ¡†æ§åˆ¶
        let isDragging = false;
        let dragStartX = 0;
        let dragStartY = 0;
        let markerStartLeft = 0;
        let markerStartTop = 0;

        function toggleMarker() {
            const marker = document.getElementById('depthMarker');
            if (marker.style.display === 'none') {
                marker.style.display = 'block';
                updateMarker();
                initDragHandlers();
            } else {
                marker.style.display = 'none';
            }
        }

        function updateMarker() {
            const marker = document.getElementById('depthMarker');
            const left = document.getElementById('markerLeft').value;
            const top = document.getElementById('markerTop').value;
            const width = document.getElementById('markerWidth').value;
            const height = document.getElementById('markerHeight').value;
            
            marker.style.left = left + 'px';
            marker.style.top = top + 'px';
            marker.style.width = width + 'px';
            marker.style.height = height + 'px';
            
            console.log('æ·±åº¦å›¾æ¡†ä½ç½®:', { left, top, width, height });
        }

        function initDragHandlers() {
            const marker = document.getElementById('depthMarker');
            
            marker.onmousedown = function(e) {
                isDragging = true;
                marker.classList.add('dragging');
                dragStartX = e.clientX;
                dragStartY = e.clientY;
                markerStartLeft = parseInt(marker.style.left) || 0;
                markerStartTop = parseInt(marker.style.top) || 0;
                e.preventDefault();
            };

            document.onmousemove = function(e) {
                if (!isDragging) return;
                
                const deltaX = e.clientX - dragStartX;
                const deltaY = e.clientY - dragStartY;
                
                const newLeft = markerStartLeft + deltaX;
                const newTop = markerStartTop + deltaY;
                
                document.getElementById('markerLeft').value = newLeft;
                document.getElementById('markerTop').value = newTop;
                updateMarker();
            };

            document.onmouseup = function() {
                if (isDragging) {
                    isDragging = false;
                    marker.classList.remove('dragging');
                }
            };
        }

        // ç»˜åˆ¶3åˆ†é’Ÿæ›²çº¿å›¾
        function drawTrendChart() {
            if (!trendCtx || scoreHistory.long.length === 0) return;
            
            const width = trendCanvas.width;
            const height = trendCanvas.height;
            const padding = { top: 30, right: 50, bottom: 40, left: 50 };
            const chartWidth = width - padding.left - padding.right;
            const chartHeight = height - padding.top - padding.bottom;
            
            // æ¸…ç©ºç”»å¸ƒ
            trendCtx.fillStyle = '#0f1229';
            trendCtx.fillRect(0, 0, width, height);
            
            // ç»˜åˆ¶ç½‘æ ¼
            trendCtx.strokeStyle = '#1a1f3a';
            trendCtx.lineWidth = 1;
            
            // æ¨ªå‘ç½‘æ ¼ï¼ˆYè½´ï¼Œ0-100åˆ†ï¼‰
            for (let i = 0; i <= 10; i++) {
                const y = padding.top + (chartHeight / 10) * i;
                trendCtx.beginPath();
                trendCtx.moveTo(padding.left, y);
                trendCtx.lineTo(padding.left + chartWidth, y);
                trendCtx.stroke();
                
                // Yè½´åˆ»åº¦æ ‡ç­¾
                const score = 100 - (i * 10);
                trendCtx.fillStyle = '#8b8fa4';
                trendCtx.font = '14px sans-serif';
                trendCtx.textAlign = 'right';
                trendCtx.fillText(score, padding.left - 10, y + 5);
            }
            
            // çºµå‘ç½‘æ ¼ï¼ˆæ—¶é—´è½´ï¼‰
            const timeSteps = 6;
            for (let i = 0; i <= timeSteps; i++) {
                const x = padding.left + (chartWidth / timeSteps) * i;
                trendCtx.beginPath();
                trendCtx.moveTo(x, padding.top);
                trendCtx.lineTo(x, padding.top + chartHeight);
                trendCtx.stroke();
            }
            
            // ç»˜åˆ¶åšå¤šæ›²çº¿ï¼ˆç»¿è‰²ï¼‰
            if (scoreHistory.long.length > 1) {
                trendCtx.strokeStyle = '#00ff88';
                trendCtx.lineWidth = 3;
                trendCtx.beginPath();
                
                scoreHistory.long.forEach((score, index) => {
                    const x = padding.left + (chartWidth / Math.max(scoreHistory.long.length - 1, 1)) * index;
                    const y = padding.top + chartHeight - (score / 100) * chartHeight;
                    
                    if (index === 0) {
                        trendCtx.moveTo(x, y);
                    } else {
                        trendCtx.lineTo(x, y);
                    }
                });
                
                trendCtx.stroke();
            }
            
            // ç»˜åˆ¶åšç©ºæ›²çº¿ï¼ˆçº¢è‰²ï¼‰
            if (scoreHistory.short.length > 1) {
                trendCtx.strokeStyle = '#ff4d4f';
                trendCtx.lineWidth = 3;
                trendCtx.beginPath();
                
                scoreHistory.short.forEach((score, index) => {
                    const x = padding.left + (chartWidth / Math.max(scoreHistory.short.length - 1, 1)) * index;
                    const y = padding.top + chartHeight - (score / 100) * chartHeight;
                    
                    if (index === 0) {
                        trendCtx.moveTo(x, y);
                    } else {
                        trendCtx.lineTo(x, y);
                    }
                });
                
                trendCtx.stroke();
            }
            
            // ç»˜åˆ¶å¤šç©ºå·®å€¼æ›²çº¿ï¼ˆé»„è‰²ï¼‰
            if (scoreHistory.long.length > 1 && scoreHistory.short.length > 1) {
                trendCtx.strokeStyle = '#ffa726';
                trendCtx.lineWidth = 2;
                trendCtx.setLineDash([5, 5]); // è™šçº¿æ ·å¼
                trendCtx.beginPath();
                
                const diffScores = scoreHistory.long.map((longScore, index) => {
                    return longScore - scoreHistory.short[index];
                });
                
                // æ‰¾å‡ºå·®å€¼çš„æœ€å¤§æœ€å°å€¼ç”¨äºç¼©æ”¾
                const maxDiff = Math.max(...diffScores.map(Math.abs));
                const scaleFactor = maxDiff > 0 ? 50 / maxDiff : 1; // ç¼©æ”¾åˆ°Â±50çš„èŒƒå›´
                
                diffScores.forEach((diff, index) => {
                    const x = padding.left + (chartWidth / Math.max(diffScores.length - 1, 1)) * index;
                    // å°†å·®å€¼æ˜ å°„åˆ°50åˆ†çš„ä½ç½®ï¼ˆå›¾è¡¨ä¸­é—´ï¼‰
                    const scaledDiff = diff * scaleFactor;
                    const y = padding.top + chartHeight / 2 - scaledDiff * (chartHeight / 100);
                    
                    if (index === 0) {
                        trendCtx.moveTo(x, y);
                    } else {
                        trendCtx.lineTo(x, y);
                    }
                });
                
                trendCtx.stroke();
                trendCtx.setLineDash([]); // æ¢å¤å®çº¿
                
                // ç»˜åˆ¶50åˆ†å‚è€ƒçº¿ï¼ˆå·®å€¼0ç‚¹ï¼‰
                trendCtx.strokeStyle = '#8b8fa4';
                trendCtx.lineWidth = 1;
                trendCtx.setLineDash([3, 3]);
                trendCtx.beginPath();
                const midY = padding.top + chartHeight / 2;
                trendCtx.moveTo(padding.left, midY);
                trendCtx.lineTo(padding.left + chartWidth, midY);
                trendCtx.stroke();
                trendCtx.setLineDash([]);
            }
            
            // ç»˜åˆ¶å›¾ä¾‹
            trendCtx.font = '16px sans-serif';
            
            // åšå¤šå›¾ä¾‹
            trendCtx.fillStyle = '#00ff88';
            trendCtx.fillRect(padding.left, 10, 30, 4);
            trendCtx.fillText('åšå¤š', padding.left + 40, 20);
            
            // åšç©ºå›¾ä¾‹
            trendCtx.fillStyle = '#ff4d4f';
            trendCtx.fillRect(padding.left + 120, 10, 30, 4);
            trendCtx.fillText('åšç©º', padding.left + 160, 20);
            
            // Xè½´æ ‡ç­¾
            trendCtx.fillStyle = '#8b8fa4';
            trendCtx.font = '14px sans-serif';
            trendCtx.textAlign = 'center';
            trendCtx.fillText('3åˆ†é’Ÿå˜åŒ–è¶‹åŠ¿', width / 2, height - 10);
        }

        // æ§åˆ¶é¢æ¿æŠ˜å /å±•å¼€
        function toggleControls() {
            const controls = document.getElementById('markerControls');
            const btn = document.getElementById('collapseBtn');
            
            controls.classList.toggle('collapsed');
            
            if (controls.classList.contains('collapsed')) {
                btn.textContent = 'â–²';
            } else {
                btn.textContent = 'â–¼';
            }
        }

        // ç›‘å¬è¾“å…¥æ¡†å˜åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            ['markerLeft', 'markerTop', 'markerWidth', 'markerHeight'].forEach(id => {
                document.getElementById(id).addEventListener('input', updateMarker);
            });
        });

        // ==================== å†å²æ•°æ®åŠŸèƒ½ ====================
        
        // åˆ‡æ¢æ—¶é—´èŒƒå›´
        function switchTimeRange(range) {
            currentTimeRange = range;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.time-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.range === range) {
                    btn.classList.add('active');
                }
            });
            
            // æ›´æ–°æ˜¾ç¤ºçš„æ—¶é—´æ®µåç§°
            const rangeNames = {
                '3m': '3åˆ†é’Ÿ',
                '1h': '1å°æ—¶',
                '3h': '3å°æ—¶',
                '6h': '6å°æ—¶',
                '12h': '12å°æ—¶',
                '24h': '24å°æ—¶'
            };
            document.getElementById('currentRange').textContent = rangeNames[range];
            
            // åŠ è½½å¹¶æ˜¾ç¤ºè¯¥æ—¶é—´æ®µçš„å†å²æ•°æ®
            loadHistoryData(range);
        }

        // åˆ‡æ¢å†å²æ•°æ®æ˜¾ç¤ºçš„å¸ç§
        function switchHistoryCoin() {
            const select = document.getElementById('historyCoinSelect');
            const selectedSymbol = select.value;
            
            console.log('ğŸ”„ åˆ‡æ¢å†å²å¸ç§:', selectedSymbol);
            
            // æ›´æ–°å½“å‰å¸ç§ï¼ˆä»…ç”¨äºå†å²æ•°æ®æ˜¾ç¤ºï¼Œä¸å½±å“å®æ—¶ç›‘æ§ï¼‰
            const oldSymbol = currentSymbol;
            currentSymbol = selectedSymbol;
            
            // âš¡ ä¼˜åŒ–ï¼šåªæ¸…ç©ºå½“å‰æ—¶é—´æ®µçš„ç¼“å­˜ï¼Œè€Œä¸æ˜¯æ‰€æœ‰æ—¶é—´æ®µ
            // è¿™æ ·åˆ‡æ¢å¸ç§æ—¶åªéœ€è¦åŠ è½½ä¸€ä¸ªæ—¶é—´æ®µçš„æ•°æ®ï¼Œå¤§å¹…æå‡é€Ÿåº¦
            if (historyData[currentTimeRange]) {
                historyData[currentTimeRange] = { long: [], short: [], timestamps: [], price_change: [], price_actual: [] };
            }
            
            // é‡ç½®å®æ—¶ä»·æ ¼å†å²æ•°æ®
            realtimePriceHistory = {
                prices: [],
                changes: [],
                timestamps: [],
                basePrice: null
            };
            
            // ğŸ“Š æ˜¾ç¤ºåŠ è½½æç¤º
            console.log(`â³ æ­£åœ¨åŠ è½½ ${selectedSymbol} çš„ ${currentTimeRange} æ•°æ®...`);
            
            // é‡æ–°åŠ è½½å½“å‰æ—¶é—´æ®µçš„å†å²æ•°æ®
            loadHistoryData(currentTimeRange);
            
            // ğŸ¯ åŒæ­¥æ›´æ–°SARæ˜¾ç¤ºçš„å¸ç§
            updateSarCoinDisplay(selectedSymbol);
            
            console.log(`âœ… å†å²æ•°æ®å·²åˆ‡æ¢: ${oldSymbol} â†’ ${selectedSymbol}`);
        }

        // åŠ è½½å†å²æ•°æ®
        let loadingHistory = false; // é˜²æ­¢é‡å¤åŠ è½½
        async function loadHistoryData(range) {
            // âš¡ é˜²æŠ–ï¼šå¦‚æœæ­£åœ¨åŠ è½½ï¼Œè·³è¿‡
            if (loadingHistory) {
                console.log('â­ï¸ è·³è¿‡é‡å¤åŠ è½½è¯·æ±‚');
                return;
            }
            
            loadingHistory = true;
            const startTime = Date.now();
            
            // æ˜¾ç¤ºåŠ è½½æŒ‡ç¤ºå™¨
            showLoadingIndicator(`æ­£åœ¨åŠ è½½ ${currentSymbol} ${getRangeLabel(range)} æ•°æ®...`);
            
            try {
                console.log(`ğŸ“¥ å¼€å§‹åŠ è½½ ${currentSymbol} çš„ ${range} æ•°æ®...`);
                
                // åŒæ—¶è¯·æ±‚æ·±åº¦å†å²æ•°æ®å’Œä»·æ ¼å†å²æ•°æ®
                const [depthResponse, priceResponse] = await Promise.all([
                    fetch(`${HISTORY_API_URL}/api/depth/history/${currentSymbol}?range=${range}`),
                    fetch(`${PRICE_API_URL}/api/price/history/${currentSymbol}`)
                ]);
                
                const depthData = await depthResponse.json();
                const priceData = await priceResponse.json();
                
                if (depthData.success && depthData.history && depthData.history.length > 0) {
                    historyData[range] = {
                        long: depthData.history.map(d => d.long_score),
                        short: depthData.history.map(d => d.short_score),
                        timestamps: depthData.history.map(d => new Date(d.timestamp)),
                        price_change: [],
                        price_actual: []
                    };
                    
                    // å¦‚æœä»·æ ¼æ•°æ®å¯ç”¨ï¼Œæ·»åŠ ä»·æ ¼å˜åŒ–ç™¾åˆ†æ¯”
                    if (priceData.success && priceData.data && priceData.data.length > 0) {
                        // ğŸ¯ å…³é”®ä¿®å¤ï¼šä»·æ ¼æ•°æ®ä½¿ç”¨ç‹¬ç«‹çš„é«˜å¯†åº¦æ•°æ®ç‚¹ï¼Œä¸å¯¹é½åˆ°æ·±åº¦æ•°æ®
                        // è¿™æ ·å¯ä»¥ä¿ç•™0.5ç§’é‡‡é›†é¢‘ç‡çš„ä¼˜åŠ¿ï¼Œæ˜¾ç¤ºæµç•…çš„ä»·æ ¼æ³¢åŠ¨æ›²çº¿
                        
                        // æ ¹æ®æ—¶é—´èŒƒå›´ç­›é€‰ä»·æ ¼æ•°æ®
                        const rangeMs = {
                            '3m': 3 * 60 * 1000,
                            '1h': 60 * 60 * 1000,
                            '3h': 3 * 60 * 60 * 1000,
                            '6h': 6 * 60 * 60 * 1000,
                            '12h': 12 * 60 * 60 * 1000,
                            '24h': 24 * 60 * 60 * 1000
                        }[range];
                        
                        const now = Date.now();
                        const filteredPriceData = priceData.data.filter(p => (now - p.timestamp) <= rangeMs);
                        
                        // âœ¨ æ–°ç­–ç•¥ï¼šç›´æ¥ä½¿ç”¨ä»·æ ¼æ•°æ®çš„æ‰€æœ‰ç‚¹ï¼Œä¸å¯¹é½ï¼ˆä¿æŒé«˜å¯†åº¦ï¼‰
                        historyData[range].price_change = filteredPriceData.map(p => p.change_percent);
                        historyData[range].price_actual = filteredPriceData.map(p => p.price);
                        historyData[range].price_timestamps = filteredPriceData.map(p => p.timestamp);
                        
                        console.log(`ğŸ“Š ä»·æ ¼æ•°æ®åŠ è½½: ${filteredPriceData.length}ä¸ªç‚¹ (ç‹¬ç«‹é«˜å¯†åº¦æ•°æ®)`);
                    }
                } else {
                    // å¦‚æœæ²¡æœ‰å†å²æ•°æ®ï¼Œä½¿ç”¨ç©ºæ•°æ®
                    historyData[range] = { long: [], short: [], timestamps: [], price_change: [], price_actual: [] };
                }
                
                // ç»˜åˆ¶å†å²å›¾è¡¨
                drawHistoryChart(range);
                
                // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
                updateHistoryStats(range);
                
                const loadTime = Date.now() - startTime;
                console.log(`âœ… æ•°æ®åŠ è½½å®Œæˆï¼Œè€—æ—¶: ${loadTime}ms`);
                
                // æ›´æ–°æœ€ååˆ·æ–°æ—¶é—´
                updateLastRefreshTime();
                
            } catch (error) {
                console.error('âŒ åŠ è½½å†å²æ•°æ®å¤±è´¥:', error);
                // ä½¿ç”¨ç©ºæ•°æ®
                historyData[range] = { long: [], short: [], timestamps: [], price_change: [], price_actual: [] };
                drawHistoryChart(range);
            } finally {
                loadingHistory = false; // é‡Šæ”¾åŠ è½½é”
                // éšè—åŠ è½½æŒ‡ç¤ºå™¨
                hideLoadingIndicator();
            }
        }

        // ç»˜åˆ¶å†å²å›¾è¡¨
        function drawHistoryChart(range) {
            const data = historyData[range];
            
            if (!historyCtx || !data || data.long.length === 0) {
                // æ¸…ç©ºç”»å¸ƒå¹¶æ˜¾ç¤ºå‹å¥½çš„æç¤º
                if (historyCtx) {
                    historyCtx.clearRect(0, 0, historyCanvas.width, historyCanvas.height);
                    
                    // èƒŒæ™¯
                    historyCtx.fillStyle = '#0f1229';
                    historyCtx.fillRect(0, 0, historyCanvas.width, historyCanvas.height);
                    
                    // ä¸»æ ‡é¢˜
                    historyCtx.fillStyle = '#8b8fa4';
                    historyCtx.font = 'bold 18px sans-serif';
                    historyCtx.textAlign = 'center';
                    historyCtx.fillText('ğŸ“Š æš‚æ— å†å²æ•°æ®', historyCanvas.width / 2, historyCanvas.height / 2 - 30);
                    
                    // æç¤ºæ–‡å­—
                    historyCtx.font = '14px sans-serif';
                    historyCtx.fillStyle = '#6b7089';
                    historyCtx.fillText('è¯·å…ˆå¯åŠ¨ç›‘æ§ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä¿å­˜å†å²æ•°æ®', historyCanvas.width / 2, historyCanvas.height / 2 + 5);
                    historyCtx.fillText('æ•°æ®ç§¯ç´¯å¤§çº¦éœ€è¦å‡ åˆ†é’Ÿ', historyCanvas.width / 2, historyCanvas.height / 2 + 30);
                }
                return;
            }

            const width = historyCanvas.width;
            const height = historyCanvas.height;
            const padding = 40;
            
            // æ¸…ç©ºç”»å¸ƒ
            historyCtx.clearRect(0, 0, width, height);
            
            // èƒŒæ™¯
            historyCtx.fillStyle = '#0f1229';
            historyCtx.fillRect(0, 0, width, height);
            
            const maxPoints = data.long.length;
            const xStep = (width - padding * 2) / Math.max(maxPoints - 1, 1);
            const yMax = 100;
            
            // ç»˜åˆ¶ç½‘æ ¼çº¿
            historyCtx.strokeStyle = '#1a1f3a';
            historyCtx.lineWidth = 1;
            for (let i = 0; i <= 5; i++) {
                const y = padding + (height - padding * 2) * (i / 5);
                historyCtx.beginPath();
                historyCtx.moveTo(padding, y);
                historyCtx.lineTo(width - padding, y);
                historyCtx.stroke();
                
                // Yè½´åˆ»åº¦
                historyCtx.fillStyle = '#8b8fa4';
                historyCtx.font = 'bold 14px sans-serif';
                historyCtx.textAlign = 'right';
                historyCtx.fillText((100 - i * 20).toString(), padding - 10, y + 5);
            }
            
            // ç»˜åˆ¶å›¾ä¾‹
            const legendY = padding - 20;
            const legendStartX = padding + 80;
            const legendSpacing = 120;
            
            // åšå¤šå›¾ä¾‹
            historyCtx.strokeStyle = '#00ff88';
            historyCtx.lineWidth = 2.5;
            historyCtx.beginPath();
            historyCtx.moveTo(legendStartX, legendY);
            historyCtx.lineTo(legendStartX + 20, legendY);
            historyCtx.stroke();
            historyCtx.fillStyle = '#00ff88';
            historyCtx.font = 'bold 12px sans-serif';
            historyCtx.textAlign = 'left';
            historyCtx.fillText('åšå¤šè¯„åˆ†', legendStartX + 25, legendY + 4);
            
            // åšç©ºå›¾ä¾‹
            historyCtx.strokeStyle = '#ff4d4f';
            historyCtx.lineWidth = 2.5;
            historyCtx.beginPath();
            historyCtx.moveTo(legendStartX + legendSpacing, legendY);
            historyCtx.lineTo(legendStartX + legendSpacing + 20, legendY);
            historyCtx.stroke();
            historyCtx.fillStyle = '#ff4d4f';
            historyCtx.fillText('åšç©ºè¯„åˆ†', legendStartX + legendSpacing + 25, legendY + 4);
            
            // å¤šç©ºå·®å€¼å›¾ä¾‹
            historyCtx.strokeStyle = '#ffa726';
            historyCtx.lineWidth = 2.5;
            historyCtx.setLineDash([5, 5]);
            historyCtx.beginPath();
            historyCtx.moveTo(legendStartX + legendSpacing * 2, legendY);
            historyCtx.lineTo(legendStartX + legendSpacing * 2 + 20, legendY);
            historyCtx.stroke();
            historyCtx.setLineDash([]);
            historyCtx.fillStyle = '#ffa726';
            historyCtx.fillText('å¤šç©ºå·®å€¼', legendStartX + legendSpacing * 2 + 25, legendY + 4);
            
            // ä»·æ ¼æ³¢åŠ¨å›¾ä¾‹
            historyCtx.strokeStyle = '#bb86fc';
            historyCtx.lineWidth = 2.5;
            historyCtx.setLineDash([4, 4]);
            historyCtx.beginPath();
            historyCtx.moveTo(legendStartX + legendSpacing * 3, legendY);
            historyCtx.lineTo(legendStartX + legendSpacing * 3 + 20, legendY);
            historyCtx.stroke();
            historyCtx.setLineDash([]);
            historyCtx.fillStyle = '#bb86fc';
            historyCtx.fillText('ä»·æ ¼æ³¢åŠ¨', legendStartX + legendSpacing * 3 + 25, legendY + 4);
            
            // ç»˜åˆ¶åšå¤šçº¿ï¼ˆç»¿è‰²ï¼‰
            if (data.long.length > 0) {
                historyCtx.strokeStyle = '#00ff88';
                historyCtx.lineWidth = 2;
                historyCtx.beginPath();
                data.long.forEach((score, i) => {
                    const x = padding + i * xStep;
                    const y = padding + (height - padding * 2) * (1 - score / yMax);
                    if (i === 0) {
                        historyCtx.moveTo(x, y);
                    } else {
                        historyCtx.lineTo(x, y);
                    }
                });
                historyCtx.stroke();
            }
            
            // ç»˜åˆ¶åšç©ºçº¿ï¼ˆçº¢è‰²ï¼‰
            if (data.short.length > 0) {
                historyCtx.strokeStyle = '#ff4d4f';
                historyCtx.lineWidth = 2;
                historyCtx.beginPath();
                data.short.forEach((score, i) => {
                    const x = padding + i * xStep;
                    const y = padding + (height - padding * 2) * (1 - score / yMax);
                    if (i === 0) {
                        historyCtx.moveTo(x, y);
                    } else {
                        historyCtx.lineTo(x, y);
                    }
                });
                historyCtx.stroke();
            }
            
            // ç»˜åˆ¶å¤šç©ºå·®å€¼çº¿ï¼ˆæ©™è‰²è™šçº¿ï¼‰
            if (data.long.length > 0 && data.short.length > 0) {
                historyCtx.strokeStyle = '#ffa726';
                historyCtx.lineWidth = 2;
                historyCtx.setLineDash([5, 5]);
                historyCtx.beginPath();
                data.long.forEach((longScore, i) => {
                    const diff = longScore - data.short[i];
                    const x = padding + i * xStep;
                    const y = padding + (height - padding * 2) * (1 - (diff + 50) / 100); // æ˜ å°„åˆ°-50åˆ°+50èŒƒå›´
                    if (i === 0) {
                        historyCtx.moveTo(x, y);
                    } else {
                        historyCtx.lineTo(x, y);
                    }
                });
                historyCtx.stroke();
                historyCtx.setLineDash([]);
            }
            
            // ===== åœ¨åŒä¸€ä¸ªcanvasä¸Šç»˜åˆ¶ä»·æ ¼æ¶¨è·Œå¹…æ›²çº¿ =====
            // ç»˜åˆ¶ä»·æ ¼æ¶¨è·Œå¹…æ›²çº¿ï¼ˆä½¿ç”¨å³ä¾§Yè½´ï¼Œæ˜¾ç¤ºç™¾åˆ†æ¯”ï¼‰
            if (data.price_change && data.price_change.length > 0) {
                const validChanges = data.price_change.filter(c => c !== null && c !== undefined);
                
                if (validChanges.length > 0) {
                    // æ‰¾å‡ºæ¶¨è·Œå¹…çš„å®é™…èŒƒå›´
                    const minChange = Math.min(...validChanges);
                    const maxChange = Math.max(...validChanges);
                    const actualRange = maxChange - minChange; // å®é™…æ•°æ®çš„è·¨åº¦
                    const centerValue = (maxChange + minChange) / 2; // æ•°æ®çš„ä¸­å¿ƒå€¼
                    
                    // ğŸ¯ æ™ºèƒ½è‡ªé€‚åº”æ˜¾ç¤ºèŒƒå›´ï¼š
                    // è®©æ›²çº¿å æ®å›¾è¡¨é«˜åº¦çš„60-80%ï¼Œç¡®ä¿æ³¢åŠ¨æ¸…æ™°å¯è§
                    // è®¡ç®—æ–¹æ³•ï¼šå®é™…èŒƒå›´ Ã— 2ï¼ˆè®©æ•°æ®å å›¾è¡¨çš„50%ï¼‰å† Ã— 1.2ï¼ˆç•™20%ä½™é‡ï¼‰
                    // å¦‚æœå®é™…èŒƒå›´<0.1%ï¼Œè®¾å®šæœ€å°æ˜¾ç¤ºèŒƒå›´ä¸º0.3%ï¼ˆè®©å¾®å°æ³¢åŠ¨ä¹Ÿèƒ½çœ‹åˆ°ï¼‰
                    let halfRange;
                    if (actualRange < 0.1) {
                        // æå°æ³¢åŠ¨ï¼šä½¿ç”¨0.15%åŠèŒƒå›´ï¼ˆæ€»èŒƒå›´0.3%ï¼‰
                        halfRange = 0.15;
                    } else if (actualRange < 1.0) {
                        // å°æ³¢åŠ¨ï¼ˆ0.1%-1%ï¼‰ï¼šä½¿ç”¨å®é™…èŒƒå›´çš„1.2å€
                        halfRange = actualRange / 2 * 1.2;
                    } else {
                        // æ­£å¸¸æ³¢åŠ¨ï¼ˆ>1%ï¼‰ï¼šä½¿ç”¨å®é™…èŒƒå›´çš„1.5å€
                        halfRange = actualRange / 2 * 1.5;
                    }
                    
                    const displayMin = centerValue - halfRange;
                    const displayMax = centerValue + halfRange;
                    const displayRange = displayMax - displayMin;
                    
                    // è°ƒè¯•æ—¥å¿—
                    console.log(`ğŸ“Š ä»·æ ¼æ¶¨è·Œå¹…æ•°æ®: Min=${minChange.toFixed(4)}%, Max=${maxChange.toFixed(4)}%, Center=${centerValue.toFixed(4)}%`);
                    console.log(`ğŸ“ æ˜¾ç¤ºèŒƒå›´: ${displayMin.toFixed(4)}% ~ ${displayMax.toFixed(4)}% (æ€»è·¨åº¦=${displayRange.toFixed(4)}%)`);
                    console.log(`ğŸ“ˆ æ¶¨è·Œå¹…æ ·æœ¬ (å‰10ä¸ª):`, validChanges.slice(0, 10).map(c => c.toFixed(4)));
                    console.log(`ğŸ” æ•°æ®ç»Ÿè®¡: æ€»æ•°=${validChanges.length}, å¹³å‡=${(validChanges.reduce((a,b)=>a+b,0)/validChanges.length).toFixed(4)}%`);
                    
                    // ç»˜åˆ¶å³ä¾§Yè½´åˆ»åº¦ï¼ˆæ¶¨è·Œå¹…%ï¼‰
                    historyCtx.fillStyle = '#bb86fc';
                    historyCtx.font = 'bold 13px sans-serif';
                    historyCtx.textAlign = 'left';
                    for (let i = 0; i <= 5; i++) {
                        const y = padding + (height - padding * 2) * (i / 5);
                        // ä»æœ€å¤§å€¼åˆ°æœ€å°å€¼
                        const percentValue = displayMax - (i / 5) * displayRange;
                        historyCtx.fillText(`${percentValue > 0 ? '+' : ''}${percentValue.toFixed(3)}%`, width - padding + 10, y + 5);
                    }
                    
                    // å¦‚æœ0%åœ¨æ˜¾ç¤ºèŒƒå›´å†…ï¼Œç»˜åˆ¶0%å‚è€ƒçº¿
                    if (displayMin < 0 && displayMax > 0) {
                        const zeroY = padding + (height - padding * 2) * ((displayMax - 0) / displayRange);
                        historyCtx.strokeStyle = 'rgba(187, 134, 252, 0.3)';
                        historyCtx.lineWidth = 1;
                        historyCtx.setLineDash([2, 2]);
                        historyCtx.beginPath();
                        historyCtx.moveTo(padding, zeroY);
                        historyCtx.lineTo(width - padding, zeroY);
                        historyCtx.stroke();
                        historyCtx.setLineDash([]);
                    }
                    
                    // ç»˜åˆ¶ä»·æ ¼æ¶¨è·Œå¹…æ›²çº¿ï¼ˆç´«è‰²è™šçº¿ï¼‰
                    historyCtx.strokeStyle = '#bb86fc';
                    historyCtx.lineWidth = 2.5;
                    historyCtx.setLineDash([4, 4]);
                    historyCtx.beginPath();
                    
                    // ğŸ¯ ä½¿ç”¨ä»·æ ¼æ•°æ®è‡ªå·±çš„æ—¶é—´èŒƒå›´æ¥è®¡ç®—Xåæ ‡
                    const priceTimeStamps = data.price_timestamps || [];
                    const priceDataLength = data.price_change.length;
                    
                    // å¦‚æœæœ‰æ—¶é—´æˆ³æ•°æ®ï¼Œä½¿ç”¨æ—¶é—´èŒƒå›´ï¼›å¦åˆ™ä½¿ç”¨ç´¢å¼•
                    let useTimeBasedX = priceTimeStamps.length === priceDataLength && priceDataLength > 1;
                    let timeMin = useTimeBasedX ? Math.min(...priceTimeStamps) : 0;
                    let timeMax = useTimeBasedX ? Math.max(...priceTimeStamps) : priceDataLength - 1;
                    let timeRange = timeMax - timeMin || 1;
                    
                    let validPoints = 0;
                    data.price_change.forEach((change, i) => {
                        if (change !== null && change !== undefined) {
                            // æ ¹æ®æ—¶é—´æˆ³è®¡ç®—Xåæ ‡ï¼ˆå¦‚æœæœ‰æ—¶é—´æˆ³ï¼‰
                            let x;
                            if (useTimeBasedX && priceTimeStamps[i]) {
                                const timeRatio = (priceTimeStamps[i] - timeMin) / timeRange;
                                x = padding + timeRatio * (width - padding * 2);
                            } else {
                                // é™çº§æ–¹æ¡ˆï¼šä½¿ç”¨ç´¢å¼•
                                const priceXStep = (width - padding * 2) / Math.max(priceDataLength - 1, 1);
                                x = padding + i * priceXStep;
                            }
                            
                            // å°†æ¶¨è·Œå¹…æ˜ å°„åˆ°canvasé«˜åº¦
                            // normalizedY = 0 è¡¨ç¤ºdisplayMaxä½ç½®ï¼ˆé¡¶éƒ¨ï¼‰
                            // normalizedY = 1 è¡¨ç¤ºdisplayMinä½ç½®ï¼ˆåº•éƒ¨ï¼‰
                            const normalizedY = (displayMax - change) / displayRange;
                            const y = padding + (height - padding * 2) * normalizedY;
                            
                            if (validPoints === 0) {
                                historyCtx.moveTo(x, y);
                            } else {
                                historyCtx.lineTo(x, y);
                            }
                            validPoints++;
                        }
                    });
                    
                    historyCtx.stroke();
                    historyCtx.setLineDash([]);
                    
                    // ç»˜åˆ¶æœ€æ–°æ¶¨è·Œå¹…æ ‡ç­¾
                    const lastChange = validChanges[validChanges.length - 1];
                    const lastIndex = data.price_change.length - 1 - [...data.price_change].reverse().findIndex(c => c !== null && c !== undefined);
                    const lastX = padding + lastIndex * xStep;
                    const normalizedY = (displayMax - lastChange) / displayRange;
                    const lastY = padding + (height - padding * 2) * normalizedY;
                    
                    // æ¶¨è·Œå¹…æ ‡ç­¾èƒŒæ™¯
                    const text = `${lastChange > 0 ? '+' : ''}${lastChange.toFixed(2)}%`;
                    historyCtx.font = 'bold 14px sans-serif';
                    const textMetrics = historyCtx.measureText(text);
                    const boxPadding = 6;
                    
                    historyCtx.fillStyle = lastChange >= 0 ? 'rgba(0, 255, 136, 0.25)' : 'rgba(255, 77, 79, 0.25)';
                    historyCtx.fillRect(
                        lastX - boxPadding,
                        lastY - 18,
                        textMetrics.width + boxPadding * 2,
                        22
                    );
                    
                    // æ¶¨è·Œå¹…æ ‡ç­¾æ–‡å­—
                    historyCtx.fillStyle = lastChange >= 0 ? '#00ff88' : '#ff4d4f';
                    historyCtx.textAlign = 'left';
                    historyCtx.fillText(text, lastX, lastY - 3);
                }
            }
            
            // ä»ç„¶è°ƒç”¨drawPriceChartä»¥ä¿æŒç‹¬ç«‹ä»·æ ¼å›¾è¡¨çš„æ›´æ–°ï¼ˆå¦‚æœéœ€è¦ï¼‰
            drawPriceChart(data, maxPoints, xStep);
        }

        // ç»˜åˆ¶ç‹¬ç«‹çš„ä»·æ ¼æ›²çº¿å›¾è¡¨ï¼ˆå½’ä¸€åŒ–åˆ°0-100èŒƒå›´ï¼Œä¸æ·±åº¦è¯„åˆ†åŒæ­¥ï¼‰
        function drawPriceChart(data, maxPoints, xStep) {
            if (!priceCtx || !data || !data.price_actual || data.price_actual.length === 0) {
                // æ¸…ç©ºç”»å¸ƒå¹¶æ˜¾ç¤ºæç¤º
                if (priceCtx) {
                    priceCtx.clearRect(0, 0, priceCanvas.width, priceCanvas.height);
                    priceCtx.fillStyle = '#0f1229';
                    priceCtx.fillRect(0, 0, priceCanvas.width, priceCanvas.height);
                    
                    priceCtx.fillStyle = '#6b7089';
                    priceCtx.font = '13px sans-serif';
                    priceCtx.textAlign = 'center';
                    priceCtx.fillText('æš‚æ— ä»·æ ¼æ•°æ®', priceCanvas.width / 2, priceCanvas.height / 2);
                }
                return;
            }

            const width = priceCanvas.width;
            const height = priceCanvas.height;
            const padding = 40;
            
            // æ¸…ç©ºç”»å¸ƒ
            priceCtx.clearRect(0, 0, width, height);
            
            // èƒŒæ™¯
            priceCtx.fillStyle = '#0f1229';
            priceCtx.fillRect(0, 0, width, height);
            
            // è·å–å®é™…ä»·æ ¼æ•°æ®å¹¶è®¡ç®—èŒƒå›´
            const prices = data.price_actual.filter(p => p > 0);
            if (prices.length === 0) return;
            
            const minPrice = Math.min(...prices);
            const maxPrice = Math.max(...prices);
            const priceRange = maxPrice - minPrice;
            
            // å½’ä¸€åŒ–å‡½æ•°ï¼šå°†ä»·æ ¼æ˜ å°„åˆ°0-100èŒƒå›´
            const normalizePriceToScore = (price) => {
                if (priceRange === 0) return 50; // å¦‚æœä»·æ ¼æ²¡æœ‰å˜åŒ–ï¼Œè¿”å›ä¸­é—´å€¼
                return ((price - minPrice) / priceRange) * 100;
            };
            
            // ç»˜åˆ¶ç½‘æ ¼çº¿ï¼ˆ5æ¡æ¨ªçº¿ï¼Œä¸ä¸»å›¾ä¸€è‡´ï¼‰
            priceCtx.strokeStyle = '#1a1f3a';
            priceCtx.lineWidth = 1;
            for (let i = 0; i <= 5; i++) {
                const y = padding + (height - padding * 2) * (i / 5);
                priceCtx.beginPath();
                priceCtx.moveTo(padding, y);
                priceCtx.lineTo(width - padding, y);
                priceCtx.stroke();
                
                // Yè½´åˆ»åº¦ - æ˜¾ç¤ºå®é™…ä»·æ ¼
                const scoreValue = 100 - i * 20;
                // å°†è¯„åˆ†å€¼åå‘æ˜ å°„åˆ°ä»·æ ¼
                const priceValue = minPrice + (scoreValue / 100) * priceRange;
                priceCtx.fillStyle = '#bb86fc';
                priceCtx.font = 'bold 14px sans-serif';
                priceCtx.textAlign = 'right';
                priceCtx.fillText(priceValue.toFixed(2), padding - 10, y + 5);
            }
            
            // ç»˜åˆ¶ä»·æ ¼æ›²çº¿ï¼ˆå½’ä¸€åŒ–åï¼Œç´«è‰²è™šçº¿ï¼‰
            priceCtx.strokeStyle = '#bb86fc';
            priceCtx.lineWidth = 2.5;
            priceCtx.setLineDash([3, 3]);
            priceCtx.beginPath();
            
            let validPoints = 0;
            data.price_actual.forEach((price, i) => {
                if (price > 0) {
                    const x = padding + i * xStep;
                    const normalizedScore = normalizePriceToScore(price);
                    const y = padding + (height - padding * 2) * (1 - normalizedScore / 100);
                    
                    if (validPoints === 0) {
                        priceCtx.moveTo(x, y);
                    } else {
                        priceCtx.lineTo(x, y);
                    }
                    validPoints++;
                }
            });
            
            priceCtx.stroke();
            priceCtx.setLineDash([]);
            
            // ç»˜åˆ¶æ•°å€¼æ ‡ç­¾ï¼ˆæœ€æ–°å€¼ï¼‰
            if (prices.length > 0) {
                const lastPrice = prices[prices.length - 1];
                const lastIndex = data.price_actual.lastIndexOf(lastPrice);
                const lastX = padding + lastIndex * xStep;
                const normalizedScore = normalizePriceToScore(lastPrice);
                const lastY = padding + (height - padding * 2) * (1 - normalizedScore / 100);
                
                // è®¡ç®—æ¶¨è·Œå¹…
                const firstPrice = prices[0];
                const changePercent = ((lastPrice - firstPrice) / firstPrice) * 100;
                
                // ç»˜åˆ¶æ•°å€¼èƒŒæ™¯æ¡†
                const text = `${lastPrice.toFixed(3)} (${changePercent > 0 ? '+' : ''}${changePercent.toFixed(2)}%)`;
                priceCtx.font = 'bold 15px sans-serif';
                const textMetrics = priceCtx.measureText(text);
                const textWidth = textMetrics.width;
                const boxPadding = 8;
                
                priceCtx.fillStyle = changePercent >= 0 ? 'rgba(0, 255, 136, 0.2)' : 'rgba(255, 77, 79, 0.2)';
                priceCtx.fillRect(
                    lastX - textWidth / 2 - boxPadding, 
                    lastY - 20, 
                    textWidth + boxPadding * 2, 
                    28
                );
                
                // ç»˜åˆ¶æ•°å€¼æ–‡å­—
                priceCtx.fillStyle = changePercent >= 0 ? '#00ff88' : '#ff4d4f';
                priceCtx.textAlign = 'center';
                priceCtx.fillText(text, lastX, lastY - 2);
            }
            
            // åœ¨å³ä¸Šè§’æ˜¾ç¤ºä»·æ ¼èŒƒå›´
            priceCtx.fillStyle = '#8b8fa4';
            priceCtx.font = 'bold 13px sans-serif';
            priceCtx.textAlign = 'right';
            priceCtx.fillText(`ä»·æ ¼èŒƒå›´: ${minPrice.toFixed(2)} - ${maxPrice.toFixed(2)}`, width - padding, padding - 10);
        }
        
        // ç»˜åˆ¶å®æ—¶ä»·æ ¼æ¶¨è·Œæ›²çº¿ï¼ˆæ¯0.5ç§’æ›´æ–°ï¼‰
        function drawRealtimePriceChart() {
            if (!priceCtx || !realtimePriceHistory.prices || realtimePriceHistory.prices.length === 0) {
                return;
            }

            const width = priceCanvas.width;
            const height = priceCanvas.height;
            const padding = 40;
            
            // æ¸…ç©ºç”»å¸ƒ
            priceCtx.clearRect(0, 0, width, height);
            
            // èƒŒæ™¯
            priceCtx.fillStyle = '#0f1229';
            priceCtx.fillRect(0, 0, width, height);
            
            // è·å–ä»·æ ¼æ¶¨è·Œå¹…æ•°æ®
            const changes = realtimePriceHistory.changes;
            const prices = realtimePriceHistory.prices;
            
            if (changes.length === 0) return;
            
            // è®¡ç®—æ¶¨è·Œå¹…èŒƒå›´
            const minChange = Math.min(...changes);
            const maxChange = Math.max(...changes);
            const changeRange = maxChange - minChange;
            
            // å¦‚æœèŒƒå›´å¤ªå°ï¼Œä½¿ç”¨å›ºå®šèŒƒå›´
            const displayRange = changeRange < 0.1 ? 0.1 : changeRange;
            const displayMin = minChange - displayRange * 0.1;
            const displayMax = maxChange + displayRange * 0.1;
            
            // è®¡ç®—Xè½´æ­¥é•¿
            const maxPoints = Math.min(changes.length, 360);
            const xStep = (width - padding * 2) / Math.max(maxPoints - 1, 1);
            
            // ç»˜åˆ¶ç½‘æ ¼çº¿ï¼ˆ5æ¡æ¨ªçº¿ï¼‰
            priceCtx.strokeStyle = '#1a1f3a';
            priceCtx.lineWidth = 1;
            for (let i = 0; i <= 5; i++) {
                const y = padding + (height - padding * 2) * (i / 5);
                priceCtx.beginPath();
                priceCtx.moveTo(padding, y);
                priceCtx.lineTo(width - padding, y);
                priceCtx.stroke();
                
                // Yè½´åˆ»åº¦ - æ˜¾ç¤ºæ¶¨è·Œå¹…ç™¾åˆ†æ¯”
                const changeValue = displayMax - (displayMax - displayMin) * (i / 5);
                priceCtx.fillStyle = '#bb86fc';
                priceCtx.font = 'bold 14px sans-serif';
                priceCtx.textAlign = 'right';
                priceCtx.fillText(`${changeValue > 0 ? '+' : ''}${changeValue.toFixed(2)}%`, padding - 10, y + 5);
            }
            
            // ç»˜åˆ¶0%å‚è€ƒçº¿ï¼ˆå¦‚æœåœ¨èŒƒå›´å†…ï¼‰
            if (displayMin <= 0 && displayMax >= 0) {
                const zeroY = padding + (height - padding * 2) * ((displayMax - 0) / (displayMax - displayMin));
                priceCtx.strokeStyle = '#4a5066';
                priceCtx.lineWidth = 1;
                priceCtx.setLineDash([5, 5]);
                priceCtx.beginPath();
                priceCtx.moveTo(padding, zeroY);
                priceCtx.lineTo(width - padding, zeroY);
                priceCtx.stroke();
                priceCtx.setLineDash([]);
            }
            
            // ç»˜åˆ¶ä»·æ ¼æ¶¨è·Œæ›²çº¿
            priceCtx.strokeStyle = '#bb86fc';
            priceCtx.lineWidth = 2.5;
            priceCtx.setLineDash([3, 3]);
            priceCtx.beginPath();
            
            changes.forEach((changePercent, i) => {
                const x = padding + i * xStep;
                // å½’ä¸€åŒ–åˆ°å›¾è¡¨èŒƒå›´
                const normalizedValue = (displayMax - changePercent) / (displayMax - displayMin);
                const y = padding + (height - padding * 2) * normalizedValue;
                
                if (i === 0) {
                    priceCtx.moveTo(x, y);
                } else {
                    priceCtx.lineTo(x, y);
                }
            });
            
            priceCtx.stroke();
            priceCtx.setLineDash([]);
            
            // ç»˜åˆ¶æ•°å€¼æ ‡ç­¾ï¼ˆæœ€æ–°å€¼ï¼‰
            if (changes.length > 0 && prices.length > 0) {
                const lastChange = changes[changes.length - 1];
                const lastPrice = prices[prices.length - 1];
                const lastX = padding + (changes.length - 1) * xStep;
                const normalizedValue = (displayMax - lastChange) / (displayMax - displayMin);
                const lastY = padding + (height - padding * 2) * normalizedValue;
                
                // ç»˜åˆ¶æ•°å€¼èƒŒæ™¯æ¡†
                const text = `${lastPrice.toFixed(3)} (${lastChange > 0 ? '+' : ''}${lastChange.toFixed(2)}%)`;
                priceCtx.font = 'bold 15px sans-serif';
                const textMetrics = priceCtx.measureText(text);
                const textWidth = textMetrics.width;
                const boxPadding = 8;
                
                priceCtx.fillStyle = lastChange >= 0 ? 'rgba(0, 255, 136, 0.2)' : 'rgba(255, 77, 79, 0.2)';
                priceCtx.fillRect(
                    lastX - textWidth / 2 - boxPadding, 
                    lastY - 20, 
                    textWidth + boxPadding * 2, 
                    28
                );
                
                // ç»˜åˆ¶æ•°å€¼æ–‡å­—
                priceCtx.fillStyle = lastChange >= 0 ? '#00ff88' : '#ff4d4f';
                priceCtx.textAlign = 'center';
                priceCtx.fillText(text, lastX, lastY - 2);
            }
            
            // åœ¨å³ä¸Šè§’æ˜¾ç¤ºæ›´æ–°é¢‘ç‡å’Œæ•°æ®ç‚¹æ•°
            priceCtx.fillStyle = '#8b8fa4';
            priceCtx.font = 'bold 13px sans-serif';
            priceCtx.textAlign = 'right';
            priceCtx.fillText(`å®æ—¶ç›‘æ§ (0.5ç§’/æ¬¡) Â· ${changes.length}ç‚¹`, width - padding, padding - 10);
        }

        // æ›´æ–°å†å²ç»Ÿè®¡ä¿¡æ¯
        function updateHistoryStats(range) {
            const data = historyData[range];
            
            if (!data || data.long.length === 0) {
                document.getElementById('dataPoints').textContent = '0';
                document.getElementById('avgLong').textContent = '--';
                document.getElementById('avgShort').textContent = '--';
                return;
            }
            
            // æ•°æ®ç‚¹æ•°
            document.getElementById('dataPoints').textContent = data.long.length;
            
            // å¹³å‡åšå¤šè¯„åˆ†
            const avgLong = data.long.reduce((a, b) => a + b, 0) / data.long.length;
            document.getElementById('avgLong').textContent = avgLong.toFixed(1);
            
            // å¹³å‡åšç©ºè¯„åˆ†
            const avgShort = data.short.reduce((a, b) => a + b, 0) / data.short.length;
            document.getElementById('avgShort').textContent = avgShort.toFixed(1);
        }

        // æ›´æ–°æœ€ååˆ·æ–°æ—¶é—´
        function updateLastRefreshTime() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            const lastRefreshElement = document.getElementById('lastRefreshTime');
            if (lastRefreshElement) {
                lastRefreshElement.textContent = timeStr;
            }
        }

        // æ˜¾ç¤ºåŠ è½½æŒ‡ç¤ºå™¨
        function showLoadingIndicator(message = 'æ­£åœ¨åŠ è½½æ•°æ®...') {
            const indicator = document.getElementById('chartLoadingIndicator');
            const statusElement = document.getElementById('loadingStatus');
            if (indicator) {
                indicator.style.display = 'block';
                if (statusElement) {
                    statusElement.textContent = message;
                }
            }
        }

        // éšè—åŠ è½½æŒ‡ç¤ºå™¨
        function hideLoadingIndicator() {
            const indicator = document.getElementById('chartLoadingIndicator');
            if (indicator) {
                indicator.style.display = 'none';
            }
        }

        // è·å–æ—¶é—´èŒƒå›´æ ‡ç­¾
        function getRangeLabel(range) {
            const labels = {
                '3m': '3åˆ†é’Ÿ',
                '1h': '1å°æ—¶',
                '3h': '3å°æ—¶',
                '6h': '6å°æ—¶',
                '12h': '12å°æ—¶',
                '24h': '24å°æ—¶'
            };
            return labels[range] || range;
        }

        // æ›´æ–°å¸ƒæ—å¸¦è±¡é™æ˜¾ç¤º
        function updateBollingerQuadrant(data) {
            const quadrantElement = document.getElementById('bollingerQuadrant');
            if (!quadrantElement) return;
            
            if (data.bollinger && data.bollinger.quadrant) {
                const quadrant = data.bollinger.quadrant;
                const label = data.bollinger.quadrant_label;
                
                // æ ¹æ®è±¡é™è®¾ç½®ä¸åŒçš„æ ·å¼
                let color, bgColor, borderColor;
                switch (quadrant) {
                    case 1:
                        // ç¬¬ä¸€è±¡é™ - çº¢è‰²ï¼ˆè¶…ä¹°ï¼Œä»·æ ¼ > UBï¼‰
                        color = '#ff4d4f';
                        bgColor = 'rgba(255, 77, 79, 0.1)';
                        borderColor = '#ff4d4f';
                        break;
                    case 2:
                        // ç¬¬äºŒè±¡é™ - æ©™è‰²ï¼ˆåå¼ºï¼ŒUB > ä»·æ ¼ > BOLLï¼‰
                        color = '#ffa726';
                        bgColor = 'rgba(255, 167, 38, 0.1)';
                        borderColor = '#ffa726';
                        break;
                    case 3:
                        // ç¬¬ä¸‰è±¡é™ - è“è‰²ï¼ˆåå¼±ï¼ŒBOLL > ä»·æ ¼ > LBï¼‰
                        color = '#64b5f6';
                        bgColor = 'rgba(100, 181, 246, 0.1)';
                        borderColor = '#64b5f6';
                        break;
                    case 4:
                        // ç¬¬å››è±¡é™ - ç»¿è‰²ï¼ˆè¶…å–ï¼Œä»·æ ¼ < LBï¼‰
                        color = '#00ff88';
                        bgColor = 'rgba(0, 255, 136, 0.1)';
                        borderColor = '#00ff88';
                        break;
                }
                
                quadrantElement.textContent = label;
                quadrantElement.style.color = color;
                quadrantElement.style.backgroundColor = bgColor;
                quadrantElement.style.borderColor = borderColor;
            } else {
                quadrantElement.textContent = '--';
                quadrantElement.style.color = '#8b8fa4';
                quadrantElement.style.backgroundColor = 'rgba(139, 143, 164, 0.1)';
                quadrantElement.style.borderColor = '#8b8fa4';
            }
        }

        // å¯åŠ¨è‡ªåŠ¨ä¿å­˜
        function startAutoSave() {
            // æ¯30ç§’ä¿å­˜ä¸€æ¬¡å½“å‰è¯„åˆ†æ•°æ®åˆ°æ•°æ®åº“
            saveDataInterval = setInterval(() => {
                saveCurrentScore();
            }, 30000); // 30ç§’
        }

        // ä¿å­˜å½“å‰è¯„åˆ†åˆ°æ•°æ®åº“ï¼ˆä¿å­˜æ‰€æœ‰é€‰ä¸­å¸ç§çš„æ•°æ®ï¼‰
        async function saveCurrentScore() {
            try {
                // ä» depth API è·å–æ‰€æœ‰é€‰ä¸­å¸ç§çš„å½“å‰è¯„åˆ†
                const promises = selectedSymbols.map(async (symbol) => {
                    try {
                        const response = await fetch(`${API_BASE_URL}/api/depth/score/${symbol}`);
                        const data = await response.json();
                        
                        if (data.success && data.scores) {
                            // ä¿å­˜åˆ°å†å²æ•°æ®åº“
                            await fetch(`${HISTORY_API_URL}/api/depth/history/save`, {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({
                                    symbol: symbol,
                                    long_score: data.scores.long_score,
                                    short_score: data.scores.short_score,
                                    timestamp: new Date().toISOString()
                                })
                            });
                            return { symbol, success: true };
                        }
                    } catch (error) {
                        console.error(`ä¿å­˜ ${symbol} æ•°æ®å¤±è´¥:`, error);
                        return { symbol, success: false };
                    }
                });
                
                const results = await Promise.all(promises);
                const successCount = results.filter(r => r.success).length;
                
                if (successCount > 0) {
                    console.log(`âœ… å·²ä¿å­˜ ${successCount}/${selectedSymbols.length} ä¸ªå¸ç§çš„è¯„åˆ†æ•°æ®`);
                    
                    // æ›´æ–°å½“å‰æ—¶é—´èŒƒå›´çš„å†å²æ•°æ®
                    loadHistoryData(currentTimeRange);
                }
            } catch (error) {
                console.error('æ‰¹é‡ä¿å­˜è¯„åˆ†æ•°æ®å¤±è´¥:', error);
            }
        }

        // åœæ­¢è‡ªåŠ¨ä¿å­˜
        function stopAutoSave() {
            if (saveDataInterval) {
                clearInterval(saveDataInterval);
                saveDataInterval = null;
            }
        }

        // =================== SARç»Ÿè®¡åŠŸèƒ½ ===================
        
        const SAR_API_URL = window.location.hostname === 'localhost' 
            ? 'http://localhost:5012' 
            : `https://${window.location.hostname.replace('3000-', '5012-')}`;
        
        let sarUpdateInterval = null;
        let currentSarSymbol = 'ETH-USDT-SWAP'; // é»˜è®¤æ˜¾ç¤ºETH
        let allSarData = {}; // ç¼“å­˜æ‰€æœ‰å¸ç§çš„SARæ•°æ®
        
        // åˆ‡æ¢SARå¸ç§
        // æ›´æ–°SARå¸ç§æ˜¾ç¤ºï¼ˆè·Ÿéšå†å²æ·±åº¦è¯„åˆ†çš„é€‰æ‹©ï¼‰
        function updateSarCoinDisplay(symbol) {
            currentSarSymbol = symbol;
            
            // æ›´æ–°æ˜¾ç¤ºçš„å¸ç§åç§°
            const coinName = symbol.split('-')[0];
            const displayElement = document.getElementById('sarCoinDisplay');
            if (displayElement) {
                displayElement.textContent = coinName;
            }
            
            console.log(`ğŸ”„ SARå¸ç§å·²åŒæ­¥åˆ°: ${currentSarSymbol}`);
            
            // ç«‹å³æ›´æ–°SARæ˜¾ç¤ºæ•°æ®
            if (allSarData[currentSarSymbol]) {
                updateSarDisplay(currentSarSymbol, allSarData[currentSarSymbol]);
            } else {
                // å¦‚æœç¼“å­˜ä¸­æ²¡æœ‰æ•°æ®ï¼Œç«‹å³è·å–
                updateSarData();
            }
        }
        
        // å¯åŠ¨SARæ•°æ®æ›´æ–°
        function startSarUpdate() {
            if (sarUpdateInterval) {
                clearInterval(sarUpdateInterval);
            }
            updateSarData(); // ç«‹å³æ›´æ–°ä¸€æ¬¡
            sarUpdateInterval = setInterval(updateSarData, 300000); // æ¯5åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡
        }
        
        // åœæ­¢SARæ•°æ®æ›´æ–°
        function stopSarUpdate() {
            if (sarUpdateInterval) {
                clearInterval(sarUpdateInterval);
                sarUpdateInterval = null;
            }
        }
        
        // æ›´æ–°æ‰€æœ‰å¸ç§çš„SARæ•°æ®
        async function updateSarData() {
            try {
                const response = await fetch(`${SAR_API_URL}/api/sar/data`);
                const result = await response.json();
                
                if (result.success && result.data) {
                    allSarData = result.data; // ç¼“å­˜æ‰€æœ‰æ•°æ®
                    
                    // æ›´æ–°å½“å‰é€‰ä¸­å¸ç§çš„æ˜¾ç¤º
                    if (allSarData[currentSarSymbol]) {
                        updateSarDisplay(currentSarSymbol, allSarData[currentSarSymbol]);
                    }
                    
                    console.log('âœ… SARæ•°æ®æ›´æ–°æˆåŠŸ');
                }
            } catch (error) {
                console.error('âŒ SARæ•°æ®æ›´æ–°å¤±è´¥:', error);
            }
        }
        
        // æ›´æ–°SARæ˜¾ç¤º
        function updateSarDisplay(symbol, data) {
            try {
                const coinName = symbol.split('-')[0];
                
                // æ›´æ–°å¸ç§åç§°
                const coinNameElement = document.getElementById('sarCoinName');
                if (coinNameElement) {
                    coinNameElement.textContent = coinName;
                }
                
                // æ›´æ–°è¶‹åŠ¿çŠ¶æ€
                const trendElement = document.getElementById('sarTrend');
                if (trendElement) {
                    trendElement.textContent = data.display || '--';
                    
                    // æ ¹æ®è¶‹åŠ¿ç±»å‹è®¾ç½®æ ·å¼
                    trendElement.classList.remove('bullish', 'bearish');
                    if (data.trend === 'bullish') {
                        trendElement.classList.add('bullish');
                    } else if (data.trend === 'bearish') {
                        trendElement.classList.add('bearish');
                    }
                }
                
                // æ›´æ–°RSI
                const rsiElement = document.getElementById('sarRsi');
                if (rsiElement && data.rsi !== null) {
                    rsiElement.textContent = data.rsi.toFixed(2);
                    
                    // RSIé¢œè‰²å˜åŒ–
                    if (data.rsi > 70) {
                        rsiElement.style.color = '#ff4d4f'; // è¶…ä¹°-çº¢è‰²
                    } else if (data.rsi < 30) {
                        rsiElement.style.color = '#00ff88'; // è¶…å–-ç»¿è‰²
                    } else {
                        rsiElement.style.color = '#ffa726'; // æ­£å¸¸-æ©™è‰²
                    }
                }
                
                // æ›´æ–°ä»·æ ¼
                const priceElement = document.getElementById('sarPrice');
                if (priceElement && data.price !== null) {
                    priceElement.textContent = parseFloat(data.price).toFixed(data.price > 100 ? 2 : 4);
                }
                
                // æ›´æ–°å¸ƒæ—å¸¦è±¡é™æ˜¾ç¤º
                updateBollingerQuadrant(data);
                
                // æ›´æ–°æ—¶é—´ï¼ˆæ˜¾ç¤ºåŒ—äº¬æ—¶é—´ï¼‰
                const updateElement = document.getElementById('sarUpdateTime');
                if (updateElement && data.update_time) {
                    // åç«¯è¿”å›çš„æ˜¯UTCæ—¶é—´ï¼Œéœ€è¦è½¬æ¢ä¸ºåŒ—äº¬æ—¶é—´ï¼ˆUTC+8ï¼‰
                    const utcTime = new Date(data.update_time + ' UTC');
                    const beijingTime = new Date(utcTime.getTime() + 8 * 60 * 60 * 1000);
                    const timeStr = beijingTime.toLocaleTimeString('zh-CN', { 
                        hour12: false,
                        hour: '2-digit',
                        minute: '2-digit',
                        second: '2-digit'
                    });
                    updateElement.textContent = timeStr + ' (åŒ—äº¬æ—¶é—´)';
                }
            } catch (error) {
                console.error(`æ›´æ–°${symbol}çš„SARæ˜¾ç¤ºå¤±è´¥:`, error);
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶å¯åŠ¨SARæ›´æ–°
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸ¯ å¯åŠ¨SARç»Ÿè®¡ç›‘æ§...');
            startSarUpdate();
        });
        
        // ===== å†…å­˜ç®¡ç†åŠŸèƒ½ =====
        let memoryMonitorInterval = null;
        let autoMemoryClearInterval = null;
        let memoryStats = {
            usedJSHeapSize: 0,
            totalJSHeapSize: 0,
            jsHeapSizeLimit: 0
        };
        
        // åˆå§‹åŒ–å†…å­˜ç®¡ç†
        function initMemoryManagement() {
            console.log('ğŸ§¹ åˆå§‹åŒ–å†…å­˜ç®¡ç†ç³»ç»Ÿ...');
            
            // åˆ›å»ºå†…å­˜æŒ‡ç¤ºå™¨
            const indicator = document.createElement('div');
            indicator.className = 'memory-indicator';
            indicator.id = 'memoryIndicator';
            indicator.innerHTML = `
                <div class="memory-title">
                    <span>ğŸ’¾</span>
                    <span>å†…å­˜ç›‘æ§</span>
                </div>
                <div class="memory-item">
                    <span>å·²ç”¨å†…å­˜:</span>
                    <span class="memory-value" id="usedMemory">--</span>
                </div>
                <div class="memory-item">
                    <span>å†…å­˜é™åˆ¶:</span>
                    <span class="memory-value" id="memoryLimit">--</span>
                </div>
                <div class="memory-item">
                    <span>ä½¿ç”¨ç‡:</span>
                    <span class="memory-value" id="memoryUsage">--</span>
                </div>
                <div class="memory-item">
                    <span>ä¸‹æ¬¡æ¸…ç†:</span>
                    <span class="memory-value" id="nextClear">--</span>
                </div>
            `;
            document.body.appendChild(indicator);
            
            // å¯åŠ¨å†…å­˜ç›‘æ§ï¼ˆæ¯ç§’æ›´æ–°ï¼‰
            startMemoryMonitor();
            
            // å¯åŠ¨è‡ªåŠ¨å†…å­˜æ¸…ç†ï¼ˆ10åˆ†é’Ÿä¸€æ¬¡ï¼‰
            startAutoMemoryClear();
            
            console.log('âœ… å†…å­˜ç®¡ç†ç³»ç»Ÿå·²å¯åŠ¨ï¼ˆ10åˆ†é’Ÿè‡ªåŠ¨æ¸…ç†ï¼‰');
        }
        
        // å¯åŠ¨å†…å­˜ç›‘æ§
        function startMemoryMonitor() {
            if (memoryMonitorInterval) {
                clearInterval(memoryMonitorInterval);
            }
            
            memoryMonitorInterval = setInterval(() => {
                updateMemoryDisplay();
            }, 1000); // æ¯ç§’æ›´æ–°ä¸€æ¬¡
        }
        
        // æ›´æ–°å†…å­˜æ˜¾ç¤º
        function updateMemoryDisplay() {
            if (!performance.memory) {
                document.getElementById('usedMemory').textContent = 'ä¸æ”¯æŒ';
                document.getElementById('memoryLimit').textContent = 'ä¸æ”¯æŒ';
                document.getElementById('memoryUsage').textContent = 'ä¸æ”¯æŒ';
                return;
            }
            
            const memory = performance.memory;
            memoryStats.usedJSHeapSize = memory.usedJSHeapSize;
            memoryStats.totalJSHeapSize = memory.totalJSHeapSize;
            memoryStats.jsHeapSizeLimit = memory.jsHeapSizeLimit;
            
            const usedMB = (memory.usedJSHeapSize / 1024 / 1024).toFixed(1);
            const limitMB = (memory.jsHeapSizeLimit / 1024 / 1024).toFixed(1);
            const usagePercent = ((memory.usedJSHeapSize / memory.jsHeapSizeLimit) * 100).toFixed(1);
            
            document.getElementById('usedMemory').textContent = `${usedMB} MB`;
            document.getElementById('memoryLimit').textContent = `${limitMB} MB`;
            
            const usageElement = document.getElementById('memoryUsage');
            usageElement.textContent = `${usagePercent}%`;
            
            // æ ¹æ®ä½¿ç”¨ç‡è®¾ç½®é¢œè‰²
            if (usagePercent >= 80) {
                usageElement.className = 'memory-value danger';
            } else if (usagePercent >= 60) {
                usageElement.className = 'memory-value warning';
            } else {
                usageElement.className = 'memory-value';
            }
            
            // å¦‚æœå†…å­˜ä½¿ç”¨ç‡è¶…è¿‡85%ï¼Œè‡ªåŠ¨è§¦å‘æ¸…ç†
            if (usagePercent >= 85) {
                console.warn(`âš ï¸ å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜ (${usagePercent}%)ï¼Œè‡ªåŠ¨è§¦å‘æ¸…ç†...`);
                clearMemory();
            }
        }
        
        // å¯åŠ¨è‡ªåŠ¨å†…å­˜æ¸…ç†
        function startAutoMemoryClear() {
            if (autoMemoryClearInterval) {
                clearInterval(autoMemoryClearInterval);
            }
            
            let countdown = 600; // 10åˆ†é’Ÿ = 600ç§’
            
            autoMemoryClearInterval = setInterval(() => {
                countdown--;
                
                const minutes = Math.floor(countdown / 60);
                const seconds = countdown % 60;
                document.getElementById('nextClear').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                if (countdown <= 0) {
                    console.log('â° å®šæ—¶è§¦å‘å†…å­˜æ¸…ç†ï¼ˆ10åˆ†é’Ÿï¼‰...');
                    clearMemory();
                    countdown = 600; // é‡ç½®å€’è®¡æ—¶
                }
            }, 1000);
        }
        
        // æ¸…ç†å†…å­˜
        function clearMemory() {
            console.log('ğŸ§¹ å¼€å§‹æ¸…ç†å†…å­˜...');
            
            const beforeUsed = performance.memory ? (performance.memory.usedJSHeapSize / 1024 / 1024).toFixed(1) : 0;
            
            try {
                // 1. æ¸…ç†å†å²æ•°æ®ï¼ˆä¿ç•™æœ€è¿‘100ä¸ªæ•°æ®ç‚¹ï¼‰
                Object.keys(historyData).forEach(range => {
                    if (historyData[range].long && historyData[range].long.length > 100) {
                        historyData[range].long = historyData[range].long.slice(-100);
                        historyData[range].short = historyData[range].short.slice(-100);
                        historyData[range].timestamps = historyData[range].timestamps.slice(-100);
                        historyData[range].price_change = historyData[range].price_change.slice(-100);
                        historyData[range].price_actual = historyData[range].price_actual.slice(-100);
                    }
                });
                
                // 2. æ¸…ç†Canvasç¼“å­˜ï¼ˆé‡ç»˜ï¼‰
                if (historyCtx) {
                    historyCtx.clearRect(0, 0, historyCanvas.width, historyCanvas.height);
                    drawHistoryChart(currentTimeRange);
                }
                
                // 3. æ¸…ç©ºiframeç¼“å­˜ï¼ˆå¯é€‰ï¼Œä¼šå¯¼è‡´é‡æ–°åŠ è½½ï¼‰
                // const iframe = document.getElementById('okexIframe');
                // if (iframe) {
                //     iframe.contentWindow.location.reload();
                // }
                
                // 4. å¼ºåˆ¶åƒåœ¾å›æ”¶ï¼ˆä»…åœ¨æ”¯æŒçš„æµè§ˆå™¨ä¸­ï¼‰
                if (window.gc) {
                    window.gc();
                    console.log('âœ… å·²è§¦å‘åƒåœ¾å›æ”¶');
                }
                
                // 5. æ¸…ç†å…¨å±€å˜é‡ç¼“å­˜
                if (window.performance && window.performance.memory) {
                    const afterUsed = (performance.memory.usedJSHeapSize / 1024 / 1024).toFixed(1);
                    const freed = (beforeUsed - afterUsed).toFixed(1);
                    console.log(`âœ… å†…å­˜æ¸…ç†å®Œæˆ: ${beforeUsed}MB â†’ ${afterUsed}MB (é‡Šæ”¾ ${freed}MB)`);
                    showNotification(`âœ… å†…å­˜æ¸…ç†å®Œæˆ\né‡Šæ”¾: ${freed}MB`, 'success');
                } else {
                    console.log('âœ… å†…å­˜æ¸…ç†å®Œæˆ');
                    showNotification('âœ… å†…å­˜æ¸…ç†å®Œæˆ', 'success');
                }
                
            } catch (error) {
                console.error('âŒ å†…å­˜æ¸…ç†å¤±è´¥:', error);
                showNotification('âŒ å†…å­˜æ¸…ç†å¤±è´¥', 'error');
            }
        }
        
        // æ‰‹åŠ¨æ¸…ç†å†…å­˜
        function manualClearMemory() {
            console.log('ğŸ–±ï¸ ç”¨æˆ·æ‰‹åŠ¨è§¦å‘å†…å­˜æ¸…ç†...');
            clearMemory();
            
            // é‡ç½®è‡ªåŠ¨æ¸…ç†å€’è®¡æ—¶
            if (autoMemoryClearInterval) {
                clearInterval(autoMemoryClearInterval);
                startAutoMemoryClear();
            }
        }
        
        // ç¡¬åˆ·æ–°é¡µé¢
        function hardRefresh() {
            console.log('ğŸ”„ ç¡¬åˆ·æ–°é¡µé¢ï¼ˆæ¸…é™¤ç¼“å­˜ï¼‰...');
            showNotification('ğŸ”„ æ­£åœ¨ç¡¬åˆ·æ–°é¡µé¢...', 'info');
            
            // å»¶è¿Ÿ200msååˆ·æ–°ï¼Œç¡®ä¿é€šçŸ¥æ˜¾ç¤º
            setTimeout(() => {
                window.location.reload(true); // å¼ºåˆ¶ä»æœåŠ¡å™¨é‡æ–°åŠ è½½
            }, 200);
        }
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–å†…å­˜ç®¡ç†
        // æ³¨é‡Šæ‰å†…å­˜ç›‘æ§æ˜¾ç¤ºï¼ˆæ ¹æ®ç”¨æˆ·è¦æ±‚ï¼‰
        // document.addEventListener('DOMContentLoaded', () => {
        //     initMemoryManagement();
        // });
        
        // é¡µé¢å¸è½½æ—¶æ¸…ç†å®šæ—¶å™¨
        window.addEventListener('beforeunload', () => {
            if (memoryMonitorInterval) {
                clearInterval(memoryMonitorInterval);
            }
            if (autoMemoryClearInterval) {
                clearInterval(autoMemoryClearInterval);
            }
        });
    </script>
</body>
</html>
