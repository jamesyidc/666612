<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Google Drive TXTç›‘æ§ (æ— ç¼“å­˜)</title>
    <link rel="stylesheet" href="/static/css/style.css?v={{ timestamp }}">
</head>
<body>
    <div style="padding: 20px; font-family: Arial, sans-serif;">
        <h1>ğŸ” Google Drive TXT æ–‡ä»¶ç›‘æ§</h1>
        <div style="background: #f0f0f0; padding: 15px; margin: 20px 0; border-radius: 8px;">
            <h2>æ£€æµ‹å™¨çŠ¶æ€</h2>
            <div style="font-size: 18px; margin: 10px 0;">
                è¿è¡ŒçŠ¶æ€: <span id="status-text" style="font-weight: bold; color: #666;">åŠ è½½ä¸­...</span>
                <span id="indicator" style="display: inline-block; width: 12px; height: 12px; border-radius: 50%; background: #ccc; margin-left: 10px;"></span>
            </div>
            <div style="font-size: 14px; color: #666; margin: 5px 0;">
                æœ€åæ£€æŸ¥: <span id="last-check">--</span>
            </div>
            <div style="font-size: 14px; color: #666; margin: 5px 0;">
                æ–‡ä»¶æ—¶é—´: <span id="file-time">--</span>
            </div>
            <div style="font-size: 14px; color: #666; margin: 5px 0;">
                æ•°æ®å»¶è¿Ÿ: <span id="delay">--</span>
            </div>
        </div>
        
        <div style="background: #f0f0f0; padding: 15px; margin: 20px 0; border-radius: 8px;">
            <h2>TXT æ–‡ä»¶åˆ—è¡¨ (<span id="file-count">0</span> ä¸ªæ–‡ä»¶)</h2>
            <div id="file-list" style="max-height: 400px; overflow-y: auto; font-family: monospace; font-size: 13px;">
                åŠ è½½ä¸­...
            </div>
        </div>
        
        <div style="margin: 20px 0;">
            <button onclick="loadAll()" style="padding: 10px 20px; font-size: 16px; cursor: pointer;">ğŸ”„ åˆ·æ–°æ•°æ®</button>
            <a href="/gdrive-detector" style="margin-left: 15px; text-decoration: none; color: #007bff;">è¿”å›åŸé¡µé¢</a>
        </div>
    </div>
    
    <script>
        async function loadStatus() {
            try {
                const response = await fetch('/api/gdrive-detector/status?' + Date.now());
                const result = await response.json();
                
                if (result.success && result.data) {
                    const data = result.data;
                    const statusEl = document.getElementById('status-text');
                    const indicator = document.getElementById('indicator');
                    
                    if (data.detector_running) {
                        statusEl.textContent = 'âœ… è¿è¡Œä¸­';
                        statusEl.style.color = '#28a745';
                        indicator.style.background = '#28a745';
                    } else {
                        statusEl.textContent = 'âŒ å·²åœæ­¢';
                        statusEl.style.color = '#dc3545';
                        indicator.style.background = '#dc3545';
                    }
                    
                    document.getElementById('last-check').textContent = data.last_check_time || '--';
                    document.getElementById('file-time').textContent = data.file_timestamp || '--';
                    document.getElementById('delay').textContent = data.delay_minutes ? data.delay_minutes.toFixed(1) + ' åˆ†é’Ÿ' : '--';
                }
            } catch (error) {
                console.error('åŠ è½½çŠ¶æ€å¤±è´¥:', error);
                document.getElementById('status-text').textContent = 'âŒ åŠ è½½å¤±è´¥';
                document.getElementById('status-text').style.color = '#dc3545';
            }
        }
        
        async function loadFiles() {
            try {
                const response = await fetch('/api/gdrive-detector/txt-files?' + Date.now());
                const result = await response.json();
                
                if (result.files && result.files.length > 0) {
                    document.getElementById('file-count').textContent = result.files.length;
                    const fileList = result.files.slice(0, 50).map((file, index) => 
                        `<div style="padding: 5px; ${index % 2 === 0 ? 'background: #fff;' : ''}">${index + 1}. ${file}</div>`
                    ).join('');
                    document.getElementById('file-list').innerHTML = fileList;
                } else {
                    document.getElementById('file-list').innerHTML = '<div style="color: #999;">æš‚æ— æ–‡ä»¶</div>';
                }
            } catch (error) {
                console.error('åŠ è½½æ–‡ä»¶å¤±è´¥:', error);
                document.getElementById('file-list').innerHTML = '<div style="color: #dc3545;">åŠ è½½å¤±è´¥</div>';
            }
        }
        
        function loadAll() {
            loadStatus();
            loadFiles();
        }
        
        // åˆå§‹åŠ è½½
        loadAll();
        
        // æ¯10ç§’è‡ªåŠ¨åˆ·æ–°
        setInterval(loadAll, 10000);
    </script>
</body>
</html>
