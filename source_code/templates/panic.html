<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ææ…Œè´ªå©ªæŒ‡æ•° - åŠ å¯†è´§å¸æ•°æ®åˆ†æ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        /* é¡¶éƒ¨å¯¼èˆª */
        .top-nav {
            background: #2a2d47;
            padding: 12px 20px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }
        
        .nav-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .nav-brand {
            display: flex;
            align-items: center;
            gap: 8px;
            background: #3b7dff;
            padding: 6px 15px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
        }
        
        .nav-title {
            font-size: 16px;
            font-weight: 600;
        }
        
        .home-btn {
            background: linear-gradient(135deg, #00d4ff 0%, #0099ff 100%);
            color: #fff;
            border: none;
            padding: 8px 20px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
            text-decoration: none;
        }
        
        .home-btn:hover {
            background: linear-gradient(135deg, #0099ff 0%, #00d4ff 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 212, 255, 0.4);
        }
        
        /* ä¸»å†…å®¹åŒº */
        .main-content {
            display: grid;
            gap: 30px;
        }
        
        /* æŒ‡æ•°å¡ç‰‡ */
        .index-card {
            background: rgba(42, 45, 71, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.4);
        }
        
        .index-title {
            font-size: 2rem;
            margin-bottom: 30px;
            color: #00d4ff;
        }
        
        .index-value {
            font-size: 5rem;
            font-weight: 700;
            margin: 20px 0;
            text-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
        
        .index-level {
            font-size: 2rem;
            margin: 20px 0;
            padding: 10px 30px;
            border-radius: 50px;
            display: inline-block;
        }
        
        .update-time {
            font-size: 1rem;
            color: rgba(255,255,255,0.6);
            margin-top: 20px;
        }
        
        /* é¢œè‰²ç­‰çº§ */
        .level-extreme-fear { background: linear-gradient(135deg, #ff4444, #cc0000); }
        .level-fear { background: linear-gradient(135deg, #ff8844, #ff4444); }
        .level-neutral { background: linear-gradient(135deg, #ffcc44, #ff8844); }
        .level-greed { background: linear-gradient(135deg, #88ff44, #44cc00); }
        .level-extreme-greed { background: linear-gradient(135deg, #44ff44, #00cc00); }
        
        .color-extreme-fear { color: #ff4444; }
        .color-fear { color: #ff8844; }
        .color-neutral { color: #ffcc44; }
        .color-greed { color: #88ff44; }
        .color-extreme-greed { color: #44ff44; }
        
        /* åŠ è½½çŠ¶æ€ */
        .loading {
            text-align: center;
            padding: 60px 20px;
            font-size: 1.2rem;
            color: rgba(255,255,255,0.6);
        }
        
        /* åŒåˆ—å¸ƒå±€ */
        .grid-2 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
        }
        
        @media (max-width: 768px) {
            .grid-2 {
                grid-template-columns: 1fr;
            }
            
            .index-value {
                font-size: 3rem;
            }
            
            .index-title {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- é¡¶éƒ¨å¯¼èˆª -->
        <div class="top-nav">
            <div class="nav-left">
                <div class="nav-brand">
                    <span>ğŸ˜±</span> ææ…Œè´ªå©ªæŒ‡æ•°
                </div>
                <div class="nav-title">å¸‚åœºæƒ…ç»ªå®æ—¶ç›‘æ§</div>
            </div>
            <a href="/" class="home-btn">
                <span>ğŸ </span> è¿”å›é¦–é¡µ
            </a>
        </div>
        
        <!-- ä¸»å†…å®¹ -->
        <div class="main-content">
            <div id="loadingState" class="loading">
                æ­£åœ¨åŠ è½½æ•°æ®...
            </div>
            
            <div id="dataContent" class="grid-2" style="display: none;">
                <!-- ææ…ŒæŒ‡æ•°å¡ç‰‡ -->
                <div class="index-card">
                    <h2 class="index-title">ğŸ˜± ææ…ŒæŒ‡æ•°</h2>
                    <div id="panicValue" class="index-value color-neutral">--</div>
                    <div id="panicLevel" class="index-level level-neutral">åŠ è½½ä¸­...</div>
                    <div id="panicTime" class="update-time">æ›´æ–°æ—¶é—´: --</div>
                </div>
                
                <!-- æ¸…æ´—æŒ‡æ•°å¡ç‰‡ -->
                <div class="index-card">
                    <h2 class="index-title">ğŸŒŠ æ¸…æ´—æŒ‡æ•°</h2>
                    <div id="washValue" class="index-value color-neutral">--</div>
                    <div id="washLevel" class="index-level level-neutral">åŠ è½½ä¸­...</div>
                    <div id="washTime" class="update-time">æ›´æ–°æ—¶é—´: --</div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // åŠ è½½æ•°æ®
        async function loadPanicData() {
            try {
                const response = await fetch('/api/panic/latest');
                const result = await response.json();
                
                if (result.success && result.data) {
                    const data = result.data;
                    
                    // æ˜¾ç¤ºæ•°æ®åŒºåŸŸï¼Œéšè—åŠ è½½çŠ¶æ€
                    document.getElementById('loadingState').style.display = 'none';
                    document.getElementById('dataContent').style.display = 'grid';
                    
                    // æ›´æ–°ææ…Œæ¸…æ´—æŒ‡æ•°
                    document.getElementById('panicValue').textContent = data.panic_index ? data.panic_index.toFixed(2) + '%' : '--';
                    document.getElementById('panicLevel').textContent = data.panic_level || 'æœªçŸ¥';
                    document.getElementById('panicTime').textContent = 'æ›´æ–°æ—¶é—´: ' + (data.record_time || '--');
                    
                    // æ›´æ–°å¸‚åœºæ•°æ®
                    document.getElementById('washValue').textContent = data.market_zone || '--';
                    document.getElementById('washLevel').textContent = `24hçˆ†ä»“: ${data.hour_24_people}ä¸‡äºº | å…¨ç½‘æŒä»“: ${data.total_position}äº¿ç¾å…ƒ`;
                    document.getElementById('washTime').textContent = 'æ›´æ–°æ—¶é—´: ' + (data.record_time || '--');
                    
                    // è®¾ç½®é¢œè‰²
                    setLevelColor('panic', data.level_color || 'gray');
                    setLevelColor('wash', data.level_color || 'gray');
                } else {
                    showError('æš‚æ— æ•°æ®');
                }
            } catch (error) {
                console.error('åŠ è½½å¤±è´¥:', error);
                showError('åŠ è½½å¤±è´¥: ' + error.message);
            }
        }
        
        // è®¾ç½®ç­‰çº§é¢œè‰²
        function setLevelColor(type, color) {
            const valueEl = document.getElementById(type + 'Value');
            const levelEl = document.getElementById(type + 'Level');
            
            if (!valueEl || !levelEl) return;
            
            // ç§»é™¤æ‰€æœ‰é¢œè‰²ç±»
            const colorClasses = ['color-extreme-fear', 'color-fear', 'color-neutral', 'color-greed', 'color-extreme-greed'];
            const levelClasses = ['level-extreme-fear', 'level-fear', 'level-neutral', 'level-greed', 'level-extreme-greed'];
            
            valueEl.classList.remove(...colorClasses);
            levelEl.classList.remove(...levelClasses);
            
            // æ ¹æ®é¢œè‰²æ·»åŠ æ ·å¼
            if (color === 'green') {
                valueEl.classList.add('color-greed');
                levelEl.classList.add('level-greed');
            } else if (color === 'yellow') {
                valueEl.classList.add('color-neutral');
                levelEl.classList.add('level-neutral');
            } else if (color === 'red') {
                valueEl.classList.add('color-extreme-fear');
                levelEl.classList.add('level-extreme-fear');
            }
        }
        
        // æ˜¾ç¤ºé”™è¯¯
        function showError(message) {
            document.getElementById('loadingState').innerHTML = 'âš ï¸ ' + message;
            document.getElementById('loadingState').style.display = 'block';
            document.getElementById('dataContent').style.display = 'none';
        }
        
        // é¡µé¢åŠ è½½æ—¶è·å–æ•°æ®
        loadPanicData();
        
        // æ¯30ç§’åˆ·æ–°ä¸€æ¬¡
        setInterval(loadPanicData, 30000);
    </script>
</body>
</html>
