<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº¤æ˜“ä¿¡å·ç›‘æ§ - åšå¤šåšç©ºä¿¡å·è¿½è¸ª</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            padding: 20px;
            color: #fff;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .top-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .page-title {
            font-size: 2rem;
            color: #fff;
        }
        
        .home-btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, #00d4ff 0%, #0099ff 100%);
            color: #fff;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .home-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 212, 255, 0.5);
        }
        
        /* ç»Ÿè®¡å¡ç‰‡ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: rgba(42, 45, 71, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 25px;
            text-align: center;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 10px;
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .stat-value.long {
            color: #10b981;
        }
        
        .stat-value.short {
            color: #ef4444;
        }
        
        .stat-value.neutral {
            color: #00d4ff;
        }
        
        /* å›¾è¡¨å®¹å™¨ */
        .chart-section {
            background: rgba(42, 45, 71, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
        }
        
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .chart-title {
            font-size: 1.5rem;
            color: #fff;
        }
        
        .chart-controls {
            display: flex;
            gap: 10px;
        }
        
        .chart-btn {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #fff;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .chart-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .chart-btn.active {
            background: linear-gradient(135deg, #00d4ff 0%, #0099ff 100%);
            border-color: transparent;
        }
        
        #signalChart {
            width: 100%;
            height: 500px;
        }
        
        /* åˆ†é¡µæ§åˆ¶ */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-top: 20px;
        }
        
        .page-btn {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #fff;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .page-btn:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .page-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        .page-info {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.95rem;
        }
        
        /* å†å²æ•°æ®è¡¨æ ¼ */
        .history-section {
            background: rgba(42, 45, 71, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 25px;
        }
        
        .history-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .history-table th,
        .history-table td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .history-table th {
            background: rgba(0, 0, 0, 0.3);
            color: #00d4ff;
            font-weight: 600;
        }
        
        .history-table tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .long-text {
            color: #10b981;
            font-weight: 600;
        }
        
        .short-text {
            color: #ef4444;
            font-weight: 600;
        }
        
        /* APIæ¥å£é¢æ¿ */
        .api-section {
            background: rgba(42, 45, 71, 0.95);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
        }
        
        .api-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .api-title {
            font-size: 1.3rem;
            color: #00d4ff;
            font-weight: 600;
        }
        
        .api-badge {
            background: linear-gradient(135deg, #00d4ff 0%, #0099ff 100%);
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .api-content {
            display: grid;
            gap: 20px;
        }
        
        .api-card {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 20px;
        }
        
        .api-card-title {
            color: #10b981;
            font-weight: 600;
            margin-bottom: 12px;
            font-size: 1.1rem;
        }
        
        .api-url-box {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 6px;
            padding: 12px 15px;
            margin: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .api-url {
            color: #00d4ff;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 0.9rem;
            word-break: break-all;
            flex: 1;
        }
        
        .copy-btn {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            color: #fff;
            cursor: pointer;
            font-weight: 600;
            margin-left: 10px;
            transition: all 0.3s;
            white-space: nowrap;
        }
        
        .copy-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
        }
        
        .test-btn {
            background: linear-gradient(135deg, #00d4ff 0%, #0099ff 100%);
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            color: #fff;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            margin-top: 10px;
        }
        
        .test-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 212, 255, 0.4);
        }
        
        .api-info {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
            line-height: 1.6;
            margin-top: 10px;
        }
        
        .api-info strong {
            color: #fff;
        }
        
        .api-result {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 0.85rem;
            color: #10b981;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-break: break-all;
            display: none;
        }
        
        .api-result::-webkit-scrollbar {
            width: 8px;
        }
        
        .api-result::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
        }
        
        .api-result::-webkit-scrollbar-thumb {
            background: rgba(16, 185, 129, 0.5);
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- é¡¶éƒ¨å¯¼èˆª -->
        <div class="top-nav">
            <h1 class="page-title">ğŸ“Š äº¤æ˜“ä¿¡å·ç›‘æ§</h1>
            <a href="/" class="home-btn">ğŸ  è¿”å›é¦–é¡µ</a>
        </div>
        
        <!-- ç»Ÿè®¡å¡ç‰‡ -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">æœ€æ–°åšå¤šä¿¡å·</div>
                <div class="stat-value long" id="latestLong">-</div>
                <div class="stat-label" id="longRatio">å æ¯”: -</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">æœ€æ–°åšç©ºä¿¡å·</div>
                <div class="stat-value short" id="latestShort">-</div>
                <div class="stat-label" id="shortRatio">å æ¯”: -</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">æ€»ä¿¡å·æ•°</div>
                <div class="stat-value neutral" id="totalSignals">-</div>
                <div class="stat-label" id="updateTime">æ›´æ–°æ—¶é—´: -</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">æ•°æ®è®°å½•</div>
                <div class="stat-value neutral" id="totalRecords">-</div>
                <div class="stat-label">å†å²æ•°æ®ç‚¹</div>
            </div>
        </div>
        
        <!-- APIæ¥å£é¢æ¿ -->
        <div class="api-section">
            <div class="api-header">
                <h2 class="api-title">ğŸ”Œ ä¹°ç‚¹ä¿¡å·APIæ¥å£</h2>
                <span class="api-badge">GET è¯·æ±‚</span>
            </div>
            <div class="api-content">
                <div class="api-card">
                    <div class="api-card-title">ğŸ“‹ æ¥å£åœ°å€</div>
                    <div class="api-url-box">
                        <span class="api-url" id="apiUrl">https://5000-iz6uddj6rs3xe48ilsyqq-b237eb32.sandbox.novita.ai/api/trading-signals/buy-points</span>
                        <button class="copy-btn" onclick="copyApiUrl()">ğŸ“‹ å¤åˆ¶</button>
                    </div>
                    <button class="test-btn" onclick="testApi()">ğŸ§ª æµ‹è¯•æ¥å£</button>
                    <div id="apiResult" class="api-result"></div>
                </div>
                
                <div class="api-card">
                    <div class="api-card-title">ğŸ“Š è¿”å›æ•°æ®è¯´æ˜</div>
                    <div class="api-info">
                        <strong>ä¹°ç‚¹ç±»å‹ï¼š</strong><br>
                        â€¢ <span style="color: #10b981;">ä¹°ç‚¹1</span>ï¼šæ”¯æ’‘çº¿ä¹°å…¥ï¼ˆé£é™©ä½ï¼Œä»“ä½30%ï¼Œåˆ†3æ¬¡ï¼‰<br>
                        â€¢ <span style="color: #f59e0b;">ä¹°ç‚¹2</span>ï¼šå›è°ƒä¹°å…¥ï¼ˆé£é™©ä¸­ï¼Œä»“ä½20%ï¼Œåˆ†2æ¬¡ï¼‰<br>
                        â€¢ <span style="color: #ef4444;">ä¹°ç‚¹3</span>ï¼šç©ºè½¬å¤šä¹°å…¥ï¼ˆé£é™©é«˜ï¼ŒåŠ¨æ€ä»“ä½ï¼Œåˆ†2æ¬¡ï¼‰<br><br>
                        
                        <strong>æ•°æ®ç»“æ„ï¼š</strong><br>
                        â€¢ summary: ç»Ÿè®¡æ‘˜è¦ï¼ˆå„ä¹°ç‚¹æ•°é‡ï¼‰<br>
                        â€¢ buy_points: æŒ‰ç±»å‹åˆ†ç»„çš„ä¿¡å·<br>
                        â€¢ all_signals: æ‰€æœ‰ä¿¡å·åˆ—è¡¨<br>
                        â€¢ rules: ä¹°ç‚¹è§„åˆ™è¯´æ˜<br><br>
                        
                        <strong>ä¿¡å·å­—æ®µï¼š</strong><br>
                        â€¢ symbol: å¸ç§ç¬¦å·<br>
                        â€¢ current_price: å½“å‰ä»·æ ¼<br>
                        â€¢ suggested_position: å»ºè®®ä»“ä½<br>
                        â€¢ distance_to_support: è·æ”¯æ’‘çº¿è·ç¦»<br>
                        â€¢ rsi_5m/1h: RSIæŒ‡æ ‡<br>
                        â€¢ recommended: æ˜¯å¦æ¨è
                    </div>
                </div>
                
                <div class="api-card">
                    <div class="api-card-title">ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹</div>
                    <div class="api-info">
                        <strong>Python:</strong>
                        <div class="api-url-box" style="flex-direction: column; align-items: flex-start;">
                            <code style="color: #10b981; font-size: 0.85rem;">
import requests<br>
url = "https://5000-iz6uddj6rs3xe48ilsyqq-b237eb32.sandbox.novita.ai/api/trading-signals/buy-points"<br>
response = requests.get(url)<br>
data = response.json()<br>
print(f"æ€»ä¿¡å·: {data['summary']['total_signals']}")
                            </code>
                        </div>
                        <br>
                        <strong>cURL:</strong>
                        <div class="api-url-box" style="flex-direction: column; align-items: flex-start;">
                            <code style="color: #00d4ff; font-size: 0.85rem;">
curl "https://5000-iz6uddj6rs3xe48ilsyqq-b237eb32.sandbox.novita.ai/api/trading-signals/buy-points"
                            </code>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- å›¾è¡¨åŒºåŸŸ -->
        <div class="chart-section">
            <div class="chart-header">
                <h2 class="chart-title">ğŸ“ˆ ä¿¡å·è¶‹åŠ¿å›¾ (12å°æ—¶)</h2>
                <div class="chart-controls">
                    <button class="chart-btn" onclick="changeTimeRange('1h')">1å°æ—¶</button>
                    <button class="chart-btn" onclick="changeTimeRange('6h')">6å°æ—¶</button>
                    <button class="chart-btn active" onclick="changeTimeRange('12h')">12å°æ—¶</button>
                    <button class="chart-btn" onclick="changeTimeRange('24h')">24å°æ—¶</button>
                </div>
            </div>
            <div id="signalChart"></div>
            <div class="pagination">
                <button class="page-btn" id="prevPage" onclick="changePage(-1)">â† ä¸Šä¸€é¡µ</button>
                <span class="page-info" id="pageInfo">ç¬¬ 1 é¡µ</span>
                <button class="page-btn" id="nextPage" onclick="changePage(1)">ä¸‹ä¸€é¡µ â†’</button>
            </div>
        </div>
        
        <!-- å†å²æ•°æ®è¡¨æ ¼ -->
        <div class="history-section">
            <h2 class="chart-title">ğŸ“‹ å†å²è®°å½• (æœ€è¿‘50æ¡)</h2>
            <table class="history-table">
                <thead>
                    <tr>
                        <th>è®°å½•æ—¶é—´</th>
                        <th>åšå¤šä¿¡å·</th>
                        <th>åšç©ºä¿¡å·</th>
                        <th>æ€»ä¿¡å·</th>
                        <th>åšå¤šå æ¯”</th>
                        <th>åšç©ºå æ¯”</th>
                    </tr>
                </thead>
                <tbody id="historyBody">
                    <tr><td colspan="6">åŠ è½½ä¸­...</td></tr>
                </tbody>
            </table>
        </div>
    </div>
    
    <script>
        let chart = null;
        let currentPage = 0;
        let currentTimeRange = '12h';
        
        // å¤åˆ¶APIåœ°å€
        function copyApiUrl() {
            const apiUrl = document.getElementById('apiUrl').textContent;
            navigator.clipboard.writeText(apiUrl).then(() => {
                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = 'âœ… å·²å¤åˆ¶';
                btn.style.background = 'linear-gradient(135deg, #10b981 0%, #059669 100%)';
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.style.background = 'linear-gradient(135deg, #10b981 0%, #059669 100%)';
                }, 2000);
            }).catch(err => {
                alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
            });
        }
        
        // æµ‹è¯•APIæ¥å£
        async function testApi() {
            const resultDiv = document.getElementById('apiResult');
            const testBtn = event.target;
            const originalText = testBtn.textContent;
            
            testBtn.textContent = 'â³ æµ‹è¯•ä¸­...';
            testBtn.disabled = true;
            resultDiv.style.display = 'block';
            resultDiv.textContent = 'æ­£åœ¨è¯·æ±‚APIï¼Œè¯·ç¨å€™...';
            
            try {
                const apiUrl = document.getElementById('apiUrl').textContent;
                const response = await fetch(apiUrl);
                const data = await response.json();
                
                // æ ¼å¼åŒ–æ˜¾ç¤ºç»“æœ
                const formatted = JSON.stringify(data, null, 2);
                resultDiv.textContent = formatted;
                resultDiv.style.borderColor = 'rgba(16, 185, 129, 0.5)';
                
                // æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
                if (data.success) {
                    const summary = data.summary;
                    const statsText = `\nğŸ“Š ç»Ÿè®¡æ‘˜è¦ï¼š\næ€»ä¿¡å·æ•°: ${summary.total_signals}\nä¹°ç‚¹1: ${summary.buy_point_1_count}ä¸ª\nä¹°ç‚¹2: ${summary.buy_point_2_count}ä¸ª\nä¹°ç‚¹3: ${summary.buy_point_3_count}ä¸ª\n\n`;
                    resultDiv.textContent = statsText + 'å®Œæ•´JSONæ•°æ®ï¼š\n' + formatted;
                }
                
                testBtn.textContent = 'âœ… æµ‹è¯•æˆåŠŸ';
                setTimeout(() => {
                    testBtn.textContent = originalText;
                    testBtn.disabled = false;
                }, 2000);
                
            } catch (error) {
                resultDiv.textContent = 'âŒ è¯·æ±‚å¤±è´¥ï¼š' + error.message;
                resultDiv.style.borderColor = 'rgba(239, 68, 68, 0.5)';
                testBtn.textContent = 'âŒ æµ‹è¯•å¤±è´¥';
                setTimeout(() => {
                    testBtn.textContent = originalText;
                    testBtn.disabled = false;
                }, 2000);
            }
        }
        
        // åˆå§‹åŒ–å›¾è¡¨
        function initChart() {
            chart = echarts.init(document.getElementById('signalChart'));
            const option = {
                backgroundColor: 'transparent',
                tooltip: {
                    trigger: 'axis',
                    backgroundColor: 'rgba(0,0,0,0.8)',
                    borderColor: '#00d4ff',
                    textStyle: { color: '#fff' }
                },
                legend: {
                    data: ['åšå¤šä¿¡å·', 'åšç©ºä¿¡å·'],
                    textStyle: { color: '#fff' },
                    top: 10
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    top: 60,
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    boundaryGap: false,
                    data: [],
                    axisLine: { lineStyle: { color: 'rgba(255,255,255,0.3)' } },
                    axisLabel: { color: 'rgba(255,255,255,0.7)' }
                },
                yAxis: {
                    type: 'value',
                    axisLine: { lineStyle: { color: 'rgba(255,255,255,0.3)' } },
                    axisLabel: { color: 'rgba(255,255,255,0.7)' },
                    splitLine: { lineStyle: { color: 'rgba(255,255,255,0.1)' } }
                },
                series: [
                    {
                        name: 'åšå¤šä¿¡å·',
                        type: 'line',
                        smooth: true,
                        symbol: 'circle',
                        symbolSize: 6,
                        itemStyle: { color: '#10b981' },
                        areaStyle: {
                            color: {
                                type: 'linear',
                                x: 0, y: 0, x2: 0, y2: 1,
                                colorStops: [
                                    { offset: 0, color: 'rgba(16, 185, 129, 0.3)' },
                                    { offset: 1, color: 'rgba(16, 185, 129, 0.05)' }
                                ]
                            }
                        },
                        data: []
                    },
                    {
                        name: 'åšç©ºä¿¡å·',
                        type: 'line',
                        smooth: true,
                        symbol: 'circle',
                        symbolSize: 6,
                        itemStyle: { color: '#ef4444' },
                        areaStyle: {
                            color: {
                                type: 'linear',
                                x: 0, y: 0, x2: 0, y2: 1,
                                colorStops: [
                                    { offset: 0, color: 'rgba(239, 68, 68, 0.3)' },
                                    { offset: 1, color: 'rgba(239, 68, 68, 0.05)' }
                                ]
                            }
                        },
                        data: []
                    }
                ]
            };
            chart.setOption(option);
        }
        
        // åŠ è½½æ•°æ®
        async function loadData() {
            try {
                // åŠ è½½å›¾è¡¨æ•°æ®
                const chartResponse = await fetch(`/api/signals/chart?page=${currentPage}&range=${currentTimeRange}`);
                const chartData = await chartResponse.json();
                
                if (chartData.success) {
                    updateChart(chartData.data);
                    updatePagination(chartData.page, chartData.total_pages);
                }
                
                // åŠ è½½ç»Ÿè®¡æ•°æ®
                const statsResponse = await fetch('/api/signals/stats');
                const statsData = await statsResponse.json();
                
                if (statsData.success) {
                    updateStats(statsData.data);
                }
                
                // åŠ è½½å†å²è®°å½•
                const historyResponse = await fetch('/api/signals/history?limit=50');
                const historyData = await historyResponse.json();
                
                if (historyData.success) {
                    updateHistory(historyData.data);
                }
                
            } catch (error) {
                console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
            }
        }
        
        // æ›´æ–°å›¾è¡¨
        function updateChart(data) {
            const times = data.map(d => d.time);
            const longSignals = data.map(d => d.long_signals);
            const shortSignals = data.map(d => d.short_signals);
            
            chart.setOption({
                xAxis: { data: times },
                series: [
                    { data: longSignals },
                    { data: shortSignals }
                ]
            });
        }
        
        // æ›´æ–°ç»Ÿè®¡å¡ç‰‡
        function updateStats(data) {
            document.getElementById('latestLong').textContent = data.latest_long || 0;
            document.getElementById('latestShort').textContent = data.latest_short || 0;
            document.getElementById('totalSignals').textContent = data.latest_total || 0;
            document.getElementById('totalRecords').textContent = data.total_records || 0;
            document.getElementById('longRatio').textContent = `å æ¯”: ${data.long_ratio || 0}%`;
            document.getElementById('shortRatio').textContent = `å æ¯”: ${data.short_ratio || 0}%`;
            document.getElementById('updateTime').textContent = `æ›´æ–°: ${data.latest_time || '-'}`;
        }
        
        // æ›´æ–°å†å²è®°å½•è¡¨æ ¼
        function updateHistory(data) {
            const tbody = document.getElementById('historyBody');
            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6">æš‚æ— æ•°æ®</td></tr>';
                return;
            }
            
            tbody.innerHTML = data.map(record => `
                <tr>
                    <td>${record.record_time}</td>
                    <td class="long-text">${record.long_signals}</td>
                    <td class="short-text">${record.short_signals}</td>
                    <td>${record.total_signals}</td>
                    <td class="long-text">${record.long_ratio}%</td>
                    <td class="short-text">${record.short_ratio}%</td>
                </tr>
            `).join('');
        }
        
        // æ›´æ–°åˆ†é¡µä¿¡æ¯
        function updatePagination(current, total) {
            document.getElementById('pageInfo').textContent = `ç¬¬ ${current + 1} / ${total} é¡µ`;
            document.getElementById('prevPage').disabled = current === 0;
            document.getElementById('nextPage').disabled = current >= total - 1;
        }
        
        // ç¿»é¡µ
        function changePage(delta) {
            currentPage += delta;
            loadData();
        }
        
        // åˆ‡æ¢æ—¶é—´èŒƒå›´
        function changeTimeRange(range) {
            currentTimeRange = range;
            currentPage = 0;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.chart-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            loadData();
        }
        
        // åˆå§‹åŒ–
        window.onload = function() {
            initChart();
            loadData();
            
            // æ¯30ç§’åˆ·æ–°ä¸€æ¬¡æ•°æ®
            setInterval(loadData, 30000);
        };
        
        // APIæ¥å£åŠŸèƒ½å‡½æ•°
        function copyApiUrl() {
            const apiUrl = document.getElementById('apiUrl').textContent;
            navigator.clipboard.writeText(apiUrl).then(() => {
                alert('âœ… APIåœ°å€å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            }).catch(err => {
                console.error('å¤åˆ¶å¤±è´¥:', err);
                // å¤‡ç”¨æ–¹æ¡ˆï¼šåˆ›å»ºä¸´æ—¶è¾“å…¥æ¡†
                const tempInput = document.createElement('input');
                tempInput.value = apiUrl;
                document.body.appendChild(tempInput);
                tempInput.select();
                document.execCommand('copy');
                document.body.removeChild(tempInput);
                alert('âœ… APIåœ°å€å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            });
        }
        
        function testApi() {
            const resultDiv = document.getElementById('apiResult');
            const testBtn = event.target;
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            resultDiv.style.display = 'block';
            resultDiv.textContent = 'â³ æ­£åœ¨è¯·æ±‚API...';
            testBtn.disabled = true;
            testBtn.textContent = 'â³ è¯·æ±‚ä¸­...';
            
            // è·å–å½“å‰çš„API URL
            const apiUrl = document.getElementById('apiUrl').textContent;
            
            // å‘èµ·APIè¯·æ±‚
            fetch(apiUrl)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    return response.json();
                })
                .then(data => {
                    // æ ¼å¼åŒ–æ˜¾ç¤ºç»“æœ
                    resultDiv.textContent = JSON.stringify(data, null, 2);
                    resultDiv.style.borderColor = 'rgba(16, 185, 129, 0.5)';
                    
                    // æ˜¾ç¤ºç®€è¦ç»Ÿè®¡
                    const summary = data.summary || {};
                    const statsText = `
âœ… APIè¯·æ±‚æˆåŠŸï¼

ğŸ“Š æ•°æ®æ‘˜è¦:
â€¢ æ€»ä¿¡å·æ•°: ${summary.total_signals || 0}
â€¢ ä¹°ç‚¹1æ•°é‡: ${summary.buy_point_1_count || 0}
â€¢ ä¹°ç‚¹2æ•°é‡: ${summary.buy_point_2_count || 0}
â€¢ ä¹°ç‚¹3æ•°é‡: ${summary.buy_point_3_count || 0}

ğŸ“‹ å®Œæ•´JSONæ•°æ®:
${JSON.stringify(data, null, 2)}
                    `;
                    resultDiv.textContent = statsText;
                })
                .catch(error => {
                    resultDiv.textContent = `âŒ è¯·æ±‚å¤±è´¥: ${error.message}`;
                    resultDiv.style.borderColor = 'rgba(239, 68, 68, 0.5)';
                    console.error('APIè¯·æ±‚é”™è¯¯:', error);
                })
                .finally(() => {
                    testBtn.disabled = false;
                    testBtn.textContent = 'ğŸ§ª æµ‹è¯•æ¥å£';
                });
        }
        
        // å“åº”å¼å›¾è¡¨
        window.onresize = function() {
            if (chart) {
                chart.resize();
            }
        };
    </script>
</body>
</html>
