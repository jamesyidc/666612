<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¨¡æ‹Ÿäº¤æ˜“è¯¦æƒ… - åŠ å¯†è´§å¸è‡ªåŠ¨äº¤æ˜“ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .header h1 {
            color: #333;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 14px;
        }

        .nav-links {
            margin-top: 15px;
        }

        .nav-links a {
            display: inline-block;
            padding: 8px 15px;
            background: #667eea;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            margin-right: 10px;
            font-size: 14px;
            transition: background 0.3s;
        }

        .nav-links a:hover {
            background: #764ba2;
        }

        .filters {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .filter-group {
            display: inline-block;
            margin-right: 20px;
        }

        .filter-group label {
            font-weight: 600;
            margin-right: 10px;
            color: #333;
        }

        .filter-group select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .stat-card h3 {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
        }

        .stat-card .value {
            font-size: 24px;
            font-weight: 700;
            color: #333;
        }

        .stat-card .value.positive {
            color: #10b981;
        }

        .stat-card .value.negative {
            color: #ef4444;
        }

        .trades-section {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .trades-section h2 {
            margin-bottom: 20px;
            color: #333;
        }

        .trade-card {
            border: 1px solid #e5e7eb;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            transition: box-shadow 0.3s;
        }

        .trade-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .trade-card.anchor {
            border-left: 4px solid #f59e0b;
            background: #fffbeb;
        }

        .trade-card.normal {
            border-left: 4px solid #3b82f6;
            background: #eff6ff;
        }

        .trade-card.stop-loss {
            border-left: 4px solid #ef4444;
            background: #fef2f2;
        }

        .trade-card.take-profit {
            border-left: 4px solid #10b981;
            background: #f0fdf4;
        }

        .trade-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .trade-title {
            font-weight: 700;
            font-size: 18px;
            color: #1f2937;
        }

        .trade-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-anchor {
            background: #fbbf24;
            color: #78350f;
        }

        .badge-normal {
            background: #60a5fa;
            color: #1e3a8a;
        }

        .badge-stop-loss {
            background: #f87171;
            color: #7f1d1d;
        }

        .badge-take-profit {
            background: #34d399;
            color: #064e3b;
        }

        .trade-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            padding: 8px;
            background: white;
            border-radius: 5px;
        }

        .detail-label {
            font-weight: 600;
            color: #6b7280;
            font-size: 13px;
        }

        .detail-value {
            color: #1f2937;
            font-size: 13px;
            font-weight: 500;
        }

        .trade-reason {
            margin-top: 10px;
            padding: 10px;
            background: white;
            border-radius: 5px;
            font-size: 13px;
            color: #4b5563;
            border-left: 3px solid #9ca3af;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #9ca3af;
        }

        .empty-state svg {
            width: 80px;
            height: 80px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .refresh-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: background 0.3s;
        }

        .refresh-btn:hover {
            background: #764ba2;
        }

        .action-buy {
            color: #10b981;
            font-weight: 700;
        }

        .action-sell {
            color: #ef4444;
            font-weight: 700;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“‹ æ¨¡æ‹Ÿäº¤æ˜“è¯¦æƒ…</h1>
            <p>æŸ¥çœ‹ç³»ç»Ÿç”Ÿæˆçš„æ‰€æœ‰æ¨¡æ‹Ÿä¹°å–å•è¯¦æƒ…ï¼ŒåŒ…æ‹¬é”šç‚¹å•ã€æ™®é€šå•ã€æ­¢ç›ˆå’Œæ­¢æŸæ“ä½œ</p>
            <div class="nav-links">
                <a href="/dashboard">ğŸ“Š è¿”å›ä»ªè¡¨æ¿</a>
                <a href="/trading-manager">âš™ï¸ äº¤æ˜“ç®¡ç†</a>
                <a href="/anchor-system">âš“ é”šç‚¹ç³»ç»Ÿ</a>
                <button class="refresh-btn" onclick="loadTrades()">ğŸ”„ åˆ·æ–°</button>
            </div>
        </div>

        <div class="filters">
            <div class="filter-group">
                <label for="trade-type-filter">äº¤æ˜“ç±»å‹:</label>
                <select id="trade-type-filter" onchange="loadTrades()">
                    <option value="all">å…¨éƒ¨</option>
                    <option value="anchor">é”šç‚¹å•</option>
                    <option value="normal">æ™®é€šå•</option>
                    <option value="stop_loss">æ­¢æŸå•</option>
                    <option value="take_profit">æ­¢ç›ˆå•</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="limit-filter">æ˜¾ç¤ºæ•°é‡:</label>
                <select id="limit-filter" onchange="loadTrades()">
                    <option value="20">20æ¡</option>
                    <option value="50" selected>50æ¡</option>
                    <option value="100">100æ¡</option>
                    <option value="200">200æ¡</option>
                </select>
            </div>
        </div>

        <div class="stats-container" id="stats-container">
            <!-- Stats will be loaded here -->
        </div>

        <div class="trades-section">
            <h2>ğŸ“ äº¤æ˜“è®°å½•</h2>
            <div id="trades-container">
                <div class="loading">åŠ è½½ä¸­...</div>
            </div>
        </div>
    </div>

    <script>
        async function loadTrades() {
            const tradesContainer = document.getElementById('trades-container');
            const statsContainer = document.getElementById('stats-container');
            
            const tradeType = document.getElementById('trade-type-filter').value;
            const limit = document.getElementById('limit-filter').value;
            
            tradesContainer.innerHTML = '<div class="loading">åŠ è½½ä¸­...</div>';
            
            try {
                // Build query params
                const params = new URLSearchParams();
                if (tradeType !== 'all') {
                    params.append('trade_type', tradeType);
                }
                params.append('limit', limit);
                
                // Fetch trades
                const response = await fetch(`/api/trading/simulated-trades?${params.toString()}`);
                const data = await response.json();
                
                if (!data.success) {
                    throw new Error(data.error || 'è·å–æ•°æ®å¤±è´¥');
                }
                
                const trades = data.trades || [];
                
                // Calculate stats
                calculateStats(trades, statsContainer);
                
                // Display trades
                if (trades.length === 0) {
                    tradesContainer.innerHTML = `
                        <div class="empty-state">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            <h3>æš‚æ— äº¤æ˜“è®°å½•</h3>
                            <p>ç³»ç»Ÿå°šæœªç”Ÿæˆä»»ä½•æ¨¡æ‹Ÿäº¤æ˜“è®°å½•</p>
                        </div>
                    `;
                    return;
                }
                
                tradesContainer.innerHTML = trades.map(trade => renderTradeCard(trade)).join('');
                
            } catch (error) {
                console.error('åŠ è½½äº¤æ˜“è®°å½•å¤±è´¥:', error);
                tradesContainer.innerHTML = `
                    <div class="empty-state">
                        <h3>âŒ åŠ è½½å¤±è´¥</h3>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }
        
        function calculateStats(trades, container) {
            const stats = {
                total: trades.length,
                anchor: trades.filter(t => t.trade_type === 'anchor').length,
                normal: trades.filter(t => t.trade_type === 'normal').length,
                stopLoss: trades.filter(t => t.trade_type === 'stop_loss').length,
                takeProfit: trades.filter(t => t.trade_type === 'take_profit').length,
                totalAmount: trades.reduce((sum, t) => sum + (t.amount || 0), 0),
                buyCount: trades.filter(t => t.action === 'open_long' || t.order_side === 'buy').length,
                sellCount: trades.filter(t => t.action === 'open_short' || t.order_side === 'sell').length
            };
            
            container.innerHTML = `
                <div class="stat-card">
                    <h3>ğŸ“Š æ€»äº¤æ˜“æ•°</h3>
                    <div class="value">${stats.total}</div>
                </div>
                <div class="stat-card">
                    <h3>âš“ é”šç‚¹å•</h3>
                    <div class="value" style="color: #f59e0b;">${stats.anchor}</div>
                </div>
                <div class="stat-card">
                    <h3>ğŸ“ˆ æ™®é€šå•</h3>
                    <div class="value" style="color: #3b82f6;">${stats.normal}</div>
                </div>
                <div class="stat-card">
                    <h3>ğŸ¯ æ­¢ç›ˆå•</h3>
                    <div class="value positive">${stats.takeProfit}</div>
                </div>
                <div class="stat-card">
                    <h3>ğŸ›‘ æ­¢æŸå•</h3>
                    <div class="value negative">${stats.stopLoss}</div>
                </div>
                <div class="stat-card">
                    <h3>ğŸ’° æ€»äº¤æ˜“é‡‘é¢</h3>
                    <div class="value">${stats.totalAmount.toFixed(2)} USDT</div>
                </div>
            `;
        }
        
        function renderTradeCard(trade) {
            const typeClass = trade.trade_type || 'normal';
            const badgeClass = `badge-${typeClass.replace('_', '-')}`;
            const typeText = {
                'anchor': 'é”šç‚¹å•',
                'normal': 'æ™®é€šå•',
                'stop_loss': 'æ­¢æŸå•',
                'take_profit': 'æ­¢ç›ˆå•'
            }[trade.trade_type] || 'æœªçŸ¥';
            
            const actionText = {
                'open_long': 'å¼€å¤š',
                'open_short': 'å¼€ç©º',
                'close_long': 'å¹³å¤š',
                'close_short': 'å¹³ç©º',
                'add_long': 'åŠ å¤šä»“',
                'add_short': 'åŠ ç©ºä»“'
            }[trade.action] || trade.action;
            
            const actionClass = (trade.action?.includes('long') || trade.order_side === 'buy') ? 'action-buy' : 'action-sell';
            const orderSideText = trade.order_side === 'buy' ? 'ä¹°å…¥' : 'å–å‡º';
            
            return `
                <div class="trade-card ${typeClass}">
                    <div class="trade-header">
                        <div class="trade-title">
                            ${trade.inst_id} 
                            <span class="${actionClass}">${actionText}</span>
                        </div>
                        <div class="trade-badge ${badgeClass}">${typeText}</div>
                    </div>
                    
                    <div class="trade-details">
                        <div class="detail-item">
                            <span class="detail-label">æ–¹å‘</span>
                            <span class="detail-value ${actionClass}">${orderSideText}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">ä»·æ ¼</span>
                            <span class="detail-value">${trade.price?.toFixed(4) || 'N/A'}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">æ•°é‡</span>
                            <span class="detail-value">${trade.size?.toFixed(2) || 'N/A'}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">é‡‘é¢</span>
                            <span class="detail-value">${trade.amount?.toFixed(2) || 'N/A'} USDT</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">ä»“ä½æ–¹å‘</span>
                            <span class="detail-value">${trade.pos_side === 'long' ? 'å¤šå¤´' : 'ç©ºå¤´'}</span>
                        </div>
                        ${trade.profit_rate ? `
                        <div class="detail-item">
                            <span class="detail-label">æ”¶ç›Šç‡</span>
                            <span class="detail-value ${trade.profit_rate > 0 ? 'action-buy' : 'action-sell'}">
                                ${(trade.profit_rate * 100).toFixed(2)}%
                            </span>
                        </div>
                        ` : ''}
                        <div class="detail-item">
                            <span class="detail-label">æ‰§è¡Œæ—¶é—´</span>
                            <span class="detail-value">${trade.executed_at || trade.created_at}</span>
                        </div>
                    </div>
                    
                    ${trade.reason ? `
                    <div class="trade-reason">
                        <strong>ğŸ“Œ åŸå› :</strong> ${trade.reason}
                        ${trade.trigger_condition ? `<br><strong>è§¦å‘æ¡ä»¶:</strong> ${trade.trigger_condition}` : ''}
                    </div>
                    ` : ''}
                </div>
            `;
        }
        
        // Load trades on page load
        window.onload = () => {
            loadTrades();
            // Auto refresh every 30 seconds
            setInterval(loadTrades, 30000);
        };
    </script>
</body>
</html>
