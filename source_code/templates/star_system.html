<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ˜Ÿæ˜Ÿç³»ç»Ÿ - åŠ å¯†è´§å¸åˆ†æ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            padding: 20px;
            color: #fff;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        
        .header p {
            color: rgba(255,255,255,0.7);
            font-size: 1.1rem;
        }
        
        .back-btn {
            display: inline-block;
            padding: 10px 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            text-decoration: none;
            color: #fff;
            margin-bottom: 20px;
            transition: all 0.3s;
        }
        
        .back-btn:hover {
            background: rgba(255,255,255,0.2);
        }
        
        /* æ±‡æ€»æ¡† */
        .summary-section {
            margin-bottom: 30px;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 40px;
        }
        
        .summary-box {
            background: linear-gradient(135deg, rgba(42, 45, 71, 0.95) 0%, rgba(32, 35, 61, 0.95) 100%);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 8px 20px rgba(0,0,0,0.4);
        }
        
        .summary-box.total {
            border-color: rgba(0, 212, 255, 0.5);
        }
        
        .summary-box.solid {
            border-color: rgba(255, 215, 0, 0.6);
            background: linear-gradient(135deg, rgba(80, 70, 20, 0.5) 0%, rgba(60, 50, 10, 0.5) 100%);
        }
        
        .summary-box.hollow {
            border-color: rgba(128, 128, 128, 0.6);
            background: linear-gradient(135deg, rgba(50, 50, 50, 0.5) 0%, rgba(30, 30, 30, 0.5) 100%);
        }
        
        .summary-value {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .summary-value.solid-color {
            color: #FFD700;
        }
        
        .summary-value.hollow-color {
            color: #A9A9A9;
        }
        
        .summary-value.total-color {
            color: #00d4ff;
        }
        
        .summary-label {
            font-size: 1.1rem;
            color: rgba(255,255,255,0.8);
            font-weight: 500;
        }
        
        /* æŒ‡æ ‡æ¡† */
        .section-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            padding-left: 10px;
            border-left: 4px solid #00d4ff;
        }
        
        .indicators-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .indicator-box {
            background: rgba(42, 45, 71, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            transition: all 0.3s;
        }
        
        .indicator-box:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.4);
        }
        
        .indicator-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: #00d4ff;
        }
        
        .indicator-value {
            font-size: 1rem;
            color: rgba(255,255,255,0.7);
            margin-bottom: 10px;
        }
        
        .indicator-stars {
            font-size: 2.5rem;
            margin-top: 10px;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .indicator-stars.solid {
            color: #FFD700;
        }
        
        .indicator-stars.hollow {
            color: #A9A9A9;
        }
        
        .indicator-stars.none {
            color: rgba(255,255,255,0.3);
        }
        
        .count-display {
            margin-top: 10px;
            min-height: 50px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        
        .update-time {
            text-align: center;
            margin-top: 30px;
            color: rgba(255,255,255,0.6);
            font-size: 0.9rem;
        }
        
        .loading {
            text-align: center;
            padding: 60px 20px;
            font-size: 1.2rem;
            color: rgba(255,255,255,0.7);
        }
        
        .error {
            text-align: center;
            padding: 40px 20px;
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 10px;
            color: #ef4444;
            margin: 20px 0;
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8rem;
            }
            
            .summary-grid {
                grid-template-columns: 1fr 1fr;
            }
            
            .indicators-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="/" class="back-btn">â† è¿”å›é¦–é¡µ</a>
        
        <div class="header">
            <h1>â­ æ˜Ÿæ˜Ÿç³»ç»Ÿ</h1>
            <p>14é¡¹æ ¸å¿ƒæŒ‡æ ‡ Â· å®å¿ƒæ˜Ÿ/ç©ºå¿ƒæ˜Ÿè¯„åˆ† Â· å®æ—¶æ›´æ–°</p>
        </div>
        
        <!-- å†å²æ•°æ®æŸ¥çœ‹å™¨ -->
        <div class="history-controls" style="background: rgba(255,255,255,0.05); padding: 20px; border-radius: 15px; margin-bottom: 30px;">
            <div style="display: flex; align-items: center; gap: 20px; flex-wrap: wrap;">
                <div style="flex: 1; min-width: 200px;">
                    <label style="display: block; margin-bottom: 8px; color: rgba(255,255,255,0.8);">ğŸ“… é€‰æ‹©æ—¥æœŸ:</label>
                    <input type="date" id="history-date" style="width: 100%; padding: 10px; border-radius: 8px; border: 2px solid rgba(255,255,255,0.2); background: rgba(0,0,0,0.3); color: white; font-size: 14px;" />
                </div>
                <div style="display: flex; gap: 10px; align-items: flex-end;">
                    <button onclick="loadHistoryData()" style="padding: 10px 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; border-radius: 8px; color: white; cursor: pointer; font-weight: bold;">
                        ğŸ” æŸ¥çœ‹å†å²
                    </button>
                    <button onclick="loadLatestData()" style="padding: 10px 20px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border: none; border-radius: 8px; color: white; cursor: pointer; font-weight: bold;">
                        ğŸ”„ æœ€æ–°æ•°æ®
                    </button>
                </div>
                <div id="current-view-info" style="color: #4ade80; font-weight: bold; font-size: 14px;">
                    å½“å‰æŸ¥çœ‹: å®æ—¶æ•°æ®
                </div>
            </div>
            
            <!-- æ—¶é—´è½´ -->
            <div id="timeline-container" style="margin-top: 20px; display: none;">
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                    <span style="color: rgba(255,255,255,0.8);">â±ï¸ æ—¶é—´è½´:</span>
                    <span id="timeline-info" style="color: #fbbf24;"></span>
                </div>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <button onclick="timelineNavigate('prev')" id="btn-prev" style="padding: 8px 16px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); border-radius: 6px; color: white; cursor: pointer;">
                        â¬…ï¸ ä¸Šä¸€æ¡
                    </button>
                    <div id="timeline-slider" style="flex: 1; position: relative; height: 40px; background: rgba(255,255,255,0.1); border-radius: 8px; overflow: hidden;">
                        <!-- æ—¶é—´è½´åˆ»åº¦å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                    <button onclick="timelineNavigate('next')" id="btn-next" style="padding: 8px 16px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); border-radius: 6px; color: white; cursor: pointer;">
                        ä¸‹ä¸€æ¡ â¡ï¸
                    </button>
                </div>
            </div>
        </div>
        
        <div id="loading" class="loading">
            åŠ è½½ä¸­...
        </div>
        
        <div id="error" class="error" style="display: none;">
        </div>
        
        <div id="content" style="display: none;">
            <!-- æ±‡æ€»åŒºåŸŸ -->
            <div class="summary-section">
                <h2 class="section-title">ğŸ“Š æ˜Ÿçº§æ±‡æ€»</h2>
                <div class="summary-grid">
                    <div class="summary-box total">
                        <div class="summary-value total-color" id="total-stars">-</div>
                        <div class="summary-label">æ€»æ˜Ÿæ•°</div>
                    </div>
                    <div class="summary-box solid">
                        <div class="summary-value solid-color" id="solid-stars">-</div>
                        <div class="summary-label">å®å¿ƒæ˜Ÿ â˜…</div>
                    </div>
                    <div class="summary-box hollow">
                        <div class="summary-value hollow-color" id="hollow-stars">-</div>
                        <div class="summary-label">ç©ºå¿ƒæ˜Ÿ â˜†</div>
                    </div>
                    <div class="summary-box">
                        <div class="summary-value" style="color: #10b981;" id="solid-percentage">-</div>
                        <div class="summary-label">å®å¿ƒæ˜Ÿå æ¯”</div>
                    </div>
                    <div class="summary-box">
                        <div class="summary-value" style="color: #ef4444;" id="hollow-percentage">-</div>
                        <div class="summary-label">ç©ºå¿ƒæ˜Ÿå æ¯”</div>
                    </div>
                </div>
            </div>
            
            <!-- æ–°å¢ï¼šè¡¥å……æ•°æ®åŒºåŸŸ -->
            <div class="summary-section">
                <h2 class="section-title">ğŸ“¦ è¡¥å……æ•°æ®</h2>
                <div class="summary-grid">
                    <!-- V1 æ•°é‡ -->
                    <div class="summary-box" style="border-color: rgba(34, 197, 94, 0.5);">
                        <div class="summary-value" style="color: #22c55e;" id="v1-count">-</div>
                        <div class="summary-label">V1 å¸ç§æ•°é‡</div>
                        <div style="margin-top: 10px; font-size: 12px; color: rgba(255,255,255,0.6);" id="v1-coins">-</div>
                    </div>
                    
                    <!-- V2 æ•°é‡ -->
                    <div class="summary-box" style="border-color: rgba(239, 68, 68, 0.5);">
                        <div class="summary-value" style="color: #ef4444;" id="v2-count">-</div>
                        <div class="summary-label">V2 å¸ç§æ•°é‡</div>
                        <div style="margin-top: 10px; font-size: 12px; color: rgba(255,255,255,0.6);" id="v2-coins">-</div>
                    </div>
                    
                    <!-- 1åˆ†é’Ÿæ¶¨è·Œé€Ÿ - ä¸Šæ¶¨é¢„è­¦ -->
                    <div class="summary-box" style="border-color: rgba(16, 185, 129, 0.5);">
                        <div class="summary-label" style="margin-bottom: 10px;">â¬†ï¸ ä¸Šæ¶¨é¢„è­¦</div>
                        <div style="font-size: 14px; line-height: 1.8;">
                            <div>è¶…å¼º: <span style="color: #10b981;" id="alert-super-up">-</span></div>
                            <div>å¾ˆå¼º: <span style="color: #10b981;" id="alert-very-up">-</span></div>
                            <div>è¾ƒå¼º: <span style="color: #10b981;" id="alert-strong-up">-</span></div>
                            <div>ä¸€èˆ¬: <span style="color: #10b981;" id="alert-general-up">-</span></div>
                        </div>
                    </div>
                    
                    <!-- 1åˆ†é’Ÿæ¶¨è·Œé€Ÿ - ä¸‹è·Œé¢„è­¦ -->
                    <div class="summary-box" style="border-color: rgba(239, 68, 68, 0.5);">
                        <div class="summary-label" style="margin-bottom: 10px;">â¬‡ï¸ ä¸‹è·Œé¢„è­¦</div>
                        <div style="font-size: 14px; line-height: 1.8;">
                            <div>è¶…å¼º: <span style="color: #ef4444;" id="alert-super-down">-</span></div>
                            <div>å¾ˆå¼º: <span style="color: #ef4444;" id="alert-very-down">-</span></div>
                            <div>è¾ƒå¼º: <span style="color: #ef4444;" id="alert-strong-down">-</span></div>
                            <div>ä¸€èˆ¬: <span style="color: #ef4444;" id="alert-general-down">-</span></div>
                        </div>
                    </div>
                    
                    <!-- ä½ç½®ç³»ç»Ÿå¹³å‡ä½ç½® -->
                    <div class="summary-box" style="border-color: rgba(59, 130, 246, 0.5);">
                        <div class="summary-label" style="margin-bottom: 10px;">ğŸ“ å¹³å‡ä½ç½®</div>
                        <div style="font-size: 14px; line-height: 1.8;">
                            <div>4å°æ—¶: <span style="color: #3b82f6;" id="pos-4h">-</span></div>
                            <div>12å°æ—¶: <span style="color: #3b82f6;" id="pos-12h">-</span></div>
                            <div>24å°æ—¶: <span style="color: #3b82f6;" id="pos-24h">-</span></div>
                            <div>48å°æ—¶: <span style="color: #3b82f6;" id="pos-48h">-</span></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- æ–°å¢ï¼šç¬¦åˆæ¡ä»¶çš„è™šæ‹Ÿå¸æ±  -->
            <div class="summary-section">
                <h2 class="section-title">ğŸ“‹ ç¬¦åˆæ¡ä»¶çš„è™šæ‹Ÿå¸æ± </h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px;">
                    <!-- V1å¸ç§ -->
                    <div class="summary-box" style="border-color: rgba(255, 215, 0, 0.6); background: linear-gradient(135deg, rgba(80, 70, 20, 0.5) 0%, rgba(60, 50, 10, 0.5) 100%); text-align: left;">
                        <div class="summary-label" style="margin-bottom: 15px; color: #FFD700; font-weight: bold; font-size: 1.2rem;">
                            ğŸŸ¡ V1å¸ç§ <span id="pool-v1-count" style="color: #FFD700;">0</span>ä¸ª
                        </div>
                        <div id="pool-v1-coins" style="font-size: 0.95rem; color: rgba(255,255,255,0.85); line-height: 1.8; word-wrap: break-word;">
                            -
                        </div>
                    </div>
                    
                    <!-- V2å¸ç§ -->
                    <div class="summary-box" style="border-color: rgba(59, 130, 246, 0.6); background: linear-gradient(135deg, rgba(20, 40, 80, 0.5) 0%, rgba(10, 30, 60, 0.5) 100%); text-align: left;">
                        <div class="summary-label" style="margin-bottom: 15px; color: #3b82f6; font-weight: bold; font-size: 1.2rem;">
                            ğŸ”µ V2å¸ç§ <span id="pool-v2-count" style="color: #3b82f6;">0</span>ä¸ª
                        </div>
                        <div id="pool-v2-coins" style="font-size: 0.95rem; color: rgba(255,255,255,0.85); line-height: 1.8; word-wrap: break-word;">
                            -
                        </div>
                    </div>
                    
                    <!-- åªæœ‰æ€¥æ¶¨ -->
                    <div class="summary-box" style="border-color: rgba(34, 197, 94, 0.6); background: linear-gradient(135deg, rgba(10, 60, 30, 0.5) 0%, rgba(5, 50, 20, 0.5) 100%); text-align: left;">
                        <div class="summary-label" style="margin-bottom: 15px; color: #22c55e; font-weight: bold; font-size: 1.2rem;">
                            ğŸŸ¢ åªæœ‰æ€¥æ¶¨ <span id="pool-only-rush-up-count" style="color: #22c55e;">0</span>ä¸ª
                        </div>
                        <div id="pool-only-rush-up-coins" style="font-size: 0.95rem; color: rgba(255,255,255,0.85); line-height: 1.8; word-wrap: break-word;">
                            -
                        </div>
                    </div>
                    
                    <!-- æ€¥æ¶¨>æ€¥è·Œ -->
                    <div class="summary-box" style="border-color: rgba(16, 185, 129, 0.6); background: linear-gradient(135deg, rgba(10, 70, 40, 0.5) 0%, rgba(5, 60, 30, 0.5) 100%); text-align: left;">
                        <div class="summary-label" style="margin-bottom: 15px; color: #10b981; font-weight: bold; font-size: 1.2rem;">
                            ğŸŸ¢ æ€¥æ¶¨>æ€¥è·Œ <span id="pool-rush-up-gt-down-count" style="color: #10b981;">0</span>ä¸ª
                        </div>
                        <div id="pool-rush-up-gt-down-coins" style="font-size: 0.95rem; color: rgba(255,255,255,0.85); line-height: 1.8; word-wrap: break-word;">
                            -
                        </div>
                    </div>
                    
                    <!-- ä¼˜å…ˆçº§â‰¥4 -->
                    <div class="summary-box" style="border-color: rgba(249, 115, 22, 0.6); background: linear-gradient(135deg, rgba(80, 40, 10, 0.5) 0%, rgba(70, 30, 5, 0.5) 100%); text-align: left;">
                        <div class="summary-label" style="margin-bottom: 15px; color: #f97316; font-weight: bold; font-size: 1.2rem;">
                            ğŸŸ  ä¼˜å…ˆçº§â‰¥4 <span id="pool-priority-high-count" style="color: #f97316;">0</span>ä¸ª
                        </div>
                        <div id="pool-priority-high-coins" style="font-size: 0.95rem; color: rgba(255,255,255,0.85); line-height: 1.8; word-wrap: break-word;">
                            -
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ç»§ç»­ï¼šè¡¥å……æ•°æ®åŒºåŸŸå…¶ä»–å†…å®¹ -->
            <div class="summary-section">
                <h2 class="section-title">ğŸ“¦ è¡¥å……æ•°æ®ï¼ˆç»­ï¼‰</h2>
                <div class="summary-grid">
                    
                    <!-- BTC å¸‚åœºæƒ…ç»ª -->
                    <div class="summary-box" style="border-color: rgba(255, 193, 7, 0.6); background: linear-gradient(135deg, rgba(255, 193, 7, 0.15) 0%, rgba(245, 158, 11, 0.15) 100%);">
                        <div class="summary-label" style="margin-bottom: 10px; color: #ffc107; font-weight: bold;">ğŸŸ¡ BTC ä½ç½®</div>
                        <div style="font-size: 14px; line-height: 1.8;">
                            <div>4å°æ—¶: <span style="color: #ffc107; font-weight: bold;" id="btc-4h">-</span></div>
                            <div>12å°æ—¶: <span style="color: #ffc107; font-weight: bold;" id="btc-12h">-</span></div>
                            <div>24å°æ—¶: <span style="color: #ffc107; font-weight: bold;" id="btc-24h">-</span></div>
                            <div>48å°æ—¶: <span style="color: #ffc107; font-weight: bold;" id="btc-48h">-</span></div>
                        </div>
                    </div>
                    
                    <!-- ETH å¸‚åœºæƒ…ç»ª -->
                    <div class="summary-box" style="border-color: rgba(99, 125, 255, 0.6); background: linear-gradient(135deg, rgba(99, 125, 255, 0.15) 0%, rgba(79, 70, 229, 0.15) 100%);">
                        <div class="summary-label" style="margin-bottom: 10px; color: #637dff; font-weight: bold;">ğŸ”µ ETH ä½ç½®</div>
                        <div style="font-size: 14px; line-height: 1.8;">
                            <div>4å°æ—¶: <span style="color: #637dff; font-weight: bold;" id="eth-4h">-</span></div>
                            <div>12å°æ—¶: <span style="color: #637dff; font-weight: bold;" id="eth-12h">-</span></div>
                            <div>24å°æ—¶: <span style="color: #637dff; font-weight: bold;" id="eth-24h">-</span></div>
                            <div>48å°æ—¶: <span style="color: #637dff; font-weight: bold;" id="eth-48h">-</span></div>
                        </div>
                    </div>
                    
                    <!-- 18. åˆ›æ–°é«˜ç»Ÿè®¡ -->
                    <div class="summary-box" style="border-color: rgba(239, 68, 68, 0.5); background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(220, 38, 38, 0.1) 100%);">
                        <div class="summary-label" style="margin-bottom: 10px; color: #ef4444;">ğŸš€ åˆ›æ–°é«˜ç»Ÿè®¡</div>
                        <div style="font-size: 14px; line-height: 1.8;">
                            <div>å½“å¤©: <span style="color: #ef4444; font-weight: bold;" id="breakthrough-today-high">-</span></div>
                            <div>3å¤©: <span style="color: #ef4444; font-weight: bold;" id="breakthrough-3days-high">-</span></div>
                            <div>7å¤©: <span style="color: #ef4444; font-weight: bold;" id="breakthrough-7days-high">-</span></div>
                        </div>
                    </div>
                    
                    <!-- 19. åˆ›æ–°ä½ç»Ÿè®¡ -->
                    <div class="summary-box" style="border-color: rgba(16, 185, 129, 0.5); background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(5, 150, 105, 0.1) 100%);">
                        <div class="summary-label" style="margin-bottom: 10px; color: #10b981;">ğŸ“‰ åˆ›æ–°ä½ç»Ÿè®¡</div>
                        <div style="font-size: 14px; line-height: 1.8;">
                            <div>å½“å¤©: <span style="color: #10b981; font-weight: bold;" id="breakthrough-today-low">-</span></div>
                            <div>3å¤©: <span style="color: #10b981; font-weight: bold;" id="breakthrough-3days-low">-</span></div>
                            <div>7å¤©: <span style="color: #10b981; font-weight: bold;" id="breakthrough-7days-low">-</span></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- æŒ‡æ ‡åŒºåŸŸ -->
            <div class="indicators-section">
                <h2 class="section-title">ğŸ“ˆ è¯„åˆ†æŒ‡æ ‡</h2>
                <div class="indicators-grid">
                    <!-- 1. æ€¥æ¶¨æé†’ -->
                    <div class="indicator-box">
                        <div class="indicator-title">1. æ€¥æ¶¨æé†’</div>
                        <div class="indicator-value">å½“å‰å€¼: <span id="rush-up-value">-</span></div>
                        <div class="indicator-value">é˜ˆå€¼: â‰¥10(1â˜…) / â‰¥50(2â˜…) / â‰¥100(3â˜…)</div>
                        <div class="indicator-stars solid" id="rush-up-stars">---</div>
                    </div>
                    
                    <!-- 2. æ€¥è·Œç³»ç»Ÿ -->
                    <div class="indicator-box">
                        <div class="indicator-title">2. æ€¥è·Œç³»ç»Ÿ</div>
                        <div class="indicator-value">å½“å‰å€¼: <span id="rush-down-value">-</span></div>
                        <div class="indicator-value">é˜ˆå€¼: â‰¥10(1â˜†) / â‰¥50(2â˜†) / â‰¥100(3â˜†)</div>
                        <div class="indicator-stars hollow" id="rush-down-stars">---</div>
                    </div>
                    
                    <!-- 3. å·®å€¼æ­£å€¼ -->
                    <div class="indicator-box">
                        <div class="indicator-title">3. æ€¥æ¶¨-æ€¥è·Œå·®å€¼(æ­£)</div>
                        <div class="indicator-value">å½“å‰å€¼: <span id="diff-pos-value">-</span></div>
                        <div class="indicator-value">é˜ˆå€¼: â‰¥10(1â˜…) / â‰¥20(2â˜…) / â‰¥50(3â˜…)</div>
                        <div class="indicator-stars solid" id="diff-pos-stars">---</div>
                    </div>
                    
                    <!-- 4. å·®å€¼è´Ÿå€¼ -->
                    <div class="indicator-box">
                        <div class="indicator-title">4. æ€¥æ¶¨-æ€¥è·Œå·®å€¼(è´Ÿ)</div>
                        <div class="indicator-value">å½“å‰å€¼: <span id="diff-neg-value">-</span></div>
                        <div class="indicator-value">é˜ˆå€¼: â‰¤-10(1â˜†) / â‰¤-20(2â˜†) / â‰¤-50(3â˜†)</div>
                        <div class="indicator-stars hollow" id="diff-neg-stars">---</div>
                    </div>
                    
                    <!-- 5. å…¨ç½‘æŒä»“é‡ -->
                    <div class="indicator-box">
                        <div class="indicator-title">5. å…¨ç½‘æŒä»“é‡</div>
                        <div class="indicator-value">å½“å‰å€¼: <span id="holdings-value">-</span> äº¿</div>
                        <div class="indicator-value">é˜ˆå€¼: â‰¤91(3â˜…) / 91-95(2â˜…) / 95-100(1â˜…)</div>
                        <div class="indicator-stars solid" id="holdings-stars">---</div>
                    </div>
                    
                    <!-- 6. åšå¤šä¿¡å· -->
                    <div class="indicator-box">
                        <div class="indicator-title">6. åšå¤šä¿¡å·</div>
                        <div class="indicator-value">å½“å‰å€¼: <span id="long-signals-value">-</span></div>
                        <div class="indicator-value">é˜ˆå€¼: 20-50(1â˜…) / 50-100(2â˜…) / â‰¥100(3â˜…)</div>
                        <div class="indicator-stars solid" id="long-signals-stars">---</div>
                    </div>
                    
                    <!-- 7. åšç©ºä¿¡å· -->
                    <div class="indicator-box">
                        <div class="indicator-title">7. åšç©ºä¿¡å·</div>
                        <div class="indicator-value">å½“å‰å€¼: <span id="short-signals-value">-</span></div>
                        <div class="indicator-value">é˜ˆå€¼: 30-50(1â˜†) / 50-120(2â˜†) / â‰¥120(3â˜†)</div>
                        <div class="indicator-stars hollow" id="short-signals-stars">---</div>
                    </div>
                    
                    <!-- 8. åªæœ‰æ€¥æ¶¨æ²¡æœ‰æ€¥è·Œ -->
                    <div class="indicator-box">
                        <div class="indicator-title">8. åªæœ‰æ€¥æ¶¨æ²¡æœ‰æ€¥è·Œ</div>
                        <div class="indicator-value">ç»Ÿè®¡: å¸ç§æ•°é‡</div>
                        <div class="count-display" id="only-rush-up">-</div>
                    </div>
                    
                    <!-- 9. æ€¥æ¶¨å¤§äºæ€¥è·Œ -->
                    <div class="indicator-box">
                        <div class="indicator-title">9. æ€¥æ¶¨å¤§äºæ€¥è·Œ</div>
                        <div class="indicator-value">ç»Ÿè®¡: å¸ç§æ•°é‡</div>
                        <div class="count-display" id="rush-up-gt-down">-</div>
                    </div>
                    
                    <!-- 10. ä¼˜å…ˆçº§â‰¥4 -->
                    <div class="indicator-box">
                        <div class="indicator-title">10. ä¼˜å…ˆçº§â‰¥4 (ç­‰çº§1-4)</div>
                        <div class="indicator-value">ç»Ÿè®¡: å¸ç§æ•°é‡</div>
                        <div class="count-display" id="priority-high">-</div>
                    </div>
                    
                    <!-- 11. åªæœ‰æ€¥è·Œ -->
                    <div class="indicator-box">
                        <div class="indicator-title">11. åªæœ‰æ€¥è·Œ</div>
                        <div class="indicator-value">ç»Ÿè®¡: å¸ç§æ•°é‡</div>
                        <div class="count-display" id="only-rush-down">-</div>
                    </div>
                    
                    <!-- 12. æ€¥è·Œå¤§äºæ€¥æ¶¨ -->
                    <div class="indicator-box">
                        <div class="indicator-title">12. æ€¥è·Œå¤§äºæ€¥æ¶¨</div>
                        <div class="indicator-value">ç»Ÿè®¡: å¸ç§æ•°é‡</div>
                        <div class="count-display" id="rush-down-gt-up">-</div>
                    </div>
                    
                    <!-- 13. ä»Šå¤©åˆ›æ–°ä½è®°å½• -->
                    <div class="indicator-box">
                        <div class="indicator-title">13. ä»Šå¤©åˆ›æ–°ä½è®°å½•</div>
                        <div class="indicator-value">å½“å‰å€¼: <span id="new-low-value">-</span> æ¬¡</div>
                        <div class="indicator-value">é˜ˆå€¼: 1-3(1â˜†) / 3-10(2â˜†) / >10(3â˜†)</div>
                        <div class="indicator-stars hollow" id="new-low-stars">---</div>
                    </div>
                    
                    <!-- 14. ä»Šå¤©åˆ›æ–°é«˜è®°å½• -->
                    <div class="indicator-box">
                        <div class="indicator-title">14. ä»Šå¤©åˆ›æ–°é«˜è®°å½•</div>
                        <div class="indicator-value">å½“å‰å€¼: <span id="new-high-value">-</span> æ¬¡</div>
                        <div class="indicator-value">é˜ˆå€¼: 1-3(1â˜…) / 3-10(2â˜…) / >10(3â˜…)</div>
                        <div class="indicator-stars solid" id="new-high-stars">---</div>
                    </div>
                    
                    <!-- 15. è®¡æ¬¡å¾—åˆ† -->
                    <div class="indicator-box">
                        <div class="indicator-title">15. è®¡æ¬¡å¾—åˆ†</div>
                        <div class="indicator-value">å½“å‰å€¼: <span id="count-value">-</span></div>
                        <div class="indicator-value">åŠ¨æ€é˜ˆå€¼ (æ ¹æ®æ—¶é—´æ®µ)</div>
                        <div class="indicator-stars" id="count-stars">---</div>
                    </div>
                </div>
            </div>
            
            <div class="update-time" id="update-time">
                æœ€åæ›´æ–°: -
            </div>
        </div>
    </div>
    
    <script>
        // åŠ è½½æ˜Ÿæ˜Ÿç³»ç»Ÿæ•°æ®
        function loadStarSystemData() {
            fetch('/api/star-system/data')
                .then(res => res.json())
                .then(response => {
                    if (response.success) {
                        document.getElementById('loading').style.display = 'none';
                        document.getElementById('error').style.display = 'none';
                        document.getElementById('content').style.display = 'block';
                        
                        const data = response.data;
                        const rawData = response.raw_data;
                        const summary = data.summary;
                        
                        // æ›´æ–°æ±‡æ€»æ•°æ®
                        document.getElementById('total-stars').textContent = summary.total_stars;
                        document.getElementById('solid-stars').textContent = summary.solid_stars;
                        document.getElementById('hollow-stars').textContent = summary.hollow_stars;
                        
                        const solidPercentage = summary.total_stars > 0 
                            ? Math.round(summary.solid_stars / summary.total_stars * 100) 
                            : 0;
                        const hollowPercentage = summary.total_stars > 0 
                            ? Math.round(summary.hollow_stars / summary.total_stars * 100) 
                            : 0;
                        
                        document.getElementById('solid-percentage').textContent = solidPercentage + '%';
                        document.getElementById('hollow-percentage').textContent = hollowPercentage + '%';
                        
                        // æ›´æ–°å„é¡¹æŒ‡æ ‡
                        // 1. æ€¥æ¶¨æé†’
                        document.getElementById('rush-up-value').textContent = rawData.rush_up;
                        document.getElementById('rush-up-stars').textContent = data.rush_up.display;
                        
                        // 2. æ€¥è·Œç³»ç»Ÿ
                        document.getElementById('rush-down-value').textContent = rawData.rush_down;
                        document.getElementById('rush-down-stars').textContent = data.rush_down.display;
                        
                        // 3. å·®å€¼æ­£å€¼
                        const diffValue = rawData.diff;
                        document.getElementById('diff-pos-value').textContent = diffValue >= 0 ? diffValue : 'ä¸é€‚ç”¨';
                        document.getElementById('diff-pos-stars').textContent = data.diff_positive.display;
                        
                        // 4. å·®å€¼è´Ÿå€¼
                        document.getElementById('diff-neg-value').textContent = diffValue < 0 ? diffValue : 'ä¸é€‚ç”¨';
                        document.getElementById('diff-neg-stars').textContent = data.diff_negative.display;
                        
                        // 5. å…¨ç½‘æŒä»“é‡ï¼ˆå•ä½è½¬æ¢ï¼šå…ƒ â†’ äº¿ï¼‰
                        const holdingsInYi = (rawData.holdings / 100000000).toFixed(2);
                        document.getElementById('holdings-value').textContent = holdingsInYi;
                        document.getElementById('holdings-stars').textContent = data.holdings.display;
                        
                        // 6. åšå¤šä¿¡å·
                        document.getElementById('long-signals-value').textContent = rawData.long_signals;
                        document.getElementById('long-signals-stars').textContent = data.long_signals.display;
                        
                        // 7. åšç©ºä¿¡å·
                        document.getElementById('short-signals-value').textContent = rawData.short_signals;
                        document.getElementById('short-signals-stars').textContent = data.short_signals.display;
                        
                        // 8-11. ç»Ÿè®¡æ•°æ® - æ˜¾ç¤ºå…·ä½“å¸ç§
                        const coinLists = response.coin_lists || {};
                        
                        // 8. åªæœ‰æ€¥æ¶¨æ²¡æœ‰æ€¥è·Œ
                        const onlyRushUpCoins = coinLists.only_rush_up_coins || [];
                        document.getElementById('only-rush-up').innerHTML = 
                            onlyRushUpCoins.length > 0 
                            ? `<div style="font-size: 2rem; font-weight: bold; color: #00d4ff; margin-bottom: 10px;">${onlyRushUpCoins.length}ä¸ªå¸ç§</div>
                               <div style="font-size: 0.9rem; color: rgba(255,255,255,0.8);">${onlyRushUpCoins.join(', ')}</div>`
                            : '<div style="font-size: 1.5rem; color: rgba(255,255,255,0.5);">æ— </div>';
                        
                        // 9. æ€¥æ¶¨å¤§äºæ€¥è·Œ
                        const rushUpGtDownCoins = coinLists.rush_up_gt_down_coins || [];
                        document.getElementById('rush-up-gt-down').innerHTML = 
                            rushUpGtDownCoins.length > 0 
                            ? `<div style="font-size: 2rem; font-weight: bold; color: #00d4ff; margin-bottom: 10px;">${rushUpGtDownCoins.length}ä¸ªå¸ç§</div>
                               <div style="font-size: 0.9rem; color: rgba(255,255,255,0.8);">${rushUpGtDownCoins.join(', ')}</div>`
                            : '<div style="font-size: 1.5rem; color: rgba(255,255,255,0.5);">æ— </div>';
                        
                        // 10. ä¼˜å…ˆçº§â‰¥4
                        const priorityHighCoins = coinLists.priority_high_coins || [];
                        document.getElementById('priority-high').innerHTML = 
                            priorityHighCoins.length > 0 
                            ? `<div style="font-size: 2rem; font-weight: bold; color: #00d4ff; margin-bottom: 10px;">${priorityHighCoins.length}ä¸ªå¸ç§</div>
                               <div style="font-size: 0.9rem; color: rgba(255,255,255,0.8);">${priorityHighCoins.join(', ')}</div>`
                            : '<div style="font-size: 1.5rem; color: rgba(255,255,255,0.5);">æ— </div>';
                        
                        // 11. åªæœ‰æ€¥è·Œ
                        const onlyRushDownCoins = coinLists.only_rush_down_coins || [];
                        document.getElementById('only-rush-down').innerHTML = 
                            onlyRushDownCoins.length > 0 
                            ? `<div style="font-size: 2rem; font-weight: bold; color: #00d4ff; margin-bottom: 10px;">${onlyRushDownCoins.length}ä¸ªå¸ç§</div>
                               <div style="font-size: 0.9rem; color: rgba(255,255,255,0.8);">${onlyRushDownCoins.join(', ')}</div>`
                            : '<div style="font-size: 1.5rem; color: rgba(255,255,255,0.5);">æ— </div>';
                        
                        // 12. æ€¥è·Œå¤§äºæ€¥æ¶¨
                        const rushDownGtUpCoins = coinLists.rush_down_gt_up_coins || [];
                        document.getElementById('rush-down-gt-up').innerHTML = 
                            rushDownGtUpCoins.length > 0 
                            ? `<div style="font-size: 2rem; font-weight: bold; color: #00d4ff; margin-bottom: 10px;">${rushDownGtUpCoins.length}ä¸ªå¸ç§</div>
                               <div style="font-size: 0.9rem; color: rgba(255,255,255,0.8);">${rushDownGtUpCoins.join(', ')}</div>`
                            : '<div style="font-size: 1.5rem; color: rgba(255,255,255,0.5);">æ— </div>';
                        
                        // 13. ä»Šå¤©åˆ›æ–°ä½
                        document.getElementById('new-low-value').textContent = rawData.new_low_today;
                        document.getElementById('new-low-stars').textContent = data.new_low_today.display;
                        
                        // 14. ä»Šå¤©åˆ›æ–°é«˜
                        document.getElementById('new-high-value').textContent = rawData.new_high_today;
                        document.getElementById('new-high-stars').textContent = data.new_high_today.display;
                        
                        // 15. è®¡æ¬¡å¾—åˆ†
                        document.getElementById('count-value').textContent = rawData.count;
                        const countStarsEl = document.getElementById('count-stars');
                        countStarsEl.textContent = data.count_score.display;
                        countStarsEl.className = 'indicator-stars ' + (data.count_score.type === 'å®å¿ƒ' ? 'solid' : data.count_score.type === 'ç©ºå¿ƒ' ? 'hollow' : 'none');
                        
                        // ========== æ–°å¢æ•°æ®æ›´æ–° ==========
                        // V1/V2 å¸ç§
                        const v1v2Data = response.v1v2_data || {};
                        document.getElementById('v1-count').textContent = v1v2Data.v1_count || 0;
                        document.getElementById('v2-count').textContent = v1v2Data.v2_count || 0;
                        document.getElementById('v1-coins').textContent = (v1v2Data.v1_coins || []).join(', ') || 'æ— ';
                        document.getElementById('v2-coins').textContent = (v1v2Data.v2_coins || []).join(', ') || 'æ— ';
                        
                        // ========== ç¬¦åˆæ¡ä»¶çš„è™šæ‹Ÿå¸æ±  ==========
                        // ä» coin_lists è·å–æ•°æ®ï¼ˆå·²åœ¨ä¸Šæ–¹å£°æ˜ï¼‰
                        
                        // V1å¸ç§
                        const v1Coins = v1v2Data.v1_coins || [];
                        document.getElementById('pool-v1-count').textContent = v1Coins.length;
                        document.getElementById('pool-v1-coins').textContent = v1Coins.join(', ') || '-';
                        
                        // V2å¸ç§
                        const v2Coins = v1v2Data.v2_coins || [];
                        document.getElementById('pool-v2-count').textContent = v2Coins.length;
                        document.getElementById('pool-v2-coins').textContent = v2Coins.join(', ') || '-';
                        
                        // åªæœ‰æ€¥æ¶¨
                        const onlyRushUp = coinLists.only_rush_up_coins || [];
                        document.getElementById('pool-only-rush-up-count').textContent = onlyRushUp.length;
                        if (onlyRushUp.length > 3) {
                            document.getElementById('pool-only-rush-up-coins').textContent = 
                                onlyRushUp.slice(0, 3).join(', ') + '... (å…±' + onlyRushUp.length + 'ä¸ª)';
                        } else {
                            document.getElementById('pool-only-rush-up-coins').textContent = onlyRushUp.join(', ') || '-';
                        }
                        
                        // æ€¥æ¶¨>æ€¥è·Œ
                        const rushUpGtDown = coinLists.rush_up_gt_down_coins || [];
                        document.getElementById('pool-rush-up-gt-down-count').textContent = rushUpGtDown.length;
                        if (rushUpGtDown.length > 3) {
                            document.getElementById('pool-rush-up-gt-down-coins').textContent = 
                                rushUpGtDown.slice(0, 3).join(', ') + '... (å…±' + rushUpGtDown.length + 'ä¸ª)';
                        } else {
                            document.getElementById('pool-rush-up-gt-down-coins').textContent = rushUpGtDown.join(', ') || '-';
                        }
                        
                        // ä¼˜å…ˆçº§â‰¥4
                        const priorityHigh = coinLists.priority_high_coins || [];
                        document.getElementById('pool-priority-high-count').textContent = priorityHigh.length;
                        document.getElementById('pool-priority-high-coins').textContent = priorityHigh.join(', ') || '-';
                        
                        // 1åˆ†é’Ÿæ¶¨è·Œé€Ÿé¢„è­¦
                        const alerts = response.price_speed_alerts || {};
                        const alertsUp = alerts.up || {};
                        const alertsDown = alerts.down || {};
                        
                        document.getElementById('alert-super-up').textContent = 
                            (alertsUp.super_strong?.count || 0) + 'ä¸ª' + 
                            ((alertsUp.super_strong?.coins || []).length > 0 ? ` (${(alertsUp.super_strong?.coins || []).join(', ')})` : '');
                        document.getElementById('alert-very-up').textContent = 
                            (alertsUp.very_strong?.count || 0) + 'ä¸ª' +
                            ((alertsUp.very_strong?.coins || []).length > 0 ? ` (${(alertsUp.very_strong?.coins || []).join(', ')})` : '');
                        document.getElementById('alert-strong-up').textContent = 
                            (alertsUp.strong?.count || 0) + 'ä¸ª' +
                            ((alertsUp.strong?.coins || []).length > 0 ? ` (${(alertsUp.strong?.coins || []).join(', ')})` : '');
                        document.getElementById('alert-general-up').textContent = 
                            (alertsUp.general?.count || 0) + 'ä¸ª' +
                            ((alertsUp.general?.coins || []).length > 0 ? ` (${(alertsUp.general?.coins || []).join(', ')})` : '');
                        
                        document.getElementById('alert-super-down').textContent = 
                            (alertsDown.super_strong?.count || 0) + 'ä¸ª' +
                            ((alertsDown.super_strong?.coins || []).length > 0 ? ` (${(alertsDown.super_strong?.coins || []).join(', ')})` : '');
                        document.getElementById('alert-very-down').textContent = 
                            (alertsDown.very_strong?.count || 0) + 'ä¸ª' +
                            ((alertsDown.very_strong?.coins || []).length > 0 ? ` (${(alertsDown.very_strong?.coins || []).join(', ')})` : '');
                        document.getElementById('alert-strong-down').textContent = 
                            (alertsDown.strong?.count || 0) + 'ä¸ª' +
                            ((alertsDown.strong?.coins || []).length > 0 ? ` (${(alertsDown.strong?.coins || []).join(', ')})` : '');
                        document.getElementById('alert-general-down').textContent = 
                            (alertsDown.general?.count || 0) + 'ä¸ª' +
                            ((alertsDown.general?.coins || []).length > 0 ? ` (${(alertsDown.general?.coins || []).join(', ')})` : '');
                        
                        // ä½ç½®ç³»ç»Ÿå¹³å‡ä½ç½®
                        const posAvg = response.position_avg || {};
                        document.getElementById('pos-4h').textContent = (posAvg['4h'] || 0).toFixed(2);
                        document.getElementById('pos-12h').textContent = (posAvg['12h'] || 0).toFixed(2);
                        document.getElementById('pos-24h').textContent = (posAvg['24h'] || 0).toFixed(2);
                        document.getElementById('pos-48h').textContent = (posAvg['48h'] || 0).toFixed(2);
                        
                        // åˆ›æ–°é«˜/åˆ›æ–°ä½ç»Ÿè®¡
                        const breakthrough = response.breakthrough_stats || {};
                        const breakthroughToday = breakthrough.today || {};
                        const breakthrough3Days = breakthrough.three_days || {};
                        const breakthrough7Days = breakthrough.seven_days || {};
                        
                        document.getElementById('breakthrough-today-high').textContent = breakthroughToday.new_high || 0;
                        document.getElementById('breakthrough-today-low').textContent = breakthroughToday.new_low || 0;
                        document.getElementById('breakthrough-3days-high').textContent = breakthrough3Days.new_high || 0;
                        document.getElementById('breakthrough-3days-low').textContent = breakthrough3Days.new_low || 0;
                        document.getElementById('breakthrough-7days-high').textContent = breakthrough7Days.new_high || 0;
                        document.getElementById('breakthrough-7days-low').textContent = breakthrough7Days.new_low || 0;
                        
                        // BTC & ETH å¸‚åœºæƒ…ç»ªå‚è€ƒ
                        updateBtcEthPositions();
                        
                        // æ›´æ–°æ—¶é—´
                        document.getElementById('update-time').textContent = 'æœ€åæ›´æ–°: ' + response.update_time;
                    } else {
                        document.getElementById('loading').style.display = 'none';
                        document.getElementById('error').style.display = 'block';
                        document.getElementById('error').textContent = 'åŠ è½½å¤±è´¥: ' + (response.error || 'æœªçŸ¥é”™è¯¯');
                    }
                })
                .catch(err => {
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('error').style.display = 'block';
                    document.getElementById('error').textContent = 'ç½‘ç»œé”™è¯¯: ' + err.message;
                    console.error('åŠ è½½æ˜Ÿæ˜Ÿç³»ç»Ÿæ•°æ®å¤±è´¥:', err);
                });
        }
        
        // æ›´æ–°BTCå’ŒETHä½ç½®æ•°æ®
        function updateBtcEthPositions() {
            fetch('/api/position/latest')
                .then(res => res.json())
                .then(data => {
                    if (data.success && data.data) {
                        // æŸ¥æ‰¾BTCå’ŒETHæ•°æ® (ä½¿ç”¨includesåŒ¹é…)
                        const btcData = data.data.find(coin => coin.symbol.includes('BTC'));
                        const ethData = data.data.find(coin => coin.symbol.includes('ETH'));
                        
                        // æ›´æ–°BTCä½ç½®
                        if (btcData) {
                            document.getElementById('btc-4h').textContent = btcData.position_4h !== null ? btcData.position_4h.toFixed(1) + '%' : '--';
                            document.getElementById('btc-12h').textContent = btcData.position_12h !== null ? btcData.position_12h.toFixed(1) + '%' : '--';
                            document.getElementById('btc-24h').textContent = btcData.position_24h !== null ? btcData.position_24h.toFixed(1) + '%' : '--';
                            document.getElementById('btc-48h').textContent = btcData.position_48h !== null ? btcData.position_48h.toFixed(1) + '%' : '--';
                        }
                        
                        // æ›´æ–°ETHä½ç½®
                        if (ethData) {
                            document.getElementById('eth-4h').textContent = ethData.position_4h !== null ? ethData.position_4h.toFixed(1) + '%' : '--';
                            document.getElementById('eth-12h').textContent = ethData.position_12h !== null ? ethData.position_12h.toFixed(1) + '%' : '--';
                            document.getElementById('eth-24h').textContent = ethData.position_24h !== null ? ethData.position_24h.toFixed(1) + '%' : '--';
                            document.getElementById('eth-48h').textContent = ethData.position_48h !== null ? ethData.position_48h.toFixed(1) + '%' : '--';
                        }
                    }
                })
                .catch(err => {
                    console.error('è·å–BTC/ETHä½ç½®æ•°æ®å¤±è´¥:', err);
                });
        }
        
        // å†å²æ•°æ®ç›¸å…³å˜é‡
        let historyData = [];
        let currentHistoryIndex = 0;
        let autoRefreshInterval = null;
        
        // åŠ è½½å†å²æ•°æ®
        function loadHistoryData() {
            const dateInput = document.getElementById('history-date');
            const selectedDate = dateInput.value;
            
            if (!selectedDate) {
                alert('è¯·é€‰æ‹©æ—¥æœŸ');
                return;
            }
            
            // åœæ­¢è‡ªåŠ¨åˆ·æ–°
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
                autoRefreshInterval = null;
            }
            
            document.getElementById('loading').style.display = 'block';
            document.getElementById('content').style.display = 'none';
            
            fetch(`/api/star-system/history?date=${selectedDate}&limit=500`)
                .then(res => res.json())
                .then(response => {
                    if (response.success && response.data.length > 0) {
                        historyData = response.data;
                        currentHistoryIndex = 0;
                        
                        // æ˜¾ç¤ºæ—¶é—´è½´
                        document.getElementById('timeline-container').style.display = 'block';
                        document.getElementById('current-view-info').textContent = `å½“å‰æŸ¥çœ‹: ${selectedDate} (å…±${historyData.length}æ¡è®°å½•)`;
                        
                        // æ¸²æŸ“æ—¶é—´è½´
                        renderTimeline();
                        
                        // æ˜¾ç¤ºç¬¬ä¸€æ¡æ•°æ®
                        displayHistoryRecord(0);
                    } else {
                        document.getElementById('loading').style.display = 'none';
                        alert('è¯¥æ—¥æœŸæ²¡æœ‰å†å²æ•°æ®');
                    }
                })
                .catch(err => {
                    document.getElementById('loading').style.display = 'none';
                    alert('åŠ è½½å†å²æ•°æ®å¤±è´¥: ' + err.message);
                });
        }
        
        // åŠ è½½æœ€æ–°æ•°æ®
        function loadLatestData() {
            historyData = [];
            currentHistoryIndex = 0;
            document.getElementById('timeline-container').style.display = 'none';
            document.getElementById('current-view-info').textContent = 'å½“å‰æŸ¥çœ‹: å®æ—¶æ•°æ®';
            
            // é‡å¯è‡ªåŠ¨åˆ·æ–°
            if (!autoRefreshInterval) {
                autoRefreshInterval = setInterval(loadStarSystemData, 30000);
            }
            
            loadStarSystemData();
        }
        
        // æ¸²æŸ“æ—¶é—´è½´
        function renderTimeline() {
            const container = document.getElementById('timeline-slider');
            container.innerHTML = '';
            
            const totalRecords = historyData.length;
            historyData.forEach((record, index) => {
                const marker = document.createElement('div');
                marker.style.cssText = `
                    position: absolute;
                    left: ${(index / (totalRecords - 1)) * 100}%;
                    top: 50%;
                    transform: translate(-50%, -50%);
                    width: 8px;
                    height: 8px;
                    background: ${index === currentHistoryIndex ? '#fbbf24' : 'rgba(255,255,255,0.3)'};
                    border-radius: 50%;
                    cursor: pointer;
                    transition: all 0.3s;
                `;
                marker.onmouseover = () => {
                    marker.style.background = '#fbbf24';
                    marker.style.transform = 'translate(-50%, -50%) scale(1.5)';
                };
                marker.onmouseout = () => {
                    if (index !== currentHistoryIndex) {
                        marker.style.background = 'rgba(255,255,255,0.3)';
                    }
                    marker.style.transform = 'translate(-50%, -50%)';
                };
                marker.onclick = () => displayHistoryRecord(index);
                container.appendChild(marker);
            });
            
            updateTimelineInfo();
        }
        
        // æ›´æ–°æ—¶é—´è½´ä¿¡æ¯
        function updateTimelineInfo() {
            if (historyData.length === 0) return;
            
            const record = historyData[currentHistoryIndex];
            document.getElementById('timeline-info').textContent = 
                `${currentHistoryIndex + 1}/${historyData.length} - ${record.timestamp}`;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.getElementById('btn-prev').disabled = currentHistoryIndex >= historyData.length - 1;
            document.getElementById('btn-next').disabled = currentHistoryIndex <= 0;
            
            // æ›´æ–°æ—¶é—´è½´æ ‡è®°
            const markers = document.getElementById('timeline-slider').children;
            for (let i = 0; i < markers.length; i++) {
                markers[i].style.background = i === currentHistoryIndex ? '#fbbf24' : 'rgba(255,255,255,0.3)';
            }
        }
        
        // æ—¶é—´è½´å¯¼èˆª
        function timelineNavigate(direction) {
            if (direction === 'prev' && currentHistoryIndex < historyData.length - 1) {
                currentHistoryIndex++;
            } else if (direction === 'next' && currentHistoryIndex > 0) {
                currentHistoryIndex--;
            }
            displayHistoryRecord(currentHistoryIndex);
        }
        
        // æ˜¾ç¤ºå†å²è®°å½•
        function displayHistoryRecord(index) {
            if (index < 0 || index >= historyData.length) return;
            
            currentHistoryIndex = index;
            const record = historyData[index];
            const details = record.details || {};
            
            document.getElementById('loading').style.display = 'none';
            document.getElementById('content').style.display = 'block';
            
            // æ›´æ–°æ±‡æ€»æ•°æ®
            document.getElementById('total-stars').textContent = record.total_stars || 0;
            document.getElementById('solid-stars').textContent = record.solid_stars || 0;
            document.getElementById('hollow-stars').textContent = record.hollow_stars || 0;
            document.getElementById('solid-percentage').textContent = (record.solid_percentage || 0).toFixed(1) + '%';
            document.getElementById('hollow-percentage').textContent = (record.hollow_percentage || 0).toFixed(1) + '%';
            
            // æ›´æ–°å„é¡¹æŒ‡æ ‡ï¼ˆä½¿ç”¨detailsä¸­çš„æ•°æ®ï¼‰
            if (details.stars) {
                for (let key in details.stars) {
                    const el = document.getElementById(key + '-stars');
                    if (el) el.textContent = details.stars[key] || '---';
                }
            }
            if (details.values) {
                for (let key in details.values) {
                    const el = document.getElementById(key + '-value');
                    if (el) el.textContent = details.values[key] !== undefined ? details.values[key] : '-';
                }
            }
            
            document.getElementById('update-time').textContent = 'å†å²è®°å½•: ' + record.timestamp;
            
            updateTimelineInfo();
        }
        
        // è®¾ç½®æ—¥æœŸé€‰æ‹©å™¨é»˜è®¤å€¼ä¸ºä»Šå¤©
        document.getElementById('history-date').valueAsDate = new Date();
        
        // é¦–æ¬¡åŠ è½½
        loadStarSystemData();
        
        // æ¯30ç§’è‡ªåŠ¨åˆ·æ–°ï¼ˆä»…åœ¨å®æ—¶æ¨¡å¼ä¸‹ï¼‰
        autoRefreshInterval = setInterval(() => {
            if (historyData.length === 0) {
                loadStarSystemData();
            }
        }, 30000);
    </script>
</body>
</html>
