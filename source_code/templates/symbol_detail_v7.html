<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>{{ symbol }} Kçº¿å›¾ - v7.0 [{{ cache_buster }}]</title>
    <!-- ğŸ”¥ v7.0 - å…¨æ–°ç‰ˆæœ¬ï¼Œæ— ç¼“å­˜é—®é¢˜ - {{ cache_buster }} -->
    
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', sans-serif;
            background: #0e1117;
            color: #e0e0e0;
        }
        
        .header {
            background: #1a1d29;
            padding: 20px;
            border-bottom: 2px solid #2d3348;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
            color: #00d4aa;
        }
        
        .header .nav {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }
        
        .header .nav a {
            color: #888;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 4px;
            transition: all 0.3s;
        }
        
        .header .nav a:hover {
            background: #2d3348;
            color: #00d4aa;
        }
        
        .container {
            max-width: 100%;
            margin: 0;
            padding: 10px;
            height: calc(100vh - 120px);
            display: flex;
            flex-direction: column;
        }
        
        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            gap: 20px;
            flex-shrink: 0;
        }
        
        .timeframe-tabs {
            display: flex;
            gap: 10px;
        }
        
        .tab-btn {
            padding: 12px 24px;
            background: #1a1d29;
            border: 2px solid #2d3348;
            color: #888;
            cursor: pointer;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .tab-btn.active {
            background: #00d4aa;
            color: #0e1117;
            border-color: #00d4aa;
        }
        
        .tab-btn:hover:not(.active) {
            border-color: #00d4aa;
            color: #00d4aa;
        }
        
        .pagination {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .page-btn {
            padding: 10px 20px;
            background: #1a1d29;
            border: 2px solid #2d3348;
            color: #00d4aa;
            cursor: pointer;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .page-btn:hover:not(:disabled) {
            background: #00d4aa;
            color: #0e1117;
        }
        
        .page-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        .page-info {
            color: #888;
            font-size: 14px;
        }
        
        .chart-container {
            background: #1a1d29;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .chart-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #00d4aa;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .date-range {
            font-size: 14px;
            color: #888;
            font-weight: normal;
        }
        
        .chart {
            width: 100%;
            height: 600px;
            min-height: 600px;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #888;
        }
        
        .spinner {
            border: 3px solid #2d3348;
            border-top: 3px solid #00d4aa;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: #1a1d29;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #00d4aa;
        }
        
        .stat-label {
            color: #888;
            font-size: 13px;
            margin-bottom: 5px;
        }
        
        .stat-value {
            font-size: 20px;
            font-weight: 600;
            color: #e0e0e0;
        }
        
        /* éšè—ç»Ÿè®¡å’Œè¾…åŠ©å›¾è¡¨ï¼Œåªæ˜¾ç¤ºä¸»Kçº¿å›¾ */
        .stats-grid,
        #rsi-container,
        #indicators-container {
            display: none !important;
        }
    </style>
</head>
<body>
    <!-- ğŸ”¥ ç‰ˆæœ¬æ ‡è¯†æ¨ªå¹… -->
    <div style="background: linear-gradient(135deg, #ff4444, #ff6b6b); color: white; padding: 15px; text-align: center; font-size: 18px; font-weight: bold; box-shadow: 0 2px 10px rgba(255,68,68,0.3);">
        ğŸ”¥ v6.0 å…¨æ–°ç‰ˆæœ¬ | æ—¶é—´æˆ³: {{ cache_buster }} | è¯·ç¡®è®¤æ­¤æ¨ªå¹…å¯è§ ğŸ”¥
    </div>
    
    <div class="header">
        <h1>{{ symbol }} - Kçº¿å›¾æŠ€æœ¯åˆ†æ v3.9.9 <span style="color:#ff1744;font-size:14px;">[ä¹°å…¥4: 7Dä½ç‚¹+2æ ¹ä¸ç ´]</span> <span style="color:#10b981;font-size:14px;">[å–ç‚¹2: é«˜ç‚¹+5æ ¹å†…ä¸ç ´]</span> <span style="color:#9333ea;font-size:14px;">[æœ€æ–°æ—¶é—´æ ‡è®°]</span></h1>
        <div class="nav">
            <a href="/">â† è¿”å›é¦–é¡µ</a>
            <a href="/kline-indicators">æŠ€æœ¯æŒ‡æ ‡æ€»è§ˆ</a>
        </div>
    </div>
    
    <div class="container">
        <div class="controls">
            <div class="timeframe-tabs">
                <button class="tab-btn active" onclick="switchTimeframe('5m')">5åˆ†é’Ÿ</button>
                <button class="tab-btn" onclick="switchTimeframe('1h')">1å°æ—¶</button>
            </div>
            
            <div class="pagination">
                <button class="page-btn" id="prev-btn" onclick="prevPage()">â† ä¸Šä¸€é¡µ</button>
                <div class="page-info" id="page-info">ç¬¬ 1 é¡µ</div>
                <button class="page-btn" id="next-btn" onclick="nextPage()">ä¸‹ä¸€é¡µ â†’</button>
            </div>
        </div>
        
        <!-- å®æ—¶äº¤æ˜“ä¿¡å·é¢æ¿ (2å°æ—¶å†…) -->
        <div id="signals-panel" style="background: #1a1d29; border-radius: 12px; padding: 15px; margin-bottom: 10px; display: none;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <h3 style="color: #00d4aa; margin: 0; font-size: 16px;">ğŸ“Š å®æ—¶äº¤æ˜“ä¿¡å· (æœ€è¿‘2å°æ—¶)</h3>
                <button onclick="refreshSignals()" style="background: #00d4aa; color: #0e1117; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-weight: bold;">åˆ·æ–°</button>
            </div>
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px;">
                <div style="background: rgba(0, 212, 170, 0.1); padding: 12px; border-radius: 8px; border: 1px solid rgba(0, 212, 170, 0.3);">
                    <div style="color: #888; font-size: 12px; margin-bottom: 4px;">ğŸ”¼ åšå¤šä¿¡å·</div>
                    <div id="signal-long-count" style="color: #00d4aa; font-size: 24px; font-weight: bold;">-</div>
                    <div id="signal-long-latest" style="color: #666; font-size: 10px; margin-top: 4px;">-</div>
                </div>
                <div style="background: rgba(255, 68, 68, 0.1); padding: 12px; border-radius: 8px; border: 1px solid rgba(255, 68, 68, 0.3);">
                    <div style="color: #888; font-size: 12px; margin-bottom: 4px;">ğŸ”½ åšç©ºä¿¡å·</div>
                    <div id="signal-short-count" style="color: #ff4444; font-size: 24px; font-weight: bold;">-</div>
                    <div id="signal-short-latest" style="color: #666; font-size: 10px; margin-top: 4px;">-</div>
                </div>
                <div style="background: rgba(255, 217, 61, 0.1); padding: 12px; border-radius: 8px; border: 1px solid rgba(255, 217, 61, 0.3);">
                    <div style="color: #888; font-size: 12px; margin-bottom: 4px;">â¬†ï¸ æ–°é«˜ä¿¡å·</div>
                    <div id="signal-high-count" style="color: #ffd93d; font-size: 24px; font-weight: bold;">-</div>
                    <div id="signal-high-latest" style="color: #666; font-size: 10px; margin-top: 4px;">-</div>
                </div>
                <div style="background: rgba(78, 205, 196, 0.1); padding: 12px; border-radius: 8px; border: 1px solid rgba(78, 205, 196, 0.3);">
                    <div style="color: #888; font-size: 12px; margin-bottom: 4px;">â¬‡ï¸ æ–°ä½ä¿¡å·</div>
                    <div id="signal-low-count" style="color: #4ecdc4; font-size: 24px; font-weight: bold;">-</div>
                    <div id="signal-low-latest" style="color: #666; font-size: 10px; margin-top: 4px;">-</div>
                </div>
            </div>
        </div>
        
        <div class="chart-container">
            <div class="chart-title">
                <span>Kçº¿å›¾ & æˆäº¤é‡</span>
                <span style="color: #00d4aa; font-size: 12px; margin-left: 10px;">[v4.0-FINAL]</span>
                <span class="date-range" id="date-range"></span>
            </div>
            <div id="loading" class="loading">
                <div class="spinner"></div>
                <p>åŠ è½½æ•°æ®ä¸­...</p>
            </div>
            <div id="kline-chart" class="chart" style="display:none; height: 600px;"></div>
        </div>
        
        <div class="stats-grid" id="stats-grid" style="display:none;">
            <div class="stat-card">
                <div class="stat-label">å½“å‰ä»·æ ¼</div>
                <div class="stat-value" id="stat-price">-</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">RSI(14)</div>
                <div class="stat-value" id="stat-rsi">-</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">SARä½ç½®</div>
                <div class="stat-value" id="stat-sar-position">-</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">SARå€¼</div>
                <div class="stat-value" id="stat-sar-value">-</div>
            </div>
        </div>
        
        <div class="chart-container" style="display:none;" id="rsi-container">
            <div class="chart-title">RSI æŒ‡æ ‡ (14)</div>
            <div id="rsi-chart" class="chart" style="height:300px;"></div>
        </div>
        
        <div class="chart-container" style="display:none;" id="indicators-container">
            <div class="chart-title">SAR & å¸ƒæ—å¸¦æŒ‡æ ‡</div>
            <div id="indicators-chart" class="chart" style="height:400px;"></div>
        </div>
    </div>
    
    <script>
        // ============================================
        // ğŸ”¥ v3.9.9-FIX: 2025-12-16 17:27 - æ·»åŠ å…¨å±€åˆå§‹åŒ–ä¿æŠ¤
        console.log('%cğŸ”§ ScriptåŠ è½½æ—¶é—´æˆ³: 2025-12-16 17:27', 'color: #00d4aa; font-size: 14px; font-weight: bold; background: #1a1d29; padding: 4px;');
        
        // ğŸ”¥ CRITICAL: åœ¨æœ€å‰é¢å£°æ˜ï¼Œé˜²æ­¢ä»»ä½•ä»£ç åœ¨åˆå§‹åŒ–å‰è¿è¡Œ
        var APP_INITIALIZED = false;
        console.log('ğŸ”’ APP_INITIALIZED å·²åœ¨è„šæœ¬æœ€å¼€å§‹è®¾ç½®ä¸º false');
        
        // ğŸ”¥ æ•è·æ‰€æœ‰é”™è¯¯
        window.onerror = function(message, source, lineno, colno, error) {
            console.error('%cğŸš¨ Global Error:', 'color: #ff0000; font-size: 16px', {message, source, lineno, colno, error});
            return false; // è®©é”™è¯¯ç»§ç»­ä¼ æ’­
        };
        // ============================================
        // ğŸ”¥ v7.0: ç®€åŒ–ç‰ˆæœ¬ - ç§»é™¤å¼ºåˆ¶ç¼“å­˜æ£€æµ‹
        // ============================================
        console.log('%câœ… v7.0 Kçº¿å›¾åŠ è½½ä¸­...', 'color: #00d4aa; font-size: 16px; font-weight: bold');
        
        // ============================================
        // ç‰ˆæœ¬æ§åˆ¶: v6.0 - 2025-12-11-22:00
        // å¼ºåˆ¶æ¸…é™¤æ‰€æœ‰æ—§ç‰ˆæœ¬ç¼“å­˜
        // ============================================
        const CURRENT_VERSION = 'v3.9.9';
        const VERSION_KEY = 'kline_chart_version';
        
        // æ£€æŸ¥ç‰ˆæœ¬å¹¶å¼ºåˆ¶åˆ·æ–°
        (function checkVersion() {
            const savedVersion = localStorage.getItem(VERSION_KEY);
            console.log(`%c[ç‰ˆæœ¬æ£€æŸ¥] å½“å‰ç‰ˆæœ¬: ${CURRENT_VERSION}, ç¼“å­˜ç‰ˆæœ¬: ${savedVersion}`, 'color: #00d4aa; font-size: 14px; font-weight: bold');
            
            if (savedVersion !== CURRENT_VERSION) {
                console.log(`%c[ç‰ˆæœ¬æ›´æ–°] æ£€æµ‹åˆ°æ–°ç‰ˆæœ¬ï¼æ¸…é™¤æ—§ç¼“å­˜...`, 'color: #ff4444; font-size: 14px; font-weight: bold');
                localStorage.setItem(VERSION_KEY, CURRENT_VERSION);
                
                // æ¸…é™¤æ‰€æœ‰å¯èƒ½çš„ç¼“å­˜
                if ('caches' in window) {
                    caches.keys().then(names => {
                        names.forEach(name => caches.delete(name));
                    });
                }
            }
            
            console.log(`%c[${CURRENT_VERSION}] Kçº¿å›¾è¡¨ç³»ç»Ÿå·²åŠ è½½`, 'color: #00d4aa; font-size: 16px; font-weight: bold');
        })();
        
        const symbol = '{{ symbol }}';
        let currentTimeframe = '5m';
        let allKlineData = [];
        let allIndicatorsData = [];
        let globalTimes = [];  // å…¨å±€timesæ•°ç»„ï¼ˆä¾›xAxisä½¿ç”¨ï¼‰
        let globalOhlc = [];   // å…¨å±€ohlcæ•°ç»„ï¼ˆä¾›chart seriesä½¿ç”¨ï¼‰
        let globalVolumes = []; // å…¨å±€volumesæ•°ç»„ï¼ˆä¾›chart seriesä½¿ç”¨ï¼‰
        let globalRsi = [];     // å…¨å±€rsiæ•°ç»„ï¼ˆä¾›chart seriesä½¿ç”¨ï¼‰
        let globalSar = [];     // å…¨å±€saræ•°ç»„ï¼ˆä¾›chart seriesä½¿ç”¨ï¼‰
        let globalBbUpper = []; // å…¨å±€å¸ƒæ—ä¸Šè½¨ï¼ˆä¾›chart seriesä½¿ç”¨ï¼‰
        let globalBbMiddle = []; // å…¨å±€å¸ƒæ—ä¸­è½¨ï¼ˆä¾›chart seriesä½¿ç”¨ï¼‰
        let globalBbLower = []; // å…¨å±€å¸ƒæ—ä¸‹è½¨ï¼ˆä¾›chart seriesä½¿ç”¨ï¼‰
        // ğŸ”¥ v3.9.5 - æ”¯æŒURLå‚æ•°æŒ‡å®šåˆå§‹é¡µç 
        const urlParams = new URLSearchParams(window.location.search);
        const initialPage = parseInt(urlParams.get('page')) || 0;
        let currentPage = initialPage;
        let klineChart, rsiChart, indicatorsChart;
        
        // ğŸ”¥ v3.9 - æ”¯æ’‘å‹åŠ›ä¿¡å·ç¼“å­˜
        let supportResistanceSignal = null;
        
        // æ¯é¡µæ˜¾ç¤º12å°æ—¶çš„æ•°æ®
        const RECORDS_PER_PAGE = {
            '5m': 144,   // 12å°æ—¶ Ã— 12æ ¹/å°æ—¶ = 144æ ¹
            '1h': 12     // 12å°æ—¶ = 12æ ¹
        };
        
        // åˆå§‹åŒ–å›¾è¡¨
        function initCharts() {
            console.log('[initCharts] å¼€å§‹åˆå§‹åŒ–å›¾è¡¨');
            const chartElement = document.getElementById('kline-chart');
            console.log('[initCharts] Chart element:', chartElement);
            
            if (chartElement && typeof echarts !== 'undefined') {
                klineChart = echarts.init(chartElement);
                console.log('[initCharts] Kçº¿å›¾è¡¨å·²åˆå§‹åŒ–:', !!klineChart);
            } else {
                console.error('[initCharts] åˆå§‹åŒ–å¤±è´¥ - echarts:', typeof echarts, 'element:', !!chartElement);
            }
            // rsiChartå’ŒindicatorsChartå·²éšè—ï¼Œä¸éœ€è¦åˆå§‹åŒ–
            
            window.addEventListener('resize', () => {
                if (klineChart) klineChart.resize();
            });
        }
        
        // åŠ è½½æ•°æ®
        async function loadData(timeframe) {
            console.log('%c[DEBUG] loadData è¢«è°ƒç”¨, timeframe:', 'color: #ff4444; font-weight: bold;', timeframe);
            console.trace('[TRACE] loadData è°ƒç”¨å †æ ˆ');
            currentTimeframe = timeframe;
            currentPage = initialPage;  // ğŸ”¥ ä½¿ç”¨URLå‚æ•°çš„åˆå§‹é¡µç 
            document.getElementById('loading').style.display = 'block';
            document.getElementById('kline-chart').style.display = 'none';
            document.getElementById('stats-grid').style.display = 'none';
            document.getElementById('rsi-container').style.display = 'none';
            document.getElementById('indicators-container').style.display = 'none';
            
            try {
                const cacheBuster = Date.now();
                console.log('å¼€å§‹åŠ è½½æ•°æ®...', { symbol, timeframe, cacheBuster });
                
                // ğŸ”¥ v3.9 - å¹¶è¡ŒåŠ è½½Kçº¿æ•°æ®ã€æŒ‡æ ‡æ•°æ®å’Œæ”¯æ’‘å‹åŠ›ä¿¡å·
                const [klineRes, indicatorsRes, supportSignal] = await Promise.all([
                    fetch(`/api/symbol/${symbol}/kline?timeframe=${timeframe}&_=${cacheBuster}`),
                    fetch(`/api/symbol/${symbol}/indicators?timeframe=${timeframe}&_=${cacheBuster}`),
                    fetchSupportResistanceSignal()
                ]);
                
                const klineData = await klineRes.json();
                const indicatorsData = await indicatorsRes.json();
                
                console.log('æ•°æ®åŠ è½½å®Œæˆ:', {
                    klineSuccess: klineData.success,
                    klineCount: klineData.data?.length,
                    indicatorsSuccess: indicatorsData.success,
                    indicatorsCount: indicatorsData.data?.length,
                    supportSignalLoaded: supportSignal ? 'âœ…' : 'âŒ'
                });
                
                if (klineData.success && indicatorsData.success) {
                    allKlineData = klineData.data;
                    allIndicatorsData = indicatorsData.data;
                    console.log('å¼€å§‹æ¸²æŸ“é¡µé¢...');
                    
                    // ğŸ”¥ v7.0: æ·»åŠ  APP_INITIALIZED æ£€æŸ¥
                    if (!APP_INITIALIZED) {
                        console.warn('%câš ï¸ loadDataå®Œæˆä½†APPæœªåˆå§‹åŒ–ï¼Œè·³è¿‡æ¸²æŸ“', 'color: #ff9800; font-size: 14px; font-weight: bold');
                        return;
                    }
                    
                    renderCurrentPage();
                    console.log('é¡µé¢æ¸²æŸ“å®Œæˆ');
                } else {
                    console.error('æ•°æ®åŠ è½½å¤±è´¥:', { klineData, indicatorsData });
                }
            } catch (error) {
                console.error('åŠ è½½æ•°æ®å‡ºé”™:', error);
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        }
        
        // ğŸ¯ è®¡ç®—å…¨å±€48å°æ—¶å’Œ7å¤©çš„é«˜ä½ç‚¹ï¼ˆåŸºäºæ•´ä¸ªæ•°æ®é›†ï¼‰
        function calculateGlobalHighLowPoints(allData, pageStartIdx, pageEndIdx) {
            if (!allData || allData.length === 0) return [];
            
            const markPoints = [];
            const latestTime = parseInt(allData[allData.length - 1].timestamp);
            
            // 48å°æ—¶ = 48 * 60 * 60 * 1000 ms
            const hours48Ms = 48 * 60 * 60 * 1000;
            // 7å¤© = 7 * 24 * 60 * 60 * 1000 ms
            const days7Ms = 7 * 24 * 60 * 60 * 1000;
            
            // æ‰¾å‡º48å°æ—¶å†…çš„æ•°æ®
            const data48h = allData.map((item, idx) => ({
                high: item.data[1],
                low: item.data[2],
                timestamp: item.timestamp,
                globalIdx: idx
            })).filter(item => (latestTime - parseInt(item.timestamp)) <= hours48Ms);
            
            // æ‰¾å‡º7å¤©å†…çš„æ•°æ®
            const data7d = allData.map((item, idx) => ({
                high: item.data[1],
                low: item.data[2],
                timestamp: item.timestamp,
                globalIdx: idx
            })).filter(item => (latestTime - parseInt(item.timestamp)) <= days7Ms);
            
            // 48å°æ—¶æœ€é«˜ç‚¹
            if (data48h.length > 0) {
                const max48h = data48h.reduce((max, item) => item.high > max.high ? item : max, data48h[0]);
                // è½¬æ¢ä¸ºå½“å‰é¡µé¢çš„ç›¸å¯¹ç´¢å¼•
                const relativeIdx = max48h.globalIdx - pageStartIdx;
                // âœ… å…³é”®ä¿®å¤ï¼šæ£€æŸ¥æ˜¯å¦åœ¨å½“å‰é¡µé¢èŒƒå›´å†… [pageStartIdx, pageEndIdx)
                if (max48h.globalIdx >= pageStartIdx && max48h.globalIdx < pageEndIdx) {
                    markPoints.push({
                        name: '48å°æ—¶æœ€é«˜',
                        coord: [relativeIdx, max48h.high],
                        value: max48h.high.toFixed(4),
                        itemStyle: { color: '#ff6b6b' },
                        label: {
                            show: true,
                            formatter: '48Hé«˜\n{c}',
                            position: 'top',
                            color: '#ff6b6b',
                            fontSize: 11,
                            fontWeight: 'bold',
                            backgroundColor: 'rgba(0, 0, 0, 0.7)',
                            padding: [4, 6],
                            borderRadius: 3
                        }
                    });
                }
            }
            
            // 48å°æ—¶æœ€ä½ç‚¹
            if (data48h.length > 0) {
                const min48h = data48h.reduce((min, item) => item.low < min.low ? item : min, data48h[0]);
                const relativeIdx = min48h.globalIdx - pageStartIdx;
                // âœ… å…³é”®ä¿®å¤ï¼šæ£€æŸ¥æ˜¯å¦åœ¨å½“å‰é¡µé¢èŒƒå›´å†…
                if (min48h.globalIdx >= pageStartIdx && min48h.globalIdx < pageEndIdx) {
                    markPoints.push({
                        name: '48å°æ—¶æœ€ä½',
                        coord: [relativeIdx, min48h.low],
                        value: min48h.low.toFixed(4),
                        itemStyle: { color: '#4ecdc4' },
                        label: {
                            show: true,
                            formatter: '48Hä½\n{c}',
                            position: 'bottom',
                            color: '#4ecdc4',
                            fontSize: 11,
                            fontWeight: 'bold',
                            backgroundColor: 'rgba(0, 0, 0, 0.7)',
                            padding: [4, 6],
                            borderRadius: 3
                        }
                    });
                }
            }
            
            // 7å¤©æœ€é«˜ç‚¹
            if (data7d.length > 0) {
                const max7d = data7d.reduce((max, item) => item.high > max.high ? item : max, data7d[0]);
                const relativeIdx = max7d.globalIdx - pageStartIdx;
                // âœ… å…³é”®ä¿®å¤ï¼šæ£€æŸ¥æ˜¯å¦åœ¨å½“å‰é¡µé¢èŒƒå›´å†…
                if (max7d.globalIdx >= pageStartIdx && max7d.globalIdx < pageEndIdx) {
                    markPoints.push({
                        name: '7å¤©æœ€é«˜',
                        coord: [relativeIdx, max7d.high],
                        value: max7d.high.toFixed(4),
                        itemStyle: { color: '#ffd93d' },
                        label: {
                            show: true,
                            formatter: '7Dé«˜\n{c}',
                            position: 'top',
                            color: '#ffd93d',
                            fontSize: 11,
                            fontWeight: 'bold',
                            backgroundColor: 'rgba(0, 0, 0, 0.7)',
                            padding: [4, 6],
                            borderRadius: 3
                        }
                    });
                }
            }
            
            // 7å¤©æœ€ä½ç‚¹
            if (data7d.length > 0) {
                const min7d = data7d.reduce((min, item) => item.low < min.low ? item : min, data7d[0]);
                const relativeIdx = min7d.globalIdx - pageStartIdx;
                // âœ… å…³é”®ä¿®å¤ï¼šæ£€æŸ¥æ˜¯å¦åœ¨å½“å‰é¡µé¢èŒƒå›´å†…
                if (min7d.globalIdx >= pageStartIdx && min7d.globalIdx < pageEndIdx) {
                    markPoints.push({
                        name: '7å¤©æœ€ä½',
                        coord: [relativeIdx, min7d.low],
                        value: min7d.low.toFixed(4),
                        itemStyle: { color: '#6bcf7f' },
                        label: {
                            show: true,
                            formatter: '7Dä½\n{c}',
                            position: 'bottom',
                            color: '#6bcf7f',
                            fontSize: 11,
                            fontWeight: 'bold',
                            backgroundColor: 'rgba(0, 0, 0, 0.7)',
                            padding: [4, 6],
                            borderRadius: 3
                        }
                    });
                }
            }
            
            console.log('%c[å…¨å±€é«˜ä½ç‚¹æ ‡è®°] åŸºäºæ•´ä¸ªæ•°æ®é›†è®¡ç®—:', 'color: #ffd93d; font-size: 14px; font-weight: bold', {
                'æœ€æ–°æ—¶é—´': new Date(latestTime).toLocaleString('zh-CN'),
                '48å°æ—¶æ•°æ®ç‚¹æ•°': data48h.length,
                '7å¤©æ•°æ®ç‚¹æ•°': data7d.length,
                'å½“å‰é¡µèŒƒå›´': `[${pageStartIdx}, ${pageEndIdx})`,
                'æ ‡è®°ç‚¹æ•°é‡': markPoints.length,
                'æ ‡è®°è¯¦æƒ…': markPoints.map(p => ({
                    name: p.name,
                    ä»·æ ¼: p.value,
                    ç›¸å¯¹ç´¢å¼•: p.coord[0]
                }))
            });
            
            return markPoints;
        }
        
        // ğŸ”¥ v3.9 - è·å–æ”¯æ’‘å‹åŠ›æœ€æ–°ä¿¡å·
        async function fetchSupportResistanceSignal() {
            try {
                const response = await fetch('/api/support-resistance/latest-signal');
                const data = await response.json();
                if (data.success) {
                    supportResistanceSignal = data;
                    console.log('%c[æ”¯æ’‘å‹åŠ›ä¿¡å·] è·å–æˆåŠŸ:', 'color: #00d4aa; font-size: 12px; font-weight: bold', {
                        'æŠ„åº•ä¿¡å·': data.signals.buy ? `âœ… (æƒ…å†µ1=${data.scenario_1_count}, æƒ…å†µ2=${data.scenario_2_count})` : 'âŒ',
                        'é€ƒé¡¶ä¿¡å·': data.signals.sell ? `âœ… (æƒ…å†µ3=${data.scenario_3_count}, æƒ…å†µ4=${data.scenario_4_count})` : 'âŒ',
                        'å¿«ç…§æ—¶é—´': data.snapshot_time
                    });
                    return data;
                }
            } catch (error) {
                console.error('[æ”¯æ’‘å‹åŠ›ä¿¡å·] è·å–å¤±è´¥:', error);
            }
            return null;
        }
        
        // ğŸ”¥ æ–°å¢: åŠ è½½å¹¶æ˜¾ç¤ºæœ€è¿‘2å°æ—¶çš„å®æ—¶äº¤æ˜“ä¿¡å·ï¼ˆåˆ†ç±»æ˜¾ç¤ºï¼‰
        async function loadRecentSignals() {
            try {
                const response = await fetch('/api/signals/recent');
                const data = await response.json();
                
                if (data.success) {
                    const summary = data.summary;
                    const signals = data.signals;
                    
                    // æ›´æ–°é¢æ¿æ˜¾ç¤º
                    document.getElementById('signals-panel').style.display = 'block';
                    
                    // åšå¤šä¿¡å·
                    document.getElementById('signal-long-count').textContent = summary.long_total;
                    if (signals.long.length > 0) {
                        const latest = signals.long[0];
                        // æ ¼å¼åŒ–æ—¶é—´ï¼šåªæ˜¾ç¤ºæ—¶:åˆ†
                        const triggerTime = latest.time.split(' ')[1].substring(0, 5); // æå– HH:MM
                        document.getElementById('signal-long-latest').textContent = 
                            `è§¦å‘æ—¶é—´: ${triggerTime} (${latest.count}ä¸ª)`;
                    } else {
                        document.getElementById('signal-long-latest').textContent = 'æš‚æ— ä¿¡å·';
                    }
                    
                    // åšç©ºä¿¡å·
                    document.getElementById('signal-short-count').textContent = summary.short_total;
                    if (signals.short.length > 0) {
                        const latest = signals.short[0];
                        const triggerTime = latest.time.split(' ')[1].substring(0, 5);
                        document.getElementById('signal-short-latest').textContent = 
                            `è§¦å‘æ—¶é—´: ${triggerTime} (${latest.count}ä¸ª)`;
                    } else {
                        document.getElementById('signal-short-latest').textContent = 'æš‚æ— ä¿¡å·';
                    }
                    
                    // æ–°é«˜ä¿¡å·
                    document.getElementById('signal-high-count').textContent = summary.new_high_total;
                    if (signals.new_high.length > 0) {
                        const latest = signals.new_high[0];
                        const triggerTime = latest.time.split(' ')[1].substring(0, 5);
                        document.getElementById('signal-high-latest').textContent = 
                            `è§¦å‘æ—¶é—´: ${triggerTime} (${latest.count}ä¸ª)`;
                    } else {
                        document.getElementById('signal-high-latest').textContent = 'æš‚æ— ä¿¡å·';
                    }
                    
                    // æ–°ä½ä¿¡å·
                    document.getElementById('signal-low-count').textContent = summary.new_low_total;
                    if (signals.new_low.length > 0) {
                        const latest = signals.new_low[0];
                        const triggerTime = latest.time.split(' ')[1].substring(0, 5);
                        document.getElementById('signal-low-latest').textContent = 
                            `è§¦å‘æ—¶é—´: ${triggerTime} (${latest.count}ä¸ª)`;
                    } else {
                        document.getElementById('signal-low-latest').textContent = 'æš‚æ— ä¿¡å·';
                    }
                    
                    console.log('%c[å®æ—¶ä¿¡å·] åŠ è½½æˆåŠŸ:', 'color: #00d4aa; font-size: 12px; font-weight: bold', summary);
                } else {
                    console.error('[å®æ—¶ä¿¡å·] åŠ è½½å¤±è´¥:', data.error);
                }
            } catch (error) {
                console.error('[å®æ—¶ä¿¡å·] è¯·æ±‚å¤±è´¥:', error);
            }
        }
        
        // åˆ·æ–°ä¿¡å·æŒ‰é’®å›è°ƒ
        async function refreshSignals() {
            await loadRecentSignals();
        }
        
        // ğŸ”¥ v3.9.9 - æ ‡è®°æ”¯æ’‘å‹åŠ›æœ€æ–°æ—¶é—´ç‚¹ï¼ˆä»latest APIè·å–ï¼‰
        async function markLatestSupportResistanceTime(allData, pageStartIdx, pageEndIdx) {
            const markPoints = [];
            
            try {
                const response = await fetch('/api/support-resistance/latest');
                const data = await response.json();
                
                if (!data || !data.data || data.data.length === 0) {
                    console.log('%c[æœ€æ–°æ—¶é—´æ ‡è®°] æ— æ”¯æ’‘å‹åŠ›æ•°æ®', 'color: #ff9800; font-size: 11px');
                    return markPoints;
                }
                
                // æ‰¾åˆ°å½“å‰å¸ç§çš„è®°å½•
                const currentSymbol = symbol + 'USDT';
                const record = data.data.find(item => item.symbol === currentSymbol);
                
                if (!record || !record.record_time) {
                    console.log(`%c[æœ€æ–°æ—¶é—´æ ‡è®°] æœªæ‰¾åˆ° ${currentSymbol} çš„è®°å½•`, 'color: #ff9800; font-size: 11px');
                    return markPoints;
                }
                
                // è§£ææ—¶é—´å¹¶è½¬æ¢ä¸ºæ¯«ç§’æ—¶é—´æˆ³
                const recordTime = new Date(record.record_time.replace(' ', 'T') + 'Z').getTime();
                
                console.log('%c[æœ€æ–°æ—¶é—´æ ‡è®°] æ”¯æ’‘å‹åŠ›æœ€æ–°æ—¶é—´:', 'color: #9333ea; font-size: 12px; font-weight: bold', {
                    'å¸ç§': currentSymbol,
                    'è®°å½•æ—¶é—´': record.record_time,
                    'æ—¶é—´æˆ³': recordTime
                });
                
                // æ‰¾åˆ°æœ€æ¥è¿‘è¿™ä¸ªæ—¶é—´çš„Kçº¿
                let closestIdx = -1;
                let minDiff = Infinity;
                
                for (let i = 0; i < allData.length; i++) {
                    const klineTime = parseInt(allData[i].timestamp);
                    const diff = Math.abs(klineTime - recordTime);
                    if (diff < minDiff) {
                        minDiff = diff;
                        closestIdx = i;
                    }
                    // å¦‚æœè¶…è¿‡10åˆ†é’Ÿå°±ä¸ç”¨ç»§ç»­æ‰¾äº†
                    if (klineTime > recordTime + 10 * 60 * 1000) break;
                }
                
                if (closestIdx === -1) {
                    console.log('%c[æœ€æ–°æ—¶é—´æ ‡è®°] æœªæ‰¾åˆ°åŒ¹é…çš„Kçº¿', 'color: #ff9800; font-size: 11px');
                    return markPoints;
                }
                
                // æ£€æŸ¥æ˜¯å¦åœ¨å½“å‰é¡µé¢èŒƒå›´å†…
                if (closestIdx >= pageStartIdx && closestIdx < pageEndIdx) {
                    const relativeIdx = closestIdx - pageStartIdx;
                    const kline = allData[closestIdx];
                    const markPrice = kline.data[1];  // ä½¿ç”¨æœ€é«˜ä»·
                    
                    // record.record_timeå·²ç»æ˜¯åŒ—äº¬æ—¶é—´ï¼Œç›´æ¥ä½¿ç”¨
                    const timeStr = record.record_time.substring(11, 19); // HH:MM:SS
                    
                    // å·²ç¦ç”¨ï¼šæ”¯æ’‘å‹åŠ›æœ€æ–°æ—¶é—´æ ‡è®°
                    /*
                    markPoints.push({
                        name: 'æ”¯æ’‘å‹åŠ›æœ€æ–°æ—¶é—´',
                        coord: [relativeIdx, markPrice],
                        value: 'æœ€æ–°',
                        itemStyle: { 
                            color: '#9333ea',
                            borderColor: '#fff',
                            borderWidth: 2
                        },
                        label: {
                            show: true,
                            formatter: `æ”¯æ’‘å‹åŠ›\næœ€æ–°æ—¶é—´\n${timeStr}`,
                            position: 'top',
                            color: '#fff',
                            fontSize: 12,
                            fontWeight: 'bold',
                            backgroundColor: '#9333ea',
                            padding: [5, 8],
                            borderRadius: 4,
                            borderColor: '#fff',
                            borderWidth: 1
                        },
                        symbolSize: 60
                    });
                    */
                    
                    console.log('%c[æœ€æ–°æ—¶é—´æ ‡è®°] å·²ç”Ÿæˆæ ‡è®°!', 'color: #9333ea; font-size: 12px; font-weight: bold', {
                        'Kçº¿ç´¢å¼•': closestIdx,
                        'ç›¸å¯¹ç´¢å¼•': relativeIdx,
                        'ä»·æ ¼': markPrice.toFixed(4),
                        'è®°å½•æ—¶é—´': record.record_time,
                        'æ—¶é—´å·®': (minDiff / 60000).toFixed(2) + 'åˆ†é’Ÿ'
                    });
                }
                
            } catch (error) {
                console.error('[æœ€æ–°æ—¶é—´æ ‡è®°] æŸ¥è¯¢å¤±è´¥:', error);
            }
            
            return markPoints;
        }
        
        // ğŸ”¥ v3.9 - æ£€æµ‹7dayä½ç‚¹å2æ ¹Kçº¿ä¸åˆ›æ–°ä½
        function detect7DayLowNoNewLow(allData) {
            if (!allData || allData.length < 3) return [];
            
            const buySignals = [];
            const latestTime = parseInt(allData[allData.length - 1].timestamp);
            const days7Ms = 7 * 24 * 60 * 60 * 1000;
            
            // æ‰¾å‡º7å¤©å†…çš„æ•°æ®
            const data7d = allData.map((item, idx) => ({
                high: item.data[1],
                low: item.data[2],
                close: item.data[3],
                timestamp: item.timestamp,
                globalIdx: idx
            })).filter(item => (latestTime - parseInt(item.timestamp)) <= days7Ms);
            
            if (data7d.length === 0) return [];
            
            // æ‰¾åˆ°7å¤©æœ€ä½ç‚¹
            const min7d = data7d.reduce((min, item) => item.low < min.low ? item : min, data7d[0]);
            const min7dIdx = min7d.globalIdx;
            
            // æ£€æŸ¥æœ€ä½ç‚¹åæ˜¯å¦æœ‰è‡³å°‘2æ ¹Kçº¿
            if (min7dIdx + 2 >= allData.length) {
                console.log('%c[ä¹°å…¥4æ£€æµ‹] 7å¤©æœ€ä½ç‚¹å¤ªæ¥è¿‘æœ€æ–°æ•°æ®ï¼Œåç»­Kçº¿ä¸è¶³', 'color: #ff9800; font-size: 11px');
                return [];
            }
            
            // è·å–æœ€ä½ç‚¹åçš„2æ ¹Kçº¿
            const nextBar1 = allData[min7dIdx + 1];
            const nextBar2 = allData[min7dIdx + 2];
            
            // æ£€æŸ¥å2æ ¹Kçº¿çš„æœ€ä½ä»·æ˜¯å¦éƒ½æ²¡æœ‰åˆ›æ–°ä½
            const nextBar1Low = nextBar1.data[2];  // low
            const nextBar2Low = nextBar2.data[2];  // low
            const noNewLow = (nextBar1Low >= min7d.low) && (nextBar2Low >= min7d.low);
            
            console.log('%c[ä¹°å…¥4æ£€æµ‹] 7å¤©ä½ç‚¹å2æ ¹Kçº¿æƒ…å†µ:', 'color: #00d4aa; font-size: 12px; font-weight: bold', {
                '7å¤©æœ€ä½ç‚¹': {
                    'ä»·æ ¼': min7d.low.toFixed(4),
                    'ç´¢å¼•': min7dIdx,
                    'æ—¶é—´': new Date(parseInt(min7d.timestamp)).toLocaleString('zh-CN')
                },
                'åç¬¬1æ ¹Kçº¿': {
                    'æœ€ä½ä»·': nextBar1Low.toFixed(4),
                    'æ˜¯å¦åˆ›æ–°ä½': nextBar1Low < min7d.low ? 'âŒ åˆ›æ–°ä½' : 'âœ… æœªåˆ›æ–°ä½'
                },
                'åç¬¬2æ ¹Kçº¿': {
                    'æœ€ä½ä»·': nextBar2Low.toFixed(4),
                    'æ˜¯å¦åˆ›æ–°ä½': nextBar2Low < min7d.low ? 'âŒ åˆ›æ–°ä½' : 'âœ… æœªåˆ›æ–°ä½'
                },
                'ç»“è®º': noNewLow ? 'âœ… å2æ ¹éƒ½æœªåˆ›æ–°ä½' : 'âŒ æœ‰åˆ›æ–°ä½'
            });
            
            if (noNewLow) {
                // åœ¨ç¬¬2æ ¹Kçº¿ä½ç½®æ ‡è®°"ä¹°å…¥4"
                buySignals.push({
                    globalIdx: min7dIdx + 2,
                    low: nextBar2Low,
                    timestamp: nextBar2.timestamp,
                    reason: '7Dä½ç‚¹å2æ ¹ä¸åˆ›æ–°ä½'
                });
            }
            
            return buySignals;
        }
        
        // ğŸ”¥ v3.9.9 - æ£€æµ‹é«˜ç‚¹å5æ ¹Kçº¿å†…ä¸åˆ›æ–°é«˜ï¼ˆåªæ£€æµ‹æœ‰æ”¯æ’‘å‹åŠ›å¿«ç…§çš„æ—¶é—´èŒƒå›´ï¼‰
        function detectHighNoNewHighWithin5Bars(allData, baseIdx = 0) {
            const sellSignals = [];
            const processedHighPoints = new Set();  // é¿å…é‡å¤æ ‡è®°åŒä¸€ä¸ªé«˜ç‚¹
            
            // ğŸ”¥ å…³é”®ä¼˜åŒ–ï¼šåªæ£€æµ‹æœ‰æ”¯æ’‘å‹åŠ›å¿«ç…§æ•°æ®çš„æ—¶é—´èŒƒå›´ï¼ˆä»12-12 00:00å¼€å§‹ï¼‰
            // æ”¯æ’‘å‹åŠ›å¿«ç…§æ•°æ®ä» 2025-12-12 00:00:00 UTC å¼€å§‹
            const snapshotStartTime = new Date('2025-12-12T00:00:00Z').getTime();  // UTCæ—¶é—´
            const dataWithSnapshot = allData.filter(item => parseInt(item.timestamp) >= snapshotStartTime);
            
            if (dataWithSnapshot.length === 0) {
                console.log('%c[å–ç‚¹2æ£€æµ‹] æ— å¯ç”¨æ•°æ®ï¼ˆéœ€è¦12-12ä¹‹åçš„æ•°æ®ï¼‰', 'color: #ff9800; font-size: 11px');
                return sellSignals;
            }
            
            // æ‰¾åˆ°æ•°æ®åœ¨å½“å‰æœç´¢æ•°æ®ä¸­çš„èµ·å§‹ç´¢å¼•
            const startLocalIdx = allData.findIndex(item => item.timestamp === dataWithSnapshot[0].timestamp);
            const startGlobalIdx = baseIdx + startLocalIdx;
            
            // éå†æœ‰å¿«ç…§çš„æ•°æ®ï¼Œä»ç¬¬1æ ¹åˆ°å€’æ•°ç¬¬6æ ¹ï¼ˆç¡®ä¿åé¢æœ‰5æ ¹Kçº¿ï¼‰
            for (let i = 0; i < dataWithSnapshot.length - 5; i++) {
                const globalIdx = baseIdx + startLocalIdx + i;
                
                // å¦‚æœè¿™ä¸ªé«˜ç‚¹å·²ç»è¢«å¤„ç†è¿‡ï¼Œè·³è¿‡
                if (processedHighPoints.has(globalIdx)) continue;
                
                const currentBar = dataWithSnapshot[i];
                const currentHigh = currentBar.data[1];  // [open, high, low, close]
                
                // æ£€æŸ¥åé¢5æ ¹Kçº¿ï¼Œæ‰¾åˆ°ç¬¬ä¸€æ ¹æ²¡æœ‰åˆ›æ–°é«˜çš„Kçº¿
                for (let j = 1; j <= 5; j++) {
                    const nextBar = dataWithSnapshot[i + j];
                    const nextHigh = nextBar.data[1];
                    
                    // å¦‚æœè¿™æ ¹Kçº¿æ²¡æœ‰åˆ›æ–°é«˜ï¼Œå°±åœ¨è¿™æ ¹Kçº¿æ ‡è®°
                    if (nextHigh <= currentHigh) {
                        sellSignals.push({
                            globalIdx: globalIdx + j,  // åœ¨ç¬¬jæ ¹Kçº¿ä½ç½®æ ‡è®°ï¼ˆå…¨å±€ç´¢å¼•ï¼‰
                            high: nextHigh,  // è¿™æ ¹Kçº¿çš„æœ€é«˜ä»·
                            timestamp: nextBar.timestamp,
                            highPointIdx: globalIdx,  // åŸå§‹é«˜ç‚¹çš„å…¨å±€ç´¢å¼•
                            highPointPrice: currentHigh,
                            barsAfterHigh: j,  // é«˜ç‚¹åç¬¬å‡ æ ¹
                            reason: `é«˜ç‚¹åç¬¬${j}æ ¹ä¸åˆ›æ–°é«˜`
                        });
                        processedHighPoints.add(globalIdx);  // æ ‡è®°è¿™ä¸ªé«˜ç‚¹å·²å¤„ç†
                        break;  // æ‰¾åˆ°ç¬¬ä¸€æ ¹ä¸åˆ›æ–°é«˜çš„å°±åœæ­¢
                    }
                }
            }
            
            console.log('%c[å–ç‚¹2æ£€æµ‹] é«˜ç‚¹å5æ ¹Kçº¿å†…ä¸åˆ›æ–°é«˜ï¼ˆä»…12-12ä¹‹åï¼‰:', 'color: #ef4444; font-size: 12px; font-weight: bold', {
                'å¯ç”¨æ•°æ®ç‚¹æ•°': dataWithSnapshot.length,
                'å€™é€‰æ•°é‡': sellSignals.length
            });
            
            return sellSignals;
        }
        
        // ğŸ”¥ v3.9.1 - è®¡ç®—"ä¹°å…¥4"ä¿¡å·ï¼ˆç»“åˆ7dayä½ç‚¹ + æ”¯æ’‘å‹åŠ›ï¼Œæ”¯æŒæ—¶é—´èŒƒå›´æŸ¥è¯¢ï¼‰
        async function calculateBuy4Signals(allData, pageStartIdx, pageEndIdx) {
            const markPoints = [];
            
            // æ£€æµ‹7dayä½ç‚¹å2æ ¹ä¸åˆ›æ–°ä½
            const buySignals = detect7DayLowNoNewLow(allData);
            
            if (buySignals.length === 0) {
                console.log('%c[ä¹°å…¥4æ£€æµ‹] æœªæ£€æµ‹åˆ°7å¤©ä½ç‚¹å2æ ¹ä¸åˆ›æ–°ä½', 'color: #ff9800; font-size: 11px');
                return markPoints;
            }
            
            // å¯¹æ¯ä¸ªä¹°å…¥ä¿¡å·ï¼ŒæŸ¥è¯¢å…¶å‰å5åˆ†é’Ÿçš„æ”¯æ’‘å‹åŠ›å¿«ç…§
            for (const signal of buySignals) {
                const targetTime = parseInt(signal.timestamp);
                const fiveMinutes = 5 * 60 * 1000;  // 5åˆ†é’Ÿ = 300,000æ¯«ç§’
                
                try {
                    const response = await fetch(
                        `/api/support-resistance/snapshots-by-time?` +
                        `time_start=${targetTime - fiveMinutes}&` +
                        `time_end=${targetTime + fiveMinutes}`
                    );
                    const data = await response.json();
                    
                    if (data.success && data.snapshots && data.snapshots.length > 0) {
                        // æ£€æŸ¥æ˜¯å¦æœ‰ä»»ä½•å¿«ç…§æ»¡è¶³æŠ„åº•æ¡ä»¶
                        const matchingSnapshots = data.snapshots.filter(s => s.buy_signal);
                        const hasBuySignal = matchingSnapshots.length > 0;
                        
                        console.log('%c[ä¹°å…¥4æ£€æµ‹] æŸ¥è¯¢å‰å5åˆ†é’Ÿæ”¯æ’‘å‹åŠ›å¿«ç…§:', 'color: #00d4aa; font-size: 12px; font-weight: bold', {
                            'ç›®æ ‡æ—¶é—´': new Date(targetTime).toLocaleString('zh-CN'),
                            'æŸ¥è¯¢èŒƒå›´': `å‰å5åˆ†é’Ÿ`,
                            'å¿«ç…§æ•°é‡': data.snapshots.length,
                            'æ»¡è¶³æ¡ä»¶çš„å¿«ç…§': matchingSnapshots.length,
                            'ç»“è®º': hasBuySignal ? 'âœ… æ»¡è¶³æŠ„åº•æ¡ä»¶' : 'âŒ ä¸æ»¡è¶³'
                        });
                        
                        // è¾“å‡ºæ¯ä¸ªå¿«ç…§çš„è¯¦æƒ…
                        matchingSnapshots.forEach(s => {
                            console.log('%c  âœ… å¿«ç…§æ—¶é—´: ' + s.snapshot_time, 'color: #4ade80', {
                                'æƒ…å†µ1': s.scenario_1_count,
                                'æƒ…å†µ2': s.scenario_2_count
                            });
                        });
                        
                        if (!hasBuySignal) {
                            console.log('%c[ä¹°å…¥4æ£€æµ‹] å‰å5åˆ†é’Ÿå†…æ— æ»¡è¶³æ¡ä»¶çš„å¿«ç…§', 'color: #ff9800; font-size: 11px');
                            continue;  // è·³è¿‡è¿™ä¸ªä¿¡å·
                        }
                        
                        // å¦‚æœé€šè¿‡äº†æ”¯æ’‘å‹åŠ›æ£€æŸ¥ï¼Œç”Ÿæˆä¹°å…¥4æ ‡è®°
                        const relativeIdx = signal.globalIdx - pageStartIdx;
                        // æ£€æŸ¥æ˜¯å¦åœ¨å½“å‰é¡µé¢èŒƒå›´å†…
                        if (signal.globalIdx >= pageStartIdx && signal.globalIdx < pageEndIdx) {
                            // ä½¿ç”¨ç¬¬ä¸€ä¸ªåŒ¹é…çš„å¿«ç…§ä¿¡æ¯
                            const matchedSnapshot = matchingSnapshots[0];
                            
                            markPoints.push({
                                name: 'ä¹°å…¥4',
                                coord: [relativeIdx, signal.low],
                                value: 'ä¹°å…¥4',
                                itemStyle: { 
                                    color: '#ff1744',
                                    borderColor: '#fff',
                                    borderWidth: 2
                                },
                                label: {
                                    show: true,
                                    formatter: 'ä¹°å…¥4\n' + signal.low.toFixed(4),
                                    position: 'bottom',
                                    color: '#fff',
                                    fontSize: 13,
                                    fontWeight: 'bold',
                                    backgroundColor: '#ff1744',
                                    padding: [6, 10],
                                    borderRadius: 4,
                                    borderColor: '#fff',
                                    borderWidth: 1
                                },
                                symbolSize: 60
                            });
                            
                            console.log('%c[ä¹°å…¥4ä¿¡å·] å·²ç”Ÿæˆæ ‡è®°!', 'color: #ff1744; font-size: 14px; font-weight: bold; background: #fff; padding: 4px 8px', {
                                'ä½ç½®': `ç´¢å¼• ${signal.globalIdx}`,
                                'ä»·æ ¼': signal.low.toFixed(4),
                                'åŸå› ': signal.reason,
                                'æ”¯æ’‘å‹åŠ›': `æƒ…å†µ1=${matchedSnapshot.scenario_1_count}, æƒ…å†µ2=${matchedSnapshot.scenario_2_count}`
                            });
                        }
                    } else {
                        console.log('%c[ä¹°å…¥4æ£€æµ‹] æœªæŸ¥è¯¢åˆ°æ”¯æ’‘å‹åŠ›å¿«ç…§', 'color: #ff9800; font-size: 11px', {
                            'ç›®æ ‡æ—¶é—´': new Date(targetTime).toLocaleString('zh-CN')
                        });
                        continue;
                    }
                } catch (error) {
                    console.error('[ä¹°å…¥4æ£€æµ‹] æŸ¥è¯¢æ”¯æ’‘å‹åŠ›å¿«ç…§å¤±è´¥:', error);
                    continue;
                }
            }
            
            return markPoints;
        }
        
        // ğŸ”¥ v3.9.4 - è®¡ç®—"å–ç‚¹2"ä¿¡å·ï¼ˆæ–°è§„åˆ™ï¼šæ‰€æœ‰å¸é€šç”¨ï¼Œ5æ ¹éƒ½åˆ›æ–°é«˜åˆ™æ ‡è®°ç¬¬5æ ¹ï¼ŒRSI>=50ï¼‰
        async function calculateSell2Signals(allData, pageStartIdx, pageEndIdx) {
            const markPoints = [];
            
            console.log('%c[å–ç‚¹2æ£€æµ‹] v3.9.4 - æƒ…å†µ3+4>=8é€‚ç”¨æ‰€æœ‰å¸ï¼Œ5æ ¹éƒ½åˆ›æ–°é«˜æ ‡ç¬¬5æ ¹ï¼ŒRSI>=50', 'color: #ef4444; font-size: 13px; font-weight: bold');
            
            // ğŸ”¥ æ­¥éª¤1ï¼šæŸ¥è¯¢æ‰€æœ‰æ»¡è¶³"æƒ…å†µ3+æƒ…å†µ4>=8"çš„å¿«ç…§ï¼ˆä¸è¿‡æ»¤å¸ç§ï¼Œé€‚ç”¨æ‰€æœ‰27ä¸ªå¸ï¼‰
            // è®¡ç®—æ•´ä¸ªæ•°æ®é›†çš„æ—¶é—´èŒƒå›´
            const dataStartTime = parseInt(allData[0].timestamp);
            const dataEndTime = parseInt(allData[allData.length - 1].timestamp);
            
            try {
                // ğŸ”¥ ä¸ä¼ symbolå‚æ•°ï¼Œè·å–æ‰€æœ‰æ»¡è¶³æ¡ä»¶çš„å¿«ç…§
                const response = await fetch(
                    `/api/support-resistance/snapshots-by-time?` +
                    `time_start=${dataStartTime}&` +
                    `time_end=${dataEndTime}`
                );
                const data = await response.json();
                
                if (!data.success || !data.snapshots || data.snapshots.length === 0) {
                    console.log('%c[å–ç‚¹2æ£€æµ‹] æœªæ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„æ”¯æ’‘å‹åŠ›å¿«ç…§', 'color: #ff9800; font-size: 11px');
                    return markPoints;
                }
                
                // è¿‡æ»¤å‡ºæ»¡è¶³å–å‡ºä¿¡å·çš„å¿«ç…§ï¼ˆæƒ…å†µ3 + æƒ…å†µ4 >= 8ï¼‰
                const sellSnapshots = data.snapshots.filter(s => s.sell_signal);
                
                if (sellSnapshots.length === 0) {
                    console.log('%c[å–ç‚¹2æ£€æµ‹] å¿«ç…§ä¸­æ— æ»¡è¶³"æƒ…å†µ3+æƒ…å†µ4>=8"çš„è®°å½•', 'color: #ff9800; font-size: 11px');
                    return markPoints;
                }
                
                console.log('%c[å–ç‚¹2æ£€æµ‹] æ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„å¿«ç…§ï¼ˆé€‚ç”¨æ‰€æœ‰å¸ï¼‰:', 'color: #ef4444; font-size: 12px; font-weight: bold', {
                    'å¿«ç…§æ•°é‡': sellSnapshots.length,
                    'å½“å‰å¸ç§': symbol,
                    'å¿«ç…§åˆ—è¡¨': sellSnapshots.map(s => s.snapshot_time)
                });
                
                // ğŸ”¥ æ­¥éª¤2ï¼šå¯¹æ¯ä¸ªå¿«ç…§ï¼Œåœ¨å…¶æ—¶é—´ç‚¹å¾€åæ‰¾5æ ¹Kçº¿
                for (const snapshot of sellSnapshots) {
                    const snapshotTime = new Date(snapshot.snapshot_time).getTime();
                    
                    console.log(`%c[å–ç‚¹2] å¤„ç†å¿«ç…§: ${snapshot.snapshot_time}`, 'color: #ef4444; font-size: 11px');
                    
                    // æ‰¾åˆ°æœ€æ¥è¿‘å¿«ç…§æ—¶é—´çš„Kçº¿ç´¢å¼•
                    let closestIdx = -1;
                    let minDiff = Infinity;
                    
                    for (let i = 0; i < allData.length; i++) {
                        const klineTime = parseInt(allData[i].timestamp);
                        const diff = Math.abs(klineTime - snapshotTime);
                        if (diff < minDiff) {
                            minDiff = diff;
                            closestIdx = i;
                        }
                        // å¦‚æœè¶…è¿‡5åˆ†é’Ÿå°±ä¸ç”¨ç»§ç»­æ‰¾äº†
                        if (klineTime > snapshotTime + 5 * 60 * 1000) break;
                    }
                    
                    console.log(`%c[å–ç‚¹2] æœ€æ¥è¿‘Kçº¿: idx=${closestIdx}, allData.length=${allData.length}`, 'color: #666; font-size: 10px');
                    
                    if (closestIdx === -1 || closestIdx + 5 >= allData.length) {
                        console.log(`%c[å–ç‚¹2æ£€æµ‹] å¿«ç…§ ${snapshot.snapshot_time} é™„è¿‘æ— è¶³å¤ŸKçº¿æ•°æ®`, 'color: #ff9800; font-size: 10px');
                        continue;
                    }
                    
                    // è·å–åŸºå‡†Kçº¿çš„æœ€é«˜ä»·
                    const baseKline = allData[closestIdx];
                    const baseHigh = baseKline.data[1];  // [open, high, low, close]
                    
                    // ğŸ”¥ v3.9.5 - åœ¨åŸºå‡†Kçº¿ä¸Šæ ‡è®°å¿«ç…§æ—¶é—´ç‚¹ï¼ˆæƒ…å†µ3+æƒ…å†µ4>=8ï¼‰
                    if (closestIdx >= pageStartIdx && closestIdx < pageEndIdx) {
                        const relativeIdx = closestIdx - pageStartIdx;
                        
                        // è½¬æ¢UTCæ—¶é—´ä¸ºåŒ—äº¬æ—¶é—´ï¼ˆUTC+8ï¼‰
                        // snapshot_timeæ ¼å¼: "2025-12-12 12:06:00"
                        const utcTime = new Date(snapshot.snapshot_time.replace(' ', 'T') + 'Z');
                        // æ‰‹åŠ¨è®¡ç®—åŒ—äº¬æ—¶é—´ï¼ˆUTC+8å°æ—¶ï¼‰
                        const beijingTime = new Date(utcTime.getTime() + 8 * 60 * 60 * 1000);
                        const hours = beijingTime.getUTCHours().toString().padStart(2, '0');
                        const minutes = beijingTime.getUTCMinutes().toString().padStart(2, '0');
                        const timeStr = `${hours}:${minutes}`; // æ ¼å¼: "20:06"
                        console.log(`%c[æ—¶é—´è½¬æ¢] UTC: ${snapshot.snapshot_time} -> åŒ—äº¬: ${timeStr}`, 'color: #00d4aa; font-weight: bold');
                        
                        const labelText = `é€ƒé¡¶ä¿¡å·\nåŒ—äº¬${timeStr}\næƒ…å†µ3=${snapshot.scenario_3_count}\næƒ…å†µ4=${snapshot.scenario_4_count}`;
                        console.log(`%c[æ ‡è®°æ–‡æœ¬ v3.9.9] ${labelText.replace(/\n/g, ' | ')}`, 'color: #ff9800; font-weight: bold');
                        
                        markPoints.push({
                            name: 'é€ƒé¡¶ä¿¡å·',
                            coord: [relativeIdx, baseHigh],
                            value: 'é€ƒé¡¶',
                            itemStyle: { 
                                color: '#ff9800',
                                borderColor: '#fff',
                                borderWidth: 2
                            },
                            label: {
                                show: true,
                                formatter: labelText,
                                position: 'top',
                                color: '#fff',
                                fontSize: 11,
                                fontWeight: 'bold',
                                backgroundColor: '#ff9800',
                                padding: [4, 8],
                                borderRadius: 4,
                                borderColor: '#fff',
                                borderWidth: 1
                            },
                            symbolSize: 50
                        });
                        
                        console.log(`%c[é€ƒé¡¶ä¿¡å·æ ‡è®°] å¿«ç…§ ${snapshot.snapshot_time}`, 'color: #ff9800; font-size: 12px; font-weight: bold', {
                            'åŸºå‡†Kçº¿ç´¢å¼•': closestIdx,
                            'ç›¸å¯¹ç´¢å¼•': relativeIdx,
                            'ä»·æ ¼': baseHigh.toFixed(4),
                            'æƒ…å†µ3': snapshot.scenario_3_count,
                            'æƒ…å†µ4': snapshot.scenario_4_count,
                            'æ€»å’Œ': snapshot.scenario_3_count + snapshot.scenario_4_count
                        });
                    }
                    
                    // ğŸ”¥ æ£€æŸ¥å5æ ¹Kçº¿ï¼Œæ‰¾åˆ°ç¬¬ä¸€æ ¹ä¸åˆ›æ–°é«˜çš„ï¼Œæˆ–è€…æ ‡è®°ç¬¬5æ ¹
                    let sellIdx = -1;
                    let sellReason = '';
                    
                    for (let j = 1; j <= 5 && (closestIdx + j) < allData.length; j++) {
                        const nextKline = allData[closestIdx + j];
                        const nextHigh = nextKline.data[1];
                        
                        // å¦‚æœä¸åˆ›æ–°é«˜ï¼Œæ ‡è®°è¿™æ ¹Kçº¿
                        if (nextHigh <= baseHigh) {
                            sellIdx = closestIdx + j;
                            sellReason = `åç¬¬${j}æ ¹ä¸åˆ›æ–°é«˜`;
                            break;
                        }
                        
                        // å¦‚æœæ˜¯ç¬¬5æ ¹ä¸”éƒ½åˆ›æ–°é«˜äº†ï¼Œæ ‡è®°ç¬¬5æ ¹
                        if (j === 5) {
                            sellIdx = closestIdx + 5;
                            sellReason = `å5æ ¹éƒ½åˆ›æ–°é«˜ï¼Œæ ‡è®°ç¬¬5æ ¹`;
                        }
                    }
                    
                    if (sellIdx === -1) {
                        console.log(`%c[å–ç‚¹2æ£€æµ‹] å¿«ç…§ ${snapshot.snapshot_time} åKçº¿æ•°æ®ä¸è¶³`, 'color: #ff9800; font-size: 10px');
                        continue;
                    }
                    
                    // ğŸ”¥ æ£€æŸ¥RSIæ¡ä»¶ï¼ˆå¿…é¡»>=50ï¼‰- é€šè¿‡timestampåŒ¹é…æŒ‡æ ‡æ•°æ®
                    const sellKline = allData[sellIdx];
                    const sellKlineTimestamp = sellKline.timestamp;
                    
                    // åœ¨æŒ‡æ ‡æ•°æ®ä¸­æ‰¾åˆ°åŒ¹é…çš„timestamp
                    const matchedIndicator = allIndicatorsData.find(ind => ind.timestamp === sellKlineTimestamp);
                    const sellKlineRSI = matchedIndicator?.rsi;
                    
                    if (!sellKlineRSI || sellKlineRSI < 50) {
                        console.log(`%c[å–ç‚¹2æ£€æµ‹] å¿«ç…§ ${snapshot.snapshot_time} RSIä¸æ»¡è¶³:`, 'color: #ff9800; font-size: 10px', {
                            'Kçº¿æ—¶é—´': new Date(parseInt(sellKlineTimestamp)).toLocaleString('zh-CN'),
                            'RSI': sellKlineRSI ? sellKlineRSI.toFixed(2) : 'null',
                            'è¦æ±‚': '>=50'
                        });
                        continue;
                    }
                    
                    // ğŸ”¥ v3.9.4 - å–ç‚¹2å…¨å±€æ£€æµ‹ï¼Œä¸é™åˆ¶é¡µé¢èŒƒå›´ï¼ˆå› ä¸ºæ˜¯é‡è¦ä¿¡å·ï¼‰
                    // æ£€æŸ¥æ˜¯å¦åœ¨å½“å‰é¡µé¢èŒƒå›´å†…
                    if (sellIdx >= pageStartIdx && sellIdx < pageEndIdx) {
                        const relativeIdx = sellIdx - pageStartIdx;
                        const sellHigh = sellKline.data[1];
                        
                        markPoints.push({
                            name: 'å–ç‚¹2',
                            coord: [relativeIdx, sellHigh],
                            value: 'å–ç‚¹2',
                            itemStyle: { 
                                color: '#10b981',
                                borderColor: '#fff',
                                borderWidth: 2
                            },
                            label: {
                                show: true,
                                formatter: `å–ç‚¹2\n${sellHigh.toFixed(4)}\nRSI=${sellKlineRSI.toFixed(1)}`,
                                position: 'top',
                                color: '#fff',
                                fontSize: 13,
                                fontWeight: 'bold',
                                backgroundColor: '#10b981',
                                padding: [6, 10],
                                borderRadius: 4,
                                borderColor: '#fff',
                                borderWidth: 1
                            },
                            symbolSize: 60
                        });
                        
                        console.log('%c[å–ç‚¹2ä¿¡å·] å·²ç”Ÿæˆæ ‡è®°!', 'color: #10b981; font-size: 14px; font-weight: bold; background: #fff; padding: 4px 8px', {
                            'å¿«ç…§æ—¶é—´': snapshot.snapshot_time,
                            'åŸºå‡†Kçº¿': new Date(parseInt(baseKline.timestamp)).toLocaleString('zh-CN'),
                            'å–ç‚¹Kçº¿': new Date(parseInt(sellKline.timestamp)).toLocaleString('zh-CN'),
                            'åŸå› ': sellReason,
                            'ä»·æ ¼': sellHigh.toFixed(4),
                            'RSI': sellKlineRSI.toFixed(2),
                            'æ”¯æ’‘å‹åŠ›': `æƒ…å†µ3=${snapshot.scenario_3_count}, æƒ…å†µ4=${snapshot.scenario_4_count}, æ€»å’Œ=${snapshot.scenario_3_count + snapshot.scenario_4_count}`
                        });
                    } else {
                        console.log(`%c[å–ç‚¹2] å–ç‚¹ä¸åœ¨å½“å‰é¡µé¢: sellIdx=${sellIdx}, é¡µé¢èŒƒå›´=[${pageStartIdx}, ${pageEndIdx})`, 'color: #ff9800; font-size: 10px', {
                            'å–ç‚¹Kçº¿': new Date(parseInt(sellKline.timestamp)).toLocaleString('zh-CN'),
                            'åŸå› ': sellReason,
                            'RSI': sellKlineRSI.toFixed(2)
                        });
                    }
                }
                
            } catch (error) {
                console.error('[å–ç‚¹2æ£€æµ‹] æŸ¥è¯¢æ”¯æ’‘å‹åŠ›å¿«ç…§å¤±è´¥:', error);
            }
            
            if (markPoints.length === 0) {
                console.log('%c[å–ç‚¹2æ£€æµ‹] æœªæ£€æµ‹åˆ°å–ç‚¹2ä¿¡å·', 'color: #ff9800; font-size: 11px');
            }
            
            return markPoints;
        }
        
        // ğŸ”¥ v3.9.9 - æ—§ç‰ˆæœ¬æ£€æµ‹å‡½æ•°ï¼ˆå·²å¼ƒç”¨ï¼Œä¿ç•™å¤‡ä»½ï¼‰
        async function calculateSell2Signals_OLD(allData, pageStartIdx, pageEndIdx) {
            const markPoints = [];
            
            // æ£€æµ‹é«˜ç‚¹å5æ ¹å†…ä¸åˆ›æ–°é«˜
            const sellSignals = detectHighNoNewHighWithin5Bars(allData, 0);
            
            // å¯¹æ¯ä¸ªå–å‡ºä¿¡å·ï¼ŒæŸ¥è¯¢å…¶å‰å5åˆ†é’Ÿçš„æ”¯æ’‘å‹åŠ›å¿«ç…§
            for (const signal of sellSignals) {
                const targetTime = parseInt(signal.timestamp);
                const fiveMinutes = 5 * 60 * 1000;  // 5åˆ†é’Ÿ = 300,000æ¯«ç§’
                
                try {
                    const response = await fetch(
                        `/api/support-resistance/snapshots-by-time?` +
                        `time_start=${targetTime - fiveMinutes}&` +
                        `time_end=${targetTime + fiveMinutes}`
                    );
                    const data = await response.json();
                    
                    if (data.success && data.snapshots && data.snapshots.length > 0) {
                        // æ£€æŸ¥æ˜¯å¦æœ‰ä»»ä½•å¿«ç…§æ»¡è¶³é€ƒé¡¶æ¡ä»¶ï¼ˆæƒ…å†µ3 + æƒ…å†µ4 >= 8ï¼‰
                        const matchingSnapshots = data.snapshots.filter(s => s.sell_signal);
                        const hasSellSignal = matchingSnapshots.length > 0;
                        
                        console.log('%c[å–ç‚¹2æ£€æµ‹] æŸ¥è¯¢å‰å5åˆ†é’Ÿæ”¯æ’‘å‹åŠ›å¿«ç…§:', 'color: #ef4444; font-size: 12px; font-weight: bold', {
                            'ç›®æ ‡æ—¶é—´': new Date(targetTime).toLocaleString('zh-CN'),
                            'æŸ¥è¯¢èŒƒå›´': `å‰å5åˆ†é’Ÿ`,
                            'å¿«ç…§æ•°é‡': data.snapshots.length,
                            'æ»¡è¶³æ¡ä»¶çš„å¿«ç…§': matchingSnapshots.length,
                            'ç»“è®º': hasSellSignal ? 'âœ… æ»¡è¶³é€ƒé¡¶æ¡ä»¶' : 'âŒ ä¸æ»¡è¶³'
                        });
                        
                        // è¾“å‡ºæ¯ä¸ªå¿«ç…§çš„è¯¦æƒ…
                        matchingSnapshots.forEach(s => {
                            console.log('%c  âœ… å¿«ç…§æ—¶é—´: ' + s.snapshot_time, 'color: #f87171', {
                                'æƒ…å†µ3': s.scenario_3_count,
                                'æƒ…å†µ4': s.scenario_4_count,
                                'æ€»å’Œ': s.scenario_3_count + s.scenario_4_count
                            });
                        });
                        
                        if (!hasSellSignal) {
                            console.log('%c[å–ç‚¹2æ£€æµ‹] å‰å5åˆ†é’Ÿå†…æ— æ»¡è¶³æ¡ä»¶çš„å¿«ç…§', 'color: #ff9800; font-size: 11px');
                            continue;  // è·³è¿‡è¿™ä¸ªä¿¡å·
                        }
                        
                        // å¦‚æœé€šè¿‡äº†æ”¯æ’‘å‹åŠ›æ£€æŸ¥ï¼Œç”Ÿæˆå–ç‚¹2æ ‡è®°
                        const relativeIdx = signal.globalIdx - pageStartIdx;
                        // æ£€æŸ¥æ˜¯å¦åœ¨å½“å‰é¡µé¢èŒƒå›´å†…
                        if (signal.globalIdx >= pageStartIdx && signal.globalIdx < pageEndIdx) {
                            // ä½¿ç”¨ç¬¬ä¸€ä¸ªåŒ¹é…çš„å¿«ç…§ä¿¡æ¯
                            const matchedSnapshot = matchingSnapshots[0];
                            
                            markPoints.push({
                                name: 'å–ç‚¹2',
                                coord: [relativeIdx, signal.high],
                                value: 'å–ç‚¹2',
                                itemStyle: { 
                                    color: '#10b981',
                                    borderColor: '#fff',
                                    borderWidth: 2
                                },
                                label: {
                                    show: true,
                                    formatter: 'å–ç‚¹2\n' + signal.high.toFixed(4),
                                    position: 'top',
                                    color: '#fff',
                                    fontSize: 13,
                                    fontWeight: 'bold',
                                    backgroundColor: '#10b981',
                                    padding: [6, 10],
                                    borderRadius: 4,
                                    borderColor: '#fff',
                                    borderWidth: 1
                                },
                                symbolSize: 60
                            });
                            
                            console.log('%c[å–ç‚¹2ä¿¡å·] å·²ç”Ÿæˆæ ‡è®°!', 'color: #10b981; font-size: 14px; font-weight: bold; background: #fff; padding: 4px 8px', {
                                'ä½ç½®': `ç´¢å¼• ${signal.globalIdx}`,
                                'ä»·æ ¼': signal.high.toFixed(4),
                                'åŸå› ': signal.reason,
                                'é«˜ç‚¹ä¿¡æ¯': `ç´¢å¼•${signal.highPointIdx}, ä»·æ ¼${signal.highPointPrice.toFixed(4)}`,
                                'æ”¯æ’‘å‹åŠ›': `æƒ…å†µ3=${matchedSnapshot.scenario_3_count}, æƒ…å†µ4=${matchedSnapshot.scenario_4_count}, æ€»å’Œ=${matchedSnapshot.scenario_3_count + matchedSnapshot.scenario_4_count}`
                            });
                        }
                    } else {
                        console.log('%c[å–ç‚¹2æ£€æµ‹] æœªæŸ¥è¯¢åˆ°æ”¯æ’‘å‹åŠ›å¿«ç…§', 'color: #ff9800; font-size: 11px', {
                            'ç›®æ ‡æ—¶é—´': new Date(targetTime).toLocaleString('zh-CN')
                        });
                        continue;
                    }
                } catch (error) {
                    console.error('[å–ç‚¹2æ£€æµ‹] æŸ¥è¯¢æ”¯æ’‘å‹åŠ›å¿«ç…§å¤±è´¥:', error);
                    continue;
                }
            }
            
            return markPoints;
        }
        
        // æ¸²æŸ“å½“å‰é¡µæ•°æ®
        async function renderCurrentPage() {
            console.log('%c[DEBUG] renderCurrentPage è¢«è°ƒç”¨', 'color: #ff4444; font-weight: bold;');
            console.trace('[TRACE] renderCurrentPage è°ƒç”¨å †æ ˆ');
            const recordsPerPage = RECORDS_PER_PAGE[currentTimeframe];
            const totalPages = Math.ceil(allKlineData.length / recordsPerPage);
            
            // è®¡ç®—å½“å‰é¡µæ•°æ®èŒƒå›´ï¼ˆä»æœ€æ–°æ•°æ®å¼€å§‹ï¼‰
            const startIdx = Math.max(0, allKlineData.length - (currentPage + 1) * recordsPerPage);
            const endIdx = allKlineData.length - currentPage * recordsPerPage;
            
            const pageKlineData = allKlineData.slice(startIdx, endIdx);
            
            // ğŸ”¥ å…³é”®ä¿®å¤ï¼šåŸºäºtimestampå¯¹é½æŒ‡æ ‡æ•°æ®ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ç›¸åŒç´¢å¼•
            // åˆ›å»ºä¸€ä¸ªtimestampåˆ°æŒ‡æ ‡çš„æ˜ å°„
            const indicatorsByTimestamp = {};
            allIndicatorsData.forEach(ind => {
                indicatorsByTimestamp[ind.timestamp] = ind;
            });
            
            // ä¸ºæ¯ä¸ªKçº¿æ‰¾åˆ°åŒ¹é…çš„æŒ‡æ ‡æ•°æ®
            const pageIndicatorsData = pageKlineData.map(kline => {
                return indicatorsByTimestamp[kline.timestamp] || {
                    timestamp: kline.timestamp,
                    sar: null,
                    bb_upper: null,
                    bb_middle: null,
                    bb_lower: null,
                    rsi: null
                };
            });
            
            // ğŸ¯ åŸºäºæ•´ä¸ªæ•°æ®é›†è®¡ç®—48å°æ—¶å’Œ7å¤©çš„æå€¼ç‚¹
            const globalMarkPoints = calculateGlobalHighLowPoints(allKlineData, startIdx, endIdx);
            
            // ğŸ”¥ v3.9.1 - è®¡ç®—ä¹°å…¥4ä¿¡å·ï¼ˆå¼‚æ­¥æŸ¥è¯¢æ”¯æ’‘å‹åŠ›ï¼‰
            const buy4Signals = await calculateBuy4Signals(allKlineData, startIdx, endIdx);
            
            // ğŸ”¥ v3.9.9 - æ ‡è®°æ”¯æ’‘å‹åŠ›æœ€æ–°æ—¶é—´
            const latestTimeMarkers = await markLatestSupportResistanceTime(allKlineData, startIdx, endIdx);
            
            // ğŸ”¥ å…ˆæ¸²æŸ“å›¾è¡¨ï¼ˆåŒ…å«åŸºç¡€æ ‡è®°ã€ä¹°å…¥4ä¿¡å·å’Œæœ€æ–°æ—¶é—´æ ‡è®°ï¼‰ï¼Œä¸ç­‰å¾…å–ç‚¹2æ£€æµ‹å®Œæˆ
            const initialMarkPoints = [...globalMarkPoints, ...buy4Signals, ...latestTimeMarkers];
            renderCharts(pageKlineData, pageIndicatorsData, initialMarkPoints);
            updatePagination(totalPages);
            
            // ğŸ”¥ v3.9.9 - å–ç‚¹2ä¿¡å·åœ¨åå°å¼‚æ­¥æ£€æµ‹ï¼ˆä¸é˜»å¡å›¾è¡¨æ˜¾ç¤ºï¼‰
            calculateSell2Signals(allKlineData, startIdx, endIdx).then(sell2Signals => {
                if (sell2Signals.length > 0) {
                    console.log(`%c[å–ç‚¹2] æ£€æµ‹å®Œæˆï¼Œå‘ç° ${sell2Signals.length} ä¸ªå–ç‚¹2ä¿¡å·ï¼Œæ­£åœ¨æ›´æ–°å›¾è¡¨...`, 'color: #ef4444; font-size: 12px; font-weight: bold');
                    // é‡æ–°æ¸²æŸ“å›¾è¡¨ï¼Œæ·»åŠ å–ç‚¹2ä¿¡å·å’Œæœ€æ–°æ—¶é—´æ ‡è®°
                    const allMarkPoints = [...globalMarkPoints, ...buy4Signals, ...latestTimeMarkers, ...sell2Signals];
                    renderCharts(pageKlineData, pageIndicatorsData, allMarkPoints);
                } else {
                    console.log(`%c[å–ç‚¹2] æ£€æµ‹å®Œæˆï¼Œå½“å‰é¡µé¢æ— å–ç‚¹2ä¿¡å·`, 'color: #ff9800; font-size: 11px');
                }
            });
            
            if (pageIndicatorsData.length > 0 && pageIndicatorsData[pageIndicatorsData.length - 1].sar !== null) {
                updateStats(pageIndicatorsData[pageIndicatorsData.length - 1]);
            }
        }
        
        // æ›´æ–°åˆ†é¡µæŒ‰é’®
        function updatePagination(totalPages) {
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const pageInfo = document.getElementById('page-info');
            
            prevBtn.disabled = currentPage >= totalPages - 1;
            nextBtn.disabled = currentPage === 0;
            
            pageInfo.textContent = `ç¬¬ ${currentPage + 1} / ${totalPages} é¡µ`;
        }
        
        // ä¸Šä¸€é¡µ
        function prevPage() {
            currentPage++;
            renderCurrentPage();
        }
        
        // ä¸‹ä¸€é¡µ
        function nextPage() {
            if (currentPage > 0) {
                currentPage--;
                renderCurrentPage();
            }
        }
        
        // è®¡ç®—æ—¥æœŸåˆ†å‰²çº¿
        function getDateSeparators(times) {
            const separators = [];
            let lastDate = null;
            
            times.forEach((time, index) => {
                const date = new Date(parseInt(time)).toLocaleDateString('zh-CN');
                if (lastDate && date !== lastDate) {
                    separators.push({
                        xAxis: index,
                        label: { formatter: date }
                    });
                }
                lastDate = date;
            });
            
            return separators;
        }
        
        // ğŸ”¥ å…¨å±€å˜é‡ï¼šä¾›ECharts tooltipè®¿é—®ï¼ˆtooltipæ˜¯é—­åŒ…å‡½æ•°ï¼Œéœ€è¦å…¨å±€ä½œç”¨åŸŸï¼‰
        let globalMarkPoints = [];
        let longSellPoint1Markers = [];
        let lowVolatilityMarkers = [];
        // æ³¨æ„ï¼šallKlineDataã€allIndicatorsDataã€globalOhlcç­‰å·²åœ¨å…¨å±€å£°æ˜
        
        // æ¸²æŸ“å›¾è¡¨
        function renderCharts(klineData, indicatorsData, inputMarkPoints = []) {
            console.log('%c[DEBUG] renderCharts è¢«è°ƒç”¨', 'color: #ff4444; font-weight: bold;');
            console.log('ğŸ” å½“å‰ APP_INITIALIZED å€¼:', APP_INITIALIZED);
            console.log('ğŸ” typeof APP_INITIALIZED:', typeof APP_INITIALIZED);
            console.trace('[TRACE] renderCharts è°ƒç”¨å †æ ˆ');
            
            // ğŸ”¥ CRITICAL: é˜²æ­¢åœ¨åˆå§‹åŒ–å‰è¿è¡Œ
            if (APP_INITIALIZED !== true) {
                console.error('%câŒâŒâŒ renderCharts è¢«è¿‡æ—©è°ƒç”¨ï¼APPå°šæœªåˆå§‹åŒ–ï¼Œå¿½ç•¥æ­¤æ¬¡è°ƒç”¨', 'color: #ff0000; font-size: 20px; font-weight: bold;');
                console.error('APP_INITIALIZED =', APP_INITIALIZED);
                console.trace('è¿‡æ—©è°ƒç”¨çš„å †æ ˆ:');
                return; // ç›´æ¥è¿”å›ï¼Œä¸æ‰§è¡Œä»»ä½•æ¸²æŸ“
            }
            
            console.log('âœ… APP_INITIALIZED check passed, ç»§ç»­æ¸²æŸ“');
            // æ›´æ–°å…¨å±€å˜é‡ä¾›tooltipé—­åŒ…è®¿é—®
            globalMarkPoints = inputMarkPoints;
            globalKlineData = klineData;
            globalIndicatorsData = indicatorsData;
            console.log('renderCharts è¢«è°ƒç”¨:', {
                klineDataLength: klineData.length,
                indicatorsDataLength: indicatorsData.length,
                klineChartExists: !!klineChart,
                firstKline: klineData[0],
                firstIndicator: indicatorsData[0]
            });
            
            // å°†timesä¿å­˜åˆ°å…¨å±€å˜é‡ï¼ˆä¾›xAxisä½¿ç”¨ï¼‰
            globalTimes = klineData.map(item => {
                const date = new Date(parseInt(item.timestamp));
                return date.toLocaleString('zh-CN', { 
                    timeZone: 'Asia/Shanghai',
                    month: '2-digit', day: '2-digit', 
                    hour: '2-digit', minute: '2-digit' 
                });
            });
            const times = globalTimes;
            
            const ohlc = klineData.map(item => item.data);
            globalOhlc = ohlc;  // æ›´æ–°å…¨å±€å˜é‡ä¾›tooltipä½¿ç”¨
            const volumes = klineData.map(item => item.volume);
            globalVolumes = volumes; // æ›´æ–°å…¨å±€å˜é‡ä¾›chart seriesä½¿ç”¨
            
            // [v6.0] è°ƒè¯•æ•°æ®ç»“æ„
            console.log('%c========================================', 'color: #ff4444; font-size: 14px; font-weight: bold');
            console.log('%c[v6.0 æ•°æ®éªŒè¯] Kçº¿æ•°æ®ç»“æ„æ£€æŸ¥', 'color: #ff4444; font-size: 14px; font-weight: bold');
            console.log('%c========================================', 'color: #ff4444; font-size: 14px; font-weight: bold');
            console.log('[v6.0] First K-line raw data:', klineData[0]);
            console.log('[v6.0] First OHLC array:', ohlc[0]);
            console.log('%c[v6.0] OHLCæ ¼å¼: [å¼€ç›˜, æœ€é«˜, æœ€ä½, æ”¶ç›˜]', 'color: #00d4aa; font-weight: bold');
            console.log('[v6.0] è§£æåçš„å€¼:', {
                å¼€ç›˜ä»·: ohlc[0][0],
                æœ€é«˜ä»·: ohlc[0][1],
                æœ€ä½ä»·: ohlc[0][2],
                æ”¶ç›˜ä»·: ohlc[0][3],
                æˆäº¤é‡: volumes[0]
            });
            console.log('%c========================================', 'color: #ff4444; font-size: 14px; font-weight: bold');
            
            // ä½¿ç”¨indicators APIæä¾›çš„çœŸå®æ•°æ®ï¼ˆä¸Kçº¿timestampå¯¹é½ï¼‰
            const rsi = indicatorsData.map(item => item.rsi);
            globalRsi = rsi;  // æ›´æ–°å…¨å±€å˜é‡ä¾›tooltipä½¿ç”¨
            const sar = indicatorsData.map(item => item.sar);
            globalSar = sar;  // æ›´æ–°å…¨å±€å˜é‡ä¾›tooltipä½¿ç”¨
            const bbUpper = indicatorsData.map(item => item.bb_upper);
            globalBbUpper = bbUpper; // æ›´æ–°å…¨å±€å˜é‡ä¾›chart seriesä½¿ç”¨
            const bbMiddle = indicatorsData.map(item => item.bb_middle);
            globalBbMiddle = bbMiddle; // æ›´æ–°å…¨å±€å˜é‡ä¾›chart seriesä½¿ç”¨
            const bbLower = indicatorsData.map(item => item.bb_lower);
            globalBbLower = bbLower; // æ›´æ–°å…¨å±€å˜é‡ä¾›chart seriesä½¿ç”¨
            
            // æ£€æŸ¥æ•°æ®å€¼èŒƒå›´
            const ohlcValues = ohlc.flat().filter(v => v !== null);
            const sarValues = sar.filter(v => v !== null && v !== undefined);
            const bbValues = [...bbUpper, ...bbMiddle, ...bbLower].filter(v => v !== null && v !== undefined);
            
            console.log('æ•°æ®æ•°ç»„:', {
                times: times.length,
                ohlc: ohlc.length,
                volumes: volumes.length,
                sar: sar.length,
                bbUpper: bbUpper.length,
                bbMiddle: bbMiddle.length,
                bbLower: bbLower.length
            });
            
            console.log('æ•°æ®å€¼èŒƒå›´:', {
                ohlcRange: `${Math.min(...ohlcValues).toFixed(4)} - ${Math.max(...ohlcValues).toFixed(4)}`,
                sarRange: sarValues.length > 0 ? `${Math.min(...sarValues).toFixed(4)} - ${Math.max(...sarValues).toFixed(4)}` : 'No values',
                bbRange: bbValues.length > 0 ? `${Math.min(...bbValues).toFixed(4)} - ${Math.max(...bbValues).toFixed(4)}` : 'No values',
                sarValidCount: sarValues.length,
                bbValidCount: bbValues.length
            });
            
            console.log('æ ·æœ¬æ•°æ®:', {
                firstOhlc: ohlc[0],
                firstSar: sar[0],
                firstBbUpper: bbUpper[0],
                firstBbMiddle: bbMiddle[0],
                firstBbLower: bbLower[0],
                lastOhlc: ohlc[ohlc.length-1],
                lastSar: sar[sar.length-1],
                lastBbUpper: bbUpper[bbUpper.length-1]
            });
            
            // ğŸ”¥ æ£€æµ‹ä½æ³¢åŠ¨Kçº¿è¿ç»­åºåˆ—ï¼ˆæ¶¨è·Œå¹…â‰¤0.25% ä¸” éœ‡è¡å¹…åº¦â‰¤0.50%ï¼‰
            lowVolatilityMarkers = [];  // é‡ç½®å…¨å±€å˜é‡
            let consecutiveCount = 0;
            let consecutiveStart = -1;
            
            for (let i = 0; i < ohlc.length; i++) {
                const [open, close, low, high] = ohlc[i];
                const changePct = (close - open) / open * 100;  // ä¸å–ç»å¯¹å€¼ï¼Œä¿ç•™æ­£è´Ÿ
                const volatilityPct = (high - low) / open * 100;  // éœ‡è¡å¹…åº¦ï¼ˆæ€»æ˜¯æ­£å€¼ï¼‰
                
                // åˆ¤æ–­æ˜¯å¦ç¬¦åˆä½æ³¢åŠ¨æ¡ä»¶ï¼šæ¶¨è·Œå¹…åœ¨ 0% åˆ° +0.25% ä¹‹é—´ ä¸” éœ‡è¡å¹…åº¦ â‰¤ 0.50%
                if (changePct >= 0 && changePct <= 0.25 && volatilityPct <= 0.50) {
                    if (consecutiveCount === 0) {
                        consecutiveStart = i;
                    }
                    consecutiveCount++;
                } else {
                    // å¦‚æœä¹‹å‰æœ‰è¿ç»­çš„ï¼Œè®°å½•ä¸‹æ¥
                    if (consecutiveCount >= 2) {
                        lowVolatilityMarkers.push({
                            start: consecutiveStart,
                            end: consecutiveStart + consecutiveCount - 1,
                            count: consecutiveCount
                        });
                    }
                    consecutiveCount = 0;
                    consecutiveStart = -1;
                }
            }
            
            // å¤„ç†æœ€åä¸€æ®µè¿ç»­åºåˆ—
            if (consecutiveCount >= 2) {
                lowVolatilityMarkers.push({
                    start: consecutiveStart,
                    end: consecutiveStart + consecutiveCount - 1,
                    count: consecutiveCount
                });
            }
            
            console.log('%c[ä½æ³¢åŠ¨Kçº¿æ£€æµ‹] ç¬¦åˆæ¡ä»¶çš„è¿ç»­åºåˆ—:', 'color: #ffa500; font-size: 14px; font-weight: bold', lowVolatilityMarkers);
            
            // ğŸ”¥ v7.0 - ä¸´æ—¶ç¦ç”¨å–ç‚¹1æ£€æµ‹ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰
            longSellPoint1Markers = [];  // é‡ç½®å…¨å±€å˜é‡
            
            // è·³è¿‡å–ç‚¹1æ£€æµ‹ä»£ç å—
            if (false) {  // è®¾ç½®ä¸º false å®Œå…¨è·³è¿‡
            const processedHighPoints = new Set();
            
            // éå†æ‰€æœ‰å¯èƒ½çš„çª—å£ï¼ˆæ¯ä¸ªä½ç½®éƒ½çœ‹å‰30æ ¹æ‰¾æœ€é«˜ç‚¹ï¼‰
            for (let i = 0; i < ohlc.length && !SKIP_SELLPOINT1; i++) {
                // ç¡®å®šçª—å£èŒƒå›´ï¼šå¦‚æœå‰é¢ä¸è¶³30æ ¹ï¼Œå°±ç”¨æ‰€æœ‰å¯ç”¨çš„Kçº¿
                const windowStart = Math.max(0, i - 29);
                const windowSize = i - windowStart + 1;
                
                // å¦‚æœçª—å£å¤ªå°ï¼ˆå°‘äº10æ ¹ï¼‰åˆ™è·³è¿‡
                if (windowSize < 10) continue;
                
                // åœ¨çª—å£å†…æ‰¾æœ€é«˜ç‚¹
                let maxHighIdx = windowStart;
                let maxHigh = ohlc[windowStart][3];  // [open, close, low, high]
                
                for (let j = windowStart + 1; j <= i; j++) {
                    if (ohlc[j][3] > maxHigh) {
                        maxHigh = ohlc[j][3];
                        maxHighIdx = j;
                    }
                }
                
                // å…³é”®ï¼šåªæœ‰å½“å‰ä½ç½®iå°±æ˜¯è¿™ä¸ªçª—å£çš„æœ€é«˜ç‚¹æ—¶æ‰å¤„ç†
                if (maxHighIdx !== i) continue;
                
                // é¿å…é‡å¤å¤„ç†åŒä¸€ä¸ªæœ€é«˜ç‚¹
                if (processedHighPoints.has(maxHighIdx)) continue;
                
                // ç¡®ä¿æœ€é«˜ç‚¹åé¢æœ‰è‡³å°‘6æ ¹Kçº¿
                if (maxHighIdx + 6 >= ohlc.length) continue;
                
                processedHighPoints.add(maxHighIdx);
                    
                    // ğŸ”¥ æ–°å¢æ¡ä»¶1ï¼šæ£€æŸ¥40æ ¹Kçº¿è·ç¦»é™åˆ¶ï¼ˆé¿å…æ ‡è®°è¿‡å¯†ï¼‰
                    let tooCloseToExisting = false;
                    for (let existingMarker of longSellPoint1Markers) {
                        const distance = Math.abs(maxHighIdx - existingMarker.highPointIdx);
                        if (distance < 40) {
                            tooCloseToExisting = true;
                            break;
                        }
                    }
                    
                    if (tooCloseToExisting) {
                        continue;  // è·³è¿‡è¿™ä¸ªæœ€é«˜ç‚¹
                    }
                    
                    // ğŸ”¥ æ–°å¢æ¡ä»¶2ï¼šåˆ¤æ–­æ˜¯å¦åœ¨ä¸‹è·Œé€šé“ï¼ˆæœ€é«˜ç‚¹å‰å30æ ¹å‡ä»·å¯¹æ¯”ï¼‰
                    if (maxHighIdx >= 29 && maxHighIdx + 30 < ohlc.length) {  // ç¡®ä¿æœ€é«˜ç‚¹å‰åéƒ½æœ‰30æ ¹æ•°æ®
                        // è®¡ç®—æœ€é«˜ç‚¹å‰30æ ¹çš„å¹³å‡æ”¶ç›˜ä»·ï¼ˆåŒ…æ‹¬æœ€é«˜ç‚¹ï¼‰
                        let sumå‰30 = 0;
                        for (let j = maxHighIdx - 29; j <= maxHighIdx; j++) {
                            sumå‰30 += ohlc[j][1];  // æ”¶ç›˜ä»·
                        }
                        const avgå‰30 = sumå‰30 / 30;
                        
                        // è®¡ç®—æœ€é«˜ç‚¹å30æ ¹çš„å¹³å‡æ”¶ç›˜ä»·
                        let sumå30 = 0;
                        for (let j = maxHighIdx + 1; j <= maxHighIdx + 30; j++) {
                            sumå30 += ohlc[j][1];  // æ”¶ç›˜ä»·
                        }
                        const avgå30 = sumå30 / 30;
                        
                        // å¦‚æœæœ€é«˜ç‚¹å‰30æ ¹å‡ä»· > å30æ ¹å‡ä»·ï¼Œè¯´æ˜ä»é«˜ç‚¹å¼€å§‹ä¸‹è·Œï¼Œè·³è¿‡
                        if (avgå‰30 > avgå30) {
                            console.log(`%c[å–ç‚¹1è¿‡æ»¤] æœ€é«˜ç‚¹${maxHighIdx}åœ¨ä¸‹è·Œé€šé“ï¼Œè·³è¿‡ (å‰30å‡ä»·:${avgå‰30.toFixed(4)} > å30å‡ä»·:${avgå30.toFixed(4)})`, 'color: #ff8800');
                            continue;
                        }
                    }
                    
                    // ğŸ”¥ æ–°å¢æ¡ä»¶3ï¼š24å°æ—¶ä½ç½®è¿‡æ»¤ï¼ˆæœ€é«˜ç‚¹ä»·æ ¼å¿…é¡» > 24å°æ—¶åŒºé—´çš„70%ä½ç½®ï¼‰
                    // 24å°æ—¶ = 288æ ¹5åˆ†é’ŸKçº¿
                    const h24KlineCount = 288;
                    if (maxHighIdx >= h24KlineCount) {  // ç¡®ä¿æœ‰24å°æ—¶å†å²æ•°æ®
                        // æ‰¾åˆ°è¿‡å»24å°æ—¶çš„æœ€é«˜ä»·å’Œæœ€ä½ä»·
                        let h24High = ohlc[maxHighIdx - h24KlineCount][3];
                        let h24Low = ohlc[maxHighIdx - h24KlineCount][2];
                        
                        for (let j = maxHighIdx - h24KlineCount + 1; j <= maxHighIdx; j++) {
                            if (ohlc[j][3] > h24High) h24High = ohlc[j][3];
                            if (ohlc[j][2] < h24Low) h24Low = ohlc[j][2];
                        }
                        
                        // è®¡ç®—70%ä½ç½®ï¼šæœ€ä½ä»· + (æœ€é«˜ä»· - æœ€ä½ä»·) Ã— 70%
                        const h24Range = h24High - h24Low;
                        const position70 = h24Low + h24Range * 0.7;
                        
                        // å¦‚æœæœ€é«˜ç‚¹ä»·æ ¼ <= 70%ä½ç½®ï¼Œè¯´æ˜ä½ç½®å¤ªä½ï¼Œè·³è¿‡
                        if (maxHigh <= position70) {
                            console.log(`%c[å–ç‚¹1è¿‡æ»¤] æœ€é«˜ç‚¹${maxHighIdx}ä½ç½®å¤ªä½ï¼Œè·³è¿‡ (ä»·æ ¼:${maxHigh.toFixed(4)} <= 70%ä½:${position70.toFixed(4)}, 24HèŒƒå›´:${h24Low.toFixed(4)}-${h24High.toFixed(4)})`, 'color: #ff8800');
                            continue;
                        }
                    }
                    
                    // æ£€æŸ¥æœ€é«˜ç‚¹å6æ ¹Kçº¿æ˜¯å¦æœ‰è¿ç»­3ä¸ªéœ‡è¡
                    let hasConsecutive3Oscillation = false;
                    let oscCount = 0;
                    
                    for (let k = maxHighIdx + 1; k <= maxHighIdx + 6; k++) {
                        const [open, close, low, high] = ohlc[k];
                        const changePct = (close - open) / open * 100;
                        const volatilityPct = (high - low) / open * 100;
                        
                        if (changePct >= 0 && changePct <= 0.25 && volatilityPct <= 0.50) {
                            oscCount++;
                            if (oscCount >= 3) {
                                hasConsecutive3Oscillation = true;
                                break;
                            }
                        } else {
                            oscCount = 0;  // é‡ç½®è®¡æ•°
                        }
                    }
                    
                    // å¦‚æœæœ€é«˜ç‚¹å6æ ¹Kçº¿æ²¡æœ‰è¿ç»­3ä¸ªéœ‡è¡ï¼Œæ£€æŸ¥æ˜¯å¦å¯ä»¥æ ‡è®°ä¸ºåšå¤šå–ç‚¹1
                    if (!hasConsecutive3Oscillation) {
                        const sellPointIdx = maxHighIdx + 6;  // æœ€é«˜ç‚¹åç¬¬6æ ¹
                        const sellPointPrice = ohlc[sellPointIdx][1];  // ä½¿ç”¨æ”¶ç›˜ä»·
                        
                        // ğŸ”¥ æ–°å¢æ¡ä»¶4ï¼šRSIè¿‡æ»¤ï¼ˆå–ç‚¹1æ ‡è®°ä½ç½®çš„RSIå¿…é¡» >= 60ï¼‰
                        const sellPointRsi = rsi[sellPointIdx];
                        
                        console.log(`%c[RSIæ£€æŸ¥] æ ‡è®°ç‚¹${sellPointIdx}, RSI=${sellPointRsi}, ç±»å‹=${typeof sellPointRsi}`, 'color: #00ffff; font-weight: bold');
                        
                        // å¦‚æœå–ç‚¹ä½ç½®çš„RSIæ•°æ®ç¼ºå¤±ï¼Œè·³è¿‡ï¼ˆä¿å®ˆå¤„ç†ï¼‰
                        if (sellPointRsi === null || sellPointRsi === undefined) {
                            console.log(`%c[å–ç‚¹1è¿‡æ»¤] æ ‡è®°ç‚¹${sellPointIdx}çš„RSIæ•°æ®ç¼ºå¤±ï¼Œè·³è¿‡`, 'color: #ff8800');
                            continue;
                        }
                        
                        // ğŸ”¥ å…³é”®ï¼šå¦‚æœå–ç‚¹ä½ç½®çš„RSI < 60ï¼Œè·³è¿‡
                        if (sellPointRsi < 60) {
                            console.log(`%c[å–ç‚¹1è¿‡æ»¤] æ ‡è®°ç‚¹${sellPointIdx}çš„RSIå¤ªä½ï¼Œè·³è¿‡ (RSI:${sellPointRsi.toFixed(2)} < 60)`, 'color: #ff8800');
                            continue;
                        }
                        
                        console.log(`%c[RSIæ£€æŸ¥é€šè¿‡] æ ‡è®°ç‚¹${sellPointIdx}, RSI=${sellPointRsi.toFixed(2)} >= 60`, 'color: #00ff00; font-weight: bold');
                        
                        // è·å–æœ€é«˜ç‚¹çš„RSIç”¨äºå‚è€ƒ
                        const highPointRsi = rsi[maxHighIdx];
                        console.log(`%c[å–ç‚¹1æ ‡è®°] æœ€é«˜ç‚¹idx=${maxHighIdx}, RSI=${highPointRsi?.toFixed(2)}, æ ‡è®°ç‚¹idx=${sellPointIdx}, RSI=${sellPointRsi.toFixed(2)}`, 'color: #00ff00; font-weight: bold');
                        
                        // ä¿å­˜å–ç‚¹1åˆ°æ•°æ®åº“
                        const sellPoint1Data = {
                            symbol: symbolParam,
                            high_price: maxHigh,
                            high_time: new Date(allKlineData[maxHighIdx].timestamp).toLocaleString('sv-SE', {timeZone: 'Asia/Shanghai'}).replace('T', ' ').substring(0, 19),
                            high_index: maxHighIdx,
                            mark_price: sellPointPrice,
                            mark_time: new Date(allKlineData[sellPointIdx].timestamp).toLocaleString('sv-SE', {timeZone: 'Asia/Shanghai'}).replace('T', ' ').substring(0, 19),
                            mark_index: sellPointIdx,
                            mark_rsi: sellPointRsi
                        };
                        
                        // å¼‚æ­¥ä¿å­˜åˆ°æ•°æ®åº“
                        fetch('/api/sell-point-1/save', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(sellPoint1Data)
                        })
                        .then(response => response.json())
                        .then(result => {
                            if (result.success) {
                                console.log(`%c[å–ç‚¹1ä¿å­˜æˆåŠŸ] ${symbolParam} ä¿¡å·ID:${result.signal_id || 'å·²å­˜åœ¨'}`, 'color: #00ff00; font-weight: bold');
                            } else {
                                console.error(`%c[å–ç‚¹1ä¿å­˜å¤±è´¥] ${symbolParam} é”™è¯¯:${result.error}`, 'color: #ff0000');
                            }
                        })
                        .catch(error => {
                            console.error(`%c[å–ç‚¹1ä¿å­˜å¼‚å¸¸] ${symbolParam}`, 'color: #ff0000', error);
                        });
                        
                        longSellPoint1Markers.push({
                            coord: [sellPointIdx, sellPointPrice],
                            value: sellPointPrice.toFixed(4),
                            xIndex: sellPointIdx,
                            highPointIdx: maxHighIdx,  // è®°å½•å¯¹åº”çš„æœ€é«˜ç‚¹ä½ç½®
                            highPointRsi: highPointRsi,   // è®°å½•æœ€é«˜ç‚¹çš„RSIï¼ˆç”¨äºå‚è€ƒï¼‰
                            sellPointRsi: sellPointRsi    // ğŸ”¥ è®°å½•å–ç‚¹çš„RSIï¼ˆè¿™æ‰æ˜¯è¿‡æ»¤æ¡ä»¶ï¼‰
                        });
                    }
                }
            }
            }  // ç»“æŸ if (!SKIP_SELLPOINT1_COMPLETELY) åˆ†æ”¯
            
            // åŸæœ‰çš„ CHECKPOINT 2 ä¼šè¢«ä¸Šé¢çš„å¼ºåˆ¶è·³è¿‡ç‰ˆæœ¬è¦†ç›–
            console.log('%c[åšå¤šå–ç‚¹1æ£€æµ‹] ç¬¦åˆæ¡ä»¶çš„å–ç‚¹:', 'color: #ff4444; font-size: 14px; font-weight: bold', longSellPoint1Markers);
            console.log('ğŸš¨ [TEST AFTER CHECKPOINT 2] ä»£ç ç»§ç»­æ‰§è¡Œä¸­...');
            
            // ğŸ¯ ä½¿ç”¨ä¼ å…¥çš„å…¨å±€æ ‡è®°ç‚¹ï¼ˆåŸºäºæ•´ä¸ªæ•°æ®é›†è®¡ç®—ï¼‰
            console.log('ğŸš¨ [TEST] å‡†å¤‡è¯»å– globalMarkPoints...');
            const markPoints = globalMarkPoints;
            console.log('ğŸš¨ [TEST] globalMarkPoints è¯»å–æˆåŠŸ:', markPoints);
            console.log('%c[æ ‡è®°ç‚¹åº”ç”¨] å½“å‰é¡µé¢æ˜¾ç¤ºçš„æ ‡è®°:', 'color: #ffd93d; font-size: 12px; font-weight: bold', markPoints);
            
            // æ—¥æœŸåˆ†å‰²çº¿
            const dateSeparators = getDateSeparators(allKlineData.map(item => item.timestamp));
            
            // æ›´æ–°æ—¥æœŸèŒƒå›´æ˜¾ç¤º
            if (allKlineData.length > 0) {
                const startDate = new Date(parseInt(allKlineData[0].timestamp)).toLocaleString('zh-CN', { timeZone: 'Asia/Shanghai' });
                const endDate = new Date(parseInt(allKlineData[allKlineData.length - 1].timestamp)).toLocaleString('zh-CN', { timeZone: 'Asia/Shanghai' });
                document.getElementById('date-range').textContent = `${startDate} ~ ${endDate}`;
            }
            
            console.log('ğŸ¯ [CHECKPOINT 3] æ ‡è®°ç‚¹å‡†å¤‡å®Œæˆï¼Œå¼€å§‹æ„å»º klineOption');
            console.log('ğŸ¯ klineChart å­˜åœ¨å—?', !!klineChart);
            console.log('ğŸ¯ globalTimes é•¿åº¦:', globalTimes.length);
            console.log('ğŸ¯ globalOhlc é•¿åº¦:', globalOhlc.length);
            
            // Kçº¿å›¾é…ç½®
            const klineOption = {
                backgroundColor: 'transparent',
                legend: {
                    data: ['Kçº¿', 'å¸ƒæ—ä¸Šè½¨', 'å¸ƒæ—ä¸­è½¨', 'å¸ƒæ—ä¸‹è½¨', 'SAR', 'æˆäº¤é‡'],
                    top: '1%',
                    left: 'center',
                    textStyle: {
                        color: '#888',
                        fontSize: 12
                    },
                    icon: 'roundRect',
                    itemWidth: 12,
                    itemHeight: 8,
                    itemGap: 15
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: { type: 'cross' },
                    backgroundColor: 'rgba(26, 29, 41, 0.95)',
                    borderColor: '#2d3348',
                    textStyle: { color: '#e0e0e0' },
                    formatter: function(params) {
                        try {
                            let result = `<b>${params[0].axisValue}</b><br/>`;
                            
                            params.forEach(item => {
                                if (item.seriesName === 'Kçº¿') {
                                    // ECharts candlestick data: [open, close, low, high]
                                    const ohlc = item.data;
                                    if (ohlc && ohlc.length >= 4) {
                                        result += `å¼€: ${ohlc[0].toFixed(3)}<br/>`;
                                        result += `æ”¶: ${ohlc[1].toFixed(3)}<br/>`;
                                        result += `ä½: ${ohlc[2].toFixed(3)}<br/>`;
                                        result += `é«˜: ${ohlc[3].toFixed(3)}<br/>`;
                                        
                                        const change = ((ohlc[1] - ohlc[0]) / ohlc[0] * 100).toFixed(2);
                                        const color = change >= 0 ? '#00d4aa' : '#ff4444';
                                        result += `<span style="color:${color}">æ¶¨è·Œ: ${change}%</span><br/>`;
                                    }
                                } else if (item.seriesName === 'æˆäº¤é‡') {
                                    result += `<span style="color:${item.color}">æˆäº¤é‡: ${item.data}</span><br/>`;
                                } else if (item.seriesName === 'SAR') {
                                    result += `<span style="color:${item.color}">SAR: ${item.data ? item.data.toFixed(4) : '-'}</span><br/>`;
                                } else if (item.seriesName.includes('BB')) {
                                    result += `<span style="color:${item.color}">${item.seriesName}: ${item.data ? item.data.toFixed(4) : '-'}</span><br/>`;
                                }
                            });
                            return result;
                        } catch (e) {
                            return `${params[0].axisValue}<br/>Error: ${e.message}`;
                        }
                    }
                },
                grid: [
                    { left: '3%', right: '2%', top: '8%', height: '65%' },
                    { left: '3%', right: '2%', top: '77%', height: '18%' }
                ],
                xAxis: [
                    {
                        type: 'category',
                        data: globalTimes,
                        gridIndex: 0,
                        axisLine: { lineStyle: { color: '#2d3348' } },
                        axisLabel: { 
                            color: '#888',
                            rotate: 0,
                            fontSize: 10,
                            interval: function(index, value) {
                                // æ˜¾ç¤ºæ¯12ä¸ªæ ‡ç­¾ï¼ˆ5åˆ†é’Ÿå‘¨æœŸæ¯å°æ—¶æ˜¾ç¤ºä¸€æ¬¡ï¼‰
                                return index % 12 === 0;
                            }
                        }
                    },
                    {
                        type: 'category',
                        data: globalTimes,
                        gridIndex: 1,
                        axisLine: { lineStyle: { color: '#2d3348' } },
                        axisLabel: { show: false }
                    }
                ],
                yAxis: [
                    {
                        scale: true,
                        gridIndex: 0,
                        splitLine: { lineStyle: { color: '#2d3348' } },
                        axisLine: { lineStyle: { color: '#2d3348' } },
                        axisLabel: { color: '#888' }
                    },
                    {
                        scale: true,
                        gridIndex: 1,
                        splitLine: { show: false },
                        axisLine: { lineStyle: { color: '#2d3348' } },
                        axisLabel: { color: '#888' }
                    }
                ],
                series: [
                    {
                        name: 'Kçº¿',
                        type: 'candlestick',
                        data: globalOhlc,
                        xAxisIndex: 0,
                        yAxisIndex: 0,
                        itemStyle: {
                            color: '#00d4aa',
                            color0: '#ff4444',
                            borderColor: '#00d4aa',
                            borderColor0: '#ff4444'
                        },
                        markPoint: {
                            symbol: 'pin',
                            symbolSize: 50,
                            data: [
                                ...markPoints
                                // ğŸ”¥ ä¸´æ—¶ç¦ç”¨å–ç‚¹1æ ‡è®°ï¼ˆå­˜åœ¨æœªå®šä¹‰é”™è¯¯ï¼‰
                                // ...longSellPoint1Markers.map(marker => ({
                                //     coord: [marker.xIndex, marker.coord[1]],
                                //     value: 'å–1',
                                //     itemStyle: {
                                //         color: '#ff4444'
                                //     },
                                //     label: {
                                //         show: true,
                                //         formatter: 'ğŸ”»å–1\n{c}',
                                //         position: 'top',
                                //         fontSize: 11,
                                //         color: '#fff',
                                //         backgroundColor: '#ff4444',
                                //         padding: [4, 8],
                                //         borderRadius: 4,
                                //         fontWeight: 'bold'
                                //     }
                                // }))
                            ]
                        },
                        markLine: {
                            silent: true,
                            symbol: 'none',
                            lineStyle: {
                                color: '#888',
                                type: 'solid',
                                width: 1
                            },
                            data: dateSeparators
                        },
                        markArea: {
                            silent: false,
                            data: lowVolatilityMarkers.map(marker => [
                                {
                                    name: `è¿ç»­${marker.count}æ ¹ä½æ³¢åŠ¨Kçº¿`,
                                    xAxis: marker.start,
                                    itemStyle: {
                                        color: 'rgba(255, 165, 0, 0.15)'
                                    },
                                    label: {
                                        show: true,
                                        position: 'top',
                                        formatter: `ğŸ”¥ ${marker.count}æ ¹`,
                                        color: '#ffa500',
                                        fontSize: 12,
                                        fontWeight: 'bold',
                                        backgroundColor: 'rgba(0, 0, 0, 0.7)',
                                        padding: [3, 6],
                                        borderRadius: 3
                                    }
                                },
                                {
                                    xAxis: marker.end
                                }
                            ])
                        }
                    },
                    {
                        name: 'å¸ƒæ—ä¸Šè½¨',
                        type: 'line',
                        data: globalBbUpper,
                        xAxisIndex: 0,
                        yAxisIndex: 0,
                        smooth: true,
                        lineStyle: {
                            color: '#f39c12',
                            width: 1,
                            type: 'dashed'
                        },
                        showSymbol: false,
                        z: 1
                    },
                    {
                        name: 'å¸ƒæ—ä¸­è½¨',
                        type: 'line',
                        data: globalBbMiddle,
                        xAxisIndex: 0,
                        yAxisIndex: 0,
                        smooth: true,
                        lineStyle: {
                            color: '#3498db',
                            width: 1.5
                        },
                        showSymbol: false,
                        z: 1
                    },
                    {
                        name: 'å¸ƒæ—ä¸‹è½¨',
                        type: 'line',
                        data: globalBbLower,
                        xAxisIndex: 0,
                        yAxisIndex: 0,
                        smooth: true,
                        lineStyle: {
                            color: '#f39c12',
                            width: 1,
                            type: 'dashed'
                        },
                        showSymbol: false,
                        z: 1
                    },
                    {
                        name: 'SAR',
                        type: 'scatter',
                        data: globalSar,
                        xAxisIndex: 0,
                        yAxisIndex: 0,
                        symbol: 'circle',
                        symbolSize: 4,
                        itemStyle: {
                            color: function(params) {
                                // æ ¹æ®SARä½ç½®åˆ¤æ–­å¤šç©º
                                const sarValue = params.value;
                                const ohlcValue = ohlc[params.dataIndex];
                                if (sarValue && ohlcValue) {
                                    const closePrice = ohlcValue[1]; // close price
                                    // SARåœ¨ä»·æ ¼ä¸‹æ–¹ä¸ºå¤šå¤´ï¼ˆç»¿è‰²ï¼‰ï¼ŒSARåœ¨ä»·æ ¼ä¸Šæ–¹ä¸ºç©ºå¤´ï¼ˆçº¢è‰²ï¼‰
                                    return sarValue < closePrice ? '#00d4aa' : '#ff4444';
                                }
                                return '#888';
                            }
                        },
                        z: 2
                    },
                    {
                        name: 'æˆäº¤é‡',
                        type: 'bar',
                        data: globalVolumes,
                        xAxisIndex: 1,
                        yAxisIndex: 1,
                        itemStyle: {
                            color: function(params) {
                                const idx = params.dataIndex;
                                const isUp = globalOhlc[idx][1] >= globalOhlc[idx][0];
                                return isUp ? 'rgba(0, 212, 170, 0.5)' : 'rgba(255, 68, 68, 0.5)';
                            }
                        }
                    }
                ]
            };
            
            console.log('ğŸ“Š å‡†å¤‡è°ƒç”¨ setOption, klineChart å­˜åœ¨:', !!klineChart);
            console.log('ğŸ“Š klineOption series æ•°é‡:', klineOption.series.length);
            console.log('ğŸ“Š klineOption ç¬¬ä¸€ä¸ª series:', klineOption.series[0]?.name);
            
            // ğŸ”¥ CRITICAL FIX: åªæœ‰å½“klineChartå­˜åœ¨æ—¶æ‰æ˜¾ç¤ºå›¾è¡¨å®¹å™¨å’Œè°ƒç”¨setOption
            if (!klineChart || typeof klineChart.setOption !== 'function') {
                console.error('âŒ klineChart not initialized! è·³è¿‡æ¸²æŸ“ï¼Œä¿æŒå®¹å™¨éšè—');
                return; // ç›´æ¥è¿”å›ï¼Œä¸æ˜¾ç¤ºç©ºç™½å›¾è¡¨
            }
            
            // å…ˆæ˜¾ç¤ºå›¾è¡¨å®¹å™¨ï¼ˆåªæœ‰åœ¨klineChartå­˜åœ¨æ—¶ï¼‰
            document.getElementById('kline-chart').style.display = 'block';
            
            // è®¾ç½®å›¾è¡¨é…ç½®
            try {
                console.log('ğŸ¯ è°ƒç”¨ klineChart.setOption...');
                klineChart.setOption(klineOption, true);
                console.log('âœ… klineChart.setOption æˆåŠŸï¼');
            } catch (error) {
                console.error('âŒâŒâŒ klineChart.setOption å¤±è´¥:', error);
                console.error('é”™è¯¯å †æ ˆ:', error.stack);
                console.error('klineOption:', klineOption);
            }
            }
            
            // ç«‹å³resizeä¸€æ¬¡
            console.log('ğŸ“ å‡†å¤‡ç¬¬ä¸€æ¬¡ resize...');
            if (klineChart && typeof klineChart.resize === 'function') {
                try {
                    klineChart.resize();
                    console.log('âœ… ç¬¬ä¸€æ¬¡ resize æˆåŠŸ');
                } catch (error) {
                    console.error('âŒ resize å¤±è´¥:', error);
                }
            }
            
            // å†æ¬¡å»¶è¿Ÿresizeç¡®ä¿æ­£ç¡®æ¸²æŸ“
            setTimeout(() => {
                console.log('ğŸ“ å‡†å¤‡å»¶è¿Ÿ resize...');
                if (klineChart && typeof klineChart.resize === 'function') {
                    try {
                        klineChart.resize();
                        console.log('âœ… å»¶è¿Ÿ resize æˆåŠŸ');
                    } catch (error) {
                        console.error('âŒ å»¶è¿Ÿ resize å¤±è´¥:', error);
                    }
                }
                console.log('å›¾è¡¨å·²resize:', {
                    width: document.getElementById('kline-chart').offsetWidth,
                    height: document.getElementById('kline-chart').offsetHeight,
                    seriesCount: klineOption.series.length
                });
            }, 100);
            // éšè—ç»Ÿè®¡å’Œè¾…åŠ©å›¾è¡¨
            // document.getElementById('stats-grid').style.display = 'grid';
            // document.getElementById('rsi-container').style.display = 'block';
            // document.getElementById('indicators-container').style.display = 'block';
            
            // RSIå›¾
            const rsiOption = {
                backgroundColor: 'transparent',
                tooltip: {
                    trigger: 'axis',
                    backgroundColor: 'rgba(26, 29, 41, 0.95)',
                    borderColor: '#2d3348',
                    textStyle: { color: '#e0e0e0' }
                },
                grid: { left: '5%', right: '3%', top: '10%', bottom: '10%' },
                xAxis: {
                    type: 'category',
                    data: globalTimes,
                    axisLine: { lineStyle: { color: '#2d3348' } },
                    axisLabel: { show: false }
                },
                yAxis: {
                    type: 'value',
                    min: 0,
                    max: 100,
                    splitLine: { lineStyle: { color: '#2d3348' } },
                    axisLine: { lineStyle: { color: '#2d3348' } },
                    axisLabel: { color: '#888' }
                },
                visualMap: {
                    show: false,
                    pieces: [
                        { gte: 70, color: '#ff4444' },
                        { gte: 30, lte: 70, color: '#888' },
                        { lte: 30, color: '#00d4aa' }
                    ]
                },
                series: [{
                    name: 'RSI',
                    type: 'line',
                    data: globalRsi,
                    smooth: true,
                    lineStyle: { width: 2 },
                    markLine: {
                        silent: true,
                        symbol: 'none',
                        data: [
                            { yAxis: 70, lineStyle: { color: '#ff4444', type: 'dashed' } },
                            { yAxis: 30, lineStyle: { color: '#00d4aa', type: 'dashed' } }
                        ]
                    }
                }]
            };
            
            // rsiChartå·²éšè—ï¼Œä¸éœ€è¦æ¸²æŸ“
            // rsiChart.setOption(rsiOption, true);
            
            // SAR & å¸ƒæ—å¸¦å›¾
            const indicatorsOption = {
                backgroundColor: 'transparent',
                tooltip: {
                    trigger: 'axis',
                    backgroundColor: 'rgba(26, 29, 41, 0.95)',
                    borderColor: '#2d3348',
                    textStyle: { color: '#e0e0e0' }
                },
                legend: {
                    data: ['SAR', 'BBä¸Šè½¨', 'BBä¸­è½¨', 'BBä¸‹è½¨'],
                    textStyle: { color: '#888' },
                    top: 0
                },
                grid: { left: '5%', right: '3%', top: '15%', bottom: '10%' },
                xAxis: {
                    type: 'category',
                    data: globalTimes,
                    axisLine: { lineStyle: { color: '#2d3348' } },
                    axisLabel: { show: false }
                },
                yAxis: {
                    type: 'value',
                    scale: true,
                    splitLine: { lineStyle: { color: '#2d3348' } },
                    axisLine: { lineStyle: { color: '#2d3348' } },
                    axisLabel: { color: '#888' }
                },
                series: [
                    {
                        name: 'SAR',
                        type: 'scatter',
                        data: globalSar,
                        symbolSize: 4,
                        itemStyle: { color: '#ffd700' }
                    },
                    {
                        name: 'BBä¸Šè½¨',
                        type: 'line',
                        data: globalBbUpper,
                        lineStyle: { color: '#ff4444', width: 1 },
                        showSymbol: false
                    },
                    {
                        name: 'BBä¸­è½¨',
                        type: 'line',
                        data: globalBbMiddle,
                        lineStyle: { color: '#888', width: 1 },
                        showSymbol: false
                    },
                    {
                        name: 'BBä¸‹è½¨',
                        type: 'line',
                        data: globalBbLower,
                        lineStyle: { color: '#00d4aa', width: 1 },
                        showSymbol: false
                    }
                ]
            };
            
            // indicatorsChartå·²éšè—ï¼Œä¸éœ€è¦æ¸²æŸ“
            // indicatorsChart.setOption(indicatorsOption, true);
        } // renderCharts å‡½æ•°ç»“æŸ
        
        // æ›´æ–°ç»Ÿè®¡æ•°æ®
        function updateStats(latestIndicator) {
            document.getElementById('stat-price').textContent = '$' + latestIndicator.price.toFixed(4);
            document.getElementById('stat-rsi').textContent = latestIndicator.rsi.toFixed(2);
            document.getElementById('stat-sar-position').textContent = latestIndicator.sar_position || '-';
            document.getElementById('stat-sar-value').textContent = latestIndicator.sar ? '$' + latestIndicator.sar.toFixed(4) : '-';
        }
        
        // åˆ‡æ¢æ—¶é—´å‘¨æœŸ
        function switchTimeframe(timeframe) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            loadData(timeframe);
        }
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ– - ç®€åŒ–ç‰ˆæœ¬ï¼Œç§»é™¤å¤æ‚é€»è¾‘
        console.log('ğŸ’« å‡†å¤‡åˆå§‹åŒ–åº”ç”¨...');
        console.log('ğŸ’« document.readyState:', document.readyState);
        
        // ç«‹å³å°è¯•åˆå§‹åŒ–ï¼ˆåœ¨è¿™ä¸ªä½ç½®ï¼ŒDOMåº”è¯¥å·²ç»readyï¼‰
        setTimeout(function() {
            console.log('â° setTimeout æ‰§è¡Œ');
            console.log('â° ECharts æ˜¯å¦åŠ è½½:', typeof echarts !== 'undefined');
            console.log('â° kline-chart å…ƒç´ :', document.getElementById('kline-chart'));
            
            initCharts();
            console.log('â° initCharts æ‰§è¡Œå®Œæ¯•, klineChart:', !!klineChart);
            
            // ğŸ”¥ æ ‡è®°åº”ç”¨å·²åˆå§‹åŒ–
            APP_INITIALIZED = true;
            console.log('%câœ… APP_INITIALIZED = true, renderChartsç°åœ¨å¯ä»¥å®‰å…¨æ‰§è¡Œ', 'color: #00ff00; font-size: 14px; font-weight: bold;');
            
            setTimeout(function() {
                console.log('â°â° å¼€å§‹åŠ è½½æ•°æ®');
                loadData('5m');
                loadRecentSignals();
            }, 200);
        }, 500);
    </script>
</body>
</html>
