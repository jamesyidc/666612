<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¸‚åœºæ·±åº¦å›¾ - ç»Ÿè®¡åˆ†æç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: #0a0e27;
            color: #e0e0e0;
            overflow: hidden;
        }

        .container {
            display: flex;
            height: 100vh;
            width: 100vw;
        }

        /* å·¦ä¾§æ·±åº¦å›¾åŒºåŸŸ */
        .depth-chart-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 20px;
            border-right: 2px solid #1a1f3a;
        }

        .chart-header {
            margin-bottom: 20px;
        }

        .chart-title {
            font-size: 24px;
            font-weight: 600;
            color: #fff;
            margin-bottom: 10px;
        }

        .symbol-selector {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .symbol-btn {
            padding: 8px 16px;
            background: #1a1f3a;
            border: 1px solid #2a3558;
            border-radius: 6px;
            color: #e0e0e0;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .symbol-btn:hover {
            background: #2a3558;
            border-color: #3a4578;
        }

        .symbol-btn.active {
            background: #2962ff;
            border-color: #2962ff;
            color: #fff;
        }

        /* ä»·æ ¼ä¿¡æ¯æ  */
        .price-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: linear-gradient(135deg, #1a1f3a 0%, #0f1229 100%);
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .price-item {
            text-align: center;
        }

        .price-label {
            font-size: 12px;
            color: #8b8fa4;
            margin-bottom: 5px;
        }

        .price-value {
            font-size: 18px;
            font-weight: 600;
        }

        .price-value.bid {
            color: #00ff88;
        }

        .price-value.ask {
            color: #ff4d4f;
        }

        .price-value.spread {
            color: #ffa726;
        }

        /* Canvasæ·±åº¦å›¾ */
        .chart-canvas-wrapper {
            flex: 1;
            background: #0f1229;
            border-radius: 10px;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        #depthCanvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        /* å³ä¾§ç»Ÿè®¡åˆ†æåŒºåŸŸ */
        .statistics-area {
            width: 400px;
            padding: 20px;
            background: #0a0e27;
            overflow-y: auto;
        }

        .stats-title {
            font-size: 20px;
            font-weight: 600;
            color: #fff;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #1a1f3a;
        }

        /* ç»Ÿè®¡å¡ç‰‡ */
        .stat-card {
            background: linear-gradient(135deg, #1a1f3a 0%, #0f1229 100%);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid #2a3558;
        }

        .stat-card-title {
            font-size: 14px;
            color: #8b8fa4;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .stat-card-title .icon {
            font-size: 16px;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #1a1f3a;
        }

        .stat-row:last-child {
            border-bottom: none;
        }

        .stat-label {
            font-size: 13px;
            color: #8b8fa4;
        }

        .stat-value {
            font-size: 14px;
            font-weight: 600;
            color: #e0e0e0;
        }

        .stat-value.bullish {
            color: #00ff88;
        }

        .stat-value.bearish {
            color: #ff4d4f;
        }

        .stat-value.neutral {
            color: #ffa726;
        }

        /* ä¹°å–ç›˜é‡æ¡å½¢å›¾ */
        .volume-bar-chart {
            margin-top: 10px;
        }

        .volume-bar-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .volume-bar-label {
            width: 60px;
            font-size: 12px;
            color: #8b8fa4;
            text-align: right;
        }

        .volume-bar-container {
            flex: 1;
            height: 20px;
            background: #0a0e27;
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }

        .volume-bar-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .volume-bar-fill.bid {
            background: linear-gradient(90deg, #00ff88 0%, #00cc66 100%);
        }

        .volume-bar-fill.ask {
            background: linear-gradient(90deg, #ff4d4f 0%, #cc0000 100%);
        }

        .volume-bar-value {
            width: 80px;
            font-size: 12px;
            color: #e0e0e0;
            text-align: right;
        }

        /* è®¢å•ç°¿åˆ—è¡¨ */
        .orderbook-list {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 10px;
        }

        .orderbook-header {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            padding: 8px 0;
            border-bottom: 1px solid #2a3558;
            font-size: 12px;
            color: #8b8fa4;
        }

        .orderbook-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            padding: 6px 0;
            font-size: 12px;
            border-bottom: 1px solid #1a1f3a;
        }

        .orderbook-row:hover {
            background: #1a1f3a;
        }

        .orderbook-row.ask {
            color: #ff6b6b;
        }

        .orderbook-row.bid {
            color: #00ff88;
        }

        /* æ»šåŠ¨æ¡æ ·å¼ */
        .statistics-area::-webkit-scrollbar,
        .orderbook-list::-webkit-scrollbar {
            width: 6px;
        }

        .statistics-area::-webkit-scrollbar-track,
        .orderbook-list::-webkit-scrollbar-track {
            background: #0a0e27;
        }

        .statistics-area::-webkit-scrollbar-thumb,
        .orderbook-list::-webkit-scrollbar-thumb {
            background: #2a3558;
            border-radius: 3px;
        }

        /* åŠ è½½çŠ¶æ€ */
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 14px;
            color: #8b8fa4;
        }

        .loading::after {
            content: '...';
            animation: dots 1.5s infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        /* æ›´æ–°æ—¶é—´ */
        .update-time {
            font-size: 12px;
            color: #8b8fa4;
            text-align: right;
            margin-top: 10px;
        }

        /* å‹åŠ›æŒ‡ç¤ºå™¨ */
        .pressure-indicator {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        .pressure-indicator.bullish {
            background: rgba(0, 255, 136, 0.2);
            color: #00ff88;
        }

        .pressure-indicator.bearish {
            background: rgba(255, 77, 79, 0.2);
            color: #ff4d4f;
        }

        .pressure-indicator.neutral {
            background: rgba(255, 167, 38, 0.2);
            color: #ffa726;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- å·¦ä¾§ï¼šæ·±åº¦å›¾åŒºåŸŸ -->
        <div class="depth-chart-area">
            <div class="chart-header">
                <div class="chart-title">ğŸ“Š å¸‚åœºæ·±åº¦å›¾ - å¤šå¸ç§ç›‘æ§</div>
                <div class="symbol-selector">
                    <button class="symbol-btn" data-symbol="BTC-USDT-SWAP">BTC</button>
                    <button class="symbol-btn active" data-symbol="ETH-USDT-SWAP">ETH</button>
                    <button class="symbol-btn" data-symbol="XRP-USDT-SWAP">XRP</button>
                    <button class="symbol-btn" data-symbol="BNB-USDT-SWAP">BNB</button>
                    <button class="symbol-btn" data-symbol="SOL-USDT-SWAP">SOL</button>
                    <button class="symbol-btn" data-symbol="LTC-USDT-SWAP">LTC</button>
                    <button class="symbol-btn" data-symbol="DOGE-USDT-SWAP">DOGE</button>
                    <button class="symbol-btn" data-symbol="SUI-USDT-SWAP">SUI</button>
                    <button class="symbol-btn" data-symbol="TRX-USDT-SWAP">TRX</button>
                    <button class="symbol-btn" data-symbol="TON-USDT-SWAP">TON</button>
                    <button class="symbol-btn" data-symbol="ETC-USDT-SWAP">ETC</button>
                    <button class="symbol-btn" data-symbol="BCH-USDT-SWAP">BCH</button>
                    <button class="symbol-btn" data-symbol="HBAR-USDT-SWAP">HBAR</button>
                    <button class="symbol-btn" data-symbol="XLM-USDT-SWAP">XLM</button>
                    <button class="symbol-btn" data-symbol="FIL-USDT-SWAP">FIL</button>
                    <button class="symbol-btn" data-symbol="LINK-USDT-SWAP">LINK</button>
                    <button class="symbol-btn" data-symbol="CRO-USDT-SWAP">CRO</button>
                    <button class="symbol-btn" data-symbol="DOT-USDT-SWAP">DOT</button>
                    <button class="symbol-btn" data-symbol="AAVE-USDT-SWAP">AAVE</button>
                    <button class="symbol-btn" data-symbol="UNI-USDT-SWAP">UNI</button>
                    <button class="symbol-btn" data-symbol="NEAR-USDT-SWAP">NEAR</button>
                    <button class="symbol-btn" data-symbol="APT-USDT-SWAP">APT</button>
                    <button class="symbol-btn" data-symbol="CFX-USDT-SWAP">CFX</button>
                    <button class="symbol-btn" data-symbol="CRV-USDT-SWAP">CRV</button>
                    <button class="symbol-btn" data-symbol="STX-USDT-SWAP">STX</button>
                    <button class="symbol-btn" data-symbol="LDO-USDT-SWAP">LDO</button>
                    <button class="symbol-btn" data-symbol="TAO-USDT-SWAP">TAO</button>
                </div>
            </div>

            <!-- ä»·æ ¼ä¿¡æ¯æ  -->
            <div class="price-info">
                <div class="price-item">
                    <div class="price-label">ä¹°ä¸€ä»·</div>
                    <div class="price-value bid" id="bestBid">--</div>
                </div>
                <div class="price-item">
                    <div class="price-label">ä¸­é—´ä»·</div>
                    <div class="price-value" id="midPrice">--</div>
                </div>
                <div class="price-item">
                    <div class="price-label">å–ä¸€ä»·</div>
                    <div class="price-value ask" id="bestAsk">--</div>
                </div>
                <div class="price-item">
                    <div class="price-label">ä»·å·®</div>
                    <div class="price-value spread" id="spread">--</div>
                </div>
                <div class="price-item">
                    <div class="price-label">ä»·å·®%</div>
                    <div class="price-value spread" id="spreadPct">--</div>
                </div>
            </div>

            <!-- æ·±åº¦å›¾Canvas -->
            <div class="chart-canvas-wrapper">
                <canvas id="depthCanvas"></canvas>
                <div class="loading" id="chartLoading">åŠ è½½ä¸­</div>
            </div>
        </div>

        <!-- å³ä¾§ï¼šç»Ÿè®¡åˆ†æåŒºåŸŸ -->
        <div class="statistics-area">
            <div class="stats-title">ğŸ“ˆ ç»Ÿè®¡åˆ†æ</div>

            <!-- å¸‚åœºå‹åŠ›åˆ†æ -->
            <div class="stat-card">
                <div class="stat-card-title">
                    <span class="icon">âš–ï¸</span>
                    <span>å¸‚åœºå‹åŠ›åˆ†æ</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">ä¹°å–æ¯”</span>
                    <span class="stat-value" id="bidAskRatio">--</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">å‹åŠ›æ–¹å‘</span>
                    <span class="stat-value" id="pressure">--</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">å‹åŠ›å¼ºåº¦</span>
                    <span class="stat-value" id="strength">--</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">æµåŠ¨æ€§</span>
                    <span class="stat-value" id="liquidity">--</span>
                </div>
            </div>

            <!-- ä¹°å–ç›˜æ€»é‡ -->
            <div class="stat-card">
                <div class="stat-card-title">
                    <span class="icon">ğŸ’°</span>
                    <span>ä¹°å–ç›˜æ€»é‡</span>
                </div>
                <div class="volume-bar-chart">
                    <div class="volume-bar-row">
                        <div class="volume-bar-label">ä¹°ç›˜</div>
                        <div class="volume-bar-container">
                            <div class="volume-bar-fill bid" id="bidVolumeBar"></div>
                        </div>
                        <div class="volume-bar-value" id="bidVolumeText">0</div>
                    </div>
                    <div class="volume-bar-row">
                        <div class="volume-bar-label">å–ç›˜</div>
                        <div class="volume-bar-container">
                            <div class="volume-bar-fill ask" id="askVolumeBar"></div>
                        </div>
                        <div class="volume-bar-value" id="askVolumeText">0</div>
                    </div>
                </div>
            </div>

            <!-- æ·±åº¦ç»Ÿè®¡ -->
            <div class="stat-card">
                <div class="stat-card-title">
                    <span class="icon">ğŸ“Š</span>
                    <span>æ·±åº¦ç»Ÿè®¡</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">ä¹°å•æ¡£ä½</span>
                    <span class="stat-value" id="bidLevels">--</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">å–å•æ¡£ä½</span>
                    <span class="stat-value" id="askLevels">--</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">æœ€å¤§ä¹°é‡</span>
                    <span class="stat-value" id="maxBidAmount">--</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">æœ€å¤§å–é‡</span>
                    <span class="stat-value" id="maxAskAmount">--</span>
                </div>
            </div>

            <!-- è®¢å•ç°¿å‰5æ¡£ -->
            <div class="stat-card">
                <div class="stat-card-title">
                    <span class="icon">ğŸ“‹</span>
                    <span>è®¢å•ç°¿ï¼ˆå‰5æ¡£ï¼‰</span>
                </div>
                <div class="orderbook-list" id="orderbookList">
                    <div class="orderbook-header">
                        <span>ä»·æ ¼</span>
                        <span>æ•°é‡</span>
                        <span>ç´¯è®¡</span>
                    </div>
                    <!-- åŠ¨æ€å¡«å…… -->
                </div>
            </div>

            <div class="update-time" id="updateTime">æœ€åæ›´æ–°: --</div>
        </div>
    </div>

    <script>
        // é…ç½® - è‡ªåŠ¨æ„å»ºAPI URL
        const API_BASE_URL = (() => {
            const hostname = window.location.hostname;
            const protocol = window.location.protocol;
            if (hostname === 'localhost' || hostname === '127.0.0.1') {
                return 'http://localhost:5009';
            }
            // ä» 3000-xxx.e2b.dev è½¬æ¢ä¸º 5009-xxx.e2b.dev
            const parts = hostname.split('-');
            parts[0] = '5009';
            return `${protocol}//${parts.join('-')}`;
        })();
        
        console.log('API Base URL:', API_BASE_URL);
        let currentSymbol = 'ETH-USDT-SWAP';
        let depthData = null;
        let canvas, ctx;
        let animationFrameId;

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            canvas = document.getElementById('depthCanvas');
            ctx = canvas.getContext('2d');
            
            // è®¾ç½®canvaså°ºå¯¸
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);

            // å¸ç§é€‰æ‹©
            document.querySelectorAll('.symbol-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.symbol-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentSymbol = btn.dataset.symbol;
                    fetchDepthData();
                });
            });

            // é¦–æ¬¡åŠ è½½
            fetchDepthData();
            
            // å®šæ—¶åˆ·æ–°ï¼ˆæ¯3ç§’ï¼‰
            setInterval(fetchDepthData, 3000);
        });

        function resizeCanvas() {
            const wrapper = canvas.parentElement;
            canvas.width = wrapper.clientWidth - 40;
            canvas.height = wrapper.clientHeight - 40;
            if (depthData) {
                drawDepthChart();
            }
        }

        async function fetchDepthData() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/depth/${currentSymbol}?depth=50`);
                const data = await response.json();
                
                if (data.success) {
                    depthData = data;
                    updatePriceInfo();
                    drawDepthChart();
                    await fetchAnalysis();
                    document.getElementById('chartLoading').style.display = 'none';
                }
            } catch (error) {
                console.error('è·å–æ·±åº¦æ•°æ®å¤±è´¥:', error);
            }
        }

        async function fetchAnalysis() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/depth/${currentSymbol}/analysis`);
                const data = await response.json();
                
                if (data.success) {
                    updateStatistics(data.analysis);
                }
            } catch (error) {
                console.error('è·å–åˆ†ææ•°æ®å¤±è´¥:', error);
            }
        }

        function updatePriceInfo() {
            const stats = depthData.depth_stats;
            
            document.getElementById('bestBid').textContent = stats.best_bid?.toFixed(4) || '--';
            document.getElementById('bestAsk').textContent = stats.best_ask?.toFixed(4) || '--';
            document.getElementById('midPrice').textContent = stats.mid_price?.toFixed(4) || '--';
            document.getElementById('spread').textContent = stats.spread?.toFixed(4) || '--';
            document.getElementById('spreadPct').textContent = stats.spread_pct ? `${stats.spread_pct.toFixed(3)}%` : '--';
        }

        function updateStatistics(analysis) {
            // å¸‚åœºå‹åŠ›åˆ†æ
            document.getElementById('bidAskRatio').textContent = analysis.bid_ask_ratio?.toFixed(3) || '--';
            
            const pressureEl = document.getElementById('pressure');
            const pressureMap = {
                'bullish': { text: 'çœ‹å¤š', class: 'bullish' },
                'bearish': { text: 'çœ‹ç©º', class: 'bearish' },
                'neutral': { text: 'ä¸­æ€§', class: 'neutral' }
            };
            const pressureInfo = pressureMap[analysis.pressure] || { text: '--', class: '' };
            pressureEl.innerHTML = `<span class="pressure-indicator ${pressureInfo.class}">${pressureInfo.text}</span>`;
            
            const strengthMap = {
                'strong': 'å¼º',
                'moderate': 'ä¸­',
                'weak': 'å¼±'
            };
            document.getElementById('strength').textContent = strengthMap[analysis.strength] || '--';
            
            const liquidityMap = {
                'high': 'é«˜',
                'medium': 'ä¸­',
                'low': 'ä½'
            };
            document.getElementById('liquidity').textContent = liquidityMap[analysis.liquidity] || '--';

            // ä¹°å–ç›˜æ€»é‡
            const totalBid = analysis.total_bid_volume;
            const totalAsk = analysis.total_ask_volume;
            const maxVolume = Math.max(totalBid, totalAsk);
            
            const bidPct = maxVolume > 0 ? (totalBid / maxVolume) * 100 : 0;
            const askPct = maxVolume > 0 ? (totalAsk / maxVolume) * 100 : 0;
            
            document.getElementById('bidVolumeBar').style.width = `${bidPct}%`;
            document.getElementById('askVolumeBar').style.width = `${askPct}%`;
            document.getElementById('bidVolumeText').textContent = formatNumber(totalBid);
            document.getElementById('askVolumeText').textContent = formatNumber(totalAsk);

            // æ·±åº¦ç»Ÿè®¡
            const stats = depthData.depth_stats;
            document.getElementById('bidLevels').textContent = stats.bid_levels;
            document.getElementById('askLevels').textContent = stats.ask_levels;

            // è®¡ç®—æœ€å¤§ä¹°å–é‡
            const maxBid = Math.max(...depthData.bids.map(b => b[1]), 0);
            const maxAsk = Math.max(...depthData.asks.map(a => a[1]), 0);
            document.getElementById('maxBidAmount').textContent = formatNumber(maxBid);
            document.getElementById('maxAskAmount').textContent = formatNumber(maxAsk);

            // è®¢å•ç°¿å‰5æ¡£
            updateOrderbook();

            // æ›´æ–°æ—¶é—´
            const now = new Date();
            document.getElementById('updateTime').textContent = `æœ€åæ›´æ–°: ${now.toLocaleTimeString()}`;
        }

        function updateOrderbook() {
            const listEl = document.getElementById('orderbookList');
            const headerHTML = `
                <div class="orderbook-header">
                    <span>ä»·æ ¼</span>
                    <span>æ•°é‡</span>
                    <span>ç´¯è®¡</span>
                </div>
            `;
            
            let rowsHTML = '';
            
            // å–å•ï¼ˆå‰5æ¡£ï¼Œååºæ˜¾ç¤ºï¼‰
            const asks = depthData.asks_cumulative.slice(0, 5).reverse();
            asks.forEach(([price, amount, cumulative]) => {
                rowsHTML += `
                    <div class="orderbook-row ask">
                        <span>${price.toFixed(4)}</span>
                        <span>${formatNumber(amount)}</span>
                        <span>${formatNumber(cumulative)}</span>
                    </div>
                `;
            });
            
            // åˆ†éš”çº¿
            rowsHTML += `<div class="orderbook-row" style="border-top: 2px solid #ffa726; border-bottom: 2px solid #ffa726;"><span style="color: #ffa726;">---</span><span style="color: #ffa726;">---</span><span style="color: #ffa726;">---</span></div>`;
            
            // ä¹°å•ï¼ˆå‰5æ¡£ï¼‰
            const bids = depthData.bids_cumulative.slice(0, 5);
            bids.forEach(([price, amount, cumulative]) => {
                rowsHTML += `
                    <div class="orderbook-row bid">
                        <span>${price.toFixed(4)}</span>
                        <span>${formatNumber(amount)}</span>
                        <span>${formatNumber(cumulative)}</span>
                    </div>
                `;
            });
            
            listEl.innerHTML = headerHTML + rowsHTML;
        }

        function drawDepthChart() {
            if (!depthData || !canvas || !ctx) return;

            const width = canvas.width;
            const height = canvas.height;
            const padding = { top: 30, right: 50, bottom: 40, left: 50 };
            const chartWidth = width - padding.left - padding.right;
            const chartHeight = height - padding.top - padding.bottom;

            // æ¸…ç©ºç”»å¸ƒ
            ctx.clearRect(0, 0, width, height);

            // èƒŒæ™¯
            ctx.fillStyle = '#0f1229';
            ctx.fillRect(0, 0, width, height);

            // è·å–æ•°æ®
            const bids = depthData.bids_cumulative;
            const asks = depthData.asks_cumulative;
            
            if (!bids.length || !asks.length) return;

            // è®¡ç®—ä»·æ ¼èŒƒå›´
            const minBidPrice = bids[bids.length - 1][0];
            const maxBidPrice = bids[0][0];
            const minAskPrice = asks[0][0];
            const maxAskPrice = asks[asks.length - 1][0];
            
            const minPrice = minBidPrice;
            const maxPrice = maxAskPrice;
            const priceRange = maxPrice - minPrice;

            // è®¡ç®—é‡èŒƒå›´
            const maxBidVolume = bids[bids.length - 1][2];
            const maxAskVolume = asks[asks.length - 1][2];
            const maxVolume = Math.max(maxBidVolume, maxAskVolume);

            // ç»˜åˆ¶ç½‘æ ¼
            drawGrid(ctx, padding, chartWidth, chartHeight, maxVolume);

            // ç»˜åˆ¶ä¹°ç›˜æ·±åº¦ï¼ˆå·¦ä¾§ç»¿è‰²ï¼‰
            drawDepthArea(ctx, bids, padding, chartWidth, chartHeight, minPrice, priceRange, maxVolume, '#00ff88', 'left');

            // ç»˜åˆ¶å–ç›˜æ·±åº¦ï¼ˆå³ä¾§çº¢è‰²ï¼‰
            drawDepthArea(ctx, asks, padding, chartWidth, chartHeight, minPrice, priceRange, maxVolume, '#ff4d4f', 'right');

            // ç»˜åˆ¶ä¸­é—´ä»·çº¿
            const midPrice = depthData.depth_stats.mid_price;
            const midX = padding.left + ((midPrice - minPrice) / priceRange) * chartWidth;
            ctx.strokeStyle = '#ffa726';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(midX, padding.top);
            ctx.lineTo(midX, height - padding.bottom);
            ctx.stroke();
            ctx.setLineDash([]);

            // ç»˜åˆ¶åæ ‡è½´æ ‡ç­¾
            drawAxes(ctx, padding, width, height, chartWidth, minPrice, maxPrice, maxVolume);
        }

        function drawGrid(ctx, padding, chartWidth, chartHeight, maxVolume) {
            ctx.strokeStyle = '#1a1f3a';
            ctx.lineWidth = 1;

            // æ°´å¹³ç½‘æ ¼çº¿ï¼ˆ5æ¡ï¼‰
            for (let i = 0; i <= 5; i++) {
                const y = padding.top + (chartHeight / 5) * i;
                ctx.beginPath();
                ctx.moveTo(padding.left, y);
                ctx.lineTo(padding.left + chartWidth, y);
                ctx.stroke();
            }

            // å‚ç›´ç½‘æ ¼çº¿ï¼ˆ10æ¡ï¼‰
            for (let i = 0; i <= 10; i++) {
                const x = padding.left + (chartWidth / 10) * i;
                ctx.beginPath();
                ctx.moveTo(x, padding.top);
                ctx.lineTo(x, padding.top + chartHeight);
                ctx.stroke();
            }
        }

        function drawDepthArea(ctx, data, padding, chartWidth, chartHeight, minPrice, priceRange, maxVolume, color, side) {
            if (!data.length) return;

            ctx.beginPath();
            
            // èµ·å§‹ç‚¹
            const startPrice = data[0][0];
            const startX = padding.left + ((startPrice - minPrice) / priceRange) * chartWidth;
            ctx.moveTo(startX, padding.top + chartHeight);

            // ç»˜åˆ¶ç´¯ç§¯é‡æ›²çº¿
            data.forEach(([price, amount, cumulative]) => {
                const x = padding.left + ((price - minPrice) / priceRange) * chartWidth;
                const y = padding.top + chartHeight - (cumulative / maxVolume) * chartHeight;
                ctx.lineTo(x, y);
            });

            // é—­åˆè·¯å¾„åˆ°åº•éƒ¨
            const endPrice = data[data.length - 1][0];
            const endX = padding.left + ((endPrice - minPrice) / priceRange) * chartWidth;
            ctx.lineTo(endX, padding.top + chartHeight);
            ctx.closePath();

            // å¡«å……æ¸å˜
            const gradient = ctx.createLinearGradient(0, padding.top, 0, padding.top + chartHeight);
            gradient.addColorStop(0, color + '40');
            gradient.addColorStop(1, color + '10');
            ctx.fillStyle = gradient;
            ctx.fill();

            // æè¾¹
            ctx.strokeStyle = color;
            ctx.lineWidth = 2;
            ctx.stroke();
        }

        function drawAxes(ctx, padding, width, height, chartWidth, minPrice, maxPrice, maxVolume) {
            ctx.fillStyle = '#8b8fa4';
            ctx.font = '12px sans-serif';
            ctx.textAlign = 'center';

            // Xè½´ï¼ˆä»·æ ¼ï¼‰æ ‡ç­¾
            for (let i = 0; i <= 5; i++) {
                const price = minPrice + (maxPrice - minPrice) * (i / 5);
                const x = padding.left + (chartWidth / 5) * i;
                ctx.fillText(price.toFixed(2), x, height - padding.bottom + 20);
            }

            // Yè½´ï¼ˆç´¯ç§¯é‡ï¼‰æ ‡ç­¾
            ctx.textAlign = 'right';
            for (let i = 0; i <= 5; i++) {
                const volume = maxVolume * (i / 5);
                const y = height - padding.bottom - (chartWidth / 5) * i;
                ctx.fillText(formatNumber(volume), padding.left - 10, y + 4);
            }

            // è½´æ ‡é¢˜
            ctx.fillStyle = '#e0e0e0';
            ctx.font = '14px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('ä»·æ ¼ (USDT)', width / 2, height - 5);
            
            ctx.save();
            ctx.translate(15, height / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText('ç´¯ç§¯é‡', 0, 0);
            ctx.restore();
        }

        function formatNumber(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(2) + 'M';
            } else if (num >= 1000) {
                return (num / 1000).toFixed(2) + 'K';
            }
            return num.toFixed(2);
        }
    </script>
</body>
</html>
