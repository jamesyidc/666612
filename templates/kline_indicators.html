<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <!-- Cache Buster: 1765947943 -->
    <title>å†³ç­–-Kçº¿æŒ‡æ ‡ç³»ç»Ÿ | OKExæ°¸ç»­</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1800px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }
        
        .back-button {
            display: inline-block;
            padding: 10px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .back-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        h1 {
            color: #764ba2;
            margin-bottom: 10px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 15px;
        }
        
        .subtitle {
            color: #666;
            font-size: 14px;
            margin-bottom: 20px;
        }
        
        .stats-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border-left: 4px solid #667eea;
        }
        
        .stat-card h3 {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
            font-weight: 500;
        }
        
        .stat-card .value {
            font-size: 28px;
            font-weight: bold;
            color: #764ba2;
        }
        
        .stat-card .value.running {
            color: #10b981;
        }
        
        .stat-card .value.stopped {
            color: #ef4444;
        }
        
        .filters {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .filters select, .filters button {
            padding: 10px 15px;
            border: 2px solid #667eea;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .filters select {
            background: white;
            color: #333;
        }
        
        .filters button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            font-weight: 500;
        }
        
        .filters button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        .legend {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }
        
        .legend h3 {
            color: #764ba2;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .legend-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 10px;
        }
        
        .legend-item {
            font-size: 13px;
            color: #555;
            padding: 5px 0;
        }
        
        .legend-item strong {
            color: #764ba2;
            font-weight: 600;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .data-table thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .data-table th {
            padding: 15px 10px;
            text-align: center;
            font-weight: 600;
            font-size: 14px;
        }
        
        .data-table td {
            padding: 12px 10px;
            text-align: center;
            border-bottom: 1px solid #e5e7eb;
            font-size: 13px;
        }
        
        .data-table tbody tr:hover {
            background-color: #f3f4f6;
        }
        
        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .badge.bullish {
            background-color: #d1fae5;
            color: #065f46;
        }
        
        .badge.bearish {
            background-color: #fee2e2;
            color: #991b1b;
        }
        
        .badge.quadrant-1 {
            background-color: #dbeafe;
            color: #1e40af;
        }
        
        .badge.quadrant-2 {
            background-color: #d1fae5;
            color: #065f46;
        }
        
        .badge.quadrant-3 {
            background-color: #fef3c7;
            color: #92400e;
        }
        
        .badge.quadrant-4 {
            background-color: #fee2e2;
            color: #991b1b;
        }
        
        .no-data {
            text-align: center;
            padding: 40px;
            color: #999;
            font-size: 16px;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
            font-size: 18px;
            font-weight: 500;
        }
        
        /* ä¿¡å·æ¡†æ ·å¼ */
        .signals-panel {
            background: linear-gradient(135deg, #fff5f5 0%, #fff 100%);
            border: 2px solid #667eea;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.15);
        }
        
        .signals-panel h2 {
            color: #764ba2;
            margin-bottom: 20px;
            font-size: 22px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .signals-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
        }
        
        .signal-box {
            background: white;
            border-left: 4px solid #667eea;
            border-radius: 8px;
            padding: 15px;
            transition: all 0.3s ease;
        }
        
        .signal-box:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .signal-box.buy-signal {
            border-left-color: #10b981;
            background: linear-gradient(135deg, #f0fdf4 0%, #fff 100%);
        }
        
        .signal-box.sell-signal {
            border-left-color: #ef4444;
            background: linear-gradient(135deg, #fef2f2 0%, #fff 100%);
        }
        
        .signal-box.high-point {
            border-left-color: #f59e0b;
            background: linear-gradient(135deg, #fffbeb 0%, #fff 100%);
        }
        
        .signal-box.low-point {
            border-left-color: #3b82f6;
            background: linear-gradient(135deg, #eff6ff 0%, #fff 100%);
        }
        
        .signal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .signal-title {
            font-weight: 600;
            font-size: 14px;
            color: #666;
        }
        
        .signal-symbol {
            font-size: 20px;
            font-weight: bold;
            color: #764ba2;
        }
        
        .signal-details {
            display: flex;
            flex-direction: column;
            gap: 5px;
            font-size: 13px;
            color: #666;
        }
        
        .signal-price {
            font-size: 16px;
            font-weight: 600;
            color: #333;
        }
        
        .signal-time {
            font-size: 11px;
            color: #999;
        }
        
        .signal-badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 600;
            background: #667eea;
            color: white;
        }
        
        .signal-badge.buy {
            background: #10b981;
        }
        
        .signal-badge.sell {
            background: #ef4444;
        }
        
        .signal-badge.high {
            background: #f59e0b;
        }
        
        .signal-badge.low {
            background: #3b82f6;
        }
        
        .no-signals {
            text-align: center;
            padding: 30px;
            color: #999;
            font-size: 14px;
        }
        
        .signal-count {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 14px;
            margin-left: 10px;
        }
        
        .symbol-cell {
            font-weight: 600;
            color: #764ba2;
        }
        
        .price-cell {
            font-family: 'Courier New', monospace;
            font-weight: 500;
        }
        
        .positive {
            color: #10b981;
        }
        
        .negative {
            color: #ef4444;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="/" class="back-button">â† è¿”å›é¦–é¡µ</a>
        
        <h1>ğŸ¯ å†³ç­–-Kçº¿æŒ‡æ ‡ç³»ç»Ÿ</h1>
        <p class="subtitle">åŸºäºOKExæ°¸ç»­åˆçº¦çš„æŠ€æœ¯æŒ‡æ ‡é‡‡é›†ç³»ç»Ÿ - å®æ—¶ç›‘æ§27ä¸ªå¸ç§çš„5åˆ†é’Ÿ/1å°æ—¶æŒ‡æ ‡</p>
        
        <div class="stats-summary">
            <div class="stat-card">
                <h3>é‡‡é›†å™¨çŠ¶æ€</h3>
                <div class="value" id="collectorStatus">åŠ è½½ä¸­...</div>
            </div>
            <div class="stat-card">
                <h3>æœ€åé‡‡é›†æ—¶é—´</h3>
                <div class="value" id="lastCollection" style="font-size: 16px;">--</div>
            </div>
            <div class="stat-card">
                <h3>5åˆ†é’ŸKçº¿æ•°</h3>
                <div class="value" id="count5m">0</div>
            </div>
            <div class="stat-card">
                <h3>1å°æ—¶Kçº¿æ•°</h3>
                <div class="value" id="count1h">0</div>
            </div>
            <div class="stat-card">
                <h3>æŒ‡æ ‡æ•°æ®æ¡æ•°</h3>
                <div class="value" id="countIndicators">0</div>
            </div>
        </div>
        
        <!-- ä¿¡å·é¢æ¿ -->
        <div class="signals-panel">
            <h2>
                ğŸ¯ å®æ—¶äº¤æ˜“ä¿¡å·ï¼ˆ2å°æ—¶å†…ï¼‰
                <span class="signal-count" id="totalSignals">0</span>
            </h2>
            <div id="signalsContainer" class="signals-grid">
                <div class="loading">åŠ è½½ä¿¡å·ä¸­...</div>
            </div>
        </div>
        
        <div class="filters">
            <select id="timeframeFilter">
                <option value="">å…¨éƒ¨å‘¨æœŸ</option>
                <option value="5m">5åˆ†é’Ÿ</option>
                <option value="1H">1å°æ—¶</option>
            </select>
            
            <select id="symbolFilter">
                <option value="">å…¨éƒ¨å¸ç§</option>
                <option value="BTC-USDT-SWAP">BTC</option>
                <option value="ETH-USDT-SWAP">ETH</option>
                <option value="XRP-USDT-SWAP">XRP</option>
                <option value="SOL-USDT-SWAP">SOL</option>
                <option value="DOGE-USDT-SWAP">DOGE</option>
            </select>
            
            <button onclick="loadData()">ğŸ”„ åˆ·æ–°æ•°æ®</button>
        </div>
        
        <div class="legend">
            <h3>ğŸ“– æŒ‡æ ‡è¯´æ˜</h3>
            <div class="legend-grid">
                <div class="legend-item">
                    <strong>RSI (14):</strong> ç›¸å¯¹å¼ºå¼±æŒ‡æ•°ï¼ŒèŒƒå›´0-100ï¼Œ< 30è¶…å–ï¼Œ> 70è¶…ä¹°
                </div>
                <div class="legend-item">
                    <strong>SAR:</strong> æŠ›ç‰©çº¿è½¬å‘æŒ‡æ ‡ï¼Œç”¨äºåˆ¤æ–­è¶‹åŠ¿åè½¬ç‚¹
                </div>
                <div class="legend-item">
                    <strong>SARå¤šç©º:</strong> <span class="badge bullish">å¤šå¤´</span> = Kçº¿åœ¨SARä¸Šæ–¹ï¼Œ<span class="badge bearish">ç©ºå¤´</span> = Kçº¿åœ¨SARä¸‹æ–¹
                </div>
                <div class="legend-item">
                    <strong>SARè±¡é™:</strong> ç›¸å¯¹å¸ƒæ—å¸¦ä½ç½® - 1(SAR>UB), 2(UB>SAR>BOLL), 3(BOLL>SAR>LB), 4(SAR<LB)
                </div>
                <div class="legend-item">
                    <strong>å¤šè½¬ç©º/ç©ºè½¬å¤š:</strong> å¦‚"ç©ºå¤´02"è¡¨ç¤ºä»å¤šå¤´è½¬ä¸ºç©ºå¤´åçš„ç¬¬2ä¸ªå‘¨æœŸï¼Œ"å¤šå¤´01"è¡¨ç¤ºä»ç©ºå¤´è½¬ä¸ºå¤šå¤´åçš„ç¬¬1ä¸ªå‘¨æœŸ
                </div>
                <div class="legend-item">
                    <strong>å¸ƒæ—å¸¦ (UB/BOLL/LB):</strong> ä¸Šè½¨ã€ä¸­è½¨ã€ä¸‹è½¨ï¼Œä»·æ ¼çªç ´ä¸Šè½¨ä¸ºè¶…ä¹°ï¼Œè·Œç ´ä¸‹è½¨ä¸ºè¶…å–
                </div>
                <div class="legend-item">
                    <strong>5åˆ†é’ŸæŒ¯å¹…:</strong> (æœ€é«˜ä»·-æœ€ä½ä»·)/æœ€ä½ä»· Ã— 100%
                </div>
                <div class="legend-item">
                    <strong>5åˆ†é’Ÿæ¶¨è·Œå¹…:</strong> (æ”¶ç›˜ä»·-å¼€ç›˜ä»·)/å¼€ç›˜ä»· Ã— 100%
                </div>
            </div>
        </div>
        
        <div id="dataContainer">
            <div class="loading">æ­£åœ¨åŠ è½½æ•°æ®...</div>
        </div>
    </div>
    
    <script>
        // å…¨å±€å˜é‡
        let allData = [];
        let chartBaseUrl = 'https://5000-iz6uddj6rs3xe48ilsyqq-2e1b9533.sandbox.novita.ai';
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = function() {
            loadChartConfig();
            loadStatus();
            loadData();
            loadSignals();
            
            // æ¯30ç§’è‡ªåŠ¨åˆ·æ–°
            setInterval(() => {
                loadStatus();
                loadData();
                loadSignals();
            }, 30000);
        };
        
        // åŠ è½½Kçº¿å›¾é…ç½®
        function loadChartConfig() {
            fetch('/api/chart-config')
                .then(response => response.json())
                .then(data => {
                    if (data.chart_base_url) {
                        chartBaseUrl = data.chart_base_url;
                    }
                })
                .catch(error => {
                    console.error('åŠ è½½Kçº¿é…ç½®å¤±è´¥:', error);
                });
        }
        
        // åŠ è½½é‡‡é›†å™¨çŠ¶æ€
        function loadStatus() {
            fetch(`/api/kline-indicators/collector-status?_t=${Date.now()}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const statusEl = document.getElementById('collectorStatus');
                        const lastCollectionEl = document.getElementById('lastCollection');
                        
                        // æ›´æ–°çŠ¶æ€
                        if (data.status === 'running') {
                            statusEl.textContent = 'è¿è¡Œä¸­';
                            statusEl.className = 'value running';
                        } else if (data.status === 'stopped') {
                            statusEl.textContent = 'å·²åœæ­¢';
                            statusEl.className = 'value stopped';
                        } else {
                            statusEl.textContent = 'æœªå¯åŠ¨';
                            statusEl.className = 'value';
                        }
                        
                        // æ›´æ–°æ—¶é—´
                        if (data.last_collection_time) {
                            const minutes = data.minutes_since_last;
                            lastCollectionEl.textContent = `${data.last_collection_time} (${minutes}åˆ†é’Ÿå‰)`;
                        } else {
                            lastCollectionEl.textContent = 'æš‚æ— æ•°æ®';
                        }
                        
                        // æ›´æ–°æ•°æ®ç»Ÿè®¡
                        document.getElementById('count5m').textContent = data.data_counts.kline_5m.toLocaleString();
                        document.getElementById('count1h').textContent = data.data_counts.kline_1h.toLocaleString();
                        document.getElementById('countIndicators').textContent = data.data_counts.indicators.toLocaleString();
                    }
                })
                .catch(error => {
                    console.error('åŠ è½½çŠ¶æ€å¤±è´¥:', error);
                });
        }
        
        // åŠ è½½æ•°æ®
        function loadData() {
            const timeframe = document.getElementById('timeframeFilter').value;
            const symbol = document.getElementById('symbolFilter').value;
            
            let url = '/api/kline-indicators/latest?';
            if (timeframe) url += `timeframe=${timeframe}&`;
            if (symbol) url += `symbol=${symbol}&`;
            url += `_t=${Date.now()}`;
            
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    console.log('ğŸ“Š APIå“åº”:', data);
                    if (data.success) {
                        allData = data.data;
                        console.log('âœ… æ¥æ”¶åˆ°æ•°æ®:', allData.length, 'æ¡');
                        renderTable(allData);
                    } else {
                        document.getElementById('dataContainer').innerHTML = 
                            `<div class="no-data">âŒ åŠ è½½å¤±è´¥: ${data.error}</div>`;
                    }
                })
                .catch(error => {
                    console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
                    document.getElementById('dataContainer').innerHTML = 
                        '<div class="no-data">âŒ ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•</div>';
                });
        }
        
        // æŒ‡å®šçš„å¸ç§é¡ºåº
        const SYMBOL_ORDER = [
            'BTC', 'ETH', 'XRP', 'BNB', 'SOL', 'LTC', 'DOGE', 'SUI', 'TRX', 
            'TON', 'ETC', 'BCH', 'HBAR', 'XLM', 'FIL', 'LINK', 'CRO', 'DOT', 
            'AAVE', 'UNI', 'NEAR', 'APT', 'CFX', 'CRV', 'STX', 'LDO', 'TAO'
        ];
        
        // æ¸²æŸ“è¡¨æ ¼
        function renderTable(data) {
            console.log('ğŸ“‹ renderTableè°ƒç”¨, æ•°æ®:', data ? data.length : 0, 'æ¡');
            if (!data || data.length === 0) {
                document.getElementById('dataContainer').innerHTML = 
                    '<div class="no-data">æš‚æ— æŒ‡æ ‡æ•°æ®</div>';
                return;
            }
            
            // æŒ‰å‘¨æœŸåˆ†ç»„æ•°æ®
            const data5m = {};
            const data1h = {};
            
            data.forEach(item => {
                const symbolShort = item.symbol.replace('-USDT-SWAP', '');
                if (item.timeframe === '5m') {
                    data5m[symbolShort] = item;
                } else if (item.timeframe === '1H') {
                    data1h[symbolShort] = item;
                }
            });
            
            console.log('ğŸ“¦ æ•°æ®åˆ†ç»„å®Œæˆ:');
            console.log('  5mæ•°æ®:', Object.keys(data5m).length, 'ä¸ªå¸ç§', Object.keys(data5m));
            console.log('  1Hæ•°æ®:', Object.keys(data1h).length, 'ä¸ªå¸ç§', Object.keys(data1h));
            
            // ç”Ÿæˆè¡¨æ ¼HTML
            let html = '<div style="margin-bottom: 40px;">';
            
            // 5åˆ†é’Ÿè¡¨æ ¼
            html += '<h2 style="color: #764ba2; margin-bottom: 20px; font-size: 24px;">ğŸ“Š 5åˆ†é’Ÿå‘¨æœŸæŒ‡æ ‡</h2>';
            html += renderTimeframeTable(data5m, '5m');
            
            html += '</div><div>';
            
            // 1å°æ—¶è¡¨æ ¼
            html += '<h2 style="color: #764ba2; margin-bottom: 20px; margin-top: 40px; font-size: 24px;">ğŸ“Š 1å°æ—¶å‘¨æœŸæŒ‡æ ‡</h2>';
            html += renderTimeframeTable(data1h, '1H');
            
            html += '</div>';
            
            console.log('ğŸ“„ ç”Ÿæˆçš„HTMLé•¿åº¦:', html.length, 'å­—ç¬¦');
            console.log('ğŸ“„ HTMLé¢„è§ˆ:', html.substring(0, 500));
            document.getElementById('dataContainer').innerHTML = html;
            console.log('âœ… HTMLå·²æ’å…¥åˆ°DOM');
        }
        
        // æ¸²æŸ“å•ä¸ªå‘¨æœŸçš„è¡¨æ ¼
        function renderTimeframeTable(dataMap, timeframe) {
            console.log(`ğŸ”§ renderTimeframeTable(${timeframe}): æ”¶åˆ°${Object.keys(dataMap).length}ä¸ªå¸ç§`);
            let html = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>å¸ç§</th>
                            <th>å‘¨æœŸ</th>
                            <th>å½“å‰ä»·</th>
                            <th>RSI (14)</th>
                            <th>SAR</th>
                            <th>SARå¤šç©º</th>
                            <th>SARè±¡é™</th>
                            <th>å¤šç©ºè®¡æ•°</th>
                            <th>å¸ƒæ—å¸¦ä¸Šè½¨</th>
                            <th>å¸ƒæ—å¸¦ä¸­è½¨</th>
                            <th>å¸ƒæ—å¸¦ä¸‹è½¨</th>
                            ${timeframe === '5m' ? '<th>æŒ¯å¹…</th><th>æ¶¨è·Œå¹…</th>' : ''}
                            <th>æ›´æ–°æ—¶é—´</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            // æŒ‰æŒ‡å®šé¡ºåºéå†å¸ç§
            SYMBOL_ORDER.forEach(symbolShort => {
                const item = dataMap[symbolShort];
                const symbolFull = `${symbolShort}-USDT-SWAP`;
                console.log(`  æ£€æŸ¥ ${symbolShort}:`, item ? 'æœ‰æ•°æ®' : 'æ— æ•°æ®');
                if (!item) {
                    // å¦‚æœæ²¡æœ‰æ•°æ®ï¼Œæ˜¾ç¤ºå ä½è¡Œ
                    html += `
                        <tr style="opacity: 0.5;">
                            <td class="symbol-cell"><a href="${chartBaseUrl}/chart/${symbolFull}" style="color: #999; text-decoration: none;" title="æŸ¥çœ‹${symbolShort}è¯¦ç»†Kçº¿å›¾">${symbolShort}</a></td>
                            <td>${timeframe}</td>
                            <td colspan="${timeframe === '5m' ? 11 : 9}" style="text-align: center; color: #999;">æš‚æ— æ•°æ®</td>
                        </tr>
                    `;
                    return;
                }
                
                const sarPositionBadge = item.sar_position === 'bullish' 
                    ? '<span class="badge bullish">å¤šå¤´</span>' 
                    : '<span class="badge bearish">ç©ºå¤´</span>';
                const sarQuadrantBadge = `<span class="badge quadrant-${item.sar_quadrant}">è±¡é™${item.sar_quadrant}</span>`;
                
                const amplitudeClass = item.amplitude && item.amplitude > 0 ? 'positive' : '';
                const changePctClass = item.change_pct && item.change_pct > 0 ? 'positive' : (item.change_pct < 0 ? 'negative' : '');
                
                html += `
                    <tr>
                        <td class="symbol-cell"><a href="${chartBaseUrl}/chart/${symbolFull}" style="color: #667eea; text-decoration: none; font-weight: 600;" title="æŸ¥çœ‹${symbolShort}è¯¦ç»†Kçº¿å›¾">${symbolShort}</a></td>
                        <td>${timeframe}</td>
                        <td class="price-cell">${item.current_price ? item.current_price.toFixed(6) : '--'}</td>
                        <td>${item.rsi_14 ? item.rsi_14.toFixed(2) : '--'}</td>
                        <td class="price-cell">${item.sar ? item.sar.toFixed(6) : '--'}</td>
                        <td>${item.sar_position ? sarPositionBadge : '--'}</td>
                        <td>${item.sar_quadrant ? sarQuadrantBadge : '--'}</td>
                        <td style="font-weight: 600;">${item.sar_count_label || '--'}</td>
                        <td class="price-cell">${item.bb_upper ? item.bb_upper.toFixed(6) : '--'}</td>
                        <td class="price-cell">${item.bb_middle ? item.bb_middle.toFixed(6) : '--'}</td>
                        <td class="price-cell">${item.bb_lower ? item.bb_lower.toFixed(6) : '--'}</td>
                        ${timeframe === '5m' ? `
                            <td class="${amplitudeClass}">${item.amplitude ? item.amplitude.toFixed(2) + '%' : '--'}</td>
                            <td class="${changePctClass}">${item.change_pct ? (item.change_pct > 0 ? '+' : '') + item.change_pct.toFixed(2) + '%' : '--'}</td>
                        ` : ''}
                        <td style="font-size: 11px;">${item.record_time}</td>
                    </tr>
                `;
            });
            
            html += `
                    </tbody>
                </table>
            `;
            
            console.log(`âœ… renderTimeframeTable(${timeframe}) è¿”å›HTML:`, html.length, 'å­—ç¬¦');
            return html;
        }
        
        // åŠ è½½äº¤æ˜“ä¿¡å·
        function loadSignals() {
            fetch(`/api/kline-indicators/signals?_t=${Date.now()}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        renderSignals(data.data);
                    } else {
                        document.getElementById('signalsContainer').innerHTML = 
                            '<div class="no-signals">âŒ åŠ è½½å¤±è´¥: ' + data.error + '</div>';
                    }
                })
                .catch(error => {
                    console.error('åŠ è½½ä¿¡å·å¤±è´¥:', error);
                    document.getElementById('signalsContainer').innerHTML = 
                        '<div class="no-signals">âŒ ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•</div>';
                });
        }
        
        // æ¸²æŸ“ä¿¡å·
        function renderSignals(data) {
            const container = document.getElementById('signalsContainer');
            const signals = data.signals;
            const counts = data.counts;
            
            // æ›´æ–°æ€»ä¿¡å·æ•°
            const totalCount = Object.values(counts).reduce((a, b) => a + b, 0);
            document.getElementById('totalSignals').textContent = totalCount;
            
            if (totalCount === 0) {
                container.innerHTML = '<div class="no-signals">æš‚æ— ç¬¦åˆæ¡ä»¶çš„ä¿¡å·</div>';
                return;
            }
            
            let html = '';
            
            // æ¸²æŸ“ä¹°ç‚¹4ï¼ˆ2å°æ—¶å†…æœ‰æ•ˆï¼‰
            if (signals.buy_point_4 && signals.buy_point_4.length > 0) {
                signals.buy_point_4.forEach(signal => {
                    const rsiText = signal.confirm_rsi ? `RSI: ${signal.confirm_rsi.toFixed(2)}` : 'RSI: N/A';
                    const confirmTime = signal.confirm_time || signal.time;
                    html += `
                        <div class="signal-box buy-signal">
                            <div class="signal-header">
                                <span class="signal-badge buy">ğŸ¯ ä¹°ç‚¹4</span>
                                <span class="signal-symbol">${signal.symbol}</span>
                            </div>
                            <div class="signal-details">
                                <div class="signal-price">$${signal.current_price ? signal.current_price.toFixed(4) : signal.price.toFixed(4)}</div>
                                <div>7å¤©ä½ç‚¹: $${signal.low_7d.toFixed(4)}</div>
                                <div>è·ç¦»ä½ç‚¹: +${signal.distance.toFixed(2)}%</div>
                                <div style="color: #00aa00; font-weight: bold;">${rsiText} (< 20)</div>
                                <div class="signal-time">ç¡®è®¤: ${confirmTime}</div>
                            </div>
                        </div>
                    `;
                });
            }
            
            // æ¸²æŸ“å–ç‚¹1ï¼ˆ2å°æ—¶å†…æœ‰æ•ˆï¼‰
            if (signals.sell_point_1 && signals.sell_point_1.length > 0) {
                signals.sell_point_1.forEach(signal => {
                    const rsiText = signal.mark_rsi ? `RSI: ${signal.mark_rsi.toFixed(2)}` : 'RSI: N/A';
                    const signalTime = signal.mark_time || signal.time || 'N/A';
                    const currentPrice = signal.current_price || signal.mark_price || signal.price;
                    const highPrice = signal.high_price || signal.high_7d || signal.price;
                    html += `
                        <div class="signal-box sell-signal">
                            <div class="signal-header">
                                <span class="signal-badge sell">ğŸ“ˆ å–ç‚¹1</span>
                                <span class="signal-symbol">${signal.symbol}</span>
                            </div>
                            <div class="signal-details">
                                <div class="signal-price">$${currentPrice.toFixed(4)}</div>
                                <div>7å¤©é«˜ç‚¹: $${highPrice.toFixed(4)}</div>
                                <div>è·ç¦»é«˜ç‚¹: -${signal.distance.toFixed(2)}%</div>
                                <div style="color: #00ff00; font-weight: bold;">${rsiText} (â‰¥ 60)</div>
                                <div class="signal-time">æ—¶é—´: ${signalTime}</div>
                            </div>
                        </div>
                    `;
                });
            }
            
            // æ¸²æŸ“7å¤©é«˜ç‚¹
            if (signals.day7_high && signals.day7_high.length > 0) {
                signals.day7_high.forEach(signal => {
                    html += `
                        <div class="signal-box high-point">
                            <div class="signal-header">
                                <span class="signal-badge high">ğŸ“Š 7å¤©é«˜ç‚¹</span>
                                <span class="signal-symbol">${signal.symbol}</span>
                            </div>
                            <div class="signal-details">
                                <div class="signal-price">$${signal.price.toFixed(4)}</div>
                                <div>é«˜ç‚¹: $${signal.high_7d.toFixed(4)}</div>
                                <div class="signal-time">${signal.time}</div>
                            </div>
                        </div>
                    `;
                });
            }
            
            // æ¸²æŸ“7å¤©ä½ç‚¹
            if (signals.day7_low && signals.day7_low.length > 0) {
                signals.day7_low.forEach(signal => {
                    html += `
                        <div class="signal-box low-point">
                            <div class="signal-header">
                                <span class="signal-badge low">ğŸ“‰ 7å¤©ä½ç‚¹</span>
                                <span class="signal-symbol">${signal.symbol}</span>
                            </div>
                            <div class="signal-details">
                                <div class="signal-price">$${signal.price.toFixed(4)}</div>
                                <div>ä½ç‚¹: $${signal.low_7d.toFixed(4)}</div>
                                <div class="signal-time">${signal.time}</div>
                            </div>
                        </div>
                    `;
                });
            }
            
            // æ¸²æŸ“48å°æ—¶é«˜ç‚¹
            if (signals.h48_high && signals.h48_high.length > 0) {
                signals.h48_high.forEach(signal => {
                    html += `
                        <div class="signal-box high-point">
                            <div class="signal-header">
                                <span class="signal-badge high">â±ï¸ 48Hé«˜ç‚¹</span>
                                <span class="signal-symbol">${signal.symbol}</span>
                            </div>
                            <div class="signal-details">
                                <div class="signal-price">$${signal.price.toFixed(4)}</div>
                                <div>é«˜ç‚¹: $${signal.high_48h.toFixed(4)}</div>
                                <div class="signal-time">${signal.time}</div>
                            </div>
                        </div>
                    `;
                });
            }
            
            // æ¸²æŸ“48å°æ—¶ä½ç‚¹
            if (signals.h48_low && signals.h48_low.length > 0) {
                signals.h48_low.forEach(signal => {
                    html += `
                        <div class="signal-box low-point">
                            <div class="signal-header">
                                <span class="signal-badge low">â±ï¸ 48Hä½ç‚¹</span>
                                <span class="signal-symbol">${signal.symbol}</span>
                            </div>
                            <div class="signal-details">
                                <div class="signal-price">$${signal.price.toFixed(4)}</div>
                                <div>ä½ç‚¹: $${signal.low_48h.toFixed(4)}</div>
                                <div class="signal-time">${signal.time}</div>
                            </div>
                        </div>
                    `;
                });
            }
            
            container.innerHTML = html;
        }
    </script>
</body>
</html>
