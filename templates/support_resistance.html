<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>æ”¯æ’‘å‹åŠ›çº¿ç³»ç»Ÿ - 27å¸ç§å®æ—¶ç›‘æ§ v3.8</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', sans-serif;
            background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            color: #fff;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            padding: 30px 0;
            border-bottom: 2px solid rgba(255,255,255,0.2);
            margin-bottom: 30px;
        }
        
        h1 {
            font-size: 36px;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        .subtitle {
            font-size: 18px;
            color: rgba(255,255,255,0.8);
        }
        
        .stats-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.2);
            text-align: center;
        }
        
        .stat-card h3 {
            font-size: 14px;
            color: rgba(255,255,255,0.7);
            margin-bottom: 10px;
        }
        
        .stat-card .value {
            font-size: 28px;
            font-weight: bold;
            color: #4ade80;
        }
        
        .table-container {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.2);
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1200px;
        }
        
        th, td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        th {
            background: rgba(255,255,255,0.15);
            font-weight: 600;
            color: #4ade80;
            position: sticky;
            top: 0;
            z-index: 10;
            cursor: pointer;
            user-select: none;
        }
        
        th:hover {
            background: rgba(255,255,255,0.25);
        }
        
        th.sortable::after {
            content: ' â‡…';
            opacity: 0.3;
            font-size: 12px;
        }
        
        th.sort-asc::after {
            content: ' â†‘';
            opacity: 1;
            color: #4ade80;
        }
        
        th.sort-desc::after {
            content: ' â†“';
            opacity: 1;
            color: #4ade80;
        }
        
        tr:hover {
            background: rgba(255,255,255,0.05);
        }
        
        .symbol-cell {
            font-weight: bold;
            color: #fbbf24;
            text-align: left !important;
        }
        
        .price-cell {
            color: #4ade80;
            font-weight: 600;
        }
        
        .support-cell {
            color: #10b981;
        }
        
        .resistance-cell {
            color: #ef4444;
        }
        
        .distance-positive {
            color: #10b981;
        }
        
        .distance-negative {
            color: #ef4444;
        }
        
        .distance-bar {
            width: 100%;
            height: 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            position: relative;
            overflow: hidden;
        }
        
        .distance-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981 0%, #34d399 100%);
            border-radius: 10px;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: bold;
        }
        
        .legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 20px 0;
            font-size: 14px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }
        
        .home-btn {
            padding: 12px 24px;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 12px;
            color: #fff;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            z-index: 100;
        }
        
        .home-btn:hover {
            background: rgba(74,222,128,0.2);
            border-color: #4ade80;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(74,222,128,0.3);
        }
        
        .update-time {
            text-align: center;
            padding: 15px;
            color: rgba(255,255,255,0.6);
            font-size: 14px;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            font-size: 18px;
            color: rgba(255,255,255,0.7);
        }
        
        .update-time-header {
            text-align: center;
            padding: 10px 20px;
            background: rgba(255,255,255,0.05);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            color: rgba(255,255,255,0.7);
            font-size: 14px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }
        
        .update-time-header .time {
            color: #4ade80;
            font-weight: 600;
        }
        
        .update-time-header .refresh-indicator {
            display: inline-block;
            animation: pulse 2s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }
        
        @keyframes slideInDown {
            from {
                transform: translate(-50%, -100px);
                opacity: 0;
            }
            to {
                transform: translate(-50%, 0);
                opacity: 1;
            }
        }
        
        .alert-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: bold;
        }
        
        .alert-near-support {
            background: #10b981;
            color: #fff;
        }
        
        .alert-near-resistance {
            background: #ef4444;
            color: #fff;
        }
        
        /* æ—¶é—´è½´å’Œè¶‹åŠ¿å›¾æ ·å¼ */
        .timeline-section {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.2);
            margin-bottom: 30px;
        }
        
        .timeline-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .date-selector {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .date-selector input[type="date"] {
            padding: 8px 12px;
            border-radius: 8px;
            border: 2px solid rgba(255,255,255,0.3);
            background: rgba(255,255,255,0.1);
            color: #fff;
            font-size: 14px;
            cursor: pointer;
        }
        
        .date-selector input[type="date"]::-webkit-calendar-picker-indicator {
            filter: invert(1);
        }
        
        .nav-buttons {
            display: flex;
            gap: 10px;
        }
        
        .nav-btn {
            padding: 8px 16px;
            border-radius: 8px;
            border: 2px solid rgba(255,255,255,0.3);
            background: rgba(255,255,255,0.1);
            color: #fff;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .nav-btn:hover {
            background: rgba(74,222,128,0.2);
            border-color: #4ade80;
        }
        
        .nav-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        .trend-chart-container {
            height: 400px;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            margin-top: 15px;
        }
        
        /* æ—¶é—´è½´æ ·å¼ */
        .timeline-item {
            display: inline-block;
            margin: 3px;
            padding: 4px 8px;
            background: rgba(74, 222, 128, 0.2);
            border: 1px solid #4ade80;
            border-radius: 4px;
            color: #4ade80;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 11px;
            font-weight: 600;
        }
        
        .timeline-item:hover {
            background: rgba(74, 222, 128, 0.4);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(74, 222, 128, 0.3);
        }
        
        .timeline-item.selected {
            background: #4ade80;
            color: #000;
        }
        
        /* æ—¶é—´è½´æ»šåŠ¨æ¡æ ·å¼ */
        #dailyTimeline::-webkit-scrollbar {
            width: 8px;
        }
        
        #dailyTimeline::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.3);
            border-radius: 4px;
        }
        
        #dailyTimeline::-webkit-scrollbar-thumb {
            background: rgba(74, 222, 128, 0.5);
            border-radius: 4px;
        }
        
        #dailyTimeline::-webkit-scrollbar-thumb:hover {
            background: rgba(74, 222, 128, 0.7);
        }
        
        .page-info {
            text-align: center;
            color: #4ade80;
            font-size: 14px;
            font-weight: 600;
        }
        
        /* å†å²æ•°æ®è¯¦æƒ…å¼¹çª— */
        .history-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }
        
        .history-modal.show {
            display: flex;
        }
        
        .modal-content {
            background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            border-radius: 16px;
            padding: 30px;
            max-width: 900px;
            max-height: 80vh;
            overflow-y: auto;
            border: 2px solid rgba(255,255,255,0.3);
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid rgba(255,255,255,0.2);
            padding-bottom: 15px;
        }
        
        .modal-title {
            font-size: 22px;
            font-weight: bold;
            color: #4ade80;
        }
        
        .modal-close {
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 8px;
            padding: 8px 16px;
            color: #fff;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .modal-close:hover {
            background: rgba(239,68,68,0.3);
            border-color: #ef4444;
        }
        
        .scenario-section {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .scenario-header {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .coin-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .coin-badge {
            background: rgba(255,255,255,0.15);
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.2);
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .coin-badge:hover {
            background: rgba(255,255,255,0.25);
            transform: translateY(-2px);
        }
        
        .coin-symbol {
            font-weight: bold;
            color: #fbbf24;
        }
        
        .coin-price {
            color: #4ade80;
            font-size: 12px;
        }
        
        .coin-position {
            color: rgba(255,255,255,0.7);
            font-size: 11px;
        }
        
        /* ä¿¡å·æ—¶é—´åˆ—è¡¨æ ·å¼ */
        .signal-times-container {
            background: rgba(255,255,255,0.05);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.2);
            margin-bottom: 30px;
        }
        
        .signal-times-header {
            text-align: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .signal-times-header h3 {
            font-size: 16px;
            color: rgba(255,255,255,0.9);
            margin: 0 0 4px 0;
        }
        
        .signal-times-header .time-range {
            font-size: 12px;
            color: rgba(255,255,255,0.5);
        }
        
        .signal-times-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .signal-column {
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            padding: 16px;
        }
        
        .signal-column-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .signal-column-header .icon {
            font-size: 18px;
        }
        
        .signal-column-header h4 {
            font-size: 14px;
            margin: 0;
            font-weight: 600;
        }
        
        .signal-column.buy .signal-column-header h4 {
            color: #4ade80;
        }
        
        .signal-column.sell .signal-column-header h4 {
            color: #ef4444;
        }
        
        .signal-times-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .signal-time-item {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 10px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .signal-time-item.buy {
            background: rgba(74,222,128,0.15);
            border: 1px solid rgba(74,222,128,0.4);
            color: #4ade80;
        }
        
        .signal-time-item.buy:hover {
            background: rgba(74,222,128,0.25);
            transform: translateY(-2px);
        }
        
        .signal-time-item.sell {
            background: rgba(239,68,68,0.15);
            border: 1px solid rgba(239,68,68,0.4);
            color: #ef4444;
        }
        
        .signal-time-item.sell:hover {
            background: rgba(239,68,68,0.25);
            transform: translateY(-2px);
        }
        
        .signal-time-item .icon {
            font-size: 12px;
        }
        
        .signal-no-recent {
            text-align: center;
            color: rgba(255,255,255,0.5);
            font-size: 12px;
            padding: 20px;
        }
        
        /* ä¿¡å·è¯¦æƒ…å¼¹çª—æ ·å¼ */
        .signal-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.85);
            z-index: 9999;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease-out;
        }
        
        .signal-modal.show {
            display: flex;
        }
        
        .signal-modal-content {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 20px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            border: 3px solid;
            box-shadow: 0 20px 60px rgba(0,0,0,0.6);
            animation: modalSlideIn 0.4s ease-out;
        }
        
        .signal-modal-content.buy-modal {
            border-color: #4ade80;
        }
        
        .signal-modal-content.sell-modal {
            border-color: #ef4444;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes modalSlideIn {
            from {
                transform: scale(0.7) translateY(-50px);
                opacity: 0;
            }
            to {
                transform: scale(1) translateY(0);
                opacity: 1;
            }
        }
        
        .signal-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(255,255,255,0.2);
        }
        
        .signal-modal-title {
            font-size: 28px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .signal-modal-title.buy {
            color: #4ade80;
        }
        
        .signal-modal-title.sell {
            color: #ef4444;
        }
        
        .signal-modal-close {
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 10px;
            padding: 10px 20px;
            color: #fff;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .signal-modal-close:hover {
            background: rgba(239,68,68,0.3);
            border-color: #ef4444;
            transform: scale(1.05);
        }
        
        .signal-modal-info {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .signal-info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .signal-info-row:last-child {
            border-bottom: none;
        }
        
        .signal-info-label {
            color: rgba(255,255,255,0.7);
            font-size: 14px;
        }
        
        .signal-info-value {
            color: #fff;
            font-size: 16px;
            font-weight: 600;
        }
        
        .signal-coin-list {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .signal-coin-list::-webkit-scrollbar {
            width: 8px;
        }
        
        .signal-coin-list::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.3);
            border-radius: 4px;
        }
        
        .signal-coin-list::-webkit-scrollbar-thumb {
            background: rgba(74,222,128,0.5);
            border-radius: 4px;
        }
        
        .signal-coin-item {
            background: rgba(255,255,255,0.08);
            border-radius: 10px;
            padding: 12px 15px;
            margin-bottom: 10px;
            border-left: 4px solid;
            transition: all 0.3s;
        }
        
        .signal-coin-item.buy {
            border-color: #4ade80;
        }
        
        .signal-coin-item.sell {
            border-color: #ef4444;
        }
        
        .signal-coin-item:hover {
            background: rgba(255,255,255,0.12);
            transform: translateX(5px);
        }
        
        .signal-coin-symbol {
            font-size: 18px;
            font-weight: bold;
            color: #fbbf24;
            margin-bottom: 5px;
        }
        
        .signal-coin-details {
            font-size: 13px;
            color: rgba(255,255,255,0.8);
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        /* è®¾ç½®å¼€å…³æ ·å¼ */
        .settings-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10001;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 15px 20px;
            border: 2px solid rgba(255,255,255,0.2);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        .settings-toggle h4 {
            color: #fff;
            font-size: 14px;
            margin: 0 0 12px 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .toggle-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            gap: 15px;
        }
        
        .toggle-item:last-child {
            margin-bottom: 0;
        }
        
        .toggle-label {
            color: rgba(255,255,255,0.9);
            font-size: 13px;
            white-space: nowrap;
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 44px;
            height: 24px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #555;
            transition: 0.3s;
            border-radius: 24px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: #4ade80;
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(20px);
        }
        
        .settings-toggle-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            background: rgba(74,222,128,0.9);
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 24px;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        .settings-toggle-btn:hover {
            transform: scale(1.1);
            background: rgba(74,222,128,1);
        }
        
        .settings-panel {
            display: none;
        }
        
        .settings-panel.show {
            display: block;
        }
        
        /* Toggle Switch æ ·å¼ */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 26px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255,255,255,0.3);
            transition: 0.4s;
            border-radius: 26px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: #10b981;
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }
    </style>
</head>
<body>
    <!-- éŸ³æ•ˆå…ƒç´  -->
    <audio id="buySignalSound" preload="auto">
        <source src="data:audio/wav;base64,UklGRhQEAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YfADAAD/////AQAAAP//AAD//wAAAQAAAAD///8A/v///wIA///+/wAAAgD//v4AAAAA/wABAAAA//8AAAAA//8AAAAAAAD///////8AAP//AAAAAP//AAAAAAAA//8AAAAA" type="audio/wav">
    </audio>
    <audio id="sellSignalSound" preload="auto">
        <source src="data:audio/wav;base64,UklGRhQEAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YfADAAD/////AQAAAP//AAD//wAAAQAAAAD///8A/v///wIA///+/wAAAgD//v4AAAAA/wABAAAA//8AAAAA//8AAAAAAAD///////8AAP//AAAAAP//AAAAAAAA//8AAAAA" type="audio/wav">
    </audio>
    
    <!-- ä¿¡å·è¯¦æƒ…å¼¹çª— -->
    <div id="signalModal" class="signal-modal">
        <div id="signalModalContent" class="signal-modal-content">
            <div class="signal-modal-header">
                <div id="signalModalTitle" class="signal-modal-title"></div>
                <button class="signal-modal-close" onclick="closeSignalModal()">âœ• å…³é—­</button>
            </div>
            <div id="signalModalBody"></div>
        </div>
    </div>
    <!-- è®¾ç½®æŒ‰é’® -->
    <div class="settings-toggle-btn" onclick="toggleSettings()" title="ä¿¡å·è®¾ç½®">
        âš™ï¸
    </div>
    
    <!-- è®¾ç½®é¢æ¿ -->
    <div id="settingsPanel" class="settings-toggle settings-panel">
        <h4>ğŸ”” ä¿¡å·æé†’è®¾ç½®</h4>
        <div class="toggle-item">
            <span class="toggle-label">ğŸ”Š éŸ³æ•ˆæé†’</span>
            <label class="toggle-switch">
                <input type="checkbox" id="soundToggle" checked onchange="saveSettings()">
                <span class="toggle-slider"></span>
            </label>
        </div>
        <div class="toggle-item">
            <span class="toggle-label">ğŸ¯ å¼¹çª—æé†’</span>
            <label class="toggle-switch">
                <input type="checkbox" id="popupToggle" checked onchange="saveSettings()">
                <span class="toggle-slider"></span>
            </label>
        </div>
        <div class="toggle-item">
            <span class="toggle-label">ğŸ“± é€šçŸ¥æ¡</span>
            <label class="toggle-switch">
                <input type="checkbox" id="notificationToggle" checked onchange="saveSettings()">
                <span class="toggle-slider"></span>
            </label>
        </div>
        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1);">
            <div style="font-size: 0.85rem; color: rgba(255,255,255,0.6); margin-bottom: 10px;">ğŸ§ª æµ‹è¯•åŠŸèƒ½</div>
            <button onclick="testBuySignal()" style="width: 100%; padding: 8px; margin-bottom: 8px; background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%); border: none; border-radius: 6px; color: white; font-weight: 600; cursor: pointer;">
                ğŸ“ˆ æµ‹è¯•æŠ„åº•ä¿¡å·
            </button>
            <button onclick="testSellSignal()" style="width: 100%; padding: 8px; background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); border: none; border-radius: 6px; color: white; font-weight: 600; cursor: pointer;">
                ğŸ“‰ æµ‹è¯•é€ƒé¡¶ä¿¡å·
            </button>
        </div>
    </div>
    
    <div class="container">
        <div style="display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap;">
            <a href="/" class="home-btn">
                <span>ğŸ </span>
                <span>è¿”å›é¦–é¡µ</span>
            </a>
            <button onclick="exportData()" class="home-btn" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                <span>ğŸ“¥</span>
                <span>å¯¼å‡ºæ•°æ®</span>
            </button>
            <button onclick="showImportModal()" class="home-btn" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
                <span>ğŸ“¤</span>
                <span>å¯¼å…¥æ•°æ®</span>
            </button>
            <button onclick="showTelegramSettingsModal()" class="home-btn" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);">
                <span>âš™ï¸</span>
                <span>TGè®¾ç½®</span>
            </button>
        </div>
        
        <div class="update-time-header">
            <span>ğŸ“¡ æœ€åæ›´æ–°:</span>
            <span class="time" id="lastUpdateTime">--</span>
            <span class="refresh-indicator">â—</span>
            <span style="color: rgba(255,255,255,0.5);">| æ¯30ç§’è‡ªåŠ¨åˆ·æ–°</span>
        </div>
        
        <div class="header">
            <h1>ğŸ“Š æ”¯æ’‘å‹åŠ›çº¿ç³»ç»Ÿ <span style="font-size: 14px; color: #4ade80;">[v3.8 - ä¿¡å·é¢æ¿ ğŸ‰]</span></h1>
            <div class="subtitle">BTC/ETH/XRP/BNB/SOLç­‰27ä¸ªä¸»æµå¸ç§æ°¸ç»­åˆçº¦çš„æ”¯æ’‘çº¿å’Œå‹åŠ›çº¿å®æ—¶ç›‘æ§ | æŒ‰é’®: â† æ›´æ—© / æ›´æ™š â†’</div>
        </div>
        
        <!-- 24å°æ—¶ä¿¡å·æ—¶é—´åˆ—è¡¨ -->
        <div class="signal-times-container">
            <div class="signal-times-header">
                <h3>ğŸ¯ 24å°æ—¶äº¤æ˜“ä¿¡å·æ—¶é—´ï¼ˆæœ€è¿‘24å°æ—¶å†…è§¦å‘ï¼‰</h3>
                <span class="time-range" id="timeRange">--</span>
            </div>
            
            <div class="signal-times-content">
                <!-- æŠ„åº•ä¿¡å·åˆ— -->
                <div class="signal-column buy">
                    <div class="signal-column-header">
                        <span class="icon">ğŸ“</span>
                        <h4>æŠ„åº•</h4>
                    </div>
                    <div class="signal-times-list" id="buySignalsList">
                        <div class="signal-no-recent">æ­£åœ¨åŠ è½½...</div>
                    </div>
                </div>
                
                <!-- é€ƒé¡¶ä¿¡å·åˆ— -->
                <div class="signal-column sell">
                    <div class="signal-column-header">
                        <span class="icon">ğŸ“</span>
                        <h4>é€ƒé¡¶</h4>
                    </div>
                    <div class="signal-times-list" id="sellSignalsList">
                        <div class="signal-no-recent">æ­£åœ¨åŠ è½½...</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 2å°æ—¶é€ƒé¡¶ä¿¡å·ç»Ÿè®¡å›¾ -->
        <div class="timeline-section" style="margin-top: 30px;">
            <div class="timeline-header">
                <div>
                    <h2 style="font-size: 20px; margin-bottom: 5px;">ğŸš¨ 2å°æ—¶é€ƒé¡¶ä¿¡å·ç»Ÿè®¡</h2>
                    <p style="color: rgba(255,255,255,0.6); font-size: 13px;">æ¯5åˆ†é’Ÿç»Ÿè®¡ä¸€æ¬¡æ¥è¿‘å‹åŠ›çº¿çš„å¸ç§æ•°é‡ï¼ˆæƒ…å†µ3+æƒ…å†µ4ï¼‰</p>
                </div>
                <div style="background: rgba(239,68,68,0.2); padding: 12px 20px; border-radius: 8px; border: 2px solid rgba(239,68,68,0.5);">
                    <span style="color: rgba(255,255,255,0.8); font-size: 14px; margin-right: 10px;">å½“å‰ä¿¡å·æ€»æ•°</span>
                    <strong style="color: #ef4444; font-size: 24px;" id="escapeCurrentCount">-</strong>
                    <span style="color: rgba(255,255,255,0.6); font-size: 14px; margin-left: 5px;">ä¸ª</span>
                </div>
            </div>
            <div id="escapeSignalChart" class="trend-chart-container"></div>
            <p style="color: rgba(255,255,255,0.6); font-size: 13px; margin-top: 10px; text-align: center;">
                ğŸ’¡ æç¤º: é¼ æ ‡æ‚¬åœæŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ | æ¯3åˆ†é’Ÿè‡ªåŠ¨åˆ·æ–° | æ˜¾ç¤ºæ‰€æœ‰æ¥è¿‘å‹åŠ›çº¿çš„è®°å½•
            </p>
        </div>
        
        <!-- å…¨å±€è¶‹åŠ¿å›¾ -->
        <div class="timeline-section" style="margin-top: 30px;">
            <!-- é€ƒé¡¶ä¿¡å·ç»Ÿè®¡ï¼ˆå·¦å³å¹¶æ’ï¼‰-->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                <!-- 24å°æ—¶é€ƒé¡¶ç»Ÿè®¡ -->
                <div style="text-align: center; padding: 20px; background: linear-gradient(135deg, rgba(239, 68, 68, 0.15) 0%, rgba(220, 38, 38, 0.15) 100%); border-radius: 12px; border: 2px solid rgba(239, 68, 68, 0.3);">
                    <div style="font-size: 16px; color: rgba(255,255,255,0.8); margin-bottom: 8px;">ğŸ“ 2å°æ—¶é€ƒé¡¶ä¿¡å·ç»Ÿè®¡</div>
                    <div id="escape24hCount" style="font-size: 42px; font-weight: 700; color: #ef4444; text-shadow: 0 2px 8px rgba(239, 68, 68, 0.5); letter-spacing: 2px;">-</div>
                    <div style="font-size: 14px; color: rgba(255,255,255,0.6); margin-top: 5px;">ä¸ªé€ƒé¡¶ä¿¡å·ï¼ˆæœ€è¿‘24å°æ—¶ï¼‰</div>
                </div>
                
                <!-- 2å°æ—¶é€ƒé¡¶ç»Ÿè®¡ -->
                <div style="text-align: center; padding: 20px; background: linear-gradient(135deg, rgba(249, 115, 22, 0.15) 0%, rgba(234, 88, 12, 0.15) 100%); border-radius: 12px; border: 2px solid rgba(249, 115, 22, 0.3);">
                    <div style="font-size: 16px; color: rgba(255,255,255,0.8); margin-bottom: 8px;">âš¡ 2å°æ—¶é€ƒé¡¶ä¿¡å·ç»Ÿè®¡</div>
                    <div id="escape2hCount" style="font-size: 42px; font-weight: 700; color: #f97316; text-shadow: 0 2px 8px rgba(249, 115, 22, 0.5); letter-spacing: 2px;">-</div>
                    <div style="font-size: 14px; color: rgba(255,255,255,0.6); margin-top: 5px;">ä¸ªé€ƒé¡¶ä¿¡å·ï¼ˆæœ€è¿‘2å°æ—¶ï¼‰</div>
                </div>
            </div>
            
            <div class="timeline-header">
                <div>
                    <h2 style="font-size: 20px; margin-bottom: 5px;">ğŸ“ˆ å…¨å±€è¶‹åŠ¿å›¾ï¼ˆæ‰€æœ‰å†å²æ•°æ®ï¼‰</h2>
                    <p style="color: rgba(255,255,255,0.6); font-size: 13px;">æ˜¾ç¤ºä»å¼€å§‹åˆ°ç°åœ¨çš„æ‰€æœ‰é‡‡æ ·æ•°æ®</p>
                </div>
            </div>
            <div id="globalTrendChart" class="trend-chart-container"></div>
            <p style="color: rgba(255,255,255,0.6); font-size: 13px; margin-top: 10px; text-align: center;">
                ğŸ’¡ æç¤º: æ­¤å›¾è¡¨æ˜¾ç¤ºæ‰€æœ‰å†å²è¶‹åŠ¿ï¼Œä¸å—æ—¥æœŸé€‰æ‹©å½±å“
            </p>
        </div>
        
        <!-- 12å°æ—¶åˆ†é¡µè¶‹åŠ¿å›¾ -->
        <div class="timeline-section" style="margin-top: 30px;">
            <div class="timeline-header">
                <div>
                    <h2 style="font-size: 20px; margin-bottom: 5px;">ğŸ“Š 12å°æ—¶åˆ†é¡µè¶‹åŠ¿å›¾ï¼ˆå…¨å†å²åˆ†é¡µï¼‰</h2>
                    <p style="color: rgba(255,255,255,0.6); font-size: 13px;">å·¦å³ç¿»é¡µæŸ¥çœ‹æ‰€æœ‰å†å²æ•°æ®ï¼Œæ¯é¡µ12å°æ—¶</p>
                </div>
                <div class="nav-buttons">
                    <button class="nav-btn" id="prevPage">â† æ›´æ—©</button>
                    <div class="page-info" id="pagedPageInfo">ç¬¬ 1 é¡µ</div>
                    <button class="nav-btn" id="nextPage">æ›´æ™š â†’</button>
                </div>
            </div>
            <div id="pagedTrendChart" class="trend-chart-container"></div>
            <p style="color: rgba(255,255,255,0.6); font-size: 13px; margin-top: 10px; text-align: center;">
                ğŸ’¡ æç¤º: ç‚¹å‡»æ•°æ®ç‚¹æŸ¥çœ‹è¯¦æƒ… | è·¨æ—¥æœŸè‡ªåŠ¨æ˜¾ç¤ºç«–çº¿åˆ†å‰²
            </p>
        </div>
        
        <!-- æ¯æ—¥æ—¶é—´è½´ -->
        <div class="timeline-section" style="margin-top: 30px;">
            <div class="timeline-header">
                <div>
                    <h2 style="font-size: 20px; margin-bottom: 5px;">ğŸ• æ¯æ—¥æ—¶é—´è½´</h2>
                    <p style="color: rgba(255,255,255,0.6); font-size: 13px;">é€‰æ‹©æ—¥æœŸæŸ¥çœ‹è¯¥å¤©çš„æ‰€æœ‰å¿«ç…§æ—¶é—´ç‚¹</p>
                </div>
                <div class="date-selector">
                    <label style="color: rgba(255,255,255,0.8);">é€‰æ‹©æ—¥æœŸ:</label>
                    <input type="date" id="datePicker" />
                </div>
            </div>
            <div id="dailyTimeline" style="background: rgba(0,0,0,0.3); border-radius: 8px; padding: 20px; max-height: 200px; overflow-y: auto; margin-top: 15px;">
                <p style="color: rgba(255,255,255,0.6); text-align: center;">è¯·é€‰æ‹©æ—¥æœŸæŸ¥çœ‹å½“å¤©çš„å¿«ç…§æ—¶é—´ç‚¹</p>
            </div>
            <p style="color: rgba(255,255,255,0.6); font-size: 13px; margin-top: 10px; text-align: center;">
                ğŸ’¡ æç¤º: ç‚¹å‡»æ—¶é—´ç‚¹æŸ¥çœ‹è¯¥æ—¶åˆ»çš„è¯¦ç»†å¸ç§åˆ—è¡¨
            </p>
        </div>
        
        <!-- å†å²æ•°æ®è¯¦æƒ…å¼¹çª— -->
        <div class="history-modal" id="historyModal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title" id="modalTitle">ğŸ• åŠ è½½ä¸­...</div>
                    <button class="modal-close" onclick="closeHistoryModal()">âœ• å…³é—­</button>
                </div>
                <div id="modalBody">
                    <p style="text-align: center; color: rgba(255,255,255,0.6);">æ­£åœ¨åŠ è½½æ•°æ®...</p>
                </div>
            </div>
        </div>
        
        <div class="stats-summary" id="statsSummary">
            <div class="stat-card">
                <h3>ç›‘æ§å¸ç§æ•°</h3>
                <div class="value" id="totalCoins">0</div>
            </div>
            <div class="stat-card">
                <h3>æ¥è¿‘æ”¯æ’‘çº¿1 (è·ç¦»<5%)</h3>
                <div class="value" id="nearSupport1" style="color: #10b981;">0</div>
            </div>
            <div class="stat-card">
                <h3>æ¥è¿‘æ”¯æ’‘çº¿2 (è·ç¦»<5%)</h3>
                <div class="value" id="nearSupport2" style="color: #10b981;">0</div>
            </div>
            <div class="stat-card">
                <h3>æ¥è¿‘å‹åŠ›çº¿1 (è·ç¦»<5%)</h3>
                <div class="value" id="nearResistance1" style="color: #ef4444;">0</div>
            </div>
            <div class="stat-card">
                <h3>æ¥è¿‘å‹åŠ›çº¿2 (è·ç¦»<5%)</h3>
                <div class="value" id="nearResistance2" style="color: #ef4444;">0</div>
            </div>
        </div>
        
        <!-- 4ç§é¢„è­¦æƒ…å†µå±•ç¤ºæ¡† -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 20px 0; max-width: 1400px;">
            <!-- 48hä½ä½é¢„è­¦ -->
            <div style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.15), rgba(16, 185, 129, 0.05)); border: 2px solid rgba(16, 185, 129, 0.4); border-radius: 12px; padding: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.3);">
                <div style="color: #10b981; font-size: 1.1rem; font-weight: bold; margin-bottom: 8px;">
                    ğŸ“‰ 48hä½ä½é¢„è­¦
                </div>
                <div style="color: rgba(255,255,255,0.6); font-size: 0.85rem; margin-bottom: 12px; line-height: 1.5;">
                    48hä½ç½® â‰¤ 5%ï¼ˆæ¥è¿‘48å°æ—¶æœ€ä½ç‚¹ï¼‰<br/>
                    <span style="color: rgba(16, 185, 129, 0.8);">çŸ­æœŸè¶…è·Œï¼Œå¯èƒ½åå¼¹</span>
                </div>
                <div id="alert-48h-low-coins" style="color: #fff; font-size: 0.95rem; min-height: 30px; display: flex; flex-wrap: wrap; gap: 6px;">
                    <span style="color: rgba(255,255,255,0.3);">åŠ è½½ä¸­...</span>
                </div>
            </div>
            
            <!-- 7å¤©ä½ä½é¢„è­¦ -->
            <div style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.15), rgba(16, 185, 129, 0.05)); border: 2px solid rgba(16, 185, 129, 0.4); border-radius: 12px; padding: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.3);">
                <div style="color: #10b981; font-size: 1.1rem; font-weight: bold; margin-bottom: 8px;">
                    ğŸ“‰ 7å¤©ä½ä½é¢„è­¦
                </div>
                <div style="color: rgba(255,255,255,0.6); font-size: 0.85rem; margin-bottom: 12px; line-height: 1.5;">
                    7å¤©ä½ç½® â‰¤ 5%ï¼ˆæ¥è¿‘7å¤©æœ€ä½ç‚¹ï¼‰<br/>
                    <span style="color: rgba(16, 185, 129, 0.8);">ä¸­æœŸæ”¯æ’‘ä½ï¼Œå¼ºæ”¯æ’‘åŒºåŸŸ</span>
                </div>
                <div id="alert-7d-low-coins" style="color: #fff; font-size: 0.95rem; min-height: 30px; display: flex; flex-wrap: wrap; gap: 6px;">
                    <span style="color: rgba(255,255,255,0.3);">åŠ è½½ä¸­...</span>
                </div>
            </div>
            
            <!-- 48hé«˜ä½é¢„è­¦ -->
            <div style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.15), rgba(239, 68, 68, 0.05)); border: 2px solid rgba(239, 68, 68, 0.4); border-radius: 12px; padding: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.3);">
                <div style="color: #ef4444; font-size: 1.1rem; font-weight: bold; margin-bottom: 8px;">
                    ğŸ“ˆ 48hé«˜ä½é¢„è­¦
                </div>
                <div style="color: rgba(255,255,255,0.6); font-size: 0.85rem; margin-bottom: 12px; line-height: 1.5;">
                    48hä½ç½® â‰¥ 95%ï¼ˆæ¥è¿‘48å°æ—¶æœ€é«˜ç‚¹ï¼‰<br/>
                    <span style="color: rgba(239, 68, 68, 0.8);">çŸ­æœŸè¶…ä¹°ï¼Œå¯èƒ½å›è°ƒ</span>
                </div>
                <div id="alert-48h-high-coins" style="color: #fff; font-size: 0.95rem; min-height: 30px; display: flex; flex-wrap: wrap; gap: 6px;">
                    <span style="color: rgba(255,255,255,0.3);">åŠ è½½ä¸­...</span>
                </div>
            </div>
            
            <!-- 7å¤©é«˜ä½é¢„è­¦ -->
            <div style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.15), rgba(239, 68, 68, 0.05)); border: 2px solid rgba(239, 68, 68, 0.4); border-radius: 12px; padding: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.3);">
                <div style="color: #ef4444; font-size: 1.1rem; font-weight: bold; margin-bottom: 8px;">
                    ğŸ“ˆ 7å¤©é«˜ä½é¢„è­¦
                </div>
                <div style="color: rgba(255,255,255,0.6); font-size: 0.85rem; margin-bottom: 12px; line-height: 1.5;">
                    7å¤©ä½ç½® â‰¥ 95%ï¼ˆæ¥è¿‘7å¤©æœ€é«˜ç‚¹ï¼‰<br/>
                    <span style="color: rgba(239, 68, 68, 0.8);">ä¸­æœŸå‹åŠ›ä½ï¼Œå¼ºå‹åŠ›åŒºåŸŸ</span>
                </div>
                <div id="alert-7d-high-coins" style="color: #fff; font-size: 0.95rem; min-height: 30px; display: flex; flex-wrap: wrap; gap: 6px;">
                    <span style="color: rgba(255,255,255,0.3);">åŠ è½½ä¸­...</span>
                </div>
            </div>
        </div>
        
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background: #10b981;"></div>
                <span>æ”¯æ’‘çº¿ (7å¤©/48å°æ—¶æœ€ä½ç‚¹)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #ef4444;"></div>
                <span>å‹åŠ›çº¿ (7å¤©/48å°æ—¶æœ€é«˜ç‚¹)</span>
            </div>
        </div>
        
        <div class="table-container">
            <div id="loading" class="loading">æ­£åœ¨åŠ è½½æ•°æ®...</div>
            <table id="dataTable" style="display: none;">
                <thead>
                    <tr>
                        <th>å¸ç§</th>
                        <th>å½“å‰ä»·æ ¼</th>
                        <th class="sortable" data-sort="support_line_1">æ”¯æ’‘çº¿1<br/>(7å¤©æœ€ä½)</th>
                        <th class="sortable" data-sort="resistance_line_1">å‹åŠ›çº¿1<br/>(7å¤©æœ€é«˜)</th>
                        <th class="sortable" data-sort="position_7d" title="7å¤©èŒƒå›´ä½ç½®: 7å¤©æœ€ä½=0%, 7å¤©æœ€é«˜=100%">7å¤©ä½ç½®%</th>
                        <th class="sortable" data-sort="support_line_2">æ”¯æ’‘çº¿2<br/>(48hæœ€ä½)</th>
                        <th class="sortable" data-sort="resistance_line_2">å‹åŠ›çº¿2<br/>(48hæœ€é«˜)</th>
                        <th class="sortable" data-sort="position_48h" title="48hèŒƒå›´ä½ç½®: 48hæœ€ä½=0%, 48hæœ€é«˜=100%">48hä½ç½®%</th>
                        <th>é¢„è­¦</th>
                    </tr>
                </thead>
                <tbody id="tableBody"></tbody>
            </table>
            <div class="update-time" id="updateTime"></div>
        </div>
    </div>
    
    <!-- ä¿¡å·å¼¹çª— -->
    <div id="signalModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10000; justify-content: center; align-items: center;">
        <div style="background: linear-gradient(135deg, #1e3a5f 0%, #2d5a7b 100%); border-radius: 20px; padding: 40px; max-width: 600px; width: 90%; box-shadow: 0 10px 50px rgba(0,0,0,0.5); border: 2px solid rgba(255,255,255,0.2); animation: modalBounce 0.5s ease-out;">
            <div id="modalContent" style="text-align: center;">
                <!-- åŠ¨æ€å†…å®¹å°†åœ¨è¿™é‡Œæ’å…¥ -->
            </div>
            <button onclick="closeSignalModal()" style="margin-top: 30px; width: 100%; padding: 15px; font-size: 18px; font-weight: bold; border: none; border-radius: 10px; cursor: pointer; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; transition: all 0.3s;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">æˆ‘çŸ¥é“äº†</button>
        </div>
    </div>
    
    <!-- éŸ³æ•ˆå…ƒç´  -->
    <audio id="buySignalSound" preload="auto">
        <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIG2m98OScTgwOUKXh8LtpIAU7kdvy0H4yBSh+zPLaizsKF2S57OihUhELTKXh8bllHgU2jdXu0oU1BShzzO/ekEIIDFar6OyrWBUIQ5zd8sFuJAUtgs/y2Ik2Bxpqve/mnU4MDlGl4fC7aSAFOZHZ8tB+MgUofszy2os7ChZkvunqoVIRC0yk4fG5ZR4FNo3V7tKFNQUoc8zv3pBCCAxWq+jsq1gVCEOc3fLBbiQFLYLP8tiJNgcaab3v5p1ODA5RpOHwu2kgBTmR2fLQfjIFKH7M8tqLOwoWY73o6qFSEQtMpOHxuWUeBTaN1e7ShTUFKHLM796QQggMVqvo7KtYFQhDnN3ywW4kBS2Cz/LYiTYHGmm97+adTgwOUaTh8LtpIAU5kdny0H4yBSh+zPLaizsKFmO96OqhUhELTKTh8bllHgU2jdXu0oU1BShy" type="audio/wav">
    </audio>
    <audio id="sellSignalSound" preload="auto">
        <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAAB/f398fHt6enh3dnV0cnFwbm1ramlnZWRiYV9eXFtZWFZVU1JQT01MSklHRkRDQT8+PDo5Nzc1NDIxLy4sKykpJyYkIyIhHx4dGxoZGBcWFRQTEhEQDw4NDAsKCQgHBgUEAwIBAP///v3+/fz8/Pv6+fn4+Pf39vb19PT08/Ly8fHw7+/u7u3t7Ovu7u3s7Ovr6urp6ejn5+bm5eXk5OPj4uLh4eHg4ODf397e3d3c3Nzb29va2tnZ2djY19fX1tbW1dXV1NTT09PS0tHR0dDQz8/Pzs7Ozc3MzMzLy8vKysrJycjIx8fHxsbGxcXExMPDw8LCwsHBwMDAwMC/v7++vr69vby8vLu7urq5ubm4uLi3t7a2tra1tbW0tLSzs7KysrGxsLCwsK+vr66urq2tra2srKurqqqqqqmpqKinp6ampqWlpKSkpKOjo6KioqKhoaCgoJ+fn5+enp2dnZ2cnJubm5qamp6enp2dnZycnJubm5ubmpqampmZmZmZmJiYmJeXl5eXlpaWlpWVlZWVlJSUlJOTk5OTkpKSkpKSkZGRkZGQkJCQj4+Pj4+Ojo6Ojo2NjY2NjIyMjIyMi4uLi4uLioqKioqKiYmJiYmJiIiIiIiIh4eHh4eHhoaGhoaGhYWFhYWFhISEhISEg4ODg4ODgoKCgoKCgYGBgYGBgICAgICA" type="audio/wav">
    </audio>
    
    <style>
        @keyframes modalBounce {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); opacity: 1; }
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .signal-icon {
            font-size: 80px;
            margin: 20px 0;
            animation: pulse 1s infinite;
        }
        
        .signal-title {
            font-size: 36px;
            font-weight: bold;
            margin: 20px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        .signal-description {
            font-size: 18px;
            line-height: 1.6;
            color: rgba(255,255,255,0.9);
            margin: 15px 0;
        }
        
        .signal-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 25px 0;
        }
        
        .signal-stat-item {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 15px;
            backdrop-filter: blur(10px);
        }
        
        .signal-stat-label {
            font-size: 14px;
            color: rgba(255,255,255,0.7);
            margin-bottom: 5px;
        }
        
        .signal-stat-value {
            font-size: 28px;
            font-weight: bold;
        }
    </style>
    
    <!-- Telegram è®¾ç½®æ¨¡æ€æ¡† -->
    <div id="telegramSettingsModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10000; justify-content: center; align-items: center;">
        <div style="background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%); border-radius: 16px; padding: 30px; max-width: 600px; width: 90%; box-shadow: 0 10px 40px rgba(0,0,0,0.5);">
            <h2 style="margin: 0 0 20px 0; font-size: 24px; display: flex; align-items: center; gap: 10px;">
                <span>âš™ï¸</span>
                <span>Telegram ä¿¡å·æ¨é€è®¾ç½®</span>
            </h2>
            
            <div style="background: rgba(255,255,255,0.1); border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                <p style="margin: 0 0 10px 0; font-size: 14px; color: rgba(255,255,255,0.9);">
                    ğŸ’¡ æç¤º:
                </p>
                <ul style="margin: 0; padding-left: 20px; font-size: 13px; color: rgba(255,255,255,0.8); line-height: 1.8;">
                    <li>å¯ç”¨åï¼Œç¬¦åˆæ¡ä»¶çš„ä¿¡å·ä¼šè‡ªåŠ¨æ¨é€åˆ° Telegram</li>
                    <li>å•ä¸€ä¿¡å·ï¼šåªè§¦å‘æ”¯æ’‘1æˆ–æ”¯æ’‘2ï¼Œåªè§¦å‘å‹åŠ›1æˆ–å‹åŠ›2</li>
                    <li>åŒé‡ä¿¡å·ï¼šåŒæ—¶è§¦å‘æ”¯æ’‘1å’Œæ”¯æ’‘2ï¼ŒåŒæ—¶è§¦å‘å‹åŠ›1å’Œå‹åŠ›2</li>
                    <li>æ¨é€é—´éš”ï¼š300ç§’ (5åˆ†é’Ÿ) å†·å´æ—¶é—´</li>
                </ul>
            </div>
            
            <div style="margin-bottom: 20px;">
                <h3 style="font-size: 16px; margin-bottom: 15px; color: #4ade80;">ğŸ“ ä¿¡å·ç±»å‹å¼€å…³</h3>
                
                <!-- æŠ„åº•ä¿¡å· -->
                <div style="background: rgba(255,255,255,0.1); border-radius: 8px; padding: 15px; margin-bottom: 12px; display: flex; align-items: center; justify-content: space-between;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 20px;">ğŸŸ¢</span>
                        <div>
                            <div style="font-weight: 600; font-size: 15px;">æŠ„åº•ä¿¡å·</div>
                            <div style="font-size: 12px; color: rgba(255,255,255,0.7);">è§¦å‘æ”¯æ’‘çº¿1æˆ–æ”¯æ’‘çº¿2</div>
                        </div>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="toggle_buy">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                
                <!-- é€ƒé¡¶ä¿¡å· -->
                <div style="background: rgba(255,255,255,0.1); border-radius: 8px; padding: 15px; margin-bottom: 12px; display: flex; align-items: center; justify-content: space-between;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 20px;">ğŸ”´</span>
                        <div>
                            <div style="font-weight: 600; font-size: 15px;">é€ƒé¡¶ä¿¡å·</div>
                            <div style="font-size: 12px; color: rgba(255,255,255,0.7);">è§¦å‘å‹åŠ›çº¿1æˆ–å‹åŠ›çº¿2</div>
                        </div>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="toggle_sell">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                
                <!-- åŒé‡æŠ„åº•ä¿¡å· -->
                <div style="background: rgba(255,255,255,0.1); border-radius: 8px; padding: 15px; margin-bottom: 12px; display: flex; align-items: center; justify-content: space-between;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 20px;">ğŸŸ¢ğŸŸ¢</span>
                        <div>
                            <div style="font-weight: 600; font-size: 15px;">åŒé‡æŠ„åº•ä¿¡å·</div>
                            <div style="font-size: 12px; color: rgba(255,255,255,0.7);">åŒæ—¶è§¦å‘æ”¯æ’‘çº¿1å’Œæ”¯æ’‘çº¿2</div>
                        </div>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="toggle_double_buy">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                
                <!-- åŒé‡é€ƒé¡¶ä¿¡å· -->
                <div style="background: rgba(255,255,255,0.1); border-radius: 8px; padding: 15px; display: flex; align-items: center; justify-content: space-between;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 20px;">ğŸ”´ğŸ”´</span>
                        <div>
                            <div style="font-weight: 600; font-size: 15px;">åŒé‡é€ƒé¡¶ä¿¡å·</div>
                            <div style="font-size: 12px; color: rgba(255,255,255,0.7);">åŒæ—¶è§¦å‘å‹åŠ›çº¿1å’Œå‹åŠ›çº¿2</div>
                        </div>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="toggle_double_sell">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>
            
            <div style="display: flex; gap: 10px;">
                <button onclick="closeTelegramSettingsModal()" style="flex: 1; padding: 12px; font-size: 16px; font-weight: 600; border: none; border-radius: 8px; cursor: pointer; background: rgba(255,255,255,0.2); color: white; transition: all 0.3s;">
                    å–æ¶ˆ
                </button>
                <button onclick="saveTelegramSettings()" style="flex: 1; padding: 12px; font-size: 16px; font-weight: 600; border: none; border-radius: 8px; cursor: pointer; background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; transition: all 0.3s;">
                    ä¿å­˜è®¾ç½®
                </button>
            </div>
        </div>
    </div>
    
    <script>
        let currentData = [];
        let currentSortField = null;
        let currentSortOrder = 'desc';
        let trendChart = null;
        // ä½¿ç”¨åŒ—äº¬æ—¶é—´è·å–ä»Šå¤©çš„æ—¥æœŸ
        function getBeijingDate() {
            const now = new Date();
            // è½¬æ¢ä¸ºåŒ—äº¬æ—¶é—´ (UTC+8)
            const beijingTime = new Date(now.getTime() + (now.getTimezoneOffset() * 60000) + (8 * 3600000));
            return beijingTime.toISOString().split('T')[0];
        }
        let currentDate = getBeijingDate();
        let globalTrendChart; // å…¨å±€è¶‹åŠ¿å›¾
        let pagedTrendChart; // 12å°æ—¶åˆ†é¡µè¶‹åŠ¿å›¾
        let escapeSignalChart; // 24å°æ—¶é€ƒé¡¶ä¿¡å·ç»Ÿè®¡å›¾
        
        // è®¾ç½®çŠ¶æ€ï¼ˆä»localStorageåŠ è½½ï¼‰
        let signalSettings = {
            soundEnabled: true,
            popupEnabled: true,
            notificationEnabled: true
        };
        
        // åŠ è½½è®¾ç½®
        function loadSettings() {
            const saved = localStorage.getItem('signalSettings');
            if (saved) {
                signalSettings = JSON.parse(saved);
            }
            
            // åŒæ­¥åˆ°UI
            document.getElementById('soundToggle').checked = signalSettings.soundEnabled;
            document.getElementById('popupToggle').checked = signalSettings.popupEnabled;
            document.getElementById('notificationToggle').checked = signalSettings.notificationEnabled;
            
            console.log('ğŸ“ å·²åŠ è½½è®¾ç½®:', signalSettings);
        }
        
        // ä¿å­˜è®¾ç½®
        function saveSettings() {
            signalSettings.soundEnabled = document.getElementById('soundToggle').checked;
            signalSettings.popupEnabled = document.getElementById('popupToggle').checked;
            signalSettings.notificationEnabled = document.getElementById('notificationToggle').checked;
            
            localStorage.setItem('signalSettings', JSON.stringify(signalSettings));
            
            console.log('ğŸ’¾ å·²ä¿å­˜è®¾ç½®:', signalSettings);
        }
        
        // åˆ‡æ¢è®¾ç½®é¢æ¿
        function toggleSettings() {
            const panel = document.getElementById('settingsPanel');
            panel.classList.toggle('show');
        }
        
        // ç‚¹å‡»å¤–éƒ¨å…³é—­è®¾ç½®é¢æ¿
        document.addEventListener('click', function(event) {
            const panel = document.getElementById('settingsPanel');
            const btn = document.querySelector('.settings-toggle-btn');
            
            if (!panel.contains(event.target) && !btn.contains(event.target)) {
                panel.classList.remove('show');
            }
        });
        
        // å…³é—­å¼¹çª—
        function closeSignalModal() {
            const modal = document.getElementById('signalModal');
            modal.style.display = 'none';
        }
        
        // æ˜¾ç¤ºä¿¡å·å¼¹çª—
        function showSignalModal(signalType, scenario1Count, scenario2Count, scenario3Count, scenario4Count) {
            const modal = document.getElementById('signalModal');
            const content = document.getElementById('modalContent');
            
            let icon, title, description, color, coins;
            
            if (signalType === 'buy') {
                icon = 'ğŸ’';
                title = 'ğŸ‰ æŠ„åº•ä¿¡å·è§¦å‘ï¼';
                color = '#10b981';
                coins = scenario1Count + scenario2Count;
                description = `
                    <div class="signal-icon" style="color: ${color};">${icon}</div>
                    <div class="signal-title" style="color: ${color};">${title}</div>
                    <div class="signal-description">
                        <p>ğŸ“Š <strong>å¤šä¸ªå¸ç§åŒæ—¶æ¥è¿‘æ”¯æ’‘çº¿</strong></p>
                        <p>ğŸ’° è¿™å¯èƒ½æ˜¯ä¸€ä¸ª<strong>æŠ„åº•æœºä¼š</strong>ï¼</p>
                        <p>âš ï¸ è¯·ç»“åˆå…¶ä»–æŠ€æœ¯æŒ‡æ ‡ç¡®è®¤</p>
                    </div>
                    <div class="signal-stats">
                        <div class="signal-stat-item">
                            <div class="signal-stat-label">æƒ…å†µ1 (æ¥è¿‘æ”¯æ’‘2)</div>
                            <div class="signal-stat-value" style="color: #10b981;">${scenario1Count}ä¸ª</div>
                        </div>
                        <div class="signal-stat-item">
                            <div class="signal-stat-label">æƒ…å†µ2 (æ¥è¿‘æ”¯æ’‘1)</div>
                            <div class="signal-stat-value" style="color: #10b981;">${scenario2Count}ä¸ª</div>
                        </div>
                        <div class="signal-stat-item" style="grid-column: 1 / -1;">
                            <div class="signal-stat-label">æ€»è®¡å¸ç§æ•°</div>
                            <div class="signal-stat-value" style="color: #fbbf24; font-size: 36px;">${coins}ä¸ª</div>
                        </div>
                    </div>
                `;
                // æ’­æ”¾æŠ„åº•éŸ³æ•ˆ
                playSound('buy');
            } else {
                icon = 'âš ï¸';
                title = 'ğŸš¨ é€ƒé¡¶ä¿¡å·è§¦å‘ï¼';
                color = '#ef4444';
                coins = scenario3Count + scenario4Count;
                description = `
                    <div class="signal-icon" style="color: ${color};">${icon}</div>
                    <div class="signal-title" style="color: ${color};">${title}</div>
                    <div class="signal-description">
                        <p>ğŸ“Š <strong>å¤šä¸ªå¸ç§åŒæ—¶æ¥è¿‘å‹åŠ›çº¿</strong></p>
                        <p>ğŸ’¸ è¿™å¯èƒ½æ˜¯ä¸€ä¸ª<strong>é€ƒé¡¶æ—¶æœº</strong>ï¼</p>
                        <p>âš ï¸ è¯·è€ƒè™‘æ­¢ç›ˆæˆ–å‡ä»“æ“ä½œ</p>
                    </div>
                    <div class="signal-stats">
                        <div class="signal-stat-item">
                            <div class="signal-stat-label">æƒ…å†µ3 (æ¥è¿‘å‹åŠ›2)</div>
                            <div class="signal-stat-value" style="color: #ef4444;">${scenario3Count}ä¸ª</div>
                        </div>
                        <div class="signal-stat-item">
                            <div class="signal-stat-label">æƒ…å†µ4 (æ¥è¿‘å‹åŠ›1)</div>
                            <div class="signal-stat-value" style="color: #ef4444;">${scenario4Count}ä¸ª</div>
                        </div>
                        <div class="signal-stat-item" style="grid-column: 1 / -1;">
                            <div class="signal-stat-label">æ€»è®¡å¸ç§æ•°</div>
                            <div class="signal-stat-value" style="color: #fbbf24; font-size: 36px;">${coins}ä¸ª</div>
                        </div>
                    </div>
                `;
                // æ’­æ”¾é€ƒé¡¶éŸ³æ•ˆ
                playSound('sell');
            }
            
            content.innerHTML = description;
            modal.style.display = 'flex';
            
            // å‘é€æµè§ˆå™¨é€šçŸ¥ï¼ˆå¦‚æœå·²æˆæƒï¼‰
            if (Notification.permission === 'granted') {
                new Notification(title, {
                    body: `æ£€æµ‹åˆ°${coins}ä¸ªå¸ç§è§¦å‘ä¿¡å·`,
                    icon: signalType === 'buy' ? 'ğŸ’' : 'âš ï¸'
                });
            }
        }
        
        // æ’­æ”¾éŸ³æ•ˆï¼ˆä½¿ç”¨Web Audio APIï¼‰
        function playSound(type) {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                if (type === 'buy') {
                    // æŠ„åº•éŸ³æ•ˆï¼šä¸Šå‡çš„å’Œå¼¦ï¼ˆæ¬¢å¿«çš„å£°éŸ³ï¼‰
                    const frequencies = [523.25, 659.25, 783.99]; // C5, E5, G5 (å¤§ä¸‰å’Œå¼¦)
                    frequencies.forEach((freq, i) => {
                        const oscillator = audioContext.createOscillator();
                        const gainNode = audioContext.createGain();
                        
                        oscillator.connect(gainNode);
                        gainNode.connect(audioContext.destination);
                        
                        oscillator.frequency.value = freq;
                        oscillator.type = 'sine';
                        
                        const now = audioContext.currentTime;
                        gainNode.gain.setValueAtTime(0, now);
                        gainNode.gain.linearRampToValueAtTime(0.2, now + 0.01);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.5);
                        
                        oscillator.start(now + i * 0.1);
                        oscillator.stop(now + i * 0.1 + 0.5);
                    });
                } else {
                    // é€ƒé¡¶éŸ³æ•ˆï¼šè­¦å‘Šå£°ï¼ˆä¸‹é™çš„éŸ³è°ƒï¼‰
                    const frequencies = [880, 698.46, 587.33]; // A5, F5, D5 (ä¸‹é™)
                    frequencies.forEach((freq, i) => {
                        const oscillator = audioContext.createOscillator();
                        const gainNode = audioContext.createGain();
                        
                        oscillator.connect(gainNode);
                        gainNode.connect(audioContext.destination);
                        
                        oscillator.frequency.value = freq;
                        oscillator.type = 'square'; // æ–¹æ³¢æ›´æœ‰è­¦ç¤ºæ„Ÿ
                        
                        const now = audioContext.currentTime;
                        gainNode.gain.setValueAtTime(0, now);
                        gainNode.gain.linearRampToValueAtTime(0.15, now + 0.01);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
                        
                        oscillator.start(now + i * 0.15);
                        oscillator.stop(now + i * 0.15 + 0.3);
                    });
                }
            } catch (e) {
                console.log('éŸ³æ•ˆæ’­æ”¾é”™è¯¯:', e);
            }
        }
        
        // æ£€æŸ¥ä¿¡å·å˜åŒ–
        function checkSignalChange(snapshotData) {
            if (!snapshotData || snapshotData.length === 0) return;
            
            // è·å–æœ€æ–°çš„å¿«ç…§æ•°æ®
            const latest = snapshotData[snapshotData.length - 1];
            const s1 = latest.scenario_1_count || 0;
            const s2 = latest.scenario_2_count || 0;
            const s3 = latest.scenario_3_count || 0;
            const s4 = latest.scenario_4_count || 0;
            
            // åˆ¤æ–­å½“å‰æ˜¯å¦æœ‰ä¿¡å·
            const hasBuySignal = (s1 >= 8 && s2 >= 8);
            const hasSellSignal = ((s3 + s4) >= 8);
            
            // æ£€æµ‹æ–°ä¿¡å·ï¼ˆä»æ— åˆ°æœ‰ï¼‰
            if (hasBuySignal && !lastSignalState.buySignal) {
                console.log('ğŸ‰ æ£€æµ‹åˆ°æ–°çš„æŠ„åº•ä¿¡å·ï¼');
                showSignalModal('buy', s1, s2, s3, s4);
            }
            
            if (hasSellSignal && !lastSignalState.sellSignal) {
                console.log('ğŸš¨ æ£€æµ‹åˆ°æ–°çš„é€ƒé¡¶ä¿¡å·ï¼');
                showSignalModal('sell', s1, s2, s3, s4);
            }
            
            // æ›´æ–°çŠ¶æ€
            lastSignalState.buySignal = hasBuySignal;
            lastSignalState.sellSignal = hasSellSignal;
            lastSignalState.timestamp = latest.snapshot_time;
        }
        
        // è¯·æ±‚æµè§ˆå™¨é€šçŸ¥æƒé™
        if ('Notification' in window && Notification.permission === 'default') {
            Notification.requestPermission();
        }
        let allSnapshotData = []; // å­˜å‚¨æ‰€æœ‰å†å²æ•°æ®ï¼ˆå…¨å±€å›¾å’Œåˆ†é¡µå›¾å…±ç”¨ï¼‰
        let dailySnapshotData = []; // å­˜å‚¨é€‰ä¸­æ—¥æœŸçš„æ•°æ®ï¼ˆæ—¶é—´è½´ä½¿ç”¨ï¼‰
        let pagedSnapshotData = []; // å­˜å‚¨å½“å‰é¡µçš„æ•°æ®
        let currentPageIndex = 0; // å½“å‰é¡µç´¢å¼•ï¼ˆåŸºäºå…¨å±€æ•°æ®åˆ†é¡µï¼‰
        let totalPages = 0; // æ€»é¡µæ•°
        
        function formatPrice(price) {
            if (price === null || price === undefined) return '--';
            
            if (price < 0.01) {
                return '$' + price.toFixed(6);
            } else if (price < 1) {
                return '$' + price.toFixed(4);
            } else if (price < 100) {
                return '$' + price.toFixed(2);
            } else {
                return '$' + price.toFixed(2);
            }
        }
        
        // æ ¼å¼åŒ–å¸¦æ—¶é—´å¤‡æ³¨çš„ä»·æ ¼
        function formatPriceWithTime(price, timeDays, timeHours, isSupport) {
            if (price === null || price === undefined) return '--';
            
            const priceStr = formatPrice(price);
            let timeStr = '';
            
            if (timeDays !== null && timeDays !== undefined) {
                // 7å¤©æ”¯æ’‘/å‹åŠ›çº¿
                if (timeDays === 0) {
                    timeStr = '<span style="opacity:0.5; font-size:0.85em;">åˆšåˆš</span>';
                } else if (timeDays === 1) {
                    timeStr = '<span style="opacity:0.5; font-size:0.85em;">1å¤©å‰</span>';
                } else {
                    timeStr = '<span style="opacity:0.5; font-size:0.85em;">' + timeDays + 'å¤©å‰</span>';
                }
            } else if (timeHours !== null && timeHours !== undefined) {
                // 48hæ”¯æ’‘/å‹åŠ›çº¿
                if (timeHours === 0) {
                    timeStr = '<span style="opacity:0.5; font-size:0.85em;">åˆšåˆš</span>';
                } else if (timeHours === 1) {
                    timeStr = '<span style="opacity:0.5; font-size:0.85em;">1å°æ—¶å‰</span>';
                } else {
                    timeStr = '<span style="opacity:0.5; font-size:0.85em;">' + timeHours + 'å°æ—¶å‰</span>';
                }
            }
            
            return priceStr + (timeStr ? '<br/>' + timeStr : '');
        }
        
        function formatDistance(distance) {
            if (distance === null || distance === undefined) return '--';
            const sign = distance >= 0 ? '+' : '';
            return sign + distance.toFixed(2) + '%';
        }
        
        function getAlertBadges(coin) {
            const badges = [];
            
            // åˆ¤æ–­7å¤©å’Œ48hä½ç½®æ˜¯å¦ç›¸åŒï¼ˆé¿å…é‡å¤æ˜¾ç¤ºï¼‰
            const pos7d = coin.position_7d !== null ? coin.position_7d.toFixed(1) : null;
            const pos48h = coin.position_48h !== null ? coin.position_48h.toFixed(1) : null;
            const samePosition = pos7d === pos48h;
            
            // ä½ä½é¢„è­¦åˆå¹¶æ˜¾ç¤ºï¼ˆå½“7å¤©å’Œ48hä½ç½®ç›¸åŒæ—¶ï¼‰
            if (coin.alert_7d_low && coin.alert_48h_low && samePosition && pos7d !== null) {
                badges.push('<span class="alert-badge alert-near-support" title="7å¤©å’Œ48hä½ç½®éƒ½æ¥è¿‘æ”¯æ’‘çº¿">ä½ä½é¢„è­¦:' + pos7d + '%</span>');
            } else {
                // 7å¤©ä½ä½é¢„è­¦ (7å¤©ä½ç½® <= 5%)
                if (coin.alert_7d_low && pos7d !== null) {
                    badges.push('<span class="alert-badge alert-near-support" title="7å¤©ä½ç½®æ¥è¿‘æ”¯æ’‘çº¿">7å¤©ä½ä½:' + pos7d + '%</span>');
                }
                
                // 48hä½ä½é¢„è­¦ (48hä½ç½® <= 5%)
                if (coin.alert_48h_low && pos48h !== null) {
                    badges.push('<span class="alert-badge alert-near-support" title="48hä½ç½®æ¥è¿‘æ”¯æ’‘çº¿">48hä½ä½:' + pos48h + '%</span>');
                }
            }
            
            // é«˜ä½é¢„è­¦åˆå¹¶æ˜¾ç¤ºï¼ˆå½“7å¤©å’Œ48hä½ç½®ç›¸åŒæ—¶ï¼‰
            if (coin.alert_7d_high && coin.alert_48h_high && samePosition && pos7d !== null) {
                badges.push('<span class="alert-badge alert-near-resistance" title="7å¤©å’Œ48hä½ç½®éƒ½æ¥è¿‘å‹åŠ›çº¿">é«˜ä½é¢„è­¦:' + pos7d + '%</span>');
            } else {
                // 7å¤©é«˜ä½é¢„è­¦ (7å¤©ä½ç½® >= 95%)
                if (coin.alert_7d_high && pos7d !== null) {
                    badges.push('<span class="alert-badge alert-near-resistance" title="7å¤©ä½ç½®æ¥è¿‘å‹åŠ›çº¿">7å¤©é«˜ä½:' + pos7d + '%</span>');
                }
                
                // 48hé«˜ä½é¢„è­¦ (48hä½ç½® >= 95%)
                if (coin.alert_48h_high && pos48h !== null) {
                    badges.push('<span class="alert-badge alert-near-resistance" title="48hä½ç½®æ¥è¿‘å‹åŠ›çº¿">48hé«˜ä½:' + pos48h + '%</span>');
                }
            }
            
            return badges.length > 0 ? badges.join(' ') : '<span style="color: rgba(255,255,255,0.3);">-</span>';
        }
        
        function renderTable() {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';
            
            currentData.forEach(coin => {
                const row = document.createElement('tr');
                
                // æ ¼å¼åŒ–ä½ç½®ç™¾åˆ†æ¯”
                const formatPosition = (pos, alert) => {
                    if (pos === null || pos === undefined) {
                        return '<span style="color: rgba(255,255,255,0.3);">-</span>';
                    }
                    const val = pos.toFixed(1) + '%';
                    if (alert) {
                        return `<span class="alert-value" style="color: #ff6b6b; font-weight: bold;">${val}</span>`;
                    }
                    return val;
                };
                
                row.innerHTML = `
                    <td class="symbol-cell">${coin.symbol}</td>
                    <td class="price-cell">${formatPrice(coin.current_price)}</td>
                    <td class="support-cell">${formatPriceWithTime(coin.support_line_1, coin.support_1_days, null, true)}</td>
                    <td class="resistance-cell">${formatPriceWithTime(coin.resistance_line_1, coin.resistance_1_days, null, false)}</td>
                    <td class="${(coin.position_7d !== null && coin.position_7d <= 5) || (coin.position_7d >= 95) ? 'position-alert' : 'position-normal'}">${formatPosition(coin.position_7d, coin.alert_7d_low || coin.alert_7d_high)}</td>
                    <td class="support-cell">${formatPriceWithTime(coin.support_line_2, null, coin.support_2_hours, true)}</td>
                    <td class="resistance-cell">${formatPriceWithTime(coin.resistance_line_2, null, coin.resistance_2_hours, false)}</td>
                    <td class="${(coin.position_48h !== null && coin.position_48h <= 5) || (coin.position_48h >= 95) ? 'position-alert' : 'position-normal'}">${formatPosition(coin.position_48h, coin.alert_48h_low || coin.alert_48h_high)}</td>
                    <td>${getAlertBadges(coin)}</td>
                `;
                tbody.appendChild(row);
            });
            
            document.getElementById('loading').style.display = 'none';
            document.getElementById('dataTable').style.display = 'table';
        }
        
        function updateStats() {
            // ä½¿ç”¨ç®€åŒ–çš„ 48h/7day è­¦æŠ¥é€»è¾‘ç»Ÿè®¡
            const alert48hLowCoins = currentData.filter(c => c.alert_48h_low);  // 48hä½ä½
            const alert7dLowCoins = currentData.filter(c => c.alert_7d_low);    // 7å¤©ä½ä½
            const alert48hHighCoins = currentData.filter(c => c.alert_48h_high); // 48hé«˜ä½
            const alert7dHighCoins = currentData.filter(c => c.alert_7d_high);   // 7å¤©é«˜ä½
            
            // æ›´æ–°ç»Ÿè®¡æ•°å­—
            document.getElementById('totalCoins').textContent = currentData.length;
            document.getElementById('nearSupport1').textContent = alert7dLowCoins.length;
            document.getElementById('nearSupport2').textContent = alert48hLowCoins.length;
            document.getElementById('nearResistance1').textContent = alert7dHighCoins.length;
            document.getElementById('nearResistance2').textContent = alert48hHighCoins.length;
            
            // æ›´æ–°4ä¸ªé¢„è­¦æ¡†çš„å¸ç§åˆ—è¡¨
            const formatCoinBadge = (coin, positionField) => {
                const symbol = coin.symbol.replace('USDT', '');
                const position = coin[positionField] || 0;
                return `<span style="display: inline-block; background: rgba(255,255,255,0.15); padding: 6px 12px; border-radius: 6px; margin: 2px; font-weight: 500; border: 1px solid rgba(255,255,255,0.2);">${symbol} <span style="opacity: 0.7; font-size: 0.85em;">${position.toFixed(1)}%</span></span>`;
            };
            
            const formatCoins = (coins, positionField) => {
                if (coins.length === 0) {
                    return '<span style="color: rgba(255,255,255,0.3); font-style: italic;">æš‚æ— é¢„è­¦</span>';
                }
                return coins.map(c => formatCoinBadge(c, positionField)).join(' ');
            };
            
            document.getElementById('alert-48h-low-coins').innerHTML = formatCoins(alert48hLowCoins, 'position_48h');
            document.getElementById('alert-7d-low-coins').innerHTML = formatCoins(alert7dLowCoins, 'position_7d');
            document.getElementById('alert-48h-high-coins').innerHTML = formatCoins(alert48hHighCoins, 'position_48h');
            document.getElementById('alert-7d-high-coins').innerHTML = formatCoins(alert7dHighCoins, 'position_7d');
        }
        
        function sortData(field, order) {
            if (!currentData || currentData.length === 0) return;
            
            currentData.sort((a, b) => {
                const aVal = a[field] || 0;
                const bVal = b[field] || 0;
                return order === 'asc' ? aVal - bVal : bVal - aVal;
            });
            
            currentSortField = field;
            currentSortOrder = order;
            
            // Update sort indicators
            document.querySelectorAll('th.sortable').forEach(th => {
                th.classList.remove('sort-asc', 'sort-desc');
                if (th.dataset.sort === field) {
                    th.classList.add(order === 'asc' ? 'sort-asc' : 'sort-desc');
                }
            });
            
            renderTable();
        }
        
        function loadData() {
            fetch('/api/support-resistance/latest')
                .then(response => response.json())
                .then(result => {
                    if (result.success) {
                        currentData = result.data;
                        
                        // Apply current sort if any
                        if (currentSortField) {
                            sortData(currentSortField, currentSortOrder);
                        } else {
                            renderTable();
                        }
                        
                        updateStats();
                        
                        // Update time displays
                        document.getElementById('updateTime').textContent = 'æœ€åæ›´æ–°: ' + (result.update_time || '--');
                        document.getElementById('lastUpdateTime').textContent = result.update_time || '--';
                    } else {
                        document.getElementById('loading').textContent = 'æ•°æ®åŠ è½½å¤±è´¥: ' + result.message;
                    }
                })
                .catch(error => {
                    document.getElementById('loading').textContent = 'æ•°æ®åŠ è½½é”™è¯¯: ' + error;
                });
        }
        
        // Add click handlers to sortable headers
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('th.sortable').forEach(th => {
                th.addEventListener('click', function() {
                    const field = this.dataset.sort;
                    
                    // Toggle sort order if clicking the same field
                    if (currentSortField === field) {
                        currentSortOrder = currentSortOrder === 'desc' ? 'asc' : 'desc';
                    } else {
                        currentSortOrder = 'desc'; // Default to descending for new field
                    }
                    
                    sortData(field, currentSortOrder);
                });
            });
        });
        
        // å†å²æ•°æ®è¯¦æƒ…å¼¹çª—ç›¸å…³å‡½æ•°
        let currentSnapshotData = [];
        
        function closeHistoryModal() {
            document.getElementById('historyModal').classList.remove('show');
        }
        
        function showHistoryDetail(dataIndex) {
            if (!currentSnapshotData || dataIndex >= currentSnapshotData.length) {
                console.error('Invalid data index:', dataIndex);
                return;
            }
            
            const snapshot = currentSnapshotData[dataIndex];
            
            // æ›´æ–°æ ‡é¢˜
            document.getElementById('modalTitle').textContent = 
                `ğŸ• ${snapshot.snapshot_time} (åŒ—äº¬æ—¶é—´)`;
            
            // æ¸²æŸ“è¯¦æƒ…
            let html = '';
            
            // æƒ…å†µ1: æ”¯æ’‘2
            html += renderScenario(
                'æƒ…å†µ1: æ¥è¿‘æ”¯æ’‘çº¿2 (48å°æ—¶æœ€ä½ç‚¹)',
                snapshot.scenario_1_count,
                snapshot.scenario_1_coins,
                '#4ade80'
            );
            
            // æƒ…å†µ2: æ”¯æ’‘1
            html += renderScenario(
                'æƒ…å†µ2: æ¥è¿‘æ”¯æ’‘çº¿1 (7å¤©æœ€ä½ç‚¹)',
                snapshot.scenario_2_count,
                snapshot.scenario_2_coins,
                '#10b981'
            );
            
            // æƒ…å†µ3: å‹åŠ›2
            html += renderScenario(
                'æƒ…å†µ3: æ¥è¿‘å‹åŠ›çº¿2 (48å°æ—¶æœ€é«˜ç‚¹)',
                snapshot.scenario_3_count,
                snapshot.scenario_3_coins,
                '#f87171'
            );
            
            // æƒ…å†µ4: å‹åŠ›1
            html += renderScenario(
                'æƒ…å†µ4: æ¥è¿‘å‹åŠ›çº¿1 (7å¤©æœ€é«˜ç‚¹)',
                snapshot.scenario_4_count,
                snapshot.scenario_4_coins,
                '#ef4444'
            );
            
            document.getElementById('modalBody').innerHTML = html;
            document.getElementById('historyModal').classList.add('show');
        }
        
        function renderScenario(title, count, coinsJson, color) {
            let coins = [];
            try {
                coins = typeof coinsJson === 'string' ? JSON.parse(coinsJson) : coinsJson;
            } catch (e) {
                coins = [];
            }
            
            let html = `
                <div class="scenario-section">
                    <div class="scenario-header" style="color: ${color};">
                        <span style="font-size: 20px;">${count > 0 ? 'â—' : 'â—‹'}</span>
                        <span>${title}</span>
                        <span style="margin-left: auto; background: rgba(255,255,255,0.1); padding: 4px 12px; border-radius: 6px; font-size: 14px;">
                            ${count} ä¸ªå¸ç§
                        </span>
                    </div>
            `;
            
            if (count === 0 || coins.length === 0) {
                html += '<p style="color: rgba(255,255,255,0.4); font-style: italic; padding: 10px;">æš‚æ— ç¬¦åˆæ¡ä»¶çš„å¸ç§</p>';
            } else {
                html += '<div class="coin-list">';
                coins.forEach(coin => {
                    const symbol = coin.symbol || 'UNKNOWN';
                    const price = coin.current_price || 0;
                    const position = coin.position || 0;
                    
                    html += `
                        <div class="coin-badge">
                            <div class="coin-symbol">${symbol.replace('USDT', '')}</div>
                            <div class="coin-price">$${formatCoinPrice(price)}</div>
                            <div class="coin-position">ä½ç½®: ${position.toFixed(1)}%</div>
                        </div>
                    `;
                });
                html += '</div>';
            }
            
            html += '</div>';
            return html;
        }
        
        function formatCoinPrice(price) {
            if (price < 0.01) return price.toFixed(6);
            if (price < 1) return price.toFixed(4);
            if (price < 100) return price.toFixed(2);
            return price.toFixed(2);
        }
        
        // è¶‹åŠ¿å›¾ç›¸å…³å‡½æ•°
        // åˆå§‹åŒ–å…¨å±€è¶‹åŠ¿å›¾ï¼ˆæ˜¾ç¤ºæ‰€æœ‰å†å²æ•°æ®ï¼‰
        function initGlobalTrendChart() {
            if (typeof echarts === 'undefined') {
                console.error('âŒ EChartsåº“æœªåŠ è½½ï¼CDNå¯èƒ½å¤±è´¥ã€‚');
                alert('å›¾è¡¨åº“åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢æˆ–è”ç³»ç®¡ç†å‘˜');
                return;
            }
            console.log('âœ… EChartsç‰ˆæœ¬:', echarts.version);
            
            const chartDom = document.getElementById('globalTrendChart');
            if (!chartDom) {
                console.error('âŒ æ‰¾ä¸åˆ°å›¾è¡¨å®¹å™¨å…ƒç´  #globalTrendChart');
                return;
            }
            console.log('âœ… å›¾è¡¨å®¹å™¨å…ƒç´ å­˜åœ¨ï¼Œå°ºå¯¸:', chartDom.offsetWidth, 'x', chartDom.offsetHeight);
            
            globalTrendChart = echarts.init(chartDom);
            console.log('âœ… EChartså®ä¾‹åˆ›å»ºæˆåŠŸ');
            
            const option = {
                backgroundColor: 'transparent',
                tooltip: {
                    trigger: 'axis',
                    backgroundColor: 'rgba(0,0,0,0.8)',
                    borderColor: 'rgba(255,255,255,0.2)',
                    textStyle: { color: '#fff' },
                    formatter: function(params) {
                        // æ˜¾ç¤ºå®Œæ•´çš„æ—¥æœŸ|æ—¶é—´æ ¼å¼
                        let result = '<div style="font-weight: bold; margin-bottom: 5px;">' + params[0].axisValue + ' (åŒ—äº¬æ—¶é—´)</div>';
                        params.forEach(item => {
                            result += item.marker + item.seriesName + ': <b>' + item.value + '</b> ä¸ªå¸ç§<br/>';
                        });
                        return result;
                    }
                },
                legend: {
                    data: ['æƒ…å†µ1(æ”¯æ’‘2)', 'æƒ…å†µ2(æ”¯æ’‘1)', 'æƒ…å†µ3(å‹åŠ›2)', 'æƒ…å†µ4(å‹åŠ›1)'],
                    textStyle: { color: '#fff' },
                    top: 10
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    boundaryGap: false,
                    data: [],
                    axisLine: { lineStyle: { color: 'rgba(255,255,255,0.3)' } },
                    axisLabel: { color: '#fff', rotate: 45 }
                },
                yAxis: {
                    type: 'value',
                    name: 'å¸ç§æ•°é‡',
                    nameTextStyle: { color: '#fff' },
                    axisLine: { lineStyle: { color: 'rgba(255,255,255,0.3)' } },
                    axisLabel: { color: '#fff' },
                    splitLine: { lineStyle: { color: 'rgba(255,255,255,0.1)' } }
                },
                series: [
                    {
                        name: 'æƒ…å†µ1(æ”¯æ’‘2)',
                        type: 'line',
                        data: [],
                        smooth: true,
                        stack: null,  // æ˜ç¡®æŒ‡å®šä¸å †å 
                        lineStyle: { color: '#4ade80', width: 2 },
                        itemStyle: { color: '#4ade80' },
                        areaStyle: { color: 'rgba(74, 222, 128, 0.1)' }
                    },
                    {
                        name: 'æƒ…å†µ2(æ”¯æ’‘1)',
                        type: 'line',
                        data: [],
                        smooth: true,
                        stack: null,  // æ˜ç¡®æŒ‡å®šä¸å †å 
                        lineStyle: { color: '#10b981', width: 2 },
                        itemStyle: { color: '#10b981' },
                        areaStyle: { color: 'rgba(16, 185, 129, 0.1)' }
                    },
                    {
                        name: 'æƒ…å†µ3(å‹åŠ›2)',
                        type: 'line',
                        data: [],
                        smooth: true,
                        stack: null,  // æ˜ç¡®æŒ‡å®šä¸å †å 
                        lineStyle: { color: '#f87171', width: 2 },
                        itemStyle: { color: '#f87171' },
                        areaStyle: { color: 'rgba(248, 113, 113, 0.1)' }
                    },
                    {
                        name: 'æƒ…å†µ4(å‹åŠ›1)',
                        type: 'line',
                        data: [],
                        smooth: true,
                        stack: null,  // æ˜ç¡®æŒ‡å®šä¸å †å 
                        lineStyle: { color: '#ef4444', width: 2 },
                        itemStyle: { color: '#ef4444' },
                        areaStyle: { color: 'rgba(239, 68, 68, 0.1)' }
                    }
                ]
            };
            
            globalTrendChart.setOption(option);
            console.log('âœ… å…¨å±€è¶‹åŠ¿å›¾åˆå§‹åŒ–å®Œæˆ');
        }
        
        // åˆå§‹åŒ–12å°æ—¶åˆ†é¡µè¶‹åŠ¿å›¾
        function initPagedTrendChart() {
            if (typeof echarts === 'undefined') {
                console.error('âŒ EChartsåº“æœªåŠ è½½');
                return;
            }
            
            const chartDom = document.getElementById('pagedTrendChart');
            if (!chartDom) {
                console.error('âŒ æ‰¾ä¸åˆ°åˆ†é¡µå›¾è¡¨å®¹å™¨');
                return;
            }
            
            pagedTrendChart = echarts.init(chartDom);
            
            const option = {
                backgroundColor: 'transparent',
                tooltip: {
                    trigger: 'axis',
                    backgroundColor: 'rgba(0,0,0,0.8)',
                    borderColor: 'rgba(255,255,255,0.2)',
                    textStyle: { color: '#fff' },
                    formatter: function(params) {
                        let result = '<div style="font-weight: bold; margin-bottom: 5px;">' + params[0].axisValue + ' (åŒ—äº¬æ—¶é—´)</div>';
                        params.forEach(item => {
                            result += item.marker + item.seriesName + ': <b>' + item.value + '</b> ä¸ªå¸ç§<br/>';
                        });
                        return result;
                    }
                },
                legend: {
                    data: ['æƒ…å†µ1(æ”¯æ’‘2)', 'æƒ…å†µ2(æ”¯æ’‘1)', 'æƒ…å†µ3(å‹åŠ›2)', 'æƒ…å†µ4(å‹åŠ›1)'],
                    textStyle: { color: '#fff' },
                    top: 10
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    boundaryGap: false,
                    data: [],
                    axisLine: { lineStyle: { color: 'rgba(255,255,255,0.3)' } },
                    axisLabel: { color: '#fff', rotate: 45 }
                },
                yAxis: {
                    type: 'value',
                    name: 'å¸ç§æ•°é‡',
                    nameTextStyle: { color: '#fff' },
                    axisLine: { lineStyle: { color: 'rgba(255,255,255,0.3)' } },
                    axisLabel: { color: '#fff' },
                    splitLine: { lineStyle: { color: 'rgba(255,255,255,0.1)' } }
                },
                series: [
                    {
                        name: 'æƒ…å†µ1(æ”¯æ’‘2)',
                        type: 'line',
                        data: [],
                        smooth: true,
                        stack: null,  // æ˜ç¡®æŒ‡å®šä¸å †å 
                        lineStyle: { color: '#4ade80', width: 2 },
                        itemStyle: { color: '#4ade80' },
                        areaStyle: { color: 'rgba(74, 222, 128, 0.1)' }
                    },
                    {
                        name: 'æƒ…å†µ2(æ”¯æ’‘1)',
                        type: 'line',
                        data: [],
                        smooth: true,
                        stack: null,  // æ˜ç¡®æŒ‡å®šä¸å †å 
                        lineStyle: { color: '#10b981', width: 2 },
                        itemStyle: { color: '#10b981' },
                        areaStyle: { color: 'rgba(16, 185, 129, 0.1)' }
                    },
                    {
                        name: 'æƒ…å†µ3(å‹åŠ›2)',
                        type: 'line',
                        data: [],
                        smooth: true,
                        stack: null,  // æ˜ç¡®æŒ‡å®šä¸å †å 
                        lineStyle: { color: '#f87171', width: 2 },
                        itemStyle: { color: '#f87171' },
                        areaStyle: { color: 'rgba(248, 113, 113, 0.1)' }
                    },
                    {
                        name: 'æƒ…å†µ4(å‹åŠ›1)',
                        type: 'line',
                        data: [],
                        smooth: true,
                        stack: null,  // æ˜ç¡®æŒ‡å®šä¸å †å 
                        lineStyle: { color: '#ef4444', width: 2 },
                        itemStyle: { color: '#ef4444' },
                        areaStyle: { color: 'rgba(239, 68, 68, 0.1)' }
                    }
                ]
            };
            
            pagedTrendChart.setOption(option);
            
            // æ·»åŠ ç‚¹å‡»äº‹ä»¶ - ç‚¹å‡»æ•°æ®ç‚¹æŸ¥çœ‹è¯¦æƒ…
            pagedTrendChart.on('click', function(params) {
                if (params.componentType === 'series') {
                    showPagedSnapshotDetail(params.dataIndex);
                }
            });
            
            console.log('âœ… 12å°æ—¶åˆ†é¡µå›¾è¡¨åˆå§‹åŒ–å®Œæˆ');
        }
        
        // åŠ è½½12å°æ—¶åˆ†é¡µæ•°æ®
        function loadPagedTrendData() {
            if (!allSnapshotData || allSnapshotData.length === 0) {
                console.log('â³ ç­‰å¾…å…¨å±€æ•°æ®åŠ è½½...');
                return;
            }
            
            // è®¡ç®—æ€»é¡µæ•°ï¼ˆæ¯é¡µæœ€å¤šæ˜¾ç¤ºçº¦40ä¸ªæ•°æ®ç‚¹ï¼Œç›¸å½“äºçº¦12å°æ—¶çš„æ•°æ®ï¼‰
            const itemsPerPage = 40;
            totalPages = Math.ceil(allSnapshotData.length / itemsPerPage);
            
            // ç¡®ä¿currentPageIndexåœ¨æœ‰æ•ˆèŒƒå›´å†…
            if (currentPageIndex < 0) currentPageIndex = 0;
            if (currentPageIndex >= totalPages) currentPageIndex = totalPages - 1;
            
            // è®¡ç®—å½“å‰é¡µçš„æ•°æ®èŒƒå›´
            const startIndex = currentPageIndex * itemsPerPage;
            const endIndex = Math.min(startIndex + itemsPerPage, allSnapshotData.length);
            const pageData = allSnapshotData.slice(startIndex, endIndex);
            
            pagedSnapshotData = pageData; // ä¿å­˜å½“å‰é¡µæ•°æ®ä¾›ç‚¹å‡»ä½¿ç”¨
            
            console.log('ğŸ“Š åŠ è½½åˆ†é¡µæ•°æ®:', {
                å½“å‰é¡µ: currentPageIndex + 1,
                æ€»é¡µæ•°: totalPages,
                æ•°æ®èŒƒå›´: `${startIndex}-${endIndex}`,
                æ•°æ®é‡: pageData.length
            });
            
            // æå–æ—¶é—´å’Œæ•°æ®
            const times = [];
            const markLineData = []; // å­˜å‚¨è·¨æ—¥æœŸåˆ†å‰²çº¿
            let lastDate = null;
            
            pageData.forEach((d, index) => {
                const parts = d.snapshot_time.split(' ');
                const currentDateStr = parts[0];
                const date = currentDateStr.substring(5); // MM-DD
                const time = parts[1].substring(0, 5); // HH:MM
                times.push(`${date} ${time}`);
                
                // æ£€æµ‹æ—¥æœŸå˜åŒ–ï¼Œæ·»åŠ åˆ†å‰²çº¿
                if (lastDate && lastDate !== currentDateStr) {
                    markLineData.push({
                        xAxis: index,
                        label: {
                            formatter: `${currentDateStr.substring(5)}`, // MM-DD
                            position: 'insideEndTop',
                            color: '#4ade80',
                            fontSize: 12,
                            fontWeight: 'bold'
                        },
                        lineStyle: {
                            color: '#4ade80',
                            width: 2,
                            type: 'solid'
                        }
                    });
                }
                lastDate = currentDateStr;
            });
            
            const scenario1 = pageData.map(d => d.scenario_1_count || 0);
            const scenario2 = pageData.map(d => d.scenario_2_count || 0);
            const scenario3 = pageData.map(d => d.scenario_3_count || 0);
            const scenario4 = pageData.map(d => d.scenario_4_count || 0);
            
            // æ£€æµ‹æŠ„åº•å’Œé€ƒé¡¶ä¿¡å·
            const signalMarkPoints = [];
            pageData.forEach((d, index) => {
                const scenario1 = d.scenario_1_count || 0;
                const scenario2 = d.scenario_2_count || 0;
                const scenario3 = d.scenario_3_count || 0;
                const scenario4 = d.scenario_4_count || 0;
                const resistanceTotal = scenario3 + scenario4;
                
                // æŠ„åº•ä¿¡å·ï¼šæƒ…å†µ1 â‰¥ 8 ä¸” æƒ…å†µ2 â‰¥ 8
                if (scenario1 >= 8 && scenario2 >= 8) {
                    const supportTotal = scenario1 + scenario2;
                    signalMarkPoints.push({
                        name: 'æŠ„åº•',
                        xAxis: index,
                        yAxis: Math.max(d.scenario_1_count || 0, d.scenario_2_count || 0),
                        value: `æŠ„åº•\n${supportTotal}å¸`,
                        symbolSize: 80,
                        symbol: 'pin',
                        itemStyle: {
                            color: '#00ff00',
                            borderColor: '#fff',
                            borderWidth: 2
                        },
                        label: {
                            show: true,
                            formatter: `æŠ„åº•\n${supportTotal}å¸`,
                            position: 'top',
                            color: '#fff',
                            fontSize: 12,
                            fontWeight: 'bold',
                            backgroundColor: 'rgba(0,255,0,0.8)',
                            padding: [4, 8],
                            borderRadius: 4
                        }
                    });
                }
                
                // é€ƒé¡¶ä¿¡å·ï¼šå‹åŠ›çº¿å¸ç§ â‰¥ 8
                if (resistanceTotal >= 8) {
                    signalMarkPoints.push({
                        name: 'é€ƒé¡¶',
                        xAxis: index,
                        yAxis: Math.max(d.scenario_3_count || 0, d.scenario_4_count || 0),
                        value: `é€ƒé¡¶\n${resistanceTotal}å¸`,
                        symbolSize: 80,
                        symbol: 'pin',
                        itemStyle: {
                            color: '#ff0000',
                            borderColor: '#fff',
                            borderWidth: 2
                        },
                        label: {
                            show: true,
                            formatter: `é€ƒé¡¶\n${resistanceTotal}å¸`,
                            position: 'top',
                            color: '#fff',
                            fontSize: 12,
                            fontWeight: 'bold',
                            backgroundColor: 'rgba(255,0,0,0.8)',
                            padding: [4, 8],
                            borderRadius: 4
                        }
                    });
                }
            });
            
            console.log('ğŸ“ æ£€æµ‹åˆ°ä¿¡å·:', {æŠ„åº•: signalMarkPoints.filter(p => p.name === 'æŠ„åº•').length, é€ƒé¡¶: signalMarkPoints.filter(p => p.name === 'é€ƒé¡¶').length});
            
            // æ›´æ–°å›¾è¡¨ï¼Œæ·»åŠ æ—¥æœŸåˆ†å‰²çº¿å’Œä¿¡å·æ ‡è®°
            pagedTrendChart.setOption({
                xAxis: { data: times },
                series: [
                    { 
                        data: scenario1,
                        markLine: markLineData.length > 0 ? { 
                            data: markLineData,
                            symbol: 'none'
                        } : undefined,
                        markPoint: signalMarkPoints.length > 0 ? {
                            data: signalMarkPoints
                        } : undefined
                    },
                    { data: scenario2 },
                    { data: scenario3 },
                    { data: scenario4 }
                ]
            });
            
            // æ›´æ–°é¡µé¢ä¿¡æ¯
            const firstTime = pageData[0]?.snapshot_time || '--';
            const lastTime = pageData[pageData.length - 1]?.snapshot_time || '--';
            document.getElementById('pagedPageInfo').textContent = 
                `ç¬¬ ${currentPageIndex + 1}/${totalPages} é¡µ | ${firstTime.substring(5, 16)} ~ ${lastTime.substring(5, 16)}`;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            updatePageButtons();
            
            // å¼ºåˆ¶è°ƒæ•´å›¾è¡¨å¤§å°ä»¥ç¡®ä¿æ­£ç¡®æ¸²æŸ“
            setTimeout(() => {
                if (pagedTrendChart) {
                    pagedTrendChart.resize();
                    console.log('âœ… åˆ†é¡µå›¾è¡¨resizeå®Œæˆ');
                }
            }, 100);
            
            console.log('âœ… åˆ†é¡µå›¾è¡¨æ›´æ–°å®Œæˆ', markLineData.length > 0 ? `(å«${markLineData.length}æ¡æ—¥æœŸåˆ†å‰²çº¿)` : '');
        }
        
        // åˆå§‹åŒ–24å°æ—¶é€ƒé¡¶ä¿¡å·ç»Ÿè®¡å›¾
        function initEscapeSignalChart() {
            if (typeof echarts === 'undefined') {
                console.error('âŒ EChartsåº“æœªåŠ è½½');
                return;
            }
            
            const chartDom = document.getElementById('escapeSignalChart');
            if (!chartDom) {
                console.error('âŒ æ‰¾ä¸åˆ°é€ƒé¡¶ä¿¡å·å›¾è¡¨å®¹å™¨');
                return;
            }
            
            escapeSignalChart = echarts.init(chartDom);
            
            const option = {
                backgroundColor: 'transparent',
                tooltip: {
                    trigger: 'axis',
                    backgroundColor: 'rgba(0,0,0,0.8)',
                    borderColor: 'rgba(255,255,255,0.2)',
                    textStyle: { color: '#fff' },
                    formatter: function(params) {
                        if (!params || params.length === 0) return '';
                        const dataIndex = params[0].dataIndex;
                        const fullTime = window.escapeFullTimes && window.escapeFullTimes[dataIndex] 
                            ? window.escapeFullTimes[dataIndex] 
                            : params[0].axisValue;
                        let result = '<div style="font-weight: bold; margin-bottom: 5px;">ğŸ• ' + fullTime + '</div>';
                        result += params[0].marker + 'æ¥è¿‘å‹åŠ›çº¿å¸ç§: <b style="font-size: 16px;">' + params[0].value + '</b> ä¸ª';
                        return result;
                    }
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    top: '5%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    boundaryGap: false,
                    data: [],
                    axisLine: { lineStyle: { color: 'rgba(255,255,255,0.3)' } },
                    axisLabel: { 
                        color: '#fff', 
                        rotate: 30,
                        fontSize: 11
                    }
                },
                yAxis: {
                    type: 'value',
                    name: 'æ¥è¿‘å‹åŠ›çº¿å¸ç§æ•°',
                    nameTextStyle: { color: '#fff' },
                    axisLine: { lineStyle: { color: 'rgba(255,255,255,0.3)' } },
                    axisLabel: { color: '#fff' },
                    splitLine: { lineStyle: { color: 'rgba(255,255,255,0.1)' } },
                    minInterval: 1
                },
                series: [
                    {
                        name: 'é€ƒé¡¶ä¿¡å·æ•°é‡',
                        type: 'line',
                        data: [],
                        smooth: true,
                        symbol: 'circle',
                        symbolSize: 6,
                        lineStyle: { 
                            color: '#ef4444', 
                            width: 3 
                        },
                        itemStyle: { 
                            color: '#ef4444',
                            borderColor: '#fff',
                            borderWidth: 2
                        },
                        areaStyle: {
                            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                                { offset: 0, color: 'rgba(239, 68, 68, 0.5)' },
                                { offset: 1, color: 'rgba(239, 68, 68, 0.1)' }
                            ])
                        }
                    }
                ]
            };
            
            escapeSignalChart.setOption(option);
            console.log('âœ… é€ƒé¡¶ä¿¡å·ç»Ÿè®¡å›¾åˆå§‹åŒ–å®Œæˆ');
        }
        
        // åŠ è½½24å°æ—¶é€ƒé¡¶ä¿¡å·æ•°æ®
        async function loadEscapeSignalData() {
            try {
                // è·å–å†å²æ—¶é—´åºåˆ—æ•°æ®ï¼ˆåªè·å–æœ€è¿‘2å°æ—¶ï¼‰
                const response = await fetch('/api/escape-top-signals/history-timeseries?hours=2');
                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.message || 'åŠ è½½å¤±è´¥');
                }
                
                // è·å–ç»Ÿè®¡æ•°æ®ï¼ˆçœŸå®çš„é€ƒé¡¶äº‹ä»¶æ¬¡æ•°ï¼‰
                const statsResponse = await fetch('/api/escape-top-signals/stats');
                const statsResult = await statsResponse.json();
                const escapeEvents = statsResult.success ? statsResult.stats.total_signals : 0;
                document.getElementById('escapeCurrentCount').textContent = escapeEvents;
                
                if (!result.success) {
                    throw new Error(result.message || 'åŠ è½½å¤±è´¥');
                }
                
                // å¤„ç†å›¾è¡¨æ•°æ®
                if (!result.data || result.data.length === 0) {
                    console.log('âš ï¸ æš‚æ— é€ƒé¡¶ä¿¡å·å†å²æ•°æ®');
                    escapeSignalChart.setOption({
                        xAxis: { data: [] },
                        series: [{ data: [] }]
                    });
                    return;
                }
                
                // æå–æ—¶é—´å’Œæ•°é‡
                const times = result.data.map(d => d.time);
                const counts = result.data.map(d => d.count);
                
                // æ ¼å¼åŒ–æ—¶é—´æ˜¾ç¤ºï¼ˆæœˆ-æ—¥ æ—¶:åˆ†ï¼‰
                const timeLabels = times.map(t => {
                    const parts = t.split(' ');
                    const date = parts[0].substring(5); // MM-DD
                    const time = parts[1].substring(0, 5); // HH:MM
                    return `${date} ${time}`;
                });
                
                // ä¿å­˜å®Œæ•´æ—¶é—´ç”¨äºtooltip
                window.escapeFullTimes = times;
                
                // æ›´æ–°å›¾è¡¨
                escapeSignalChart.setOption({
                    xAxis: { data: timeLabels },
                    series: [{ data: counts }]
                });
                
                console.log('âœ… é€ƒé¡¶ä¿¡å·æ•°æ®åŠ è½½å®Œæˆ:', {
                    æ—¶é—´ç‚¹: times.length,
                    å½“å‰ä¿¡å·æ•°: currentCount,
                    æ•°æ®ç¤ºä¾‹: times.slice(0, 3).map((t, i) => `${t}: ${counts[i]}ä¸ª`)
                });
                
            } catch (error) {
                console.error('âŒ åŠ è½½é€ƒé¡¶ä¿¡å·æ•°æ®å¤±è´¥:', error);
                document.getElementById('escapeCurrentCount').textContent = '?';
            }
        }
        
        // æ˜¾ç¤ºåˆ†é¡µå›¾è¡¨çš„å¿«ç…§è¯¦æƒ…
        function showPagedSnapshotDetail(dataIndex) {
            console.log('ğŸ” æ˜¾ç¤ºåˆ†é¡µå¿«ç…§è¯¦æƒ…ï¼Œç´¢å¼•:', dataIndex);
            
            if (!pagedSnapshotData || dataIndex >= pagedSnapshotData.length) {
                console.error('âŒ æ•°æ®ç´¢å¼•æ— æ•ˆ');
                return;
            }
            
            const snapshot = pagedSnapshotData[dataIndex];
            console.log('ğŸ“Š å¿«ç…§æ•°æ®:', snapshot);
            console.log('ğŸª™ æƒ…å†µ1å¸ç§æ•°æ®ç±»å‹:', typeof snapshot.scenario_1_coins);
            console.log('ğŸª™ æƒ…å†µ1å¸ç§æ•°æ®:', snapshot.scenario_1_coins);
            const modal = document.getElementById('historyModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');
            
            // è®¾ç½®æ ‡é¢˜
            modalTitle.textContent = `ğŸ• ${snapshot.snapshot_time} (åŒ—äº¬æ—¶é—´)`;
            
            // æ„å»ºå†…å®¹
            let html = '<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">';
            
            html += buildScenarioCard('æƒ…å†µ1ï¼šæ¥è¿‘æ”¯æ’‘2', snapshot.scenario_1_count, snapshot.scenario_1_coins, '#4ade80');
            html += buildScenarioCard('æƒ…å†µ2ï¼šæ¥è¿‘æ”¯æ’‘1', snapshot.scenario_2_count, snapshot.scenario_2_coins, '#10b981');
            html += buildScenarioCard('æƒ…å†µ3ï¼šæ¥è¿‘å‹åŠ›2', snapshot.scenario_3_count, snapshot.scenario_3_coins, '#f87171');
            html += buildScenarioCard('æƒ…å†µ4ï¼šæ¥è¿‘å‹åŠ›1', snapshot.scenario_4_count, snapshot.scenario_4_coins, '#ef4444');
            
            html += '</div>';
            html += `<div style="margin-top: 15px; padding: 10px; background: rgba(74,222,128,0.1); border-radius: 6px; text-align: center;">
                <strong style="color: #4ade80;">æ€»è®¡: ${snapshot.total_coins} ä¸ªå¸ç§</strong>
            </div>`;
            
            modalBody.innerHTML = html;
            modal.classList.add('show');
        }
        
        // æ›´æ–°ç¿»é¡µæŒ‰é’®çŠ¶æ€
        function updatePageButtons() {
            // ä¸Šä¸€é¡µæŒ‰é’®ï¼šç¬¬ä¸€é¡µæ—¶ç¦ç”¨
            document.getElementById('prevPage').disabled = (currentPageIndex === 0);
            
            // ä¸‹ä¸€é¡µæŒ‰é’®ï¼šæœ€åä¸€é¡µæ—¶ç¦ç”¨
            document.getElementById('nextPage').disabled = (currentPageIndex >= totalPages - 1);
        }
        
        // æ›´æ–°24å°æ—¶ä¿¡å·æ—¶é—´åˆ—è¡¨ï¼ˆå·¦å³åˆ†åˆ—ï¼‰
        function updateSignalPanel(signalMarkPoints) {
            const buyListEl = document.getElementById('buySignalsList');
            const sellListEl = document.getElementById('sellSignalsList');
            const timeRangeEl = document.getElementById('timeRange');
            
            if (!buyListEl || !sellListEl) return;
            
            // è·å–å½“å‰æ—¶é—´ï¼ˆsnapshot_timeå·²ç»æ˜¯åŒ—äº¬æ—¶é—´ï¼Œæ— éœ€è½¬æ¢ï¼‰
            const now = new Date();
            const beijingNow = now;  // snapshot_timeå·²æ˜¯åŒ—äº¬æ—¶é—´
            const twentyFourHoursAgo = new Date(beijingNow.getTime() - 24 * 3600 * 1000);
            
            // è¿‡æ»¤å‡º24å°æ—¶å†…çš„ä¿¡å·ï¼Œå¹¶åˆ†ç±»
            const buySignals = [];
            const sellSignals = [];
            
            signalMarkPoints.forEach(signal => {
                // ä»allSnapshotDataä¸­è·å–å¯¹åº”çš„æ—¶é—´
                const dataIndex = signal.xAxis;
                if (allSnapshotData && dataIndex < allSnapshotData.length) {
                    const snapshot = allSnapshotData[dataIndex];
                    // snapshot_timeå·²ç»æ˜¯åŒ—äº¬æ—¶é—´ï¼Œç›´æ¥ä½¿ç”¨
                    const signalTime = new Date(snapshot.snapshot_time);
                    const beijingSignalTime = signalTime;  // ä¸éœ€è¦è½¬æ¢
                    
                    // åªä¿ç•™24å°æ—¶å†…çš„ä¿¡å·
                    if (beijingSignalTime >= twentyFourHoursAgo) {
                        const signalData = {
                            type: signal.name,
                            time: beijingSignalTime,
                            timeStr: snapshot.snapshot_time.substring(5, 16), // MM-DD HH:MM
                            coinCount: signal.value.split('\n')[1] || ''
                        };
                        
                        if (signal.name === 'æŠ„åº•') {
                            buySignals.push(signalData);
                        } else {
                            sellSignals.push(signalData);
                        }
                    }
                }
            });
            
            // æŒ‰æ—¶é—´å€’åºæ’åˆ—ï¼ˆæœ€æ–°çš„åœ¨å‰ï¼‰
            buySignals.sort((a, b) => b.time - a.time);
            sellSignals.sort((a, b) => b.time - a.time);
            
            // æ›´æ–°æ—¶é—´èŒƒå›´æ˜¾ç¤º
            if (timeRangeEl) {
                const startStr = twentyFourHoursAgo.toISOString().substring(5, 16).replace('T', ' ');
                const nowStr = beijingNow.toISOString().substring(5, 16).replace('T', ' ');
                timeRangeEl.textContent = `${startStr} ~ ${nowStr}`;
            }
            
            // æ¸²æŸ“æŠ„åº•ä¿¡å·åˆ—è¡¨
            if (buySignals.length === 0) {
                buyListEl.innerHTML = '<div class="signal-no-recent">æš‚æ— ä¿¡å·</div>';
            } else {
                let html = '';
                buySignals.forEach(signal => {
                    html += `
                        <div class="signal-time-item buy">
                            <span class="icon">ğŸ“</span>
                            <span>${signal.timeStr}</span>
                            <span>${signal.coinCount}</span>
                        </div>
                    `;
                });
                buyListEl.innerHTML = html;
            }
            
            // æ¸²æŸ“é€ƒé¡¶ä¿¡å·åˆ—è¡¨
            if (sellSignals.length === 0) {
                sellListEl.innerHTML = '<div class="signal-no-recent">æš‚æ— ä¿¡å·</div>';
            } else {
                let html = '';
                sellSignals.forEach(signal => {
                    html += `
                        <div class="signal-time-item sell">
                            <span class="icon">ğŸ“</span>
                            <span>${signal.timeStr}</span>
                            <span>${signal.coinCount}</span>
                        </div>
                    `;
                });
                sellListEl.innerHTML = html;
            }
            
            // ç»Ÿè®¡2å°æ—¶å†…çš„é€ƒé¡¶ä¿¡å·
            const twoHoursAgo = new Date(beijingNow.getTime() - 2 * 3600 * 1000);
            const sellSignals2h = sellSignals.filter(signal => signal.time >= twoHoursAgo);
            
            console.log('ğŸ“Š 24å°æ—¶ä¿¡å·åˆ—è¡¨å·²æ›´æ–°ï¼ˆå·¦å³åˆ†åˆ—ï¼‰:', {
                æ€»ä¿¡å·æ•°: signalMarkPoints.length,
                æœ€è¿‘24å°æ—¶: buySignals.length + sellSignals.length,
                æŠ„åº•: buySignals.length,
                é€ƒé¡¶24h: sellSignals.length,
                é€ƒé¡¶2h: sellSignals2h.length
            });
            
            // æ›´æ–°24å°æ—¶é€ƒé¡¶ç»Ÿè®¡æ•°å­—
            const escape24hCountEl = document.getElementById('escape24hCount');
            if (escape24hCountEl) {
                escape24hCountEl.textContent = sellSignals.length;
                // æ ¹æ®æ•°é‡åŠ¨æ€è°ƒæ•´é¢œè‰²
                if (sellSignals.length === 0) {
                    escape24hCountEl.style.color = '#6b7280';
                    escape24hCountEl.style.textShadow = '0 2px 8px rgba(107, 114, 128, 0.5)';
                } else if (sellSignals.length >= 5) {
                    escape24hCountEl.style.color = '#dc2626';
                    escape24hCountEl.style.textShadow = '0 2px 8px rgba(220, 38, 38, 0.8)';
                } else {
                    escape24hCountEl.style.color = '#ef4444';
                    escape24hCountEl.style.textShadow = '0 2px 8px rgba(239, 68, 68, 0.5)';
                }
            }
            
            // æ›´æ–°2å°æ—¶é€ƒé¡¶ç»Ÿè®¡æ•°å­—
            const escape2hCountEl = document.getElementById('escape2hCount');
            if (escape2hCountEl) {
                escape2hCountEl.textContent = sellSignals2h.length;
                // æ ¹æ®æ•°é‡åŠ¨æ€è°ƒæ•´é¢œè‰²ï¼ˆæ©™è‰²ç³»ï¼‰
                if (sellSignals2h.length === 0) {
                    escape2hCountEl.style.color = '#6b7280';
                    escape2hCountEl.style.textShadow = '0 2px 8px rgba(107, 114, 128, 0.5)';
                } else if (sellSignals2h.length >= 3) {
                    escape2hCountEl.style.color = '#ea580c';
                    escape2hCountEl.style.textShadow = '0 2px 8px rgba(234, 88, 12, 0.8)';
                } else {
                    escape2hCountEl.style.color = '#f97316';
                    escape2hCountEl.style.textShadow = '0 2px 8px rgba(249, 115, 22, 0.5)';
                }
            }
        }
        
        
        // åŠ è½½å…¨å±€è¶‹åŠ¿æ•°æ®ï¼ˆæ‰€æœ‰å†å²ï¼‰
        function loadGlobalTrendData() {
            console.log('ğŸ“Š å¼€å§‹åŠ è½½å…¨å±€è¶‹åŠ¿æ•°æ®...');
            
            fetch('/api/support-resistance/snapshots?all=true')
                .then(response => response.json())
                .then(result => {
                    if (result.success) {
                        const data = result.data;
                        allSnapshotData = data; // ä¿å­˜å…¨å±€æ•°æ®
                        
                        console.log('âœ… å…¨å±€æ•°æ®åŠ è½½æˆåŠŸ:', data.length, 'æ¡è®°å½•');
                        
                        // æ£€æŸ¥ä¿¡å·å˜åŒ–ï¼ˆæ–°å¢ï¼‰
                        checkSignalChange(data);
                        
                        // æå–æ—¶é—´å’Œæ•°æ®
                        const times = data.map(d => {
                            const parts = d.snapshot_time.split(' ');
                            const date = parts[0].substring(5); // MM-DD
                            const time = parts[1].substring(0, 5); // HH:MM
                            return `${date} ${time}`;
                        });
                        const scenario1 = data.map(d => d.scenario_1_count || 0);
                        const scenario2 = data.map(d => d.scenario_2_count || 0);
                        const scenario3 = data.map(d => d.scenario_3_count || 0);
                        const scenario4 = data.map(d => d.scenario_4_count || 0);
                        
                        // æ£€æµ‹æŠ„åº•å’Œé€ƒé¡¶ä¿¡å·ï¼ˆå…¨å±€å›¾ï¼‰
                        const globalSignalMarkPoints = [];
                        data.forEach((d, index) => {
                            const scenario1 = d.scenario_1_count || 0;
                            const scenario2 = d.scenario_2_count || 0;
                            const scenario3 = d.scenario_3_count || 0;
                            const scenario4 = d.scenario_4_count || 0;
                            const resistanceTotal = scenario3 + scenario4;
                            
                            // æŠ„åº•ä¿¡å·ï¼šæƒ…å†µ1 â‰¥ 8 ä¸” æƒ…å†µ2 â‰¥ 8
                            if (scenario1 >= 8 && scenario2 >= 8) {
                                const supportTotal = scenario1 + scenario2;
                                globalSignalMarkPoints.push({
                                    name: 'æŠ„åº•',
                                    xAxis: index,
                                    yAxis: Math.max(d.scenario_1_count || 0, d.scenario_2_count || 0),
                                    value: `æŠ„åº•\n${supportTotal}å¸`,
                                    symbolSize: 60,
                                    symbol: 'pin',
                                    itemStyle: {
                                        color: '#00ff00',
                                        borderColor: '#fff',
                                        borderWidth: 2
                                    },
                                    label: {
                                        show: true,
                                        formatter: `æŠ„åº•\n${supportTotal}`,
                                        position: 'top',
                                        color: '#fff',
                                        fontSize: 10,
                                        fontWeight: 'bold',
                                        backgroundColor: 'rgba(0,255,0,0.8)',
                                        padding: [3, 6],
                                        borderRadius: 3
                                    }
                                });
                            }
                            
                            // é€ƒé¡¶ä¿¡å·ï¼šå‹åŠ›çº¿å¸ç§ â‰¥ 8
                            if (resistanceTotal >= 8) {
                                globalSignalMarkPoints.push({
                                    name: 'é€ƒé¡¶',
                                    xAxis: index,
                                    yAxis: Math.max(d.scenario_3_count || 0, d.scenario_4_count || 0),
                                    value: `é€ƒé¡¶\n${resistanceTotal}å¸`,
                                    symbolSize: 60,
                                    symbol: 'pin',
                                    itemStyle: {
                                        color: '#ff0000',
                                        borderColor: '#fff',
                                        borderWidth: 2
                                    },
                                    label: {
                                        show: true,
                                        formatter: `é€ƒé¡¶\n${resistanceTotal}`,
                                        position: 'top',
                                        color: '#fff',
                                        fontSize: 10,
                                        fontWeight: 'bold',
                                        backgroundColor: 'rgba(255,0,0,0.8)',
                                        padding: [3, 6],
                                        borderRadius: 3
                                    }
                                });
                            }
                        });
                        
                        console.log('ğŸ“ å…¨å±€å›¾æ£€æµ‹åˆ°ä¿¡å·:', {æŠ„åº•: globalSignalMarkPoints.filter(p => p.name === 'æŠ„åº•').length, é€ƒé¡¶: globalSignalMarkPoints.filter(p => p.name === 'é€ƒé¡¶').length});
                        
                        // æ›´æ–°ä¿¡å·é¢æ¿
                        updateSignalPanel(globalSignalMarkPoints);
                        
                        // æ›´æ–°å…¨å±€è¶‹åŠ¿å›¾
                        globalTrendChart.setOption({
                            xAxis: { data: times },
                            series: [
                                { 
                                    data: scenario1,
                                    markPoint: globalSignalMarkPoints.length > 0 ? {
                                        data: globalSignalMarkPoints
                                    } : undefined
                                },
                                { data: scenario2 },
                                { data: scenario3 },
                                { data: scenario4 }
                            ]
                        });
                        
                        // å¼ºåˆ¶è°ƒæ•´å›¾è¡¨å¤§å°ä»¥ç¡®ä¿æ­£ç¡®æ¸²æŸ“
                        setTimeout(() => {
                            if (globalTrendChart) {
                                globalTrendChart.resize();
                                console.log('âœ… å…¨å±€è¶‹åŠ¿å›¾resizeå®Œæˆ');
                            }
                        }, 100);
                        
                        console.log('âœ… å…¨å±€è¶‹åŠ¿å›¾æ›´æ–°å®Œæˆ');
                        
                        // å…¨å±€æ•°æ®åŠ è½½å®Œæˆåï¼Œè®¡ç®—æ€»é¡µæ•°å¹¶åŠ è½½æœ€æ–°ä¸€é¡µ
                        const itemsPerPage = 40;
                        totalPages = Math.ceil(allSnapshotData.length / itemsPerPage);
                        currentPageIndex = totalPages > 0 ? totalPages - 1 : 0; // é»˜è®¤æ˜¾ç¤ºæœ€æ–°ä¸€é¡µ
                        console.log('ğŸ“Š è®¡ç®—åˆ†é¡µ:', {æ€»è®°å½•æ•°: allSnapshotData.length, æ€»é¡µæ•°: totalPages, é»˜è®¤é¡µ: currentPageIndex + 1});
                        loadPagedTrendData();
                    }
                })
                .catch(error => {
                    console.error('âŒ åŠ è½½å…¨å±€è¶‹åŠ¿æ•°æ®å¤±è´¥:', error);
                });
        }
        
        // åŠ è½½æ¯æ—¥æ—¶é—´è½´ï¼ˆé€‰ä¸­æ—¥æœŸçš„æ‰€æœ‰å¿«ç…§ï¼‰
        function loadDailyTimeline(date) {
            console.log('ğŸ• åŠ è½½æ¯æ—¥æ—¶é—´è½´:', date);
            
            fetch(`/api/support-resistance/snapshots?date=${date}`)
                .then(response => response.json())
                .then(result => {
                    if (result.success) {
                        const data = result.data;
                        dailySnapshotData = data; // ä¿å­˜å½“æ—¥æ•°æ®
                        
                        console.log('âœ… å½“æ—¥æ•°æ®åŠ è½½æˆåŠŸ:', data.length, 'æ¡è®°å½•');
                        
                        const timelineContainer = document.getElementById('dailyTimeline');
                        
                        if (data.length === 0) {
                            timelineContainer.innerHTML = '<p style="color: rgba(255,255,255,0.6); text-align: center;">è¯¥æ—¥æœŸæš‚æ— æ•°æ®</p>';
                            return;
                        }
                        
                        // ç”Ÿæˆæ—¶é—´ç‚¹æŒ‰é’®
                        let html = '<div style="text-align: center;">';
                        data.forEach((snapshot, index) => {
                            const time = snapshot.snapshot_time.split(' ')[1].substring(0, 5); // HH:MM
                            const totalCount = snapshot.total_coins || 0;
                            html += `
                                <span class="timeline-item" onclick="showSnapshotDetail(${index})" title="å…±${totalCount}ä¸ªå¸ç§">
                                    ${time}
                                </span>
                            `;
                        });
                        html += '</div>';
                        
                        timelineContainer.innerHTML = html;
                        console.log('âœ… æ—¶é—´è½´æ¸²æŸ“å®Œæˆï¼Œå…±', data.length, 'ä¸ªæ—¶é—´ç‚¹');
                    }
                })
                .catch(error => {
                    console.error('âŒ åŠ è½½æ¯æ—¥æ—¶é—´è½´å¤±è´¥:', error);
                    document.getElementById('dailyTimeline').innerHTML = 
                        '<p style="color: #ef4444; text-align: center;">åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•</p>';
                });
        }
        
        // æ˜¾ç¤ºå¿«ç…§è¯¦æƒ…ï¼ˆç‚¹å‡»æ—¶é—´ç‚¹ï¼‰
        function showSnapshotDetail(index) {
            console.log('ğŸ” æ˜¾ç¤ºå¿«ç…§è¯¦æƒ…ï¼Œç´¢å¼•:', index);
            
            if (!dailySnapshotData || index >= dailySnapshotData.length) {
                console.error('âŒ æ•°æ®ç´¢å¼•æ— æ•ˆ');
                return;
            }
            
            const snapshot = dailySnapshotData[index];
            const modal = document.getElementById('historyModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');
            
            // è®¾ç½®æ ‡é¢˜
            modalTitle.textContent = `ğŸ• ${snapshot.snapshot_time} (åŒ—äº¬æ—¶é—´)`;
            
            // æ„å»ºå†…å®¹
            let html = '<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">';
            
            // æƒ…å†µ1
            html += buildScenarioCard(
                'æƒ…å†µ1ï¼šæ¥è¿‘æ”¯æ’‘2',
                snapshot.scenario_1_count,
                snapshot.scenario_1_coins,
                '#4ade80'
            );
            
            // æƒ…å†µ2
            html += buildScenarioCard(
                'æƒ…å†µ2ï¼šæ¥è¿‘æ”¯æ’‘1',
                snapshot.scenario_2_count,
                snapshot.scenario_2_coins,
                '#10b981'
            );
            
            // æƒ…å†µ3
            html += buildScenarioCard(
                'æƒ…å†µ3ï¼šæ¥è¿‘å‹åŠ›2',
                snapshot.scenario_3_count,
                snapshot.scenario_3_coins,
                '#f87171'
            );
            
            // æƒ…å†µ4
            html += buildScenarioCard(
                'æƒ…å†µ4ï¼šæ¥è¿‘å‹åŠ›1',
                snapshot.scenario_4_count,
                snapshot.scenario_4_coins,
                '#ef4444'
            );
            
            html += '</div>';
            html += `<div style="margin-top: 15px; padding: 10px; background: rgba(74,222,128,0.1); border-radius: 6px; text-align: center;">
                <strong style="color: #4ade80;">æ€»è®¡: ${snapshot.total_coins} ä¸ªå¸ç§</strong>
            </div>`;
            
            modalBody.innerHTML = html;
            modal.classList.add('show');
        }
        
        // æ„å»ºæƒ…å†µå¡ç‰‡HTML
        function buildScenarioCard(title, count, coinsJson, color) {
            console.log('ğŸ—ï¸ æ„å»ºåœºæ™¯å¡ç‰‡:', {title, count, coinsJsonType: typeof coinsJson, coinsJson});
            
            let coins = [];
            
            // å¦‚æœcoinsJsonå·²ç»æ˜¯æ•°ç»„ï¼Œç›´æ¥ä½¿ç”¨ï¼›å¦‚æœæ˜¯å­—ç¬¦ä¸²ï¼Œå°è¯•è§£æ
            if (Array.isArray(coinsJson)) {
                coins = coinsJson;
                console.log('âœ… å¸ç§æ•°æ®å·²ç»æ˜¯æ•°ç»„:', coins.length, 'ä¸ªå¸ç§');
            } else if (typeof coinsJson === 'string') {
                try {
                    coins = JSON.parse(coinsJson || '[]');
                    console.log('âœ… æˆåŠŸè§£æå¸ç§JSON:', coins.length, 'ä¸ªå¸ç§');
                } catch (e) {
                    console.error('âŒ è§£æå¸ç§åˆ—è¡¨å¤±è´¥:', e);
                }
            } else {
                console.warn('âš ï¸ å¸ç§æ•°æ®æ ¼å¼æœªçŸ¥:', typeof coinsJson);
            }
            
            let html = `
                <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; border-left: 3px solid ${color};">
                    <h4 style="color: ${color}; margin-bottom: 10px;">${title}</h4>
                    <div style="font-size: 24px; font-weight: bold; color: ${color}; margin-bottom: 10px;">${count} ä¸ª</div>
            `;
            
            if (coins.length > 0) {
                html += '<div style="max-height: 200px; overflow-y: auto;">';
                coins.forEach(coin => {
                    html += `
                        <div style="margin: 5px 0; padding: 5px; background: rgba(255,255,255,0.05); border-radius: 4px; font-size: 12px;">
                            <strong style="color: #fff;">${coin.symbol}</strong>
                            <span style="color: rgba(255,255,255,0.7);"> - $${coin.current_price?.toFixed(6) || 'N/A'}</span>
                        </div>
                    `;
                });
                html += '</div>';
            } else {
                html += '<p style="color: rgba(255,255,255,0.5); font-size: 12px;">æ— å¸ç§</p>';
            }
            
            html += '</div>';
            return html;
        }
        
        // å…³é—­å¼¹çª—
        function closeHistoryModal() {
            document.getElementById('historyModal').classList.remove('show');
        }
        
        
        // æ—¥æœŸé€‰æ‹©å™¨äº‹ä»¶
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ é¡µé¢åˆå§‹åŒ– v3.8 - å…¨å±€è¶‹åŠ¿ + æ¯æ—¥æ—¶é—´è½´');
            
            // æ£€æŸ¥éŸ³é¢‘æ¿€æ´»çŠ¶æ€å¹¶æç¤ºç”¨æˆ·
            if (!localStorage.getItem('audioActivated')) {
                console.log('âš ï¸ AudioContext å°šæœªæ¿€æ´»ï¼Œéœ€è¦ç”¨æˆ·äº¤äº’');
                // æ˜¾ç¤ºæ¿€æ´»æç¤º
                showAudioActivationTip();
            }
            
            // åˆå§‹åŒ–æ—¥æœŸé€‰æ‹©å™¨
            const datePicker = document.getElementById('datePicker');
            datePicker.value = currentDate;
            datePicker.max = getBeijingDate();
            
            // æ—¥æœŸé€‰æ‹©å™¨changeäº‹ä»¶ - åªå½±å“æ¯æ—¥æ—¶é—´è½´
            datePicker.addEventListener('change', function() {
                currentDate = this.value;
                console.log('ğŸ“… æ—¥æœŸå·²æ›´æ”¹:', currentDate);
                loadDailyTimeline(currentDate);
            });
            
            // åˆå§‹åŒ–å…¨å±€è¶‹åŠ¿å›¾
            console.log('ğŸ“Š åˆå§‹åŒ–å…¨å±€è¶‹åŠ¿å›¾...');
            try {
                initGlobalTrendChart();
                console.log('âœ… å…¨å±€è¶‹åŠ¿å›¾åˆå§‹åŒ–æˆåŠŸ');
            } catch (error) {
                console.error('âŒ å…¨å±€è¶‹åŠ¿å›¾åˆå§‹åŒ–å¤±è´¥:', error);
            }
            
            // åŠ è½½å…¨å±€è¶‹åŠ¿æ•°æ®ï¼ˆæ‰€æœ‰å†å²ï¼‰
            console.log('ğŸ“¡ åŠ è½½å…¨å±€è¶‹åŠ¿æ•°æ®...');
            try {
                loadGlobalTrendData();
            } catch (error) {
                console.error('âŒ åŠ è½½å…¨å±€è¶‹åŠ¿æ•°æ®å¤±è´¥:', error);
            }
            
            // åˆå§‹åŒ–12å°æ—¶åˆ†é¡µå›¾è¡¨
            console.log('ğŸ“Š åˆå§‹åŒ–12å°æ—¶åˆ†é¡µå›¾...');
            try {
                initPagedTrendChart();
                console.log('âœ… 12å°æ—¶åˆ†é¡µå›¾åˆå§‹åŒ–æˆåŠŸ');
            } catch (error) {
                console.error('âŒ 12å°æ—¶åˆ†é¡µå›¾åˆå§‹åŒ–å¤±è´¥:', error);
            }
            
            // åˆå§‹åŒ–24å°æ—¶é€ƒé¡¶ä¿¡å·ç»Ÿè®¡å›¾
            console.log('ğŸš¨ åˆå§‹åŒ–24å°æ—¶é€ƒé¡¶ä¿¡å·ç»Ÿè®¡å›¾...');
            try {
                initEscapeSignalChart();
                console.log('âœ… é€ƒé¡¶ä¿¡å·ç»Ÿè®¡å›¾åˆå§‹åŒ–æˆåŠŸ');
            } catch (error) {
                console.error('âŒ é€ƒé¡¶ä¿¡å·ç»Ÿè®¡å›¾åˆå§‹åŒ–å¤±è´¥:', error);
            }
            
            // åŠ è½½é€ƒé¡¶ä¿¡å·æ•°æ®
            console.log('ğŸ“¡ åŠ è½½é€ƒé¡¶ä¿¡å·æ•°æ®...');
            try {
                loadEscapeSignalData();
            } catch (error) {
                console.error('âŒ åŠ è½½é€ƒé¡¶ä¿¡å·æ•°æ®å¤±è´¥:', error);
            }
            
            // æ—¥æœŸé€‰æ‹©å™¨æ§åˆ¶åˆ†é¡µå›¾è¡¨
            
            // ç»‘å®šç¿»é¡µæŒ‰é’®äº‹ä»¶
            document.getElementById('prevPage').addEventListener('click', function() {
                if (currentPageIndex > 0) {
                    currentPageIndex--;
                    console.log('â¬…ï¸ ç¿»åˆ°æ›´æ—©é¡µé¢:', currentPageIndex + 1);
                    loadPagedTrendData();
                }
            });
            
            document.getElementById('nextPage').addEventListener('click', function() {
                if (currentPageIndex < totalPages - 1) {
                    currentPageIndex++;
                    console.log('â¡ï¸ ç¿»åˆ°æ›´æ™šé¡µé¢:', currentPageIndex + 1);
                    loadPagedTrendData();
                }
            });
            
            // æ³¨æ„ï¼šåˆ†é¡µæ•°æ®ä¼šåœ¨å…¨å±€æ•°æ®åŠ è½½å®Œæˆåè‡ªåŠ¨åŠ è½½
            
            // åŠ è½½ä»Šå¤©çš„æ¯æ—¥æ—¶é—´è½´
            console.log('ğŸ• åŠ è½½ä»Šæ—¥æ—¶é—´è½´...');
            try {
                loadDailyTimeline(currentDate);
            } catch (error) {
                console.error('âŒ åŠ è½½æ¯æ—¥æ—¶é—´è½´å¤±è´¥:', error);
            }
        });
        
        // ç‰ˆæœ¬ä¿¡æ¯
        (function displayVersion() {
            const VERSION = '3.0';
            console.log('âœ… é¡µé¢ç‰ˆæœ¬: v' + VERSION + ' - å…¨å±€è¶‹åŠ¿ + æ¯æ—¥æ—¶é—´è½´');
            console.log('ğŸ“Š å…¨å±€è¶‹åŠ¿å›¾: æ˜¾ç¤ºæ‰€æœ‰å†å²æ•°æ®ï¼ˆä¸å—æ—¥æœŸé€‰æ‹©å½±å“ï¼‰');
            console.log('ğŸ• æ¯æ—¥æ—¶é—´è½´: é€‰æ‹©æ—¥æœŸåæ˜¾ç¤ºè¯¥å¤©çš„æ‰€æœ‰å¿«ç…§æ—¶é—´ç‚¹');
            console.log('ğŸ’¡ ç‚¹å‡»æ—¶é—´ç‚¹å¯æŸ¥çœ‹è¯¥æ—¶åˆ»çš„è¯¦ç»†å¸ç§åˆ—è¡¨');
        })();
        
        // éŸ³é¢‘æ¿€æ´»æç¤º
        function showAudioActivationTip() {
            // åˆ›å»ºæç¤ºæ¨ªå¹…
            const tipBanner = document.createElement('div');
            tipBanner.id = 'audioActivationTip';
            tipBanner.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                padding: 15px 30px;
                border-radius: 12px;
                box-shadow: 0 10px 25px rgba(0,0,0,0.3);
                z-index: 10001;
                font-size: 16px;
                font-weight: 600;
                cursor: pointer;
                animation: slideInDown 0.5s ease-out;
                display: flex;
                align-items: center;
                gap: 15px;
            `;
            tipBanner.innerHTML = `
                <span style="font-size: 24px;">ğŸ”Š</span>
                <span>ç‚¹å‡»æ­¤å¤„å¯ç”¨éŸ³æ•ˆæé†’åŠŸèƒ½</span>
                <span style="font-size: 20px; animation: pulse 2s infinite;">ğŸ‘†</span>
            `;
            
            // ç‚¹å‡»åæ¿€æ´»éŸ³é¢‘
            tipBanner.addEventListener('click', function() {
                activateAudio();
                document.body.removeChild(tipBanner);
            });
            
            document.body.appendChild(tipBanner);
            
            // 10ç§’åè‡ªåŠ¨æ·¡å‡ºï¼ˆå¦‚æœç”¨æˆ·æœªç‚¹å‡»ï¼‰
            setTimeout(() => {
                if (document.getElementById('audioActivationTip')) {
                    tipBanner.style.transition = 'opacity 1s';
                    tipBanner.style.opacity = '0';
                    setTimeout(() => {
                        if (document.body.contains(tipBanner)) {
                            document.body.removeChild(tipBanner);
                        }
                    }, 1000);
                }
            }, 10000);
        }
        
        // æ¿€æ´»éŸ³é¢‘ä¸Šä¸‹æ–‡
        function activateAudio() {
            try {
                // åˆ›å»ºå¹¶æ¢å¤ AudioContext
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                audioContext.resume().then(() => {
                    console.log('âœ… AudioContext å·²æ¿€æ´»');
                    localStorage.setItem('audioActivated', 'true');
                    
                    // æ’­æ”¾çŸ­ä¿ƒæç¤ºéŸ³ç¡®è®¤æ¿€æ´»
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.1);
                    
                    // æ˜¾ç¤ºæˆåŠŸæç¤º
                    const successMsg = document.createElement('div');
                    successMsg.style.cssText = `
                        position: fixed;
                        top: 20px;
                        left: 50%;
                        transform: translateX(-50%);
                        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
                        color: white;
                        padding: 12px 25px;
                        border-radius: 8px;
                        box-shadow: 0 8px 20px rgba(0,0,0,0.2);
                        z-index: 10002;
                        font-size: 15px;
                        font-weight: 600;
                        animation: slideInDown 0.3s ease-out;
                    `;
                    successMsg.textContent = 'âœ… éŸ³æ•ˆå·²å¯ç”¨ï¼Œä¿¡å·è§¦å‘æ—¶å°†æ’­æ”¾æç¤ºéŸ³ï¼';
                    document.body.appendChild(successMsg);
                    
                    // 3ç§’åç§»é™¤æˆåŠŸæç¤º
                    setTimeout(() => {
                        successMsg.style.transition = 'opacity 0.5s';
                        successMsg.style.opacity = '0';
                        setTimeout(() => {
                            if (document.body.contains(successMsg)) {
                                document.body.removeChild(successMsg);
                            }
                        }, 500);
                    }, 3000);
                });
            } catch (error) {
                console.error('âŒ AudioContext æ¿€æ´»å¤±è´¥:', error);
            }
        }
        
        // è‡ªåŠ¨æ£€æµ‹æœ€æ–°ä¿¡å·
        let lastCheckedSignalTime = null;
        let lastSignalState = { buy: false, sell: false }; // è®°å½•ä¸Šä¸€æ¬¡çš„ä¿¡å·çŠ¶æ€
        
        function checkLatestSignal() {
            fetch('/api/support-resistance/latest-signal')
                .then(response => response.json())
                .then(result => {
                    if (result.success) {
                        const snapshot = result;
                        const snapshotTime = snapshot.snapshot_time;
                        
                        // å¦‚æœæ˜¯æ–°çš„å¿«ç…§
                        if (snapshotTime !== lastCheckedSignalTime) {
                            lastCheckedSignalTime = snapshotTime;
                            
                            const signals = snapshot.signals;
                            const buyListEl = document.getElementById('buySignalsList');
                            const sellListEl = document.getElementById('sellSignalsList');
                            
                            // æ£€æŸ¥æŠ„åº•ä¿¡å·æ˜¯å¦ä»æ— åˆ°æœ‰ï¼ˆæ–°å¢åŠ ï¼‰
                            const isBuySignalNew = signals.buy && !lastSignalState.buy;
                            
                            // å¦‚æœè§¦å‘æŠ„åº•ä¿¡å· ä¸” æ˜¯æ–°å¢åŠ çš„
                            if (isBuySignalNew) {
                                console.log('ğŸ¯ æ£€æµ‹åˆ°æ–°çš„æŠ„åº•ä¿¡å·!', {
                                    æ—¶é—´: snapshotTime,
                                    æƒ…å†µ1: snapshot.scenario_1_count,
                                    æƒ…å†µ2: snapshot.scenario_2_count,
                                    æ€»å¸æ•°: signals.buy_count
                                });
                                
                                // å‡†å¤‡å¸ç§æ•°æ®
                                const buyCoins = [];
                                if (snapshot.scenario_1_coins) {
                                    snapshot.scenario_1_coins.forEach(coin => {
                                        buyCoins.push({
                                            symbol: coin.symbol || coin,
                                            price: coin.current_price,
                                            position: coin.position
                                        });
                                    });
                                }
                                if (snapshot.scenario_2_coins) {
                                    snapshot.scenario_2_coins.forEach(coin => {
                                        // é¿å…é‡å¤
                                        if (!buyCoins.find(c => c.symbol === (coin.symbol || coin))) {
                                            buyCoins.push({
                                                symbol: coin.symbol || coin,
                                                price: coin.current_price,
                                                position: coin.position
                                            });
                                        }
                                    });
                                }
                                
                                // æ·»åŠ åˆ°æŠ„åº•åˆ—è¡¨é¡¶éƒ¨
                                if (buyListEl) {
                                    const timeStr = snapshotTime.substring(5, 16); // MM-DD HH:MM
                                    const newItem = document.createElement('div');
                                    newItem.className = 'signal-time-item buy';
                                    newItem.style.animation = 'pulse 1s ease-in-out 3';
                                    newItem.innerHTML = `
                                        <span class="icon">ğŸ“</span>
                                        <span>${timeStr}</span>
                                        <span>${signals.buy_count}å¸</span>
                                    `;
                                    
                                    // æ’å…¥åˆ°åˆ—è¡¨æœ€å‰é¢
                                    const firstChild = buyListEl.querySelector('.signal-time-item');
                                    if (firstChild) {
                                        buyListEl.insertBefore(newItem, firstChild);
                                    } else {
                                        // å¦‚æœåˆ—è¡¨ä¸ºç©ºï¼Œå…ˆæ¸…ç©º"æš‚æ— ä¿¡å·"
                                        buyListEl.innerHTML = '';
                                        buyListEl.appendChild(newItem);
                                    }
                                    
                                    // æ˜¾ç¤ºé€šçŸ¥ï¼ˆåŒ…å«å¸ç§æ•°æ®ï¼‰
                                    showSignalNotification('æŠ„åº•', snapshotTime, signals.buy_count, buyCoins);
                                }
                            }
                            
                            // æ£€æŸ¥é€ƒé¡¶ä¿¡å·æ˜¯å¦ä»æ— åˆ°æœ‰ï¼ˆæ–°å¢åŠ ï¼‰
                            const isSellSignalNew = signals.sell && !lastSignalState.sell;
                            
                            // å¦‚æœè§¦å‘é€ƒé¡¶ä¿¡å· ä¸” æ˜¯æ–°å¢åŠ çš„
                            if (isSellSignalNew) {
                                console.log('ğŸ¯ æ£€æµ‹åˆ°æ–°çš„é€ƒé¡¶ä¿¡å·!', {
                                    æ—¶é—´: snapshotTime,
                                    æƒ…å†µ3: snapshot.scenario_3_count,
                                    æƒ…å†µ4: snapshot.scenario_4_count,
                                    æ€»å¸æ•°: signals.sell_count
                                });
                                
                                // å‡†å¤‡å¸ç§æ•°æ®
                                const sellCoins = [];
                                if (snapshot.scenario_3_coins) {
                                    snapshot.scenario_3_coins.forEach(coin => {
                                        sellCoins.push({
                                            symbol: coin.symbol || coin,
                                            price: coin.current_price,
                                            position: coin.position
                                        });
                                    });
                                }
                                if (snapshot.scenario_4_coins) {
                                    snapshot.scenario_4_coins.forEach(coin => {
                                        // é¿å…é‡å¤
                                        if (!sellCoins.find(c => c.symbol === (coin.symbol || coin))) {
                                            sellCoins.push({
                                                symbol: coin.symbol || coin,
                                                price: coin.current_price,
                                                position: coin.position
                                            });
                                        }
                                    });
                                }
                                
                                // æ·»åŠ åˆ°é€ƒé¡¶åˆ—è¡¨é¡¶éƒ¨
                                if (sellListEl) {
                                    const timeStr = snapshotTime.substring(5, 16); // MM-DD HH:MM
                                    const newItem = document.createElement('div');
                                    newItem.className = 'signal-time-item sell';
                                    newItem.style.animation = 'pulse 1s ease-in-out 3';
                                    newItem.innerHTML = `
                                        <span class="icon">ğŸ“</span>
                                        <span>${timeStr}</span>
                                        <span>${signals.sell_count}å¸</span>
                                    `;
                                    
                                    // æ’å…¥åˆ°åˆ—è¡¨æœ€å‰é¢
                                    const firstChild = sellListEl.querySelector('.signal-time-item');
                                    if (firstChild) {
                                        sellListEl.insertBefore(newItem, firstChild);
                                    } else {
                                        // å¦‚æœåˆ—è¡¨ä¸ºç©ºï¼Œå…ˆæ¸…ç©º"æš‚æ— ä¿¡å·"
                                        sellListEl.innerHTML = '';
                                        sellListEl.appendChild(newItem);
                                    }
                                    
                                    // æ˜¾ç¤ºé€šçŸ¥ï¼ˆåŒ…å«å¸ç§æ•°æ®ï¼‰
                                    showSignalNotification('é€ƒé¡¶', snapshotTime, signals.sell_count, sellCoins);
                                }
                            }
                            
                            // æ›´æ–°ä¿¡å·çŠ¶æ€
                            lastSignalState.buy = signals.buy;
                            lastSignalState.sell = signals.sell;
                            
                            // è®°å½•å½“å‰ä¿¡å·çŠ¶æ€ï¼ˆç”¨äºè°ƒè¯•ï¼‰
                            console.log('ğŸ“Š ä¿¡å·çŠ¶æ€æ›´æ–°:', {
                                æ—¶é—´: snapshotTime,
                                æŠ„åº•ä¿¡å·: signals.buy ? `âœ… (${signals.buy_count}å¸)` : 'âŒ',
                                é€ƒé¡¶ä¿¡å·: signals.sell ? `âœ… (${signals.sell_count}å¸)` : 'âŒ',
                                æœ¬æ¬¡è§¦å‘: {
                                    æŠ„åº•: isBuySignalNew ? 'ğŸ”” è§¦å‘é€šçŸ¥' : 'â¸ï¸ æœªè§¦å‘',
                                    é€ƒé¡¶: isSellSignalNew ? 'ğŸ”” è§¦å‘é€šçŸ¥' : 'â¸ï¸ æœªè§¦å‘'
                                }
                            });
                        }
                    }
                })
                .catch(error => {
                    console.error('âŒ æ£€æµ‹æœ€æ–°ä¿¡å·å¤±è´¥:', error);
                });
        }
        
        // æ’­æ”¾éŸ³æ•ˆ - é—´æ–­æ€§å£°éŸ³ï¼ˆæ¯ç§’å“ä¸€æ¬¡ï¼Œå…±10æ¬¡ï¼‰
        function playSignalSound(type) {
            // æ£€æŸ¥è®¾ç½®
            if (!signalSettings.soundEnabled) {
                console.log('ğŸ”‡ éŸ³æ•ˆå·²å…³é—­');
                return;
            }
            
            console.log('ğŸ”Š å¼€å§‹æ’­æ”¾é—´æ–­éŸ³æ•ˆï¼ˆ10æ¬¡ï¼Œæ¯ç§’1æ¬¡ï¼‰:', type);
            
            // æ’­æ”¾å•æ¬¡"å“”"å£°
            function playBeep(beepNumber) {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                // çŸ­ä¿ƒçš„"å“”"å£°ï¼ˆ0.2ç§’ï¼‰
                if (type === 'æŠ„åº•') {
                    // æŠ„åº•ä¿¡å·ï¼šé«˜éŸ³å“”å“”ï¼ˆ800Hzï¼‰
                    oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                } else {
                    // é€ƒé¡¶ä¿¡å·ï¼šä½éŸ³å“”å“”ï¼ˆ400Hzï¼‰
                    oscillator.frequency.setValueAtTime(400, audioContext.currentTime);
                }
                
                // éŸ³é‡ï¼šå¿«é€Ÿè¡°å‡
                gainNode.gain.setValueAtTime(0.7, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.2);
                
                console.log(`  ğŸ”” ç¬¬ ${beepNumber}/10 æ¬¡å“”å£°`);
            }
            
            // ç«‹å³æ’­æ”¾ç¬¬ä¸€æ¬¡
            playBeep(1);
            
            // æ¯éš”1ç§’æ’­æ”¾ä¸€æ¬¡ï¼Œå…±10æ¬¡
            let beepCount = 1;
            const beepInterval = setInterval(() => {
                beepCount++;
                playBeep(beepCount);
                
                if (beepCount >= 10) {
                    clearInterval(beepInterval);
                    console.log('âœ… éŸ³æ•ˆæ’­æ”¾å®Œæˆï¼ˆå…±10æ¬¡ï¼‰');
                }
            }, 1000);
        }
        
        // æ˜¾ç¤ºä¿¡å·è¯¦æƒ…å¼¹çª—
        function showSignalModal(type, time, count, coinData) {
            // æ£€æŸ¥è®¾ç½®
            if (!signalSettings.popupEnabled) {
                console.log('ğŸš« å¼¹çª—å·²å…³é—­');
                return;
            }
            
            const modal = document.getElementById('signalModal');
            const modalContent = document.getElementById('signalModalContent');
            const modalTitle = document.getElementById('signalModalTitle');
            const modalBody = document.getElementById('signalModalBody');
            
            const icon = type === 'æŠ„åº•' ? 'ğŸ“ˆ' : 'ğŸ“‰';
            const colorClass = type === 'æŠ„åº•' ? 'buy' : 'sell';
            const color = type === 'æŠ„åº•' ? '#4ade80' : '#ef4444';
            
            // è®¾ç½®æ ‡é¢˜
            modalTitle.className = `signal-modal-title ${colorClass}`;
            modalTitle.innerHTML = `<span style="font-size: 36px;">${icon}</span><span>${type}ä¿¡å·è§¦å‘ï¼</span>`;
            
            // è®¾ç½®è¾¹æ¡†é¢œè‰²
            modalContent.className = `signal-modal-content ${colorClass}-modal`;
            
            // è®¾ç½®å†…å®¹
            let coinsHTML = '';
            if (coinData && coinData.length > 0) {
                coinData.forEach(coin => {
                    coinsHTML += `
                        <div class="signal-coin-item ${colorClass}">
                            <div class="signal-coin-symbol">${coin.symbol || coin}</div>
                            ${coin.price ? `<div class="signal-coin-details">
                                <span>ğŸ’° ä»·æ ¼: $${coin.price}</span>
                                ${coin.position ? `<span>ğŸ“ ä½ç½®: ${coin.position}</span>` : ''}
                            </div>` : ''}
                        </div>
                    `;
                });
            }
            
            modalBody.innerHTML = `
                <div class="signal-modal-info">
                    <div class="signal-info-row">
                        <span class="signal-info-label">â° è§¦å‘æ—¶é—´</span>
                        <span class="signal-info-value">${time}</span>
                    </div>
                    <div class="signal-info-row">
                        <span class="signal-info-label">ğŸ“Š è§¦å‘å¸ç§æ•°é‡</span>
                        <span class="signal-info-value" style="color: ${color};">${count} ä¸ªå¸ç§</span>
                    </div>
                    <div class="signal-info-row">
                        <span class="signal-info-label">ğŸ¯ ä¿¡å·ç±»å‹</span>
                        <span class="signal-info-value" style="color: ${color};">${type}ä¿¡å·</span>
                    </div>
                </div>
                ${coinsHTML ? `
                    <div style="margin-top: 20px;">
                        <h4 style="color: rgba(255,255,255,0.9); margin-bottom: 15px;">ğŸ“‹ è§¦å‘å¸ç§åˆ—è¡¨</h4>
                        <div class="signal-coin-list">${coinsHTML}</div>
                    </div>
                ` : ''}
                <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1); text-align: center; color: rgba(255,255,255,0.6); font-size: 13px;">
                    ğŸ’¡ æç¤ºï¼šæ­¤ä¿¡å·åŸºäºæ”¯æ’‘å‹åŠ›çº¿ç³»ç»Ÿè‡ªåŠ¨æ£€æµ‹ç”Ÿæˆ
                </div>
            `;
            
            // æ˜¾ç¤ºå¼¹çª—ï¼ˆä»…æ‰‹åŠ¨å…³é—­ï¼‰
            modal.classList.add('show');
            
            console.log('ğŸ“‹ æ˜¾ç¤ºä¿¡å·è¯¦æƒ…å¼¹çª—:', type, count, 'ä¸ªå¸ç§ï¼ˆæ‰‹åŠ¨å…³é—­ï¼‰');
        }
        
        // å…³é—­ä¿¡å·è¯¦æƒ…å¼¹çª—
        function closeSignalModal() {
            const modal = document.getElementById('signalModal');
            modal.classList.remove('show');
        }
        
        // ç¦ç”¨ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­ï¼ˆç”¨æˆ·è¦æ±‚åªèƒ½ç‚¹âœ•æŒ‰é’®å…³é—­ï¼‰
        // document.addEventListener('click', function(event) {
        //     const modal = document.getElementById('signalModal');
        //     if (event.target === modal) {
        //         closeSignalModal();
        //     }
        // });
        
        // ç¦ç”¨ESCé”®å…³é—­å¼¹çª—ï¼ˆç”¨æˆ·è¦æ±‚åªèƒ½ç‚¹âœ•æŒ‰é’®å…³é—­ï¼‰
        // document.addEventListener('keydown', function(event) {
        //     if (event.key === 'Escape') {
        //         closeSignalModal();
        //     }
        // });
        
        // æ˜¾ç¤ºä¿¡å·é€šçŸ¥
        function showSignalNotification(type, time, count, coinData) {
            const color = type === 'æŠ„åº•' ? '#4ade80' : '#ef4444';
            const icon = type === 'æŠ„åº•' ? 'ğŸ“ˆ' : 'ğŸ“‰';
            
            // æ’­æ”¾éŸ³æ•ˆï¼ˆä¼šæ£€æŸ¥è‡ªå·±çš„è®¾ç½®ï¼‰
            playSignalSound(type);
            
            // æ£€æŸ¥é€šçŸ¥æ è®¾ç½®
            if (!signalSettings.notificationEnabled) {
                console.log('ğŸ”• é€šçŸ¥æ å·²å…³é—­');
                return;
            }
            
            // åˆ›å»ºé€šçŸ¥å…ƒç´ 
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 80px;
                right: 20px;
                background: ${color};
                color: white;
                padding: 16px 24px;
                border-radius: 12px;
                box-shadow: 0 8px 24px rgba(0,0,0,0.4);
                z-index: 10000;
                font-size: 16px;
                font-weight: 600;
                animation: slideIn 0.5s ease-out;
                cursor: pointer;
            `;
            notification.innerHTML = `
                <div style="display: flex; align-items: center; justify-content: space-between; width: 100%;">
                    <div style="display: flex; align-items: center; gap: 12px; flex: 1;">
                        <span style="font-size: 24px;">${icon}</span>
                        <div>
                            <div>${type}ä¿¡å·è§¦å‘ï¼</div>
                            <div style="font-size: 13px; opacity: 0.9; margin-top: 4px;">
                                ${time.substring(5)} | ${count}ä¸ªå¸ç§
                            </div>
                            <div style="font-size: 11px; opacity: 0.8; margin-top: 4px;">
                                ğŸ–±ï¸ ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…
                            </div>
                        </div>
                    </div>
                    <button onclick="event.stopPropagation(); this.parentElement.parentElement.remove();" 
                            style="background: none; border: none; color: white; font-size: 20px; 
                                   cursor: pointer; padding: 0 8px; opacity: 0.8; line-height: 1;"
                            onmouseover="this.style.opacity='1'" 
                            onmouseout="this.style.opacity='0.8'">Ã—</button>
                </div>
            `;
            
            // ç‚¹å‡»é€šçŸ¥æ‰“å¼€è¯¦æƒ…å¼¹çª—
            notification.onclick = function() {
                showSignalModal(type, time, count, coinData);
                document.body.removeChild(notification);
            };
            
            document.body.appendChild(notification);
            
            // ä¸è‡ªåŠ¨æ¶ˆå¤±ï¼Œä»…æ‰‹åŠ¨å…³é—­
            console.log('âœ… é€šçŸ¥æ¡å·²æ˜¾ç¤ºï¼ˆä»…æ‰‹åŠ¨å…³é—­ï¼‰');
        }
        
        // æµ‹è¯•æŠ„åº•ä¿¡å·
        function testBuySignal() {
            console.log('ğŸ§ª æ‰‹åŠ¨æµ‹è¯•æŠ„åº•ä¿¡å·');
            const testTime = new Date().toISOString().replace('T', ' ').substring(0, 19);
            const testCoins = [
                { symbol: 'BTCUSDT', price: 106000.50, position: 'æ¥è¿‘æ”¯æ’‘1' },
                { symbol: 'ETHUSDT', price: 3850.25, position: 'æ¥è¿‘æ”¯æ’‘2' },
                { symbol: 'BNBUSDT', price: 680.75, position: 'æ¥è¿‘æ”¯æ’‘1' }
            ];
            showSignalNotification('æŠ„åº•', testTime, 3, testCoins);
        }
        
        // æµ‹è¯•é€ƒé¡¶ä¿¡å·
        function testSellSignal() {
            console.log('ğŸ§ª æ‰‹åŠ¨æµ‹è¯•é€ƒé¡¶ä¿¡å·');
            const testTime = new Date().toISOString().replace('T', ' ').substring(0, 19);
            const testCoins = [
                { symbol: 'BTCUSDT', price: 108000.50, position: 'æ¥è¿‘å‹åŠ›1' },
                { symbol: 'ETHUSDT', price: 4050.25, position: 'æ¥è¿‘å‹åŠ›2' }
            ];
            showSignalNotification('é€ƒé¡¶', testTime, 2, testCoins);
        }
        
        // åŠ è½½è®¾ç½®
        loadSettings();
        
        // Initial load
        loadData();
        
        // Auto-refresh
        setInterval(loadData, 30000); // ä¸»æ•°æ®æ¯30ç§’åˆ·æ–°
        setInterval(function() {
            loadGlobalTrendData(); // å…¨å±€è¶‹åŠ¿å›¾æ¯3åˆ†é’Ÿåˆ·æ–°
            loadDailyTimeline(currentDate); // å½“æ—¥æ—¶é—´è½´æ¯3åˆ†é’Ÿåˆ·æ–°
            loadEscapeSignalData(); // é€ƒé¡¶ä¿¡å·æ•°æ®æ¯3åˆ†é’Ÿåˆ·æ–°
        }, 180000);
        
        // è‡ªåŠ¨æ£€æµ‹æœ€æ–°ä¿¡å·ï¼ˆæ¯30ç§’æ£€æµ‹ä¸€æ¬¡ï¼‰
        checkLatestSignal(); // åˆå§‹æ£€æµ‹
        setInterval(checkLatestSignal, 30000);
        
        // ==================== å¯¼å‡º/å¯¼å…¥åŠŸèƒ½ ====================
        
        // å¯¼å‡ºæ•°æ®
        function exportData() {
            const btn = event.target.closest('button');
            const originalHTML = btn.innerHTML;
            
            btn.disabled = true;
            btn.innerHTML = '<span>â³</span><span>å¯¼å‡ºä¸­...</span>';
            
            fetch('/api/support-resistance/export', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert(`âœ… å¯¼å‡ºæˆåŠŸï¼\n\næ–‡ä»¶å: ${data.filename}\næ–‡ä»¶å¤§å°: ${data.file_size_mb} MB\n\nç‚¹å‡»ç¡®å®šå¼€å§‹ä¸‹è½½...`);
                    
                    // ä¸‹è½½æ–‡ä»¶
                    window.location.href = data.download_url;
                } else {
                    alert(`âŒ å¯¼å‡ºå¤±è´¥: ${data.error}`);
                }
            })
            .catch(error => {
                alert(`âŒ å¯¼å‡ºå¤±è´¥: ${error}`);
            })
            .finally(() => {
                btn.disabled = false;
                btn.innerHTML = originalHTML;
            });
        }
        
        // æ˜¾ç¤ºå¯¼å…¥æ¨¡æ€æ¡†
        function showImportModal() {
            const modal = document.getElementById('importModal');
            if (!modal) {
                createImportModal();
            }
            document.getElementById('importModal').style.display = 'flex';
        }
        
        // åˆ›å»ºå¯¼å…¥æ¨¡æ€æ¡†
        function createImportModal() {
            const modalHTML = `
                <div id="importModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10000; align-items: center; justify-content: center;">
                    <div style="background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%); border-radius: 16px; padding: 30px; max-width: 500px; width: 90%; box-shadow: 0 10px 40px rgba(0,0,0,0.5);">
                        <h2 style="margin: 0 0 20px 0; font-size: 24px; display: flex; align-items: center; gap: 10px;">
                            <span>ğŸ“¤</span>
                            <span>å¯¼å…¥æ”¯æ’‘/é˜»åŠ›ä½æ•°æ®</span>
                        </h2>
                        
                        <div style="background: rgba(255,255,255,0.1); border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                            <p style="margin: 0 0 10px 0; font-size: 14px; color: rgba(255,255,255,0.9);">
                                âš ï¸ å¯¼å…¥å‰è¯·æ³¨æ„:
                            </p>
                            <ul style="margin: 0; padding-left: 20px; font-size: 13px; color: rgba(255,255,255,0.8); line-height: 1.8;">
                                <li>ç³»ç»Ÿä¼šè‡ªåŠ¨å¤‡ä»½å½“å‰æ•°æ®</li>
                                <li>å¯¼å…¥è¿‡ç¨‹çº¦éœ€2-5åˆ†é’Ÿ</li>
                                <li>åªæ”¯æŒJSONæ ¼å¼çš„å¯¼å‡ºæ–‡ä»¶</li>
                                <li>å‹¾é€‰"æ¸…ç©ºç°æœ‰æ•°æ®"å°†å®Œå…¨æ›¿æ¢</li>
                            </ul>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 10px; font-size: 14px; font-weight: 600;">
                                é€‰æ‹©å¯¼å‡ºæ–‡ä»¶:
                            </label>
                            <input type="file" id="importFile" accept=".json" style="width: 100%; padding: 10px; border-radius: 6px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.1); color: white; cursor: pointer;">
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; font-size: 14px;">
                                <input type="checkbox" id="clearExisting" style="width: 18px; height: 18px; cursor: pointer;">
                                <span>æ¸…ç©ºç°æœ‰æ•°æ®åå†å¯¼å…¥ï¼ˆå®Œå…¨æ›¿æ¢ï¼‰</span>
                            </label>
                        </div>
                        
                        <div style="display: flex; gap: 10px;">
                            <button onclick="closeImportModal()" style="flex: 1; padding: 12px; font-size: 16px; font-weight: 600; border: none; border-radius: 8px; cursor: pointer; background: rgba(255,255,255,0.2); color: white; transition: all 0.3s;">
                                å–æ¶ˆ
                            </button>
                            <button onclick="importData()" style="flex: 1; padding: 12px; font-size: 16px; font-weight: 600; border: none; border-radius: 8px; cursor: pointer; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; transition: all 0.3s;">
                                å¼€å§‹å¯¼å…¥
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', modalHTML);
        }
        
        // å…³é—­å¯¼å…¥æ¨¡æ€æ¡†
        function closeImportModal() {
            document.getElementById('importModal').style.display = 'none';
        }
        
        // å¯¼å…¥æ•°æ®
        function importData() {
            const fileInput = document.getElementById('importFile');
            const clearExisting = document.getElementById('clearExisting').checked;
            
            if (!fileInput.files || fileInput.files.length === 0) {
                alert('âŒ è¯·é€‰æ‹©è¦å¯¼å…¥çš„æ–‡ä»¶');
                return;
            }
            
            const file = fileInput.files[0];
            
            if (!file.name.endsWith('.json')) {
                alert('âŒ åªæ”¯æŒJSONæ ¼å¼æ–‡ä»¶');
                return;
            }
            
            if (clearExisting) {
                if (!confirm('âš ï¸ ç¡®å®šè¦æ¸…ç©ºç°æœ‰æ•°æ®å—ï¼Ÿ\n\næ­¤æ“ä½œå°†åˆ é™¤æ‰€æœ‰ç°æœ‰çš„æ”¯æ’‘/é˜»åŠ›ä½æ•°æ®ï¼Œç„¶åå¯¼å…¥æ–°æ•°æ®ã€‚\nç³»ç»Ÿä¼šè‡ªåŠ¨å¤‡ä»½ï¼Œä½†å»ºè®®è°¨æ…æ“ä½œã€‚')) {
                    return;
                }
            }
            
            const formData = new FormData();
            formData.append('file', file);
            formData.append('clear_existing', clearExisting ? 'true' : 'false');
            
            // ç¦ç”¨æŒ‰é’®
            event.target.disabled = true;
            event.target.textContent = 'å¯¼å…¥ä¸­...';
            
            fetch('/api/support-resistance/import', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert(`âœ… å¯¼å…¥æˆåŠŸï¼\n\nå¯¼å…¥çš„è¡¨æ•°é‡: ${data.stats.tables}\nå¯¼å…¥çš„è®°å½•æ•°: ${data.stats.records}\n\né¡µé¢å°†è‡ªåŠ¨åˆ·æ–°...`);
                    closeImportModal();
                    setTimeout(() => {
                        window.location.reload();
                    }, 1000);
                } else {
                    alert(`âŒ å¯¼å…¥å¤±è´¥: ${data.error}`);
                    event.target.disabled = false;
                    event.target.textContent = 'å¼€å§‹å¯¼å…¥';
                }
            })
            .catch(error => {
                alert(`âŒ å¯¼å…¥å¤±è´¥: ${error}`);
                event.target.disabled = false;
                event.target.textContent = 'å¼€å§‹å¯¼å…¥';
            });
        }
        
        // æ˜¾ç¤º Telegram è®¾ç½®æ¨¡æ€æ¡†
        function showTelegramSettingsModal() {
            // å…ˆåŠ è½½å½“å‰é…ç½®
            fetch('/api/telegram/config')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const config = data.config.signal_types;
                        document.getElementById('toggle_buy').checked = config.buy.enabled;
                        document.getElementById('toggle_sell').checked = config.sell.enabled;
                        document.getElementById('toggle_double_buy').checked = config.double_buy.enabled;
                        document.getElementById('toggle_double_sell').checked = config.double_sell.enabled;
                        
                        document.getElementById('telegramSettingsModal').style.display = 'flex';
                    } else {
                        alert(`âŒ åŠ è½½é…ç½®å¤±è´¥: ${data.error}`);
                    }
                })
                .catch(error => {
                    alert(`âŒ åŠ è½½é…ç½®å¤±è´¥: ${error}`);
                });
        }
        
        // å…³é—­ Telegram è®¾ç½®æ¨¡æ€æ¡†
        function closeTelegramSettingsModal() {
            document.getElementById('telegramSettingsModal').style.display = 'none';
        }
        
        // ä¿å­˜ Telegram è®¾ç½®
        function saveTelegramSettings() {
            const settings = {
                buy: document.getElementById('toggle_buy').checked,
                sell: document.getElementById('toggle_sell').checked,
                double_buy: document.getElementById('toggle_double_buy').checked,
                double_sell: document.getElementById('toggle_double_sell').checked
            };
            
            fetch('/api/telegram/config', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(settings)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('âœ… è®¾ç½®å·²ä¿å­˜ï¼\n\n' + 
                          `æŠ„åº•ä¿¡å·: ${settings.buy ? 'âœ… å¯ç”¨' : 'âŒ ç¦ç”¨'}\n` +
                          `é€ƒé¡¶ä¿¡å·: ${settings.sell ? 'âœ… å¯ç”¨' : 'âŒ ç¦ç”¨'}\n` +
                          `åŒé‡æŠ„åº•: ${settings.double_buy ? 'âœ… å¯ç”¨' : 'âŒ ç¦ç”¨'}\n` +
                          `åŒé‡é€ƒé¡¶: ${settings.double_sell ? 'âœ… å¯ç”¨' : 'âŒ ç¦ç”¨'}\n\n` +
                          'è®¾ç½®å°†ç«‹å³ç”Ÿæ•ˆï¼');
                    closeTelegramSettingsModal();
                } else {
                    alert(`âŒ ä¿å­˜å¤±è´¥: ${data.error}`);
                }
            })
            .catch(error => {
                alert(`âŒ ä¿å­˜å¤±è´¥: ${error}`);
            });
        }
    </script>
</body>
</html>
