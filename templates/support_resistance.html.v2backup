<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>æ”¯æ’‘å‹åŠ›çº¿ç³»ç»Ÿ - 27å¸ç§å®æ—¶ç›‘æ§ v2.2-DEBUG</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', sans-serif;
            background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            color: #fff;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            padding: 30px 0;
            border-bottom: 2px solid rgba(255,255,255,0.2);
            margin-bottom: 30px;
        }
        
        h1 {
            font-size: 36px;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        .subtitle {
            font-size: 18px;
            color: rgba(255,255,255,0.8);
        }
        
        .stats-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.2);
            text-align: center;
        }
        
        .stat-card h3 {
            font-size: 14px;
            color: rgba(255,255,255,0.7);
            margin-bottom: 10px;
        }
        
        .stat-card .value {
            font-size: 28px;
            font-weight: bold;
            color: #4ade80;
        }
        
        .table-container {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.2);
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1200px;
        }
        
        th, td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        th {
            background: rgba(255,255,255,0.15);
            font-weight: 600;
            color: #4ade80;
            position: sticky;
            top: 0;
            z-index: 10;
            cursor: pointer;
            user-select: none;
        }
        
        th:hover {
            background: rgba(255,255,255,0.25);
        }
        
        th.sortable::after {
            content: ' â‡…';
            opacity: 0.3;
            font-size: 12px;
        }
        
        th.sort-asc::after {
            content: ' â†‘';
            opacity: 1;
            color: #4ade80;
        }
        
        th.sort-desc::after {
            content: ' â†“';
            opacity: 1;
            color: #4ade80;
        }
        
        tr:hover {
            background: rgba(255,255,255,0.05);
        }
        
        .symbol-cell {
            font-weight: bold;
            color: #fbbf24;
            text-align: left !important;
        }
        
        .price-cell {
            color: #4ade80;
            font-weight: 600;
        }
        
        .support-cell {
            color: #10b981;
        }
        
        .resistance-cell {
            color: #ef4444;
        }
        
        .distance-positive {
            color: #10b981;
        }
        
        .distance-negative {
            color: #ef4444;
        }
        
        .distance-bar {
            width: 100%;
            height: 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            position: relative;
            overflow: hidden;
        }
        
        .distance-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981 0%, #34d399 100%);
            border-radius: 10px;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: bold;
        }
        
        .legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 20px 0;
            font-size: 14px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }
        
        .home-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 24px;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 12px;
            color: #fff;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 1000;
        }
        
        .home-btn:hover {
            background: rgba(74,222,128,0.2);
            border-color: #4ade80;
            transform: translateY(-2px);
        }
        
        .update-time {
            text-align: center;
            padding: 15px;
            color: rgba(255,255,255,0.6);
            font-size: 14px;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            font-size: 18px;
            color: rgba(255,255,255,0.7);
        }
        
        .update-time-header {
            text-align: center;
            padding: 10px 20px;
            background: rgba(255,255,255,0.05);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            color: rgba(255,255,255,0.7);
            font-size: 14px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }
        
        .update-time-header .time {
            color: #4ade80;
            font-weight: 600;
        }
        
        .update-time-header .refresh-indicator {
            display: inline-block;
            animation: pulse 2s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }
        
        .alert-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: bold;
        }
        
        .alert-near-support {
            background: #10b981;
            color: #fff;
        }
        
        .alert-near-resistance {
            background: #ef4444;
            color: #fff;
        }
        
        /* æ—¶é—´è½´å’Œè¶‹åŠ¿å›¾æ ·å¼ */
        .timeline-section {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.2);
            margin-bottom: 30px;
        }
        
        .timeline-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .date-selector {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .date-selector input[type="date"] {
            padding: 8px 12px;
            border-radius: 8px;
            border: 2px solid rgba(255,255,255,0.3);
            background: rgba(255,255,255,0.1);
            color: #fff;
            font-size: 14px;
            cursor: pointer;
        }
        
        .date-selector input[type="date"]::-webkit-calendar-picker-indicator {
            filter: invert(1);
        }
        
        .nav-buttons {
            display: flex;
            gap: 10px;
        }
        
        .nav-btn {
            padding: 8px 16px;
            border-radius: 8px;
            border: 2px solid rgba(255,255,255,0.3);
            background: rgba(255,255,255,0.1);
            color: #fff;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .nav-btn:hover {
            background: rgba(74,222,128,0.2);
            border-color: #4ade80;
        }
        
        .nav-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        .trend-chart-container {
            height: 400px;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            margin-top: 15px;
        }
        
        /* æ—¶é—´è½´æ ·å¼ */
        .timeline-item {
            display: inline-block;
            margin: 5px;
            padding: 8px 15px;
            background: rgba(74, 222, 128, 0.2);
            border: 2px solid #4ade80;
            border-radius: 6px;
            color: #4ade80;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 13px;
            font-weight: 600;
        }
        
        .timeline-item:hover {
            background: rgba(74, 222, 128, 0.4);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(74, 222, 128, 0.3);
        }
        
        .timeline-item.selected {
            background: #4ade80;
            color: #000;
        }
        
        .page-info {
            text-align: center;
            color: #4ade80;
            font-size: 14px;
            font-weight: 600;
        }
        
        /* å†å²æ•°æ®è¯¦æƒ…å¼¹çª— */
        .history-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }
        
        .history-modal.show {
            display: flex;
        }
        
        .modal-content {
            background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            border-radius: 16px;
            padding: 30px;
            max-width: 900px;
            max-height: 80vh;
            overflow-y: auto;
            border: 2px solid rgba(255,255,255,0.3);
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid rgba(255,255,255,0.2);
            padding-bottom: 15px;
        }
        
        .modal-title {
            font-size: 22px;
            font-weight: bold;
            color: #4ade80;
        }
        
        .modal-close {
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 8px;
            padding: 8px 16px;
            color: #fff;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .modal-close:hover {
            background: rgba(239,68,68,0.3);
            border-color: #ef4444;
        }
        
        .scenario-section {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .scenario-header {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .coin-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .coin-badge {
            background: rgba(255,255,255,0.15);
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.2);
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .coin-badge:hover {
            background: rgba(255,255,255,0.25);
            transform: translateY(-2px);
        }
        
        .coin-symbol {
            font-weight: bold;
            color: #fbbf24;
        }
        
        .coin-price {
            color: #4ade80;
            font-size: 12px;
        }
        
        .coin-position {
            color: rgba(255,255,255,0.7);
            font-size: 11px;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="/" class="home-btn">
            <span>ğŸ </span>
            <span>è¿”å›é¦–é¡µ</span>
        </a>
        
        <div class="update-time-header">
            <span>ğŸ“¡ æœ€åæ›´æ–°:</span>
            <span class="time" id="lastUpdateTime">--</span>
            <span class="refresh-indicator">â—</span>
            <span style="color: rgba(255,255,255,0.5);">| æ¯30ç§’è‡ªåŠ¨åˆ·æ–°</span>
        </div>
        
        <div class="header">
            <h1>ğŸ“Š æ”¯æ’‘å‹åŠ›çº¿ç³»ç»Ÿ <span style="font-size: 14px; color: #ff6b6b;">[v2.2-è°ƒè¯•ç‰ˆæœ¬ ğŸ”§]</span></h1>
            <div class="subtitle">BTC/ETH/XRP/BNB/SOLç­‰27ä¸ªä¸»æµå¸ç§æ°¸ç»­åˆçº¦çš„æ”¯æ’‘çº¿å’Œå‹åŠ›çº¿å®æ—¶ç›‘æ§ | æŒ‰é’®: â† æ›´æ—© / æ›´æ™š â†’</div>
        </div>
        
        <!-- å…¨å±€è¶‹åŠ¿å›¾ -->
        <div class="timeline-section">
            <div class="timeline-header">
                <div>
                    <h2 style="font-size: 20px; margin-bottom: 5px;">ğŸ“ˆ å…¨å±€è¶‹åŠ¿å›¾ï¼ˆæ‰€æœ‰å†å²æ•°æ®ï¼‰</h2>
                    <p style="color: rgba(255,255,255,0.6); font-size: 13px;">æ˜¾ç¤ºä»å¼€å§‹åˆ°ç°åœ¨çš„æ‰€æœ‰é‡‡æ ·æ•°æ®</p>
                </div>
            </div>
            <div id="globalTrendChart" class="trend-chart-container"></div>
            <p style="color: rgba(255,255,255,0.6); font-size: 13px; margin-top: 10px; text-align: center;">
                ğŸ’¡ æç¤º: æ­¤å›¾è¡¨æ˜¾ç¤ºæ‰€æœ‰å†å²è¶‹åŠ¿ï¼Œä¸å—æ—¥æœŸé€‰æ‹©å½±å“
            </p>
        </div>
        
        <!-- æ¯æ—¥æ—¶é—´è½´ -->
        <div class="timeline-section" style="margin-top: 30px;">
            <div class="timeline-header">
                <div>
                    <h2 style="font-size: 20px; margin-bottom: 5px;">ğŸ• æ¯æ—¥æ—¶é—´è½´</h2>
                    <p style="color: rgba(255,255,255,0.6); font-size: 13px;">é€‰æ‹©æ—¥æœŸæŸ¥çœ‹è¯¥å¤©çš„æ‰€æœ‰å¿«ç…§æ—¶é—´ç‚¹</p>
                </div>
                <div class="date-selector">
                    <label style="color: rgba(255,255,255,0.8);">é€‰æ‹©æ—¥æœŸ:</label>
                    <input type="date" id="datePicker" />
                </div>
            </div>
            <div id="dailyTimeline" style="background: rgba(0,0,0,0.3); border-radius: 8px; padding: 20px; min-height: 100px; margin-top: 15px;">
                <p style="color: rgba(255,255,255,0.6); text-align: center;">è¯·é€‰æ‹©æ—¥æœŸæŸ¥çœ‹å½“å¤©çš„å¿«ç…§æ—¶é—´ç‚¹</p>
            </div>
            <p style="color: rgba(255,255,255,0.6); font-size: 13px; margin-top: 10px; text-align: center;">
                ğŸ’¡ æç¤º: ç‚¹å‡»æ—¶é—´ç‚¹æŸ¥çœ‹è¯¥æ—¶åˆ»çš„è¯¦ç»†å¸ç§åˆ—è¡¨
            </p>
        </div>
        
        <!-- å†å²æ•°æ®è¯¦æƒ…å¼¹çª— -->
        <div class="history-modal" id="historyModal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title" id="modalTitle">ğŸ• åŠ è½½ä¸­...</div>
                    <button class="modal-close" onclick="closeHistoryModal()">âœ• å…³é—­</button>
                </div>
                <div id="modalBody">
                    <p style="text-align: center; color: rgba(255,255,255,0.6);">æ­£åœ¨åŠ è½½æ•°æ®...</p>
                </div>
            </div>
        </div>
        
        <div class="stats-summary" id="statsSummary">
            <div class="stat-card">
                <h3>ç›‘æ§å¸ç§æ•°</h3>
                <div class="value" id="totalCoins">0</div>
            </div>
            <div class="stat-card">
                <h3>æ¥è¿‘æ”¯æ’‘çº¿1 (è·ç¦»<5%)</h3>
                <div class="value" id="nearSupport1" style="color: #10b981;">0</div>
            </div>
            <div class="stat-card">
                <h3>æ¥è¿‘æ”¯æ’‘çº¿2 (è·ç¦»<5%)</h3>
                <div class="value" id="nearSupport2" style="color: #10b981;">0</div>
            </div>
            <div class="stat-card">
                <h3>æ¥è¿‘å‹åŠ›çº¿1 (è·ç¦»<5%)</h3>
                <div class="value" id="nearResistance1" style="color: #ef4444;">0</div>
            </div>
            <div class="stat-card">
                <h3>æ¥è¿‘å‹åŠ›çº¿2 (è·ç¦»<5%)</h3>
                <div class="value" id="nearResistance2" style="color: #ef4444;">0</div>
            </div>
        </div>
        
        <!-- 4ç§é¢„è­¦æƒ…å†µå±•ç¤ºæ¡† -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 20px 0; max-width: 1400px;">
            <!-- æƒ…å†µ1: æ”¯æ’‘2â†’å‹åŠ›1 (â‰¤5%) -->
            <div style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.15), rgba(16, 185, 129, 0.05)); border: 2px solid rgba(16, 185, 129, 0.4); border-radius: 12px; padding: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.3);">
                <div style="color: #10b981; font-size: 1.1rem; font-weight: bold; margin-bottom: 8px;">
                    ğŸ“‰ æƒ…å†µ1: æ¥è¿‘æ”¯æ’‘çº¿2
                </div>
                <div style="color: rgba(255,255,255,0.6); font-size: 0.85rem; margin-bottom: 12px; line-height: 1.5;">
                    æ”¯æ’‘çº¿2(0%) â†’ å‹åŠ›çº¿1(100%)ï¼Œä½ç½® â‰¤ 5%<br/>
                    <span style="color: rgba(16, 185, 129, 0.8);">æ¥è¿‘48å°æ—¶æœ€ä½ç‚¹ï¼Œå¯èƒ½åå¼¹</span>
                </div>
                <div id="scenario-1-coins" style="color: #fff; font-size: 0.95rem; min-height: 30px; display: flex; flex-wrap: wrap; gap: 6px;">
                    <span style="color: rgba(255,255,255,0.3);">åŠ è½½ä¸­...</span>
                </div>
            </div>
            
            <!-- æƒ…å†µ2: æ”¯æ’‘1â†’å‹åŠ›2 (â‰¤5%) -->
            <div style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.15), rgba(16, 185, 129, 0.05)); border: 2px solid rgba(16, 185, 129, 0.4); border-radius: 12px; padding: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.3);">
                <div style="color: #10b981; font-size: 1.1rem; font-weight: bold; margin-bottom: 8px;">
                    ğŸ“‰ æƒ…å†µ2: æ¥è¿‘æ”¯æ’‘çº¿1
                </div>
                <div style="color: rgba(255,255,255,0.6); font-size: 0.85rem; margin-bottom: 12px; line-height: 1.5;">
                    æ”¯æ’‘çº¿1(0%) â†’ å‹åŠ›çº¿2(100%)ï¼Œä½ç½® â‰¤ 5%<br/>
                    <span style="color: rgba(16, 185, 129, 0.8);">æ¥è¿‘7å¤©æœ€ä½ç‚¹ï¼Œå¼ºæ”¯æ’‘åŒºåŸŸ</span>
                </div>
                <div id="scenario-2-coins" style="color: #fff; font-size: 0.95rem; min-height: 30px; display: flex; flex-wrap: wrap; gap: 6px;">
                    <span style="color: rgba(255,255,255,0.3);">åŠ è½½ä¸­...</span>
                </div>
            </div>
            
            <!-- æƒ…å†µ3: æ”¯æ’‘1â†’å‹åŠ›2 (â‰¥95%) -->
            <div style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.15), rgba(239, 68, 68, 0.05)); border: 2px solid rgba(239, 68, 68, 0.4); border-radius: 12px; padding: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.3);">
                <div style="color: #ef4444; font-size: 1.1rem; font-weight: bold; margin-bottom: 8px;">
                    ğŸ“ˆ æƒ…å†µ3: æ¥è¿‘å‹åŠ›çº¿2
                </div>
                <div style="color: rgba(255,255,255,0.6); font-size: 0.85rem; margin-bottom: 12px; line-height: 1.5;">
                    æ”¯æ’‘çº¿1(0%) â†’ å‹åŠ›çº¿2(100%)ï¼Œä½ç½® â‰¥ 95%<br/>
                    <span style="color: rgba(239, 68, 68, 0.8);">æ¥è¿‘48å°æ—¶æœ€é«˜ç‚¹ï¼Œå¯èƒ½é‡é˜»</span>
                </div>
                <div id="scenario-3-coins" style="color: #fff; font-size: 0.95rem; min-height: 30px; display: flex; flex-wrap: wrap; gap: 6px;">
                    <span style="color: rgba(255,255,255,0.3);">åŠ è½½ä¸­...</span>
                </div>
            </div>
            
            <!-- æƒ…å†µ4: æ”¯æ’‘1â†’å‹åŠ›1 (â‰¥95%) -->
            <div style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.15), rgba(239, 68, 68, 0.05)); border: 2px solid rgba(239, 68, 68, 0.4); border-radius: 12px; padding: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.3);">
                <div style="color: #ef4444; font-size: 1.1rem; font-weight: bold; margin-bottom: 8px;">
                    ğŸ“ˆ æƒ…å†µ4: æ¥è¿‘å‹åŠ›çº¿1
                </div>
                <div style="color: rgba(255,255,255,0.6); font-size: 0.85rem; margin-bottom: 12px; line-height: 1.5;">
                    æ”¯æ’‘çº¿1(0%) â†’ å‹åŠ›çº¿1(100%)ï¼Œä½ç½® â‰¥ 95%<br/>
                    <span style="color: rgba(239, 68, 68, 0.8);">æ¥è¿‘7å¤©æœ€é«˜ç‚¹ï¼Œå¼ºå‹åŠ›åŒºåŸŸ</span>
                </div>
                <div id="scenario-4-coins" style="color: #fff; font-size: 0.95rem; min-height: 30px; display: flex; flex-wrap: wrap; gap: 6px;">
                    <span style="color: rgba(255,255,255,0.3);">åŠ è½½ä¸­...</span>
                </div>
            </div>
        </div>
        
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background: #10b981;"></div>
                <span>æ”¯æ’‘çº¿ (7å¤©/48å°æ—¶æœ€ä½ç‚¹)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #ef4444;"></div>
                <span>å‹åŠ›çº¿ (7å¤©/48å°æ—¶æœ€é«˜ç‚¹)</span>
            </div>
        </div>
        
        <div class="table-container">
            <div id="loading" class="loading">æ­£åœ¨åŠ è½½æ•°æ®...</div>
            <table id="dataTable" style="display: none;">
                <thead>
                    <tr>
                        <th>å¸ç§</th>
                        <th>å½“å‰ä»·æ ¼</th>
                        <th class="sortable" data-sort="support_line_1">æ”¯æ’‘çº¿1 (7å¤©)</th>
                        <th class="sortable" data-sort="distance_to_support_1">è·ç¦»æ”¯æ’‘1</th>
                        <th class="sortable" data-sort="support_line_2">æ”¯æ’‘çº¿2 (48h)</th>
                        <th class="sortable" data-sort="distance_to_support_2">è·ç¦»æ”¯æ’‘2</th>
                        <th class="sortable" data-sort="resistance_line_1">å‹åŠ›çº¿1 (7å¤©)</th>
                        <th class="sortable" data-sort="distance_to_resistance_1">è·ç¦»å‹åŠ›1</th>
                        <th class="sortable" data-sort="resistance_line_2">å‹åŠ›çº¿2 (48h)</th>
                        <th class="sortable" data-sort="distance_to_resistance_2">è·ç¦»å‹åŠ›2</th>
                        <th class="sortable" data-sort="position_s2_r1" title="æ”¯æ’‘2ä¸º0%ï¼Œå‹åŠ›1ä¸º100%">ä½ç½®1<br/>(S2â†’R1)</th>
                        <th class="sortable" data-sort="position_s1_r2" title="æ”¯æ’‘1ä¸º0%ï¼Œå‹åŠ›2ä¸º100%">ä½ç½®2<br/>(S1â†’R2)</th>
                        <th class="sortable" data-sort="position_s1_r1" title="æ”¯æ’‘1ä¸º0%ï¼Œå‹åŠ›1ä¸º100%">ä½ç½®4<br/>(S1â†’R1)</th>
                        <th>é¢„è­¦</th>
                    </tr>
                </thead>
                <tbody id="tableBody"></tbody>
            </table>
            <div class="update-time" id="updateTime"></div>
        </div>
    </div>
    
    <script>
        let currentData = [];
        let currentSortField = null;
        let currentSortOrder = 'desc';
        let trendChart = null;
        // ä½¿ç”¨åŒ—äº¬æ—¶é—´è·å–ä»Šå¤©çš„æ—¥æœŸ
        function getBeijingDate() {
            const now = new Date();
            // è½¬æ¢ä¸ºåŒ—äº¬æ—¶é—´ (UTC+8)
            const beijingTime = new Date(now.getTime() + (now.getTimezoneOffset() * 60000) + (8 * 3600000));
            return beijingTime.toISOString().split('T')[0];
        }
        let currentDate = getBeijingDate();
        let globalTrendChart; // å…¨å±€è¶‹åŠ¿å›¾
        let allSnapshotData = []; // å­˜å‚¨æ‰€æœ‰å†å²æ•°æ®
        let dailySnapshotData = []; // å­˜å‚¨é€‰ä¸­æ—¥æœŸçš„æ•°æ®
        
        function formatPrice(price) {
            if (price === null || price === undefined) return '--';
            
            if (price < 0.01) {
                return '$' + price.toFixed(6);
            } else if (price < 1) {
                return '$' + price.toFixed(4);
            } else if (price < 100) {
                return '$' + price.toFixed(2);
            } else {
                return '$' + price.toFixed(2);
            }
        }
        
        function formatDistance(distance) {
            if (distance === null || distance === undefined) return '--';
            const sign = distance >= 0 ? '+' : '';
            return sign + distance.toFixed(2) + '%';
        }
        
        function getAlertBadges(coin) {
            const badges = [];
            
            // æƒ…å†µ1: æ”¯æ’‘2â†’å‹åŠ›1 (<=5%)
            if (coin.alert_scenario_1 && coin.position_s2_r1 !== null && coin.position_s2_r1 !== undefined) {
                badges.push('<span class="alert-badge alert-near-support" title="æ”¯æ’‘2â†’å‹åŠ›1ä½ç½®">S2â†’R1:' + coin.position_s2_r1.toFixed(1) + '%</span>');
            }
            
            // æƒ…å†µ2: æ”¯æ’‘1â†’å‹åŠ›2 (<=5%)
            if (coin.alert_scenario_2 && coin.position_s1_r2 !== null && coin.position_s1_r2 !== undefined) {
                badges.push('<span class="alert-badge alert-near-support" title="æ”¯æ’‘1â†’å‹åŠ›2ä½ç½®">S1â†’R2:' + coin.position_s1_r2.toFixed(1) + '%</span>');
            }
            
            // æƒ…å†µ3: æ”¯æ’‘1â†’å‹åŠ›2 (>=95%)
            if (coin.alert_scenario_3 && coin.position_s1_r2_upper !== null && coin.position_s1_r2_upper !== undefined) {
                badges.push('<span class="alert-badge alert-near-resistance" title="æ”¯æ’‘1â†’å‹åŠ›2ä½ç½®">S1â†’R2:' + coin.position_s1_r2_upper.toFixed(1) + '%</span>');
            }
            
            // æƒ…å†µ4: æ”¯æ’‘1â†’å‹åŠ›1 (>=95%)
            if (coin.alert_scenario_4 && coin.position_s1_r1 !== null && coin.position_s1_r1 !== undefined) {
                badges.push('<span class="alert-badge alert-near-resistance" title="æ”¯æ’‘1â†’å‹åŠ›1ä½ç½®">S1â†’R1:' + coin.position_s1_r1.toFixed(1) + '%</span>');
            }
            
            return badges.length > 0 ? badges.join(' ') : '<span style="color: rgba(255,255,255,0.3);">-</span>';
        }
        
        function renderTable() {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';
            
            currentData.forEach(coin => {
                const row = document.createElement('tr');
                
                // æ ¼å¼åŒ–ä½ç½®ç™¾åˆ†æ¯”
                const formatPosition = (pos, alert) => {
                    if (pos === null || pos === undefined) {
                        return '<span style="color: rgba(255,255,255,0.3);">-</span>';
                    }
                    const val = pos.toFixed(1) + '%';
                    if (alert) {
                        return `<span class="alert-value" style="color: #ff6b6b; font-weight: bold;">${val}</span>`;
                    }
                    return val;
                };
                
                row.innerHTML = `
                    <td class="symbol-cell">${coin.symbol}</td>
                    <td class="price-cell">${formatPrice(coin.current_price)}</td>
                    <td class="support-cell">${formatPrice(coin.support_line_1)}</td>
                    <td class="${coin.distance_to_support_1 < 0 ? 'distance-negative' : 'distance-positive'}">${formatDistance(coin.distance_to_support_1)}</td>
                    <td class="support-cell">${formatPrice(coin.support_line_2)}</td>
                    <td class="${coin.distance_to_support_2 < 0 ? 'distance-negative' : 'distance-positive'}">${formatDistance(coin.distance_to_support_2)}</td>
                    <td class="resistance-cell">${formatPrice(coin.resistance_line_1)}</td>
                    <td class="${coin.distance_to_resistance_1 < 0 ? 'distance-negative' : 'distance-positive'}">${formatDistance(coin.distance_to_resistance_1)}</td>
                    <td class="resistance-cell">${formatPrice(coin.resistance_line_2)}</td>
                    <td class="${coin.distance_to_resistance_2 < 0 ? 'distance-negative' : 'distance-positive'}">${formatDistance(coin.distance_to_resistance_2)}</td>
                    <td class="position-cell">${formatPosition(coin.position_s2_r1, coin.alert_scenario_1)}</td>
                    <td class="position-cell">${formatPosition(coin.position_s1_r2, coin.alert_scenario_2 || coin.alert_scenario_3)}</td>
                    <td class="position-cell">${formatPosition(coin.position_s1_r1, coin.alert_scenario_4)}</td>
                    <td>${getAlertBadges(coin)}</td>
                `;
                tbody.appendChild(row);
            });
            
            document.getElementById('loading').style.display = 'none';
            document.getElementById('dataTable').style.display = 'table';
        }
        
        function updateStats() {
            // ä½¿ç”¨æ–°çš„è­¦æŠ¥é€»è¾‘ç»Ÿè®¡
            const scenario1Coins = currentData.filter(c => c.alert_scenario_1);  // æ¥è¿‘æ”¯æ’‘2
            const scenario2Coins = currentData.filter(c => c.alert_scenario_2);  // æ¥è¿‘æ”¯æ’‘1
            const scenario3Coins = currentData.filter(c => c.alert_scenario_3);  // æ¥è¿‘å‹åŠ›2
            const scenario4Coins = currentData.filter(c => c.alert_scenario_4);  // æ¥è¿‘å‹åŠ›1
            
            // æ›´æ–°ç»Ÿè®¡æ•°å­—
            document.getElementById('totalCoins').textContent = currentData.length;
            document.getElementById('nearSupport1').textContent = scenario2Coins.length;
            document.getElementById('nearSupport2').textContent = scenario1Coins.length;
            document.getElementById('nearResistance1').textContent = scenario4Coins.length;
            document.getElementById('nearResistance2').textContent = scenario3Coins.length;
            
            // æ›´æ–°4ä¸ªé¢„è­¦æ¡†çš„å¸ç§åˆ—è¡¨
            const formatCoinBadge = (coin, positionField) => {
                const symbol = coin.symbol.replace('USDT', '');
                const position = coin[positionField] || 0;
                return `<span style="display: inline-block; background: rgba(255,255,255,0.15); padding: 6px 12px; border-radius: 6px; margin: 2px; font-weight: 500; border: 1px solid rgba(255,255,255,0.2);">${symbol} <span style="opacity: 0.7; font-size: 0.85em;">${position.toFixed(1)}%</span></span>`;
            };
            
            const formatCoins = (coins, positionField) => {
                if (coins.length === 0) {
                    return '<span style="color: rgba(255,255,255,0.3); font-style: italic;">æš‚æ— é¢„è­¦</span>';
                }
                return coins.map(c => formatCoinBadge(c, positionField)).join(' ');
            };
            
            document.getElementById('scenario-1-coins').innerHTML = formatCoins(scenario1Coins, 'position_s2_r1');
            document.getElementById('scenario-2-coins').innerHTML = formatCoins(scenario2Coins, 'position_s1_r2');
            document.getElementById('scenario-3-coins').innerHTML = formatCoins(scenario3Coins, 'position_s1_r2');
            document.getElementById('scenario-4-coins').innerHTML = formatCoins(scenario4Coins, 'position_s1_r1');
        }
        
        function sortData(field, order) {
            if (!currentData || currentData.length === 0) return;
            
            currentData.sort((a, b) => {
                const aVal = a[field] || 0;
                const bVal = b[field] || 0;
                return order === 'asc' ? aVal - bVal : bVal - aVal;
            });
            
            currentSortField = field;
            currentSortOrder = order;
            
            // Update sort indicators
            document.querySelectorAll('th.sortable').forEach(th => {
                th.classList.remove('sort-asc', 'sort-desc');
                if (th.dataset.sort === field) {
                    th.classList.add(order === 'asc' ? 'sort-asc' : 'sort-desc');
                }
            });
            
            renderTable();
        }
        
        function loadData() {
            fetch('/api/support-resistance/latest')
                .then(response => response.json())
                .then(result => {
                    if (result.success) {
                        currentData = result.data;
                        
                        // Apply current sort if any
                        if (currentSortField) {
                            sortData(currentSortField, currentSortOrder);
                        } else {
                            renderTable();
                        }
                        
                        updateStats();
                        
                        // Update time displays
                        document.getElementById('updateTime').textContent = 'æœ€åæ›´æ–°: ' + (result.update_time || '--');
                        document.getElementById('lastUpdateTime').textContent = result.update_time || '--';
                    } else {
                        document.getElementById('loading').textContent = 'æ•°æ®åŠ è½½å¤±è´¥: ' + result.message;
                    }
                })
                .catch(error => {
                    document.getElementById('loading').textContent = 'æ•°æ®åŠ è½½é”™è¯¯: ' + error;
                });
        }
        
        // Add click handlers to sortable headers
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('th.sortable').forEach(th => {
                th.addEventListener('click', function() {
                    const field = this.dataset.sort;
                    
                    // Toggle sort order if clicking the same field
                    if (currentSortField === field) {
                        currentSortOrder = currentSortOrder === 'desc' ? 'asc' : 'desc';
                    } else {
                        currentSortOrder = 'desc'; // Default to descending for new field
                    }
                    
                    sortData(field, currentSortOrder);
                });
            });
        });
        
        // å†å²æ•°æ®è¯¦æƒ…å¼¹çª—ç›¸å…³å‡½æ•°
        let currentSnapshotData = [];
        
        function closeHistoryModal() {
            document.getElementById('historyModal').classList.remove('show');
        }
        
        function showHistoryDetail(dataIndex) {
            if (!currentSnapshotData || dataIndex >= currentSnapshotData.length) {
                console.error('Invalid data index:', dataIndex);
                return;
            }
            
            const snapshot = currentSnapshotData[dataIndex];
            
            // æ›´æ–°æ ‡é¢˜
            document.getElementById('modalTitle').textContent = 
                `ğŸ• ${snapshot.snapshot_time} (åŒ—äº¬æ—¶é—´)`;
            
            // æ¸²æŸ“è¯¦æƒ…
            let html = '';
            
            // æƒ…å†µ1: æ”¯æ’‘2
            html += renderScenario(
                'æƒ…å†µ1: æ¥è¿‘æ”¯æ’‘çº¿2 (48å°æ—¶æœ€ä½ç‚¹)',
                snapshot.scenario_1_count,
                snapshot.scenario_1_coins,
                '#4ade80'
            );
            
            // æƒ…å†µ2: æ”¯æ’‘1
            html += renderScenario(
                'æƒ…å†µ2: æ¥è¿‘æ”¯æ’‘çº¿1 (7å¤©æœ€ä½ç‚¹)',
                snapshot.scenario_2_count,
                snapshot.scenario_2_coins,
                '#10b981'
            );
            
            // æƒ…å†µ3: å‹åŠ›2
            html += renderScenario(
                'æƒ…å†µ3: æ¥è¿‘å‹åŠ›çº¿2 (48å°æ—¶æœ€é«˜ç‚¹)',
                snapshot.scenario_3_count,
                snapshot.scenario_3_coins,
                '#f87171'
            );
            
            // æƒ…å†µ4: å‹åŠ›1
            html += renderScenario(
                'æƒ…å†µ4: æ¥è¿‘å‹åŠ›çº¿1 (7å¤©æœ€é«˜ç‚¹)',
                snapshot.scenario_4_count,
                snapshot.scenario_4_coins,
                '#ef4444'
            );
            
            document.getElementById('modalBody').innerHTML = html;
            document.getElementById('historyModal').classList.add('show');
        }
        
        function renderScenario(title, count, coinsJson, color) {
            let coins = [];
            try {
                coins = typeof coinsJson === 'string' ? JSON.parse(coinsJson) : coinsJson;
            } catch (e) {
                coins = [];
            }
            
            let html = `
                <div class="scenario-section">
                    <div class="scenario-header" style="color: ${color};">
                        <span style="font-size: 20px;">${count > 0 ? 'â—' : 'â—‹'}</span>
                        <span>${title}</span>
                        <span style="margin-left: auto; background: rgba(255,255,255,0.1); padding: 4px 12px; border-radius: 6px; font-size: 14px;">
                            ${count} ä¸ªå¸ç§
                        </span>
                    </div>
            `;
            
            if (count === 0 || coins.length === 0) {
                html += '<p style="color: rgba(255,255,255,0.4); font-style: italic; padding: 10px;">æš‚æ— ç¬¦åˆæ¡ä»¶çš„å¸ç§</p>';
            } else {
                html += '<div class="coin-list">';
                coins.forEach(coin => {
                    const symbol = coin.symbol || 'UNKNOWN';
                    const price = coin.current_price || 0;
                    const position = coin.position || 0;
                    
                    html += `
                        <div class="coin-badge">
                            <div class="coin-symbol">${symbol.replace('USDT', '')}</div>
                            <div class="coin-price">$${formatCoinPrice(price)}</div>
                            <div class="coin-position">ä½ç½®: ${position.toFixed(1)}%</div>
                        </div>
                    `;
                });
                html += '</div>';
            }
            
            html += '</div>';
            return html;
        }
        
        function formatCoinPrice(price) {
            if (price < 0.01) return price.toFixed(6);
            if (price < 1) return price.toFixed(4);
            if (price < 100) return price.toFixed(2);
            return price.toFixed(2);
        }
        
        // è¶‹åŠ¿å›¾ç›¸å…³å‡½æ•°
        // åˆå§‹åŒ–å…¨å±€è¶‹åŠ¿å›¾ï¼ˆæ˜¾ç¤ºæ‰€æœ‰å†å²æ•°æ®ï¼‰
        function initGlobalTrendChart() {
            if (typeof echarts === 'undefined') {
                console.error('âŒ EChartsåº“æœªåŠ è½½ï¼CDNå¯èƒ½å¤±è´¥ã€‚');
                alert('å›¾è¡¨åº“åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢æˆ–è”ç³»ç®¡ç†å‘˜');
                return;
            }
            console.log('âœ… EChartsç‰ˆæœ¬:', echarts.version);
            
            const chartDom = document.getElementById('globalTrendChart');
            if (!chartDom) {
                console.error('âŒ æ‰¾ä¸åˆ°å›¾è¡¨å®¹å™¨å…ƒç´  #globalTrendChart');
                return;
            }
            console.log('âœ… å›¾è¡¨å®¹å™¨å…ƒç´ å­˜åœ¨ï¼Œå°ºå¯¸:', chartDom.offsetWidth, 'x', chartDom.offsetHeight);
            
            globalTrendChart = echarts.init(chartDom);
            console.log('âœ… EChartså®ä¾‹åˆ›å»ºæˆåŠŸ');
            
            const option = {
                backgroundColor: 'transparent',
                tooltip: {
                    trigger: 'axis',
                    backgroundColor: 'rgba(0,0,0,0.8)',
                    borderColor: 'rgba(255,255,255,0.2)',
                    textStyle: { color: '#fff' },
                    formatter: function(params) {
                        // æ˜¾ç¤ºå®Œæ•´çš„æ—¥æœŸ|æ—¶é—´æ ¼å¼
                        let result = '<div style="font-weight: bold; margin-bottom: 5px;">' + params[0].axisValue + ' (åŒ—äº¬æ—¶é—´)</div>';
                        params.forEach(item => {
                            result += item.marker + item.seriesName + ': <b>' + item.value + '</b> ä¸ªå¸ç§<br/>';
                        });
                        return result;
                    }
                },
                legend: {
                    data: ['æƒ…å†µ1(æ”¯æ’‘2)', 'æƒ…å†µ2(æ”¯æ’‘1)', 'æƒ…å†µ3(å‹åŠ›2)', 'æƒ…å†µ4(å‹åŠ›1)'],
                    textStyle: { color: '#fff' },
                    top: 10
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    boundaryGap: false,
                    data: [],
                    axisLine: { lineStyle: { color: 'rgba(255,255,255,0.3)' } },
                    axisLabel: { color: '#fff', rotate: 45 }
                },
                yAxis: {
                    type: 'value',
                    name: 'å¸ç§æ•°é‡',
                    nameTextStyle: { color: '#fff' },
                    axisLine: { lineStyle: { color: 'rgba(255,255,255,0.3)' } },
                    axisLabel: { color: '#fff' },
                    splitLine: { lineStyle: { color: 'rgba(255,255,255,0.1)' } }
                },
                series: [
                    {
                        name: 'æƒ…å†µ1(æ”¯æ’‘2)',
                        type: 'line',
                        data: [],
                        smooth: true,
                        lineStyle: { color: '#4ade80', width: 2 },
                        itemStyle: { color: '#4ade80' },
                        areaStyle: { color: 'rgba(74, 222, 128, 0.1)' }
                    },
                    {
                        name: 'æƒ…å†µ2(æ”¯æ’‘1)',
                        type: 'line',
                        data: [],
                        smooth: true,
                        lineStyle: { color: '#10b981', width: 2 },
                        itemStyle: { color: '#10b981' },
                        areaStyle: { color: 'rgba(16, 185, 129, 0.1)' }
                    },
                    {
                        name: 'æƒ…å†µ3(å‹åŠ›2)',
                        type: 'line',
                        data: [],
                        smooth: true,
                        lineStyle: { color: '#f87171', width: 2 },
                        itemStyle: { color: '#f87171' },
                        areaStyle: { color: 'rgba(248, 113, 113, 0.1)' }
                    },
                    {
                        name: 'æƒ…å†µ4(å‹åŠ›1)',
                        type: 'line',
                        data: [],
                        smooth: true,
                        lineStyle: { color: '#ef4444', width: 2 },
                        itemStyle: { color: '#ef4444' },
                        areaStyle: { color: 'rgba(239, 68, 68, 0.1)' }
                    }
                ]
            };
            
            globalTrendChart.setOption(option);
            console.log('âœ… å…¨å±€è¶‹åŠ¿å›¾åˆå§‹åŒ–å®Œæˆ');
        }
        
        function loadTrendData() {
            // è®¡ç®—æ—¶é—´èŒƒå›´ï¼ˆ12å°æ—¶ï¼‰
            const startHour = currentPage * 12;
            const endHour = startHour + 12;
            
            console.log('ğŸ“¡ loadTrendData() å‡½æ•°æ‰§è¡Œ:', {
                æ—¥æœŸ: currentDate,
                å¼€å§‹å°æ—¶: startHour,
                ç»“æŸå°æ—¶: endHour,
                APIåœ°å€: `/api/support-resistance/snapshots?date=${currentDate}&start_hour=${startHour}&end_hour=${endHour}`
            });
            
            fetch(`/api/support-resistance/snapshots?date=${currentDate}&start_hour=${startHour}&end_hour=${endHour}`)
                .then(response => {
                    console.log('ğŸ“¥ APIå“åº”çŠ¶æ€:', response.status, response.statusText);
                    return response.json();
                })
                .then(result => {
                    console.log('ğŸ“Š APIè¿”å›æ•°æ®:', {
                        success: result.success,
                        count: result.count,
                        æ•°æ®æ¡æ•°: result.data ? result.data.length : 0
                    });
                    
                    if (result.success) {
                        const data = result.data;
                        
                        // ä¿å­˜å½“å‰å¿«ç…§æ•°æ®ä¾›å¼¹çª—ä½¿ç”¨
                        currentSnapshotData = data;
                        
                        // æå–æ—¶é—´å’Œæ•°æ® - æ ¼å¼: MM-DD|HH:MM (åŒ—äº¬æ—¶é—´)
                        const times = data.map(d => {
                            const parts = d.snapshot_time.split(' ');
                            const date = parts[0].substring(5); // MM-DD
                            const time = parts[1].substring(0, 5); // HH:MM
                            return `${date}|${time}`;
                        });
                        const scenario1 = data.map(d => d.scenario_1_count || 0);
                        const scenario2 = data.map(d => d.scenario_2_count || 0);
                        const scenario3 = data.map(d => d.scenario_3_count || 0);
                        const scenario4 = data.map(d => d.scenario_4_count || 0);
                        
                        console.log('ğŸ“ˆ å›¾è¡¨æ•°æ®å‡†å¤‡å®Œæˆ:', {
                            æ—¶é—´ç‚¹æ•°é‡: times.length,
                            å‰3ä¸ªæ—¶é—´ç‚¹: times.slice(0, 3),
                            æƒ…å†µ1æ•°æ®: scenario1.slice(0, 5),
                            æƒ…å†µ2æ•°æ®: scenario2.slice(0, 5)
                        });
                        
                        // æ›´æ–°å›¾è¡¨
                        console.log('ğŸ¨ å¼€å§‹æ›´æ–°EChartså›¾è¡¨...');
                        trendChart.setOption({
                            xAxis: { data: times },
                            series: [
                                { data: scenario1 },
                                { data: scenario2 },
                                { data: scenario3 },
                                { data: scenario4 }
                            ]
                        });
                        console.log('âœ… EChartså›¾è¡¨æ›´æ–°å®Œæˆ');
                        
                        // æ›´æ–°é¡µé¢ä¿¡æ¯
                        const pageTimeRange = currentPage === 0 ? '00:00 - 12:00' : '12:00 - 24:00';
                        document.getElementById('pageInfo').textContent = `${currentDate} ${pageTimeRange}`;
                        
                        // æ›´æ–°æŒ‰é’®çŠ¶æ€
                        const todayDate = getBeijingDate(); // åŒ—äº¬æ—¶åŒºçš„ä»Šå¤©æ—¥æœŸ
                        const isToday = currentDate === todayDate;
                        
                        // è·å–åŒ—äº¬æ—¶é—´çš„å½“å‰å°æ—¶
                        const now = new Date();
                        const beijingTime = new Date(now.getTime() + (now.getTimezoneOffset() * 60000) + (8 * 3600000));
                        const currentHour = beijingTime.getHours();
                        
                        // å‰12å°æ—¶æŒ‰é’®: ä»…åœ¨ç¬¬0é¡µ(00:00-12:00)æ—¶ç¦ç”¨
                        document.getElementById('prevPage').disabled = currentPage === 0;
                        
                        // å12å°æ—¶æŒ‰é’®: 
                        // - å¦‚æœæ˜¯ä»Šå¤©ä¸”å½“å‰æ—¶é—´<12:00ï¼Œåœ¨ç¬¬0é¡µæ—¶ç¦ç”¨
                        // - å¦‚æœæ˜¯å†å²æ—¥æœŸï¼Œåœ¨ç¬¬1é¡µæ—¶ç¦ç”¨
                        let nextPageDisabled;
                        if (isToday) {
                            // ä»Šå¤©çš„æƒ…å†µ
                            if (currentHour < 12) {
                                // å½“å‰æ—¶é—´åœ¨å‰12å°æ—¶å†…ï¼Œåªæœ‰ç¬¬0é¡µæ•°æ®ï¼Œç¦ç”¨å12å°æ—¶æŒ‰é’®
                                nextPageDisabled = true;
                            } else {
                                // å½“å‰æ—¶é—´åœ¨å12å°æ—¶å†…ï¼Œå¯ä»¥æŸ¥çœ‹ä¸¤é¡µï¼Œåœ¨ç¬¬1é¡µæ—¶ç¦ç”¨
                                nextPageDisabled = currentPage === 1;
                            }
                        } else {
                            // å†å²æ—¥æœŸï¼Œå¯ä»¥æŸ¥çœ‹å®Œæ•´24å°æ—¶ï¼Œåœ¨ç¬¬1é¡µæ—¶ç¦ç”¨
                            nextPageDisabled = currentPage === 1;
                        }
                        
                        document.getElementById('nextPage').disabled = nextPageDisabled;
                        console.log('ğŸ“Š æŒ‰é’®çŠ¶æ€æ›´æ–°:', {
                            æ—¥æœŸ: currentDate,
                            æ˜¯å¦ä»Šå¤©: isToday,
                            å½“å‰å°æ—¶: currentHour,
                            å½“å‰é¡µ: currentPage,
                            å‰12å°æ—¶æŒ‰é’®ç¦ç”¨: currentPage === 0,
                            å12å°æ—¶æŒ‰é’®ç¦ç”¨: nextPageDisabled
                        });
                    } else {
                        console.error('Failed to load trend data:', result.message);
                    }
                })
                .catch(error => {
                    console.error('Error loading trend data:', error);
                });
        }
        
        // æ—¥æœŸé€‰æ‹©å™¨äº‹ä»¶
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–æ—¥æœŸé€‰æ‹©å™¨
            const datePicker = document.getElementById('datePicker');
            datePicker.value = currentDate;
            datePicker.max = getBeijingDate(); // ä½¿ç”¨åŒ—äº¬æ—¶é—´ä½œä¸ºæœ€å¤§æ—¥æœŸ
            
            datePicker.addEventListener('change', function() {
                currentDate = this.value;
                
                // åˆ¤æ–­é€‰æ‹©çš„æ—¥æœŸ
                const todayDate = getBeijingDate();
                const isToday = currentDate === todayDate;
                
                if (isToday) {
                    // å¦‚æœæ˜¯ä»Šå¤©ï¼Œæ ¹æ®å½“å‰æ—¶é—´è‡ªåŠ¨é€‰æ‹©é¡µé¢
                    currentPage = getCurrentPage();
                } else {
                    // å¦‚æœæ˜¯å†å²æ—¥æœŸï¼Œé»˜è®¤æ˜¾ç¤ºå12å°æ—¶ï¼ˆæœ€æ–°æ•°æ®ï¼‰
                    currentPage = 1;
                }
                
                loadTrendData();
            });
            
            // ç¿»é¡µæŒ‰é’®
            document.getElementById('prevPage').addEventListener('click', function() {
                if (currentPage > 0) {
                    currentPage--;
                    loadTrendData();
                }
            });
            
            document.getElementById('nextPage').addEventListener('click', function(e) {
                console.log('ğŸ”˜ å12å°æ—¶æŒ‰é’®ç‚¹å‡»äº‹ä»¶è§¦å‘');
                console.log('  å½“å‰é¡µ:', currentPage);
                console.log('  æŒ‰é’®disabledçŠ¶æ€:', document.getElementById('nextPage').disabled);
                console.log('  æ¡ä»¶æ£€æŸ¥ (currentPage < 1):', currentPage < 1);
                
                if (currentPage < 1) {
                    console.log('  âœ… æ¡ä»¶æ»¡è¶³ï¼Œåˆ‡æ¢åˆ°å12å°æ—¶');
                    currentPage++;
                    loadTrendData();
                } else {
                    console.log('  âŒ æ¡ä»¶ä¸æ»¡è¶³ï¼Œæ— æ³•åˆ‡æ¢');
                }
            });
            
            // åˆå§‹åŒ–è¶‹åŠ¿å›¾
            console.log('ğŸš€ é¡µé¢åˆå§‹åŒ–:', {
                å½“å‰æ—¥æœŸ: currentDate,
                å½“å‰é¡µé¢: currentPage,
                é¡µé¢è¯´æ˜: currentPage === 0 ? '00:00-12:00 (å‰12å°æ—¶)' : '12:00-24:00 (å12å°æ—¶)'
            });
            
            console.log('ğŸ“Š å¼€å§‹åˆå§‹åŒ–ECharts...');
            try {
                initTrendChart();
                console.log('âœ… EChartsåˆå§‹åŒ–æˆåŠŸ');
            } catch (error) {
                console.error('âŒ EChartsåˆå§‹åŒ–å¤±è´¥:', error);
            }
            
            console.log('ğŸ“¡ å¼€å§‹åŠ è½½è¶‹åŠ¿æ•°æ®...');
            try {
                loadTrendData();
                console.log('âœ… loadTrendData()è°ƒç”¨æˆåŠŸ');
            } catch (error) {
                console.error('âŒ loadTrendData()è°ƒç”¨å¤±è´¥:', error);
            }
        });
        
        // ç‰ˆæœ¬æ£€æµ‹å’Œç¼“å­˜æç¤º
        (function checkVersion() {
            const VERSION = '2.2'; // æ›´æ–°ç‰ˆæœ¬å·å¼ºåˆ¶åˆ·æ–°
            const prevPageBtn = document.getElementById('prevPage');
            const nextPageBtn = document.getElementById('nextPage');
            
            // æ£€æŸ¥æŒ‰é’®æ–‡æœ¬ï¼Œå¦‚æœæ˜¯æ—§ç‰ˆæœ¬åˆ™æç¤º
            if (prevPageBtn && prevPageBtn.textContent.includes('å‰12å°æ—¶')) {
                console.error('âš ï¸ æ£€æµ‹åˆ°æ—§ç‰ˆæœ¬é¡µé¢ï¼è¯·æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ï¼');
                console.log('æ¸…é™¤æ–¹æ³•: Ctrl+Shift+R (Windows) æˆ– Cmd+Shift+R (Mac)');
                
                // åœ¨é¡µé¢é¡¶éƒ¨æ˜¾ç¤ºçº¢è‰²æç¤ºæ¡
                const alertDiv = document.createElement('div');
                alertDiv.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; background: #ef4444; color: white; padding: 15px; text-align: center; z-index: 10000; font-weight: bold;';
                alertDiv.innerHTML = 'âš ï¸ é¡µé¢ç‰ˆæœ¬è¿‡æ—§ï¼è¯·æŒ‰ Ctrl+Shift+R å¼ºåˆ¶åˆ·æ–°æ¸…é™¤ç¼“å­˜ âš ï¸';
                document.body.insertBefore(alertDiv, document.body.firstChild);
            } else {
                console.log('âœ… é¡µé¢ç‰ˆæœ¬: v' + VERSION + ' (æœ€æ–°)');
                console.log('âœ… æŒ‰é’®æ ‡ç­¾å·²æ›´æ–°: â† æ›´æ—© / æ›´æ™š â†’');
            }
        })();
        
        // Initial load
        loadData();
        
        // Auto-refresh every 30 seconds
        setInterval(loadData, 30000);
        setInterval(loadTrendData, 180000); // è¶‹åŠ¿å›¾æ¯3åˆ†é’Ÿåˆ·æ–°
    </script>
</body>
</html>
